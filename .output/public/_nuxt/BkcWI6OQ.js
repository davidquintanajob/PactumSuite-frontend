import{_ as Te,r as h,k as J,y as $,F as N,z as _,A as e,E as ge,B as S,C as te,M as Le,o as Oe,N as He,I as Ce,T as Ae,O as Ue,P as je,K as R,L as H,H as be,n as Me,q as _e,h as ve,Q as Je,G as ze,R as xe}from"#entry";import{S as qe}from"./CC2Sf2Ne.js";import{N as We}from"./DTHag2Fn.js";import{D as Be}from"./DIpJa8iN.js";import{_ as Ie}from"./CP6NTKUH.js";import{_ as Re}from"./DWLPyndB.js";import{_ as Fe}from"./BYdYousv.js";import"./BzLCLO6P.js";const Ge={key:0,class:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center"},Ke={class:"bg-white rounded-lg p-6 w-full max-w-3xl max-h-[80vh] overflow-y-auto"},Qe={class:"mb-4"},Ye={class:"text-sm text-gray-600"},Xe={class:"font-medium"},Ze={class:"text-sm text-gray-600"},et={class:"font-medium"},tt={__name:"VentaModal",props:{modelValue:{type:Boolean,required:!0},listaVenta:{type:Object,default:()=>({})}},emits:["update:modelValue"],setup(D,{emit:ie}){const k=D,f=ie,T=h(1);function y(C){if(!C)return"";const m=String(C).substring(0,8).split(":");if(m.length<2)return C;let F=parseInt(m[0],10);const z=m[1],j=F>=12?"PM":"AM";return F=F%12,F===0&&(F=12),`${F}:${z} ${j}`}const M=[{key:"fecha",label:"Fecha"},{key:"hora",label:"Hora"},{key:"productoNombre",label:"Producto"},{key:"cantidad",label:"Cantidad"},{key:"precio_cobrado",label:"Precio Cobrado"},{key:"total",label:"Total"},{key:"forma_pago",label:"Forma Pago"},{key:"usuario",label:"Usuario"}],P=J(()=>(Array.isArray(k.listaVenta?.ventas)?k.listaVenta.ventas:[]).map(b=>{const m=b.fecha_hora?b.fecha_hora.substring(0,10):b.createdAt?b.createdAt.substring(0,10):"",F=b.fecha_hora?b.fecha_hora.substring(11,19):b.createdAt?b.createdAt.substring(11,19):"",z=y(F);return{fecha:m,hora:z,productoNombre:b.producto?b.producto.nombre:b.servicio?b.servicio.nombre:"",cantidad:b.cantidad,precio_cobrado:b.precio_cobrado,total:(Number(b.cantidad||0)*(parseFloat(b.precio_cobrado)||0)).toFixed(2),usuario:b.usuario?b.usuario.nombre_usuario:"",forma_pago:b.forma_pago||""}})),U=J(()=>P.value.length);function x(){f("update:modelValue",!1)}return(C,b)=>D.modelValue?(_(),$("div",Ge,[e("div",Ke,[e("div",{class:"flex justify-between items-center mb-6"},[b[1]||(b[1]=e("h2",{class:"text-2xl font-bold text-gray-800"},"Detalles de Lista de Ventas",-1)),e("button",{onClick:x,class:"text-gray-500 hover:text-gray-700"},[...b[0]||(b[0]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",Qe,[e("div",Ye,[b[2]||(b[2]=ge("Nota: ",-1)),e("span",Xe,S(D.listaVenta?.nota||"-"),1)]),e("div",Ze,[b[3]||(b[3]=ge("Creado: ",-1)),e("span",et,S(D.listaVenta?.createdAt?D.listaVenta.createdAt.substring(0,19).replace("T"," "):"-"),1)])]),e("div",null,[te(Be,{columns:M,items:P.value,"is-loading":!1,"items-per-page":5,"total-items":U.value,"current-page":T.value},null,8,["items","total-items","current-page"])])])])):N("",!0)}},ot=Te(tt,[["__scopeId","data-v-5a98fab4"]]),at={key:0,class:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center"},rt={key:0,class:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/50"},nt={class:"flex justify-between items-center mb-6"},st={class:"text-2xl font-bold text-gray-800"},lt=["disabled"],it={class:"fixed inset-0 z-[9999] flex items-center justify-center pointer-events-none"},dt={class:"w-full max-w-xl pointer-events-auto px-4"},ct={class:"fixed top-24 left-1/2 transform -translate-x-1/2 z-[10000] w-full max-w-md px-4 pointer-events-auto"},ut={key:0,class:"fixed inset-0 z-[10000] flex items-center justify-center bg-black bg-opacity-80 p-4"},pt={class:"w-full max-w-lg bg-black rounded-lg overflow-hidden relative"},mt={key:2,class:"absolute inset-0 bg-white bg-opacity-60 z-50 flex items-center justify-center"},ft={class:"mb-4"},bt={class:"grid grid-cols-1 gap-4"},vt={class:"hidden sm:flex items-center gap-2 w-full"},gt=["src"],yt={class:"flex items-end gap-2 flex-1"},xt={class:"flex-1 min-w-[200px]"},ht={class:"min-w-[70px]"},_t=["onUpdate:modelValue","disabled"],wt={class:"min-w-[85px]"},kt=["onUpdate:modelValue","disabled"],Ct={key:0,class:"min-w-[85px]"},St={class:"block text-xs text-gray-600 mb-1"},$t={class:"text-xs text-gray-500"},Vt=["max","onUpdate:modelValue","disabled"],Nt=["onClick"],Tt={class:"block sm:hidden"},Dt={class:"flex items-center gap-2 mb-2"},Et=["src"],Pt={class:"flex-1"},At=["onClick"],Ut={class:"grid grid-cols-2 gap-2 mb-2"},jt=["onUpdate:modelValue","disabled"],It=["onUpdate:modelValue","disabled"],Ot={key:0},Lt={class:"block text-xs text-gray-600 mb-1"},Ft={class:"text-xs text-gray-500"},Mt=["max","onUpdate:modelValue","disabled"],zt={class:"mt-3 flex justify-between items-center"},Bt={class:"flex items-center gap-2"},Rt=["disabled"],Ht={class:"text-sm text-gray-600"},Jt={class:"mt-3"},qt={class:"text-xl font-bold"},Wt={key:0,class:"mt-3 p-3 bg-blue-50 rounded border border-blue-200"},Gt={class:"text-lg font-bold text-blue-600"},Kt={class:"text-sm text-gray-600 mt-1"},Qt={class:"mt-4"},Yt=["disabled"],Xt={class:"mt-3"},Zt={class:"flex flex-wrap w-full gap-2 md:max-w-xs"},eo=["onClick","disabled"],to={class:"flex justify-end gap-3"},oo=["disabled"],ao=["disabled"],ro={__name:"VentaModalSell",props:{modelValue:{type:Boolean,required:!0},mode:{type:String,default:"create"},initialData:{type:Object,default:null}},emits:["update:modelValue","submit","open-comprobante"],setup(D,{emit:ie}){const k=Me(),f=D,T=ie,y=h([]),M=h(""),P=h(""),U=["Efectivo CUP","Efectivo USD","Transferencia CUP","Transferencia USD","Efectivo y Transferencia"],x=h(U[0]),C=h(!1),b=h(null),m=h(null),F=h(!1),z=h(null),j=h(null),pe={render(){return ve("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[ve("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 9V2h12v7"}),ve("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18h12v-5H6v5z"})])}},oe=h(!1),Q=h(null);let Y=null,de=null;const n=h(1);function d(){try{const a=localStorage.getItem("config");if(a){const t=JSON.parse(a),r=Number(t?.cambio_moneda);n.value=r&&r>0?r:1}else n.value=1}catch{n.value=1}}const s=J(()=>{if(y.value.length===0)return!0;const a=y.value[y.value.length-1];return!!(a&&a.id_producto)}),w=J(()=>f.mode==="view"),B=J(()=>f.mode==="edit"?"Editar Venta":f.mode==="view"?"Ver Venta":"Nueva Venta"),ae=J(()=>y.value.reduce((a,t)=>{if(!t||!t.id_producto)return a;const r=Number(t.cantidad||0),u=parseFloat(t.precio_cobrado)||0;return a+r*u},0)),X=J(()=>x.value!=="Efectivo y Transferencia"?0:y.value.reduce((a,t)=>{if(!t||!t.id_producto)return a;const r=Number(t.cantidad_pagada_transferencia_cup||0);return a+r},0));Le(()=>y.value,()=>{y.value.forEach(a=>{if(a&&a.id_producto){const t=Number(a.cantidad||0)*Number(a.precio_cobrado||0);Number(a.cantidad_pagada_transferencia_cup)>t&&(a.cantidad_pagada_transferencia_cup=t),Number(a.cantidad_pagada_transferencia_cup)<0&&(a.cantidad_pagada_transferencia_cup=0)}})},{deep:!0});function ye(){return{_id:`${Date.now()}_${Math.random().toString(36).slice(2,8)}`,id_producto:"",cantidad:1,costo_venta:0,precio_original_venta:0,precio_cobrado:0,initialLabel:"",cantidad_pagada_transferencia_cup:0}}function re(){y.value.push(ye())}function we(a){y.value[a]&&y.value.splice(a,1)}function Se(a,t){if(!a){y.value[t]&&(y.value[t].id_producto="",y.value[t].initialLabel="",y.value[t].precio_cobrado=0,y.value[t].productoObj=null);return}y.value[t].id_producto=a.id_producto||a.id_producto,y.value[t].initialLabel=a.nombre||a.label||"",y.value[t].productoObj=a;const r=a.precio??a.precio_cobrado??a.precioVenta??null;r!=null&&(y.value[t].precio_cobrado=Number(r)||0),t===y.value.length-1&&re()}function ce(a){try{if(a&&a.productoObj&&a.productoObj.foto){const t=a.productoObj.foto;return typeof t=="string"&&(t.startsWith("http")||t.startsWith("data:"))?t:`${k.public.backendHost}${t}`}}catch{}return"/image.png"}function $e(a){try{a.target.src="/image.png",a.target.style.background="white"}catch{}}function ne(){T("update:modelValue",!1),y.value=[],P.value="",x.value=U[0],he()}function De(a){const t=new Date(a),r=p=>String(p).padStart(2,"0"),u=t.getFullYear(),c=r(t.getMonth()+1),v=r(t.getDate()),q=r(t.getHours()),A=r(t.getMinutes()),I=r(t.getSeconds());return`${u}-${c}-${v}T${q}:${A}:${I}`}function Ve(){oe.value=!1;try{if(de){try{de.reset()}catch(a){console.warn("error resetting codeReader",a)}de=null}if(Q.value){try{Q.value.pause()}catch{}try{Q.value.srcObject=null}catch{}}if(Y){try{Y.getTracks().forEach(a=>a.stop())}catch{}Y=null}}catch(a){console.error("stopScanner",a)}}function he(){m.value=null,b.value=null}function Z(a){return Number(a||0).toFixed(2)}function Ee(a){if(!a)return"-";try{return new Date(a).toLocaleString()}catch{return a}}function Pe(a){return a?Array.isArray(a.ventas)?a.ventas:Array.isArray(a.data)&&a.data.length&&Array.isArray(a.data[0].ventas)?a.data[0].ventas:[]:[]}function Ne(a){const t=Pe(a),r=t.reduce((p,g)=>p+(Number(g.precio_cobrado)||0)*(Number(g.cantidad)||0),0),u=t.map(p=>{const g=p.producto&&p.producto.nombre||p.servicio&&p.servicio.nombre||p.nombre||"---",se=p.cantidad||0,fe=Z(p.precio_cobrado),O=Z((Number(p.precio_cobrado)||0)*(Number(p.cantidad)||0));return`<tr class="border-b"><td class="py-2">${g}</td><td class="py-2 text-right">${se}</td><td class="py-2 text-right">${fe}</td><td class="py-2 text-right">${O}</td></tr>`}).join(`
`),q=`<!doctype html><html><head><meta charset="utf-8"><title>Comprobante</title><style>body{font-family: Helvetica,Arial,sans-serif;padding:20px;color:#111;} table{width:100%;border-collapse:collapse;} th,td{padding:8px;border-bottom:1px solid #eee;} .text-right{text-align:right;} .title{font-weight:700;margin-bottom:8px}</style></head><body><div class="text-center"><div class="title">Comprobante de pago</div></div><div class="mb-4"><div><strong>Fecha creación:</strong> ${Ee(a?.createdAt||a?.created_at||a?.fecha||"")}</div></div><table class="w-full text-sm border-collapse"><thead><tr class="border-b"><th class="text-left py-2">Producto</th><th class="text-right py-2">Cantidad</th><th class="text-right py-2">Precio</th><th class="text-right py-2">Total</th></tr></thead><tbody>${u}</tbody></table><div class="mt-4 text-right"><div><strong>Total:</strong> ${Z(r)}</div></div></body></html>`,A=window.open("","_blank");if(!A)return alert("No se pudo abrir la ventana de impresión. Revisa bloqueadores de ventanas emergentes."),null;A.document.open(),A.document.write(q),A.document.close();const I=()=>{try{A.focus(),A.print()}catch(p){console.warn("Print failed",p)}};return A.onload=()=>setTimeout(I,300),setTimeout(I,800),A}async function i(){F.value=!1;const a=z.value;if(!a){Ne(j.value||null),T("update:modelValue",!1),y.value=[],z.value=null,j.value=null;return}try{C.value=!0,b.value={title:"Cargando comprobante",description:"Obteniendo lista de venta...",type:"info"};const t=localStorage.getItem("token"),r=await fetch(`${k.public.backendHost}/ListaVenta/${a}`,{method:"GET",headers:{Accept:"application/json",Authorization:t}});if(r.status===401){m.value={title:"Sesión Expirada",description:"Tu sesión ha expirado.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>_e("/"),2e3);return}if(!r.ok){let c=await r.text();try{c=JSON.parse(c)}catch{}m.value={title:`Error ${r.status}`,description:JSON.stringify(c),type:"error"};return}const u=await r.json();Ne(u),T("update:modelValue",!1),y.value=[],z.value=null,j.value=null}catch(t){console.error("Error fetching lista venta for print:",t),m.value={title:"Error",description:"No se pudo obtener la lista para imprimir.",type:"error"}}finally{C.value=!1,b.value=null}}function o(){F.value=!1,T("update:modelValue",!1),y.value=[],z.value=null,j.value=null,he()}async function l(){let a=null;try{const r=localStorage.getItem("user")||localStorage.getItem("usuario");if(r){const u=JSON.parse(r);a=u?.id_usuario||u?.id||null,M.value=u?.nombre||u?.nombre_usuario||""}}catch{}const t=y.value.map(r=>({id_venta:r.id_venta||void 0,id_producto:r.id_producto,id_usuario:a,cantidad:Number(r.cantidad)||1,costo_venta:r.costo_venta||0,precio_original_venta:r.precio_original_venta||0,precio_cobrado:r.precio_cobrado||0}));if(f.mode==="create"){const r=y.value.filter(p=>p&&p.id_producto);if(!r||r.length===0){m.value={title:"Error",description:"La lista debe contener al menos 1 elemento con producto seleccionado.",type:"error"};return}for(const p of r){if(Number(p.cantidad)<0||Number(p.precio_cobrado)<0){m.value={title:"Error",description:"Cantidad y Precio Cobrado deben ser >= 0 en cada elemento.",type:"error"};return}if(x.value==="Efectivo y Transferencia"){const g=Number(p.cantidad)*Number(p.precio_cobrado);if(Number(p.cantidad_pagada_transferencia_cup||0)>g){m.value={title:"Error",description:`La cantidad pagada por transferencia en un elemento no puede ser mayor que su subtotal (${Z(g)}).`,type:"error"};return}}}const u=localStorage.getItem("token"),c=localStorage.getItem("user")||localStorage.getItem("usuario");let v=null;try{c&&(v=JSON.parse(c)?.id_usuario||JSON.parse(c)?.id||null)}catch{}const q=Date.now(),A=De(q);d();const I={nota:P.value||"",ventas:r.map(p=>({id_producto:Number(p.id_producto),id_usuario:v,cambioUSD_al_vender:n.value,cantidad:Number(p.cantidad)||0,forma_pago:x.value,cantidad_pagada_transferencia_cup:x.value==="Efectivo y Transferencia"&&Number(p.cantidad_pagada_transferencia_cup)||0,costo_venta:p.productoObj?Number(p.productoObj.costo||0):Number(p.costo_venta||0),precio_original_venta:p.productoObj?Number(p.productoObj.precio||0):Number(p.precio_original_venta||0),precio_cobrado:Number(p.precio_cobrado)||0,fecha_hora:A}))};console.log(JSON.stringify(I,null,2)),C.value=!0,b.value={title:"Creando ventas",description:"Enviando datos al servidor...",type:"info"};try{const p=await fetch(`${k.public.backendHost}/ListaVenta/createWithVentas`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:u},body:JSON.stringify(I)});if(p.status===401){C.value=!1,b.value=null,m.value={title:"Sesión Expirada",description:"Tu sesión ha expirado.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>_e("/"),2e3);return}let g=null;try{g=await p.json()}catch{g=null}if(!p.ok){C.value=!1,b.value=null;let O="Error desconocido";g&&g.errors&&Array.isArray(g.errors)?O=g.errors.join(`
• `):g&&typeof g.error=="string"?O=g.error:g&&(g.message||g.description)?O=g.message||g.description:g&&(O=JSON.stringify(g)),m.value={title:`Error ${p.status}`,description:O,type:"error"};return}T("submit",{mode:"create",items:I.ventas,nota:I.nota,formaPago:x.value}),m.value={title:"Éxito",description:"Ventas creadas correctamente.",type:"success"};let se=null;try{j.value=g||null,z.value=g&&(g.id_lista_venta||g.id||g.data&&(g.data.id_lista_venta||g.data.id))||null}catch{z.value=null,j.value=null}if(g&&(Array.isArray(g.ventas)||Array.isArray(g.data)||Array.isArray(g.lista)||Array.isArray(g.items)))se=g;else{const O=(r||[]).map((W,ue)=>{const me=W.productoObj||W.producto||null,le=me?{nombre:me.nombre||me.name||"",codigo:me.codigo||"",precio:me.precio??me.price}:{nombre:W.initialLabel||""};return Object.assign({},W,{producto:le})});se={id_lista_venta:z.value||null,nota:I.nota||"",fecha:new Date().toISOString(),ventas:O}}y.value=[];try{T("open-comprobante",se)}catch(O){console.warn("open-comprobante emit failed",O)}T("update:modelValue",!1),setTimeout(()=>{m.value=null,b.value=null},2500)}catch(p){console.error("Error creating ventas:",p),m.value={title:"Error",description:"Ocurrió un error al crear las ventas.",type:"error"}}finally{C.value=!1,b.value=null}return}if(f.mode==="edit"){const r=f.initialData&&(f.initialData.id_lista_venta||f.initialData.id)||null;T("submit",{mode:"edit",id_lista_venta:r,items:t,nota:P.value,formaPago:x.value})}else T("submit",{mode:"create",items:t,nota:P.value,formaPago:x.value});T("update:modelValue",!1),y.value=[]}return Oe(()=>{re(),d();try{const a=localStorage.getItem("user")||localStorage.getItem("usuario");if(a){const t=JSON.parse(a);M.value=t?.nombre||t?.nombre_usuario||""}}catch{}}),He(()=>{Ve()}),Le(()=>f.modelValue,a=>{if(a)if(d(),(f.mode==="edit"||f.mode==="view")&&f.initialData){y.value=Array.isArray(f.initialData.ventas)?f.initialData.ventas.map(t=>({_id:`${Date.now()}_${Math.random().toString(36).slice(2,8)}`,id_venta:t.id_venta,id_producto:t.id_producto||t.producto&&t.producto.id_producto||"",cantidad:t.cantidad||1,costo_venta:t.costo_venta||0,precio_original_venta:t.precio_original_venta||0,precio_cobrado:Number(t.precio_cobrado)||0,forma_pago:t.forma_pago||"",initialLabel:t.producto&&t.producto.nombre||"",productoObj:t.producto||null,cantidad_pagada_transferencia_cup:Number(t.cantidad_pagada_transferencia_cup)||0})):[],P.value=f.initialData.nota||"";try{let t="";y.value[0]&&y.value[0].forma_pago?t=y.value[0].forma_pago:f.initialData&&(f.initialData.forma_pago||f.initialData.formaPago)&&(t=f.initialData.forma_pago||f.initialData.formaPago);let r="";if(t&&typeof t=="object"?r=t.nombre||t.name||"":r=String(t||""),r=r.trim(),!r)x.value=U[0];else{const c=r.toLowerCase(),v=U.find(q=>q.toLowerCase()===c);v?x.value=v:c.includes("efectivo")&&c.includes("transfer")?x.value="Efectivo y Transferencia":c.includes("transfer")&&c.includes("usd")?x.value="Transferencia USD":c.includes("transfer")&&c.includes("cup")||c.includes("transfer")?x.value="Transferencia CUP":c.includes("efectivo")&&c.includes("usd")?x.value="Efectivo USD":c.includes("efectivo")&&c.includes("cup")||c.includes("efectivo")?x.value="Efectivo CUP":x.value=U[0]}let u=0;f.initialData&&typeof f.initialData.cantidad_pagada_transferencia_cup<"u"?u=Number(f.initialData.cantidad_pagada_transferencia_cup)||0:f.initialData&&f.initialData.data&&typeof f.initialData.data.cantidad_pagada_transferencia_cup<"u"&&(u=Number(f.initialData.data.cantidad_pagada_transferencia_cup)||0)}catch{x.value=U[0]}}else f.mode==="create"?(y.value=[ye()],P.value="",x.value=U[0]):(y.value.length||re(),x.value=U[0],P.value="")}),(a,t)=>D.modelValue?(_(),$("div",at,[C.value?(_(),$("div",rt,[...t[3]||(t[3]=[e("div",{class:"bg-white rounded-lg p-8 shadow-xl flex flex-col items-center gap-4"},[e("div",{class:"w-12 h-12 border-4 border-gray-200 border-t-primary rounded-full animate-spin"}),e("p",{class:"text-gray-700 font-medium"},"Procesando, espere...")],-1)])])):N("",!0),e("div",{class:be(["bg-white rounded-lg p-6 w-full max-w-7xl max-h-[80vh] overflow-y-auto",C.value&&"pointer-events-none opacity-50"])},[e("div",nt,[e("h2",st,S(B.value),1),e("button",{onClick:ne,disabled:C.value,class:"text-gray-500 hover:text-gray-700 disabled:opacity-50 disabled:cursor-not-allowed"},[...t[4]||(t[4]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,lt)]),m.value||b.value?(_(),Ce(Ae,{key:0,to:"body"},[e("div",it,[e("div",dt,[m.value?(_(),Ce(Ie,{key:0,title:m.value.title||"Error",description:m.value.description||"",type:m.value.type||"error",onClose:he},null,8,["title","description","type"])):(_(),Ce(Ie,{key:1,title:b.value.title||"Cargando",description:b.value.description||"",type:b.value.type||"warning",persistent:!0,onClose:he},null,8,["title","description","type"]))])])])):N("",!0),F.value?(_(),Ce(Ae,{key:1,to:"body"},[e("div",ct,[te(Re,{title:"¿Deseas imprimir la venta creada?",description:"¿Deseas imprimir la lista de venta que acabas de crear?",icon:pe,type:"warning",onConfirm:i,onClose:o})])])):N("",!0),(_(),Ce(Ae,{to:"body"},[oe.value?(_(),$("div",ut,[e("div",pt,[e("button",{onClick:Ve,class:"absolute top-2 right-2 z-20 bg-white/80 rounded-full p-1"},[...t[5]||(t[5]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-gray-800",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M10 9.293l4.146-4.147a.5.5 0 11.708.708L10.707 10l4.147 4.146a.5.5 0 01-.708.708L10 10.707l-4.146 4.147a.5.5 0 01-.708-.708L9.293 10 5.146 5.854a.5.5 0 11.708-.708L10 9.293z","clip-rule":"evenodd"})],-1)])]),e("video",{ref_key:"videoEl",ref:Q,autoplay:"",muted:"",playsinline:"",class:"w-full h-72 object-cover bg-black"},null,512),t[6]||(t[6]=e("div",{class:"absolute inset-0 flex items-center justify-center pointer-events-none"},[e("div",{class:"w-3/4 h-1/3 border-2 border-white/70 rounded"})],-1)),t[7]||(t[7]=e("div",{class:"absolute bottom-2 left-0 right-0 text-center text-white text-sm"},"Apunta al código QR o de barras",-1))])])):N("",!0)])),C.value?(_(),$("div",mt,[...t[8]||(t[8]=[e("div",{class:"text-center"},[e("div",{class:"loader ease-linear rounded-full border-4 border-t-4 border-gray-200 h-12 w-12 mb-4"}),e("div",{class:"text-sm text-gray-700"},"Enviando datos...")],-1)])])):N("",!0),e("div",null,[e("div",ft,[e("div",bt,[(_(!0),$(Ue,null,je(y.value,(r,u)=>(_(),$("div",{key:r._id,class:"p-2 sm:p-3 border rounded bg-gray-50"},[e("div",vt,[e("img",{src:ce(r),onError:t[0]||(t[0]=c=>$e(c)),class:"w-10 h-10 rounded-full object-cover bg-white border flex-shrink-0",alt:"foto-producto"},null,40,gt),e("div",yt,[e("div",xt,[t[9]||(t[9]=e("label",{class:"block text-xs text-gray-600 mb-1"},"Producto",-1)),te(Fe,{modelValue:r.id_producto,"onUpdate:modelValue":c=>r.id_producto=c,disabled:w.value,endpoint:"/producto/filterProductos/1/10",method:"POST","search-key":"nombre","label-key":"nombre","value-key":"id_producto","initial-label":r.initialLabel,placeholder:"Buscar...",onProductoSeleccionado:c=>Se(c,u)},null,8,["modelValue","onUpdate:modelValue","disabled","initial-label","onProductoSeleccionado"])]),e("div",ht,[t[10]||(t[10]=e("label",{class:"block text-xs text-gray-600 mb-1"},"Cant.",-1)),R(e("input",{type:"number","onUpdate:modelValue":c=>r.cantidad=c,disabled:w.value,min:"1",class:"w-full px-2 py-1 rounded border text-center text-sm"},null,8,_t),[[H,r.cantidad,void 0,{number:!0}]])]),e("div",wt,[t[11]||(t[11]=e("label",{class:"block text-xs text-gray-600 mb-1"},"Precio",-1)),R(e("input",{type:"number",step:"0.01","onUpdate:modelValue":c=>r.precio_cobrado=c,disabled:w.value,class:"w-full px-2 py-1 rounded border text-center text-sm"},null,8,kt),[[H,r.precio_cobrado,void 0,{number:!0}]])]),x.value==="Efectivo y Transferencia"?(_(),$("div",Ct,[e("label",St,[t[12]||(t[12]=ge("Transfer. ",-1)),e("span",$t,"Límite: CUP "+S(Z(Number(r.cantidad||0)*Number(r.precio_cobrado||0))),1)]),R(e("input",{type:"number",step:"0.01",min:"0",max:Number(r.cantidad||0)*Number(r.precio_cobrado||0),"onUpdate:modelValue":c=>r.cantidad_pagada_transferencia_cup=c,disabled:w.value,class:"w-full px-2 py-1 rounded border text-center text-sm"},null,8,Vt),[[H,r.cantidad_pagada_transferencia_cup,void 0,{number:!0}]])])):N("",!0),w.value?N("",!0):(_(),$("button",{key:1,type:"button",onClick:c=>we(u),class:"px-2 py-1 bg-red-500 text-white rounded flex items-center gap-1 text-sm hover:bg-red-600 flex-shrink-0",title:"Eliminar"},[...t[13]||(t[13]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6M9 7V4a1 1 0 011-1h4a1 1 0 011 1v3"})],-1)])],8,Nt))])]),e("div",Tt,[e("div",Dt,[e("img",{src:ce(r),onError:t[1]||(t[1]=c=>$e(c)),class:"w-12 h-12 rounded-full object-cover bg-white border flex-shrink-0",alt:"foto-producto"},null,40,Et),e("div",Pt,[t[14]||(t[14]=e("label",{class:"block text-xs text-gray-600 mb-1"},"Producto",-1)),te(Fe,{modelValue:r.id_producto,"onUpdate:modelValue":c=>r.id_producto=c,disabled:w.value,endpoint:"/producto/filterProductos/1/10",method:"POST","search-key":"nombre","label-key":"nombre","value-key":"id_producto","initial-label":r.initialLabel,placeholder:"Buscar...",onProductoSeleccionado:c=>Se(c,u)},null,8,["modelValue","onUpdate:modelValue","disabled","initial-label","onProductoSeleccionado"])]),w.value?N("",!0):(_(),$("button",{key:0,type:"button",onClick:c=>we(u),class:"px-2 py-1 bg-red-500 text-white rounded text-sm hover:bg-red-600 flex-shrink-0"},[...t[15]||(t[15]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6M9 7V4a1 1 0 011-1h4a1 1 0 011 1v3"})],-1)])],8,At))]),e("div",Ut,[e("div",null,[t[16]||(t[16]=e("label",{class:"block text-xs text-gray-600 mb-1"},"Cantidad",-1)),R(e("input",{type:"number","onUpdate:modelValue":c=>r.cantidad=c,disabled:w.value,min:"1",class:"w-full px-2 py-1 rounded border text-center text-sm"},null,8,jt),[[H,r.cantidad,void 0,{number:!0}]])]),e("div",null,[t[17]||(t[17]=e("label",{class:"block text-xs text-gray-600 mb-1"},"Precio",-1)),R(e("input",{type:"number",step:"0.01","onUpdate:modelValue":c=>r.precio_cobrado=c,disabled:w.value,class:"w-full px-2 py-1 rounded border text-center text-sm"},null,8,It),[[H,r.precio_cobrado,void 0,{number:!0}]])])]),x.value==="Efectivo y Transferencia"?(_(),$("div",Ot,[e("label",Lt,[t[18]||(t[18]=ge("A Transferencia ",-1)),e("span",Ft,"Límite: CUP "+S(Z(Number(r.cantidad||0)*Number(r.precio_cobrado||0))),1)]),R(e("input",{type:"number",step:"0.01",min:"0",max:Number(r.cantidad||0)*Number(r.precio_cobrado||0),"onUpdate:modelValue":c=>r.cantidad_pagada_transferencia_cup=c,disabled:w.value,class:"w-full px-2 py-1 rounded border text-center text-sm"},null,8,Mt),[[H,r.cantidad_pagada_transferencia_cup,void 0,{number:!0}]])])):N("",!0)])]))),128))]),e("div",zt,[e("div",Bt,[w.value?N("",!0):(_(),$("button",{key:0,type:"button",onClick:re,disabled:!s.value,class:"px-4 py-2 bg-primary text-neutral rounded disabled:opacity-50"},"+ Agregar elemento",8,Rt))]),e("div",Ht,"Usuario: "+S(M.value||"-"),1)]),e("div",Jt,[t[19]||(t[19]=e("div",{class:"text-sm font-medium text-gray-700"},"Total a cobrar",-1)),e("div",qt,"CUP "+S(Z(ae.value))+" - USD: "+S(Z(ae.value/n.value)),1)]),x.value==="Efectivo y Transferencia"?(_(),$("div",Wt,[t[20]||(t[20]=e("div",{class:"text-sm font-medium text-gray-700"},"Total pagado por transferencia",-1)),e("div",Gt,"CUP "+S(Z(X.value)),1),e("div",Kt,"Efectivo: CUP "+S(Z(ae.value-X.value)),1)])):N("",!0),e("div",Qt,[t[21]||(t[21]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Nota (opcional)",-1)),R(e("textarea",{"onUpdate:modelValue":t[2]||(t[2]=r=>P.value=r),disabled:w.value,class:"w-full px-3 py-2 rounded border",rows:"2",placeholder:"Nota para estas ventas"},null,8,Yt),[[H,P.value]])]),e("div",Xt,[t[22]||(t[22]=e("div",{class:"mb-1 text-sm font-medium text-gray-700"},"Forma de pago",-1)),e("div",Zt,[(_(),$(Ue,null,je(U,r=>e("button",{key:r,type:"button",onClick:u=>x.value=r,disabled:w.value,class:be(["flex-1 px-4 py-2 rounded-lg font-medium transition-all duration-300 text-center",x.value===r?"text-neutral bg-primary":"text-dark bg-secondary"])},S(r),11,eo)),64))])])]),e("div",to,[e("button",{onClick:ne,disabled:C.value,class:"px-4 py-2 bg-gray-100 rounded disabled:opacity-50 disabled:cursor-not-allowed"},S(w.value?"Cerrar":"Cancelar"),9,oo),w.value?N("",!0):(_(),$("button",{key:0,onClick:l,disabled:C.value,class:"px-4 py-2 bg-primary text-white rounded disabled:opacity-50 disabled:cursor-not-allowed transition-all"},S(C.value?f.mode==="edit"?"Guardando...":"Creando...":f.mode==="edit"?"Guardar cambios":"Crear Ventas"),9,ao))])])],2)])):N("",!0)}},no=Te(ro,[["__scopeId","data-v-a62a7cdf"]]),so=Je("/whasapChanel.png"),lo={key:0,class:"fixed inset-0 z-[12000] flex items-center justify-center"},io={class:"bg-white rounded-md shadow-lg max-w-[90%] w-[400px] mx-auto z-10 p-4"},co={class:"overflow-auto max-h-[60vh] p-2"},uo={class:"receipt-header text-center mb-3"},po={class:"text-sm text-gray-600 mt-1"},mo={class:"text-xs font-semibold mt-1 uppercase"},fo={key:0,class:"text-xs font-semibold mt-1"},bo={class:"receipt-body"},vo={class:"w-full text-sm border-collapse"},go={class:"py-2 px-0"},yo={class:"py-2 px-0 text-center"},xo={class:"py-2 px-0 text-right"},ho={class:"border-t border-gray-300 border-dashed"},_o={class:"py-3 px-0 text-center font-bold"},wo={class:"py-3 px-0 text-right font-bold"},ko={key:0,class:"mt-4 pt-3 border-t border-gray-300 border-dashed text-xs"},Co={key:0,class:"mb-1"},So={key:1,class:"mb-1"},$o={__name:"VentaComprobante",props:{modelValue:{type:Boolean,default:!1},data:{type:[Object,Array,null],default:null}},emits:["update:modelValue"],setup(D,{emit:ie}){const k=D,f=ie,T=h(null),y=h("");Oe(()=>{try{const n=localStorage.getItem("usuario");if(n){const d=JSON.parse(n);y.value=d.nombre?d.nombre.toUpperCase():""}}catch(n){console.error("Error al obtener usuario del localStorage:",n),y.value=""}});const M=()=>f("update:modelValue",!1),P=J(()=>{const n=k.data;if(!n)return[];if(Array.isArray(n))return n;const d=["items","lista","detalles","listaVenta","ventas","lista_venta","listaVentaDetalle","detalle","productos"];for(const s of d)if(n[s]&&Array.isArray(n[s]))return n[s];return n.nombre||n.nombre_producto||n.productoNombre?[n]:[]}),U=J(()=>{function n(s){if(!s)return null;if(typeof s=="string")try{return JSON.parse(s)}catch{return null}return typeof s=="object"?s:null}function d(s){return s&&(s.nombre||s.name||s.nombre_producto||s.productoNombre||s.descripcion||s.codigo)||null}return P.value.map(s=>{const w=s.producto??s.producto_detalle??s.producto_obj??null,B=n(w)||null,ae=s.nombre||s.nombre_producto||s.productoNombre||(typeof s.producto=="string"?s.producto:null)||null,X=d(B)||(typeof ae=="string"?ae:null)||"-",ye=Number(s.cantidad??s.qty??s.cant??s.quantity??s.unidades??0),re=Number(s.precio??s.precio_cobrado??s.precio_unitario??s.price??(B&&(B.precio??B.price))??0);return{original:s,nombre:X,cantidad:ye,precio:re}})}),x=J(()=>U.value.reduce((n,d)=>n+Number(d.cantidad||0)*Number(d.precio||0),0)),C=J(()=>U.value.reduce((n,d)=>n+Number(d.cantidad||0),0)),b=J(()=>{try{const n=k.data&&(k.data.fecha||k.data.created_at||k.data.createdAt||k.data.date);return(n?new Date(n):new Date).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return""}});function m(n){const d=n.split("."),s=d[0],w=d[1]||"",B=s.replace(/\B(?=(\d{3})+(?!\d))/g," ");return w?`${B}.${w}`:B}function F(n){const s=Number(n||0).toFixed(2);return`$${m(s)}`}function z(n){const d=Number(n||0),s=Number.isInteger(d)?d.toString():d.toFixed(2);return m(s)}let j=null;function pe(){return window.html2pdf?Promise.resolve():j||(j=new Promise((n,d)=>{const s=document.createElement("script");s.src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js",s.onload=()=>n(),s.onerror=()=>d(new Error("No se pudo cargar html2pdf")),document.head.appendChild(s)}),j)}async function oe(){if(!T.value)throw new Error("Receipt element not found");await pe();const n={margin:[2,2,2,2],filename:`comprobante_${new Date().getTime()}.pdf`,image:{type:"jpeg",quality:.98},html2canvas:{scale:2,useCORS:!0,letterRendering:!0},jsPDF:{unit:"mm",format:[72,150],orientation:"portrait"}};return new Promise((d,s)=>{try{window.html2pdf().set(n).from(T.value).outputPdf("blob").then(w=>d(w)).catch(s)}catch(w){s(w)}})}function Q(){if(!T.value)return;const n=T.value.cloneNode(!0),d=document.createElement("iframe");d.style.position="fixed",d.style.right="0",d.style.bottom="0",d.style.width="0",d.style.height="0",d.style.border="0",document.body.appendChild(d);const s=d.contentWindow.document,w=`
		<style>
			@page { 
				size: 72mm auto; /* Ancho reducido */
				margin: 2mm; /* Margen reducido */
			}
			body { 
				font-family: 'Arial', sans-serif; 
				padding: 0; 
				margin: 0; 
				font-size: 12px;
				line-height: 1.3;
				width: 72mm; /* Ancho reducido */
			}
			.receipt-preview { 
				width: 72mm; /* Ancho reducido */
				max-width: 72mm;
				padding: 6px;
				box-sizing: border-box;
			}
			.receipt-header { 
				text-align: center; 
				margin-bottom: 8px;
			}
			.receipt-header div:first-child {
				font-size: 16px;
				font-weight: bold;
				margin-bottom: 2px;
			}
			.receipt-header div:nth-child(2) {
				font-size: 13px;
				font-weight: normal;
			}
			table {
				width: 100%;
				border-collapse: collapse;
				margin-bottom: 6px;
			}
			th {
				border-bottom: 1px dashed #666;
				padding: 4px 0;
				text-align: left;
				font-weight: bold;
				font-size: 11px;
			}
			td {
				padding: 3px 0;
				vertical-align: top;
				font-size: 11px;
			}
			tbody tr {
				border-bottom: 1px dashed #ddd;
			}
			tfoot tr {
				border-top: 1px dashed #666;
			}
			tfoot td {
				padding-top: 5px;
				padding-bottom: 5px;
				font-weight: bold;
			}
			.additional-info, .footer {
				border-top: 1px dashed #666;
				padding-top: 5px;
				margin-top: 5px;
				font-size: 10px;
			}
			img.qr-code-print {
				max-width: 22.5mm;
				height: auto;
				display: block;
				margin: 6px auto;
			}
			.receipt-body > div {
				text-align: center !important;
			}
			@media print {
				body { 
					background: white;
					color: black;
				}
			}
		</style>`;s.open(),s.write(`<html><head><title>Comprobante de Venta</title>${w}</head><body></body></html>`),s.body.appendChild(n),s.close();try{d.contentWindow.focus(),setTimeout(()=>{try{d.contentWindow.print()}catch(B){console.error("Error al imprimir:",B);const ae=s.documentElement.outerHTML,X=window.open("","_blank");X.document.write(ae),X.document.close(),X.focus(),setTimeout(()=>{X.print(),X.close()},250)}setTimeout(()=>{try{document.body.removeChild(d)}catch{}},1e3)},200)}catch(B){console.error("Impresión fallida:",B);try{document.body.removeChild(d)}catch{}alert("No se pudo iniciar la impresión. Intente descargar el PDF.")}}async function Y(){try{const n=await oe(),d=URL.createObjectURL(n),s=document.createElement("a");s.href=d;const w=new Date().toISOString().slice(0,19).replace(/:/g,"-");s.download=`comprobante_${w}.pdf`,document.body.appendChild(s),s.click(),s.remove(),URL.revokeObjectURL(d)}catch(n){console.error(n),alert("Error generando PDF.")}}async function de(){try{const n=await oe(),d=new File([n],"comprobante.pdf",{type:"application/pdf"});navigator.canShare&&navigator.canShare({files:[d]})?await navigator.share({files:[d],title:"Comprobante",text:"Comprobante de venta"}):confirm("Tu navegador no soporta compartir archivos. ¿Deseas descargar el PDF en su lugar?")&&await Y()}catch(n){console.error(n),alert("No se pudo compartir el PDF.")}}return(n,d)=>D.modelValue?(_(),$("div",lo,[e("div",{class:"absolute inset-0 bg-black/50",onClick:M}),e("div",io,[e("div",{class:"flex justify-between items-center mb-3"},[d[0]||(d[0]=e("h3",{class:"text-lg font-semibold"},"Comprobante",-1)),e("button",{class:"text-sm text-gray-600",onClick:M},"Cerrar ✕")]),e("div",co,[e("div",{ref_key:"receiptEl",ref:T,class:"receipt-preview mx-auto"},[e("div",uo,[d[1]||(d[1]=e("div",{class:"text-xl font-bold mb-1"},"ALMACEN 5TA KILO 12",-1)),d[2]||(d[2]=e("div",{class:"text-base font-semibold text-gray-700"},"Comprobante de Venta",-1)),e("div",po,S(b.value),1),d[3]||(d[3]=e("div",{class:"text-xs text-gray-500 mt-1"},"Dirección: Calle 5ta, #24",-1)),e("div",mo,"Dependiente: "+S(y.value),1),D.data?.codigo||D.data?.folio?(_(),$("div",fo," Folio: "+S(D.data.codigo||D.data.folio||"N/A"),1)):N("",!0)]),e("div",bo,[e("table",vo,[d[5]||(d[5]=e("thead",null,[e("tr",{class:"border-b border-gray-300 border-dashed"},[e("th",{class:"text-left py-2 px-0 font-semibold w-[45%]"},"Producto"),e("th",{class:"text-center py-2 px-0 font-semibold w-[20%]"},"Cant."),e("th",{class:"text-right py-2 px-0 font-semibold w-[35%]"},"Total")])],-1)),e("tbody",null,[(_(!0),$(Ue,null,je(U.value,(s,w)=>(_(),$("tr",{key:w,class:"border-b border-gray-100 border-dashed"},[e("td",go,[e("div",null,S(s.nombre),1)]),e("td",yo,S(z(s.cantidad)),1),e("td",xo,S(F(s.cantidad*s.precio)),1)]))),128))]),e("tfoot",null,[e("tr",ho,[d[4]||(d[4]=e("td",{class:"py-3 px-0 text-left font-bold"},"TOTAL",-1)),e("td",_o,S(z(C.value)),1),e("td",wo,S(F(x.value)),1)])])]),D.data?.cliente||D.data?.metodo_pago?(_(),$("div",ko,[D.data.cliente?(_(),$("div",Co,[d[6]||(d[6]=e("span",{class:"font-semibold"},"Cliente:",-1)),ge(" "+S(D.data.cliente),1)])):N("",!0),D.data.metodo_pago?(_(),$("div",So,[d[7]||(d[7]=e("span",{class:"font-semibold"},"Método de pago:",-1)),ge(" "+S(D.data.metodo_pago),1)])):N("",!0)])):N("",!0),d[8]||(d[8]=ze('<div class="mt-4 pt-3 border-t border-gray-300 border-dashed text-center" data-v-51acbb8f><div class="text-xs font-semibold mb-2" data-v-51acbb8f>Síguenos en WhatsApp</div><img src="'+so+'" alt="Código QR WhatsApp" class="w-24 h-24 mx-auto mb-2 qr-code-print" data-v-51acbb8f><div class="text-xs text-gray-600" data-v-51acbb8f>Escanea para unirte a nuestro<br data-v-51acbb8f>canal de WhatsApp</div></div><div class="mt-4 pt-3 border-t border-gray-300 border-dashed text-center text-xs" data-v-51acbb8f><div class="font-semibold mb-1" data-v-51acbb8f>¡Gracias por su compra!</div><div class="text-gray-500" data-v-51acbb8f>Vuelva pronto</div></div>',2))])],512)]),e("div",{class:"mt-4 flex gap-2 justify-end"},[e("button",{onClick:Q,class:"px-3 py-1 bg-accent text-white rounded-md text-sm"},"Imprimir"),e("button",{onClick:Y,class:"px-3 py-1 bg-blue-600 text-white rounded-md text-sm"},"Descargar"),e("button",{onClick:de,class:"px-3 py-1 bg-green-600 text-white rounded-md text-sm"},"Compartir")])])])):N("",!0)}},Vo=Te($o,[["__scopeId","data-v-51acbb8f"]]),No={class:"min-h-screen bg-gradient-to-br via-secondary/40 from-accent/30 to-neutral"},To={key:0,class:"fixed top-6 left-1/2 transform -translate-x-1/2 z-[9999] w-full max-w-md px-4 pointer-events-none"},Do={key:1,class:"fixed top-24 left-1/2 transform -translate-x-1/2 z-[10000] w-full max-w-md px-4 pointer-events-auto"},Eo={class:"w-[95%] mx-auto px-4 py-4 md:py-4 mt-20 md:mt-0"},Po={class:"bg-white rounded-lg shadow-md p-4"},Ao={class:"mb-4"},Uo={class:"relative"},jo={class:"mb-4"},Io={class:"relative flex w-full max-w-xs"},Oo=["disabled"],Lo=["disabled"],Fo={class:"md:hidden flex justify-between items-center mb-4"},Mo={key:0},zo={class:"grid grid-cols-2 gap-2"},Bo={class:"w-[95%] mx-auto px-4 py-4"},Ro={class:"flex justify-between items-center mb-4"},Ho={class:"mt-4 bg-white rounded-lg shadow-md p-4 w-[95%] mx-auto flex flex-col md:flex-row md:items-center md:justify-between gap-4"},Jo={class:"flex flex-col md:flex-row md:items-center gap-4"},qo={class:"relative w-32"},Wo=["disabled"],Go={class:"text-sm text-gray-600"},Ko={class:"font-semibold"},Qo={key:0,class:"mt-6 bg-white rounded-lg shadow-md p-4 w-[95%] mx-auto"},Yo={class:"text-xl font-semibold mb-4"},Xo={class:"grid grid-cols-2 md:grid-cols-4 gap-4 text-center"},Zo={class:"bg-gray-100 text-gray-800 rounded p-3"},ea={class:"text-lg font-bold"},ta={class:"bg-green-100 text-green-800 rounded p-3"},oa={class:"text-lg font-bold"},aa={key:0,class:"bg-blue-100 text-blue-800 rounded p-3"},ra={class:"text-lg font-bold"},na={key:1,class:"bg-yellow-100 text-yellow-800 rounded p-3"},sa={class:"text-lg font-bold"},la={class:"mt-6 pt-6 border-t border-gray-300"},ia={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},da={class:"grid grid-cols-1 gap-4 text-center"},ca={class:"bg-purple-50 text-purple-800 rounded p-3"},ua={class:"text-lg font-bold"},pa={class:"bg-purple-100 text-purple-800 rounded p-3"},ma={class:"text-lg font-bold"},fa={class:"grid grid-cols-1 gap-4 text-center"},ba={class:"bg-indigo-50 text-indigo-800 rounded p-3"},va={class:"text-lg font-bold"},ga={class:"bg-indigo-100 text-indigo-800 rounded p-3"},ya={class:"text-lg font-bold"},xa={key:2,class:"fixed inset-0 z-[11000] bg-black bg-opacity-50 flex items-center justify-center"},ha={__name:"ventas",setup(D){const ie=Me(),k=h({nota:"",nombre_producto:"",codigo_producto:"",fecha_hora_min:"",fecha_hora_max:"",precio_cobrado_min:null,precio_cobrado_max:null}),f=h("normal"),T=h(!1);function y(i){if(!i)return"";const l=String(i).substring(0,8).split(":");if(l.length<2)return i;let a=parseInt(l[0],10);const t=l[1],r=a>=12?"PM":"AM";return a=a%12,a===0&&(a=12),`${a}:${t} ${r}`}function M(i,o=2){const l=Number(i);if(!isFinite(l))return 0 .toFixed(o);if(o===0)return String(Math.trunc(l)).replace(/\B(?=(\d{3})+(?!\d))/g," ");const t=l.toFixed(o).split(".");return t[0]=t[0].replace(/\B(?=(\d{3})+(?!\d))/g," "),t.join(".")}const P=h(1),U=h(0),x=h(!1),C=h(50),b=h([]),m=h({}),F=h(!1),z=h(null),j=h(!1),pe=h("create"),oe=h(null),Q=h(!1),Y=h(!1),de=h(null),n=h(null),d=h(!1),s=h(null),w=h(1);function B(){try{const i=localStorage.getItem("config");if(i){const o=JSON.parse(i),l=Number(o?.cambio_moneda);w.value=l&&l>0?l:1}else w.value=1}catch{w.value=1}}const ae=J(()=>f.value==="normal"?[{key:"fecha",label:"Fecha"},{key:"hora",label:"Hora"},{key:"totalCobrado",label:"Total Cobrado"},...re.value?[]:[{key:"totalCobradoUSD",label:"TOTAL COBRADO USD"}],{key:"formaPago",label:"Forma de Pago",cellRenderer:i=>{if(!i)return"";const o=String(i).toLowerCase(),l=o.includes("efectivo"),a=o.includes("transferencia");if(l&&a)return'<span class="px-2 py-1 rounded-full text-sm font-medium"><span class="inline-block bg-green-100 text-green-800 px-2 py-0.5 rounded-l">Efectivo</span><span class="inline-block bg-blue-100 text-blue-800 px-2 py-0.5 rounded-r">Transferencia</span></span>';let t="bg-gray-100 text-gray-800";return a?t="bg-blue-100 text-blue-800":l&&(t="bg-green-100 text-green-800"),`<span class="px-2 py-1 rounded-full text-sm font-medium ${t}">${i}</span>`}},{key:"usuario",label:"Usuario"}]:[{key:"fecha",label:"Fecha"},{key:"hora",label:"Hora"},{key:"productoNombre",label:"Producto"},{key:"cantidad",label:"Cantidad"},{key:"precio_cobrado",label:"Precio Cobrado"},...re.value?[]:[{key:"totalUSD",label:"TOTAL COBRADO USD"}],{key:"total",label:"Total"},{key:"forma_pago",label:"Forma de Pago",cellRenderer:i=>{if(!i)return"";const o=String(i).toLowerCase(),l=o.includes("efectivo"),a=o.includes("transferencia");if(l&&a)return'<span class="px-2 py-1 rounded-full text-sm font-medium"><span class="inline-block bg-green-100 text-green-800 px-2 py-0.5 rounded-l">Efectivo</span><span class="inline-block bg-blue-100 text-blue-800 px-2 py-0.5 rounded-r">Transferencia</span></span>';let t="bg-gray-100 text-gray-800";return a?t="bg-blue-100 text-blue-800":l&&(t="bg-green-100 text-green-800"),`<span class="px-2 py-1 rounded-full text-sm font-medium ${t}">${i}</span>`}},{key:"usuario",label:"Usuario"}]),X=[{name:"Imprimir",icon:{render(){return ve("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[ve("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 9V2h12v7"}),ve("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18h12v-5H6v5z"})])}},buttonClass:"px-3 py-1 bg-accent text-neutral rounded-md hover:bg-accent/90",handler:async i=>{if(f.value==="normal"){de.value=i.rawItem||i,Y.value=!0;return}const o=i.rawItem||i,l=o.id_lista_venta||o.id_lista||o.id;if(!l){n.value={title:"Error",description:"ID de lista no encontrado.",type:"error"};return}try{Q.value=!0;const a=localStorage.getItem("token"),t=await fetch(`${ie.public.backendHost}/ListaVenta/${l}`,{method:"GET",headers:{Accept:"application/json",Authorization:a}});if(t.status===401){n.value={title:"Sesión Expirada",description:"Tu sesión ha expirado.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>_e("/"),2e3);return}if(!t.ok){let u=await t.text();try{u=JSON.parse(u)}catch{}n.value={title:`Error ${t.status}`,description:JSON.stringify(u),type:"error"};return}const r=await t.json();de.value=r,Y.value=!0}catch(a){console.error("Error fetching lista venta for comprobante:",a),n.value={title:"Error",description:"No se pudo cargar la lista de venta.",type:"error"}}finally{Q.value=!1}}},{name:"Eliminar",icon:{render(){return ve("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[ve("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6M9 7V4a1 1 0 011-1h4a1 1 0 011 1v3"})])}},buttonClass:"px-3 py-1 bg-red-600 text-white rounded-md hover:bg-red-700",handler:i=>{s.value={raw:i.rawItem||i,mode:f.value},d.value=!0}}],ye=J(()=>{try{const i=localStorage.getItem("usuario");if(!i)return!1;const o=JSON.parse(i),l=o&&(o.rol||o.role||o.perfil&&o.perfil.rol||o.profile&&o.profile.role)?o.rol||o.role||o.perfil&&o.perfil.rol||o.profile&&o.profile.role:null;return l?String(l).trim().toLowerCase()==="invitado":!1}catch{return!1}}),re=J(()=>{try{const i=localStorage.getItem("usuario");if(!i)return!1;const o=JSON.parse(i),l=o&&(o.rol||o.role||o.perfil&&o.perfil.rol||o.profile&&o.profile.role)?o.rol||o.role||o.perfil&&o.perfil.rol||o.profile&&o.profile.role:null;return l?String(l).trim().toLowerCase()==="vendedor":!1}catch{return!1}});function we(i){f.value!==i&&(f.value=i,De())}function Se(i,o="normal"){const l={};for(const a in i){if(o==="detallado"&&a==="nota")continue;const t=i[a];t!=null&&(typeof t=="string"&&t.trim()===""||(l[a]=t))}return l}async function ce(i=1,o=20){try{x.value=!0;const l=localStorage.getItem("token"),a=Se(k.value,f.value),t=f.value==="normal"?"ListaVenta":"Venta",r=await fetch(`${ie.public.backendHost}/${t}/filter/${i}/${o}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:l,Accept:"application/json"},body:JSON.stringify(a)});if(r.status===401){n.value={title:"Sesión Expirada",description:"Tu sesión ha expirado.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>_e("/"),2e3);return}if(r.status===403){n.value={title:"Acceso Denegado",description:"No tienes permisos.",type:"error"};return}const u=await r.json();if(f.value==="normal"){const c=(u.data||[]).map(v=>{const q=Array.isArray(v.ventas)?v.ventas:[],A={},I={};let p=0;const g=new Set;let se="",fe=0;q.forEach(V=>{if(V.fecha_hora){const ke=V.fecha_hora.substring(0,10),K=V.fecha_hora.substring(11,19);A[ke]=(A[ke]||0)+1,I[K]=(I[K]||0)+1}const L=parseFloat(V.precio_cobrado)||0,E=Number(V.cantidad)||0;p+=L*E;const G=parseFloat(V.cambioUSD_al_vender),ee=G&&G!==0?L/G:0;fe+=ee,V.forma_pago&&g.add(String(V.forma_pago).toLowerCase()),V.usuario&&V.usuario.nombre_usuario&&(se=V.usuario.nombre_usuario)});function O(V){let L=0,E="";for(const G in V)V[G]>L&&(L=V[G],E=G);return E}let W="";const ue=Array.from(g);if(ue.length===0)W="";else if(ue.length===1)W=ue[0].split(" ").map(V=>V.charAt(0).toUpperCase()+V.slice(1)).join(" ");else{const V=ue.some(E=>E.includes("efectivo")),L=ue.some(E=>E.includes("transferencia"));V&&L?W="Efectivo y Transferencia":W=ue.map(E=>E.split(" ").map(G=>G.charAt(0).toUpperCase()+G.slice(1)).join(" ")).join(" y ")}const me=O(I)||(v.createdAt?v.createdAt.substring(11,19):""),le=y(me);return{fecha:O(A)||(v.createdAt?v.createdAt.substring(0,10):""),hora:le,nota:v.nota||"",totalCobrado:p.toFixed(2),totalCobradoUSD:fe.toFixed(2),formaPago:W,usuario:se||(v.usuario?v.usuario.nombre_usuario:""),rawItem:v}});b.value=c,U.value=u.pagination?u.pagination.total:c.length;try{let v=0,q=0,A=0,I=0,p=0,g=0,se=0,fe=0,O=0,W=0;(u.data||[]).forEach(ue=>{(Array.isArray(ue.ventas)?ue.ventas:[]).forEach(le=>{const V=parseFloat(le.precio_cobrado)||0,L=Number(le.cantidad)||0,E=parseFloat(le.cambioUSD_al_vender)||0,G=parseFloat(le.costo_venta)||parseFloat(le.costoVenta)||0,ee=String(le.forma_pago||"").toLowerCase(),ke=parseFloat(le.cantidad_pagada_transferencia_cup)||0;if(fe+=L,O+=G*L,W+=V*L,E&&E!==0&&(v+=V*L/E,q+=G*L/E,A+=(V-G)*L/E),ee.includes("efectivo")){if(ee==="efectivo cup"){const K=V*L;I+=K}else if(ee.includes("efectivo")&&ee.includes("transferencia")){const K=V*L-ke;I+=K}}if(ee.includes("transferencia"))if(ee==="transferencia cup"){const K=V*L;g+=K}else ee.includes("efectivo")&&ee.includes("transferencia")&&(g+=ke);if(ee==="efectivo usd"){const K=V*L/(E&&E!==0?E:1);p+=K}if(ee==="transferencia usd"){const K=V*L/(E&&E!==0?E:1);se+=K}})}),m.value=u.pagination||{},m.value.sumCantidad=fe,m.value.sumCostoVenta=O,m.value.sumPrecioCobrado=W,m.value.sumTotalVentas=W,m.value.sumPrecioCobradoUSD=v,m.value.sumCostoVentaUSD=q,m.value.sumGananciaTotalUSD=A,m.value.sumEfectivoCUP=I,m.value.sumEfectivoUSD=p,m.value.sumTransferenciaCUP=g,m.value.sumTransferenciaUSD=se}catch(v){m.value=u.pagination||{},console.error("Error calculando totales:",v)}}else{const c=(u.data||[]).map(v=>{const q=v.fecha_hora?v.fecha_hora.substring(0,10):v.createdAt?v.createdAt.substring(0,10):"",A=v.fecha_hora?v.fecha_hora.substring(11,19):v.createdAt?v.createdAt.substring(11,19):"",I=y(A),p=parseFloat(v.cambioUSD_al_vender),g=p&&p!==0?(parseFloat(v.precio_cobrado)||0)/p:0;return{fecha:q,hora:I,productoNombre:v.producto?v.producto.nombre:v.servicio?v.servicio.nombre:"",cantidad:v.cantidad,precio_cobrado:(parseFloat(v.precio_cobrado)||0).toFixed(2),totalUSD:g.toFixed(2),total:(Number(v.cantidad||0)*(parseFloat(v.precio_cobrado)||0)).toFixed(2),forma_pago:v.forma_pago||"",usuario:v.usuario?v.usuario.nombre_usuario:"",rawItem:v}});b.value=c,U.value=u.pagination?u.pagination.total:c.length,m.value=u.pagination||{}}}catch(l){console.error("Error al cargar ventas:",l),n.value={title:"Error",description:"Ocurrió un error al cargar ventas.",type:"error"}}finally{x.value=!1}}const $e=i=>{P.value=i,ce(i,C.value)},ne=async()=>{P.value=1,await ce(1,C.value)},De=async()=>{P.value=1,await ce(1,C.value)},Ve=async()=>{P.value=1,await ce(1,C.value)};function he(){pe.value="create",oe.value=null,j.value=!0}const Z=i=>{if(f.value==="normal"){pe.value="view",oe.value=i.rawItem||i,j.value=!0;return}(async()=>{const o=i.rawItem||i,l=o.id_lista_venta||o.id_lista||o.id;if(!l){n.value={title:"Error",description:"ID de lista no encontrado.",type:"error"};return}try{Q.value=!0;const a=localStorage.getItem("token"),t=await fetch(`${ie.public.backendHost}/ListaVenta/${l}`,{method:"GET",headers:{Accept:"application/json",Authorization:a}});if(t.status===401){n.value={title:"Sesión Expirada",description:"Tu sesión ha expirado.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>_e("/"),2e3);return}if(!t.ok){let u=await t.text();try{u=JSON.parse(u)}catch{}n.value={title:`Error ${t.status}`,description:JSON.stringify(u),type:"error"};return}const r=await t.json();pe.value="view",oe.value=r,j.value=!0}catch(a){console.error("Error fetching lista venta:",a),n.value={title:"Error",description:"No se pudo cargar la lista de venta.",type:"error"}}finally{Q.value=!1}})()},Ee=async i=>{let o=[],l="",a="";Array.isArray(i)?o=i:i&&i.items&&(o=i.items,l=i.nota||"",a=i.formaPago||"");const t=o.length;i&&i.mode==="edit"?n.value={title:"Ventas actualizadas",description:`${t} venta(s) actualizada(s). ${l?"Nota: "+l:""} ${a?"Forma: "+a:""}`,type:"success"}:n.value={title:"Ventas creadas",description:`${t} venta(s) listas. ${l?"Nota: "+l:""} ${a?"Forma: "+a:""}`,type:"success"},await ce(1,C.value),pe.value="create",oe.value=null,j.value=!1};function Pe(i){de.value=i||null,Y.value=!0}async function Ne(){if(d.value=!1,!!s.value)try{x.value=!0;const i=localStorage.getItem("token"),o=s.value.raw||{},l=s.value.mode||"normal",a=l==="normal"?"ListaVenta":"Venta";let t=null;if(l==="normal"?t=o.id_lista_venta||o.id_lista_venta:t=o.id_venta||o.id_venta,!t){n.value={title:"Error",description:"ID no encontrado para eliminar.",type:"error"};return}const r=await fetch(`${ie.public.backendHost}/${a}/${t}`,{method:"DELETE",headers:{Accept:"application/json",Authorization:i}});if(r.status===401){n.value={title:"Sesión Expirada",description:"Tu sesión ha expirado.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>_e("/"),2e3);return}if(r.status===403){n.value={title:"Acceso Denegado",description:"No tienes permisos.",type:"error"};return}let u=null;try{u=await r.json()}catch{u=null}if(!r.ok){let c="Error desconocido";u&&u.errors&&Array.isArray(u.errors)?c=u.errors.join(`
• `):u&&typeof u.error=="string"?c=u.error:u&&(u.message||u.description)?c=u.message||u.description:u&&(c=JSON.stringify(u)),n.value={title:`Error ${r.status}`,description:c,type:"error"};return}n.value={title:"Eliminado",description:"Elemento eliminado correctamente.",type:"success"},await ce(P.value,C.value)}catch(i){console.error("Error al eliminar:",i),n.value={title:"Error",description:"Ocurrió un error al eliminar.",type:"error"}}finally{x.value=!1,s.value=null}}return Oe(()=>{B();const i=new Date,o=i.getFullYear(),l=String(i.getMonth()+1).padStart(2,"0"),a=String(i.getDate()).padStart(2,"0"),t=`${o}-${l}-${a}`;k.value.fecha_hora_min||(k.value.fecha_hora_min=t),k.value.fecha_hora_max||(k.value.fecha_hora_max=t),ce(1,C.value)}),(i,o)=>(_(),$("div",No,[te(qe,{title:"Ventas - Contract Manager",description:"Lista de ventas agrupadas.",canonical:"/ventas"}),te(We),n.value?(_(),$("div",To,[te(Ie,{title:n.value.title,description:n.value.description,type:n.value.type,onClose:o[0]||(o[0]=l=>n.value=null),class:"pointer-events-auto"},null,8,["title","description","type"])])):N("",!0),d.value?(_(),$("div",Do,[te(Re,{title:"¿Estás seguro que deseas eliminar esta venta?",description:"Esta acción no se puede deshacer.",type:"warning",onConfirm:Ne,onClose:o[1]||(o[1]=l=>d.value=!1)})])):N("",!0),e("div",Eo,[e("div",Po,[e("div",Ao,[o[17]||(o[17]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Buscar por nombre de producto",-1)),e("div",Uo,[R(e("input",{type:"text","onUpdate:modelValue":o[2]||(o[2]=l=>k.value.nombre_producto=l),placeholder:"Nombre producto...",class:"w-full pl-10 pr-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary",onKeyup:xe(ne,["enter"])},null,544),[[H,k.value.nombre_producto]]),o[16]||(o[16]=e("div",{class:"absolute left-3 top-2.5"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))])]),e("div",jo,[e("div",Io,[e("div",{class:be(["absolute top-0 left-0 w-1/2 h-full bg-primary rounded-lg transition-transform duration-300",f.value==="normal"?"transform translate-x-0":"transform translate-x-full"])},null,2),e("button",{type:"button",onClick:o[3]||(o[3]=l=>we("normal")),class:be(["relative flex-1 px-4 py-2 rounded-lg font-medium transition-all duration-300 z-10",f.value==="normal"?"text-neutral bg-transparent":"text-dark bg-secondary"]),disabled:x.value}," Normal ",10,Oo),e("button",{type:"button",onClick:o[4]||(o[4]=l=>we("detallado")),class:be(["relative flex-1 px-4 py-2 rounded-lg font-medium transition-all duration-300 z-10",f.value==="detallado"?"text-neutral bg-transparent":"text-dark bg-secondary"]),disabled:x.value}," Detallado ",10,Lo)])]),e("div",Fo,[e("button",{onClick:o[5]||(o[5]=l=>T.value=!T.value),class:"flex items-center text-primary hover:brightness-90"},[o[19]||(o[19]=e("span",{class:"mr-2"},"Filtros adicionales",-1)),(_(),$("svg",{xmlns:"http://www.w3.org/2000/svg",class:be(["h-5 w-5 transform transition-transform",{"rotate-180":T.value}]),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[...o[18]||(o[18]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))])]),e("div",{class:be(["grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",{"hidden md:grid":!T.value}])},[f.value==="normal"?(_(),$("div",Mo,[o[20]||(o[20]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Nota",-1)),R(e("input",{"onUpdate:modelValue":o[6]||(o[6]=l=>k.value.nota=l),type:"text",placeholder:"Nota",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary",onKeyup:xe(ne,["enter"])},null,544),[[H,k.value.nota]])])):N("",!0),e("div",null,[o[21]||(o[21]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Código Producto",-1)),R(e("input",{"onUpdate:modelValue":o[7]||(o[7]=l=>k.value.codigo_producto=l),type:"text",placeholder:"Código producto",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary",onKeyup:xe(ne,["enter"])},null,544),[[H,k.value.codigo_producto]])]),e("div",zo,[e("div",null,[o[22]||(o[22]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Precio cobrado min",-1)),R(e("input",{"onUpdate:modelValue":o[8]||(o[8]=l=>k.value.precio_cobrado_min=l),type:"number",min:"0",step:"0.01",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary",onKeyup:xe(ne,["enter"])},null,544),[[H,k.value.precio_cobrado_min,void 0,{number:!0}]])]),e("div",null,[o[23]||(o[23]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Precio cobrado max",-1)),R(e("input",{"onUpdate:modelValue":o[9]||(o[9]=l=>k.value.precio_cobrado_max=l),type:"number",min:"0",step:"0.01",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary",onKeyup:xe(ne,["enter"])},null,544),[[H,k.value.precio_cobrado_max,void 0,{number:!0}]])])])],2),e("div",{class:be(["mb-4 grid grid-cols-1 md:grid-cols-3 gap-4",{"hidden md:grid":!T.value}])},[e("div",null,[o[24]||(o[24]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Fecha mínima",-1)),R(e("input",{"onUpdate:modelValue":o[10]||(o[10]=l=>k.value.fecha_hora_min=l),type:"date",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary",onKeyup:xe(ne,["enter"])},null,544),[[H,k.value.fecha_hora_min]])]),e("div",null,[o[25]||(o[25]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Fecha máxima",-1)),R(e("input",{"onUpdate:modelValue":o[11]||(o[11]=l=>k.value.fecha_hora_max=l),type:"date",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary",onKeyup:xe(ne,["enter"])},null,544),[[H,k.value.fecha_hora_max]])]),e("div",{class:"flex items-end justify-end"},[e("button",{onClick:ne,class:"px-6 py-2 bg-primary text-neutral rounded-lg hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition-colors"}," Buscar ")])],2)])]),e("div",Bo,[e("div",Ro,[o[26]||(o[26]=e("h2",{class:"text-2xl font-bold"},"Ventas",-1)),e("div",null,[ye.value?N("",!0):(_(),$("button",{key:0,onClick:he,class:"px-3 py-1 bg-green-600 text-white rounded-md"},"+ Agregar Venta"))])]),te(Be,{columns:ae.value,items:b.value,actions:ye.value?[]:X,"total-items":U.value,"items-per-page":C.value,"current-page":P.value,"is-loading":x.value,onPageChange:$e,onRowClick:Z},null,8,["columns","items","actions","total-items","items-per-page","current-page","is-loading"]),e("div",Ho,[e("div",Jo,[o[28]||(o[28]=e("label",{class:"text-sm font-medium text-gray-700"},"Elementos por página:",-1)),e("div",qo,[R(e("input",{"onUpdate:modelValue":o[12]||(o[12]=l=>C.value=l),type:"number",min:"1",max:"1000",list:"itemsPerPageOptions",onChange:Ve,class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary cursor-pointer",disabled:x.value},null,40,Wo),[[H,C.value,void 0,{number:!0}]]),o[27]||(o[27]=ze('<datalist id="itemsPerPageOptions" data-v-f2bf4a4b><option value="10" data-v-f2bf4a4b>10</option><option value="20" data-v-f2bf4a4b>20</option><option value="50" data-v-f2bf4a4b>50</option><option value="100" data-v-f2bf4a4b>100</option><option value="200" data-v-f2bf4a4b>200</option></datalist>',1))])]),e("div",Go,[o[29]||(o[29]=ge(" Total: ",-1)),e("span",Ko,S(U.value),1),o[30]||(o[30]=ge(" elementos ",-1))])]),f.value==="normal"?(_(),$("div",Qo,[e("h3",Yo,"Resumen de Totales - Reporte de las "+S(C.value)+" elementos",1),e("div",Xo,[e("div",Zo,[o[31]||(o[31]=e("div",{class:"text-sm font-medium"},"Suma Cantidad de productos vendidos",-1)),e("div",ea,S(M(m.value.sumCantidad??0,0)),1)]),e("div",ta,[o[32]||(o[32]=e("div",{class:"text-sm font-medium"},"Suma Total CUP vendido (Efectivo y Transferencia)",-1)),e("div",oa,S(M(m.value.sumTotalVentas??0,2)),1)]),re.value?N("",!0):(_(),$("div",aa,[o[33]||(o[33]=e("div",{class:"text-sm font-medium"},"Suma Total Costos CUP de las ventas",-1)),e("div",ra,S(M(m.value.sumCostoVenta??0,2)),1)])),re.value?N("",!0):(_(),$("div",na,[o[34]||(o[34]=e("div",{class:"text-sm font-medium"},"Ganancia Total en CUP",-1)),e("div",sa,S(M((m.value.sumTotalVentas??0)-(m.value.sumCostoVenta??0)||0,2)),1)]))]),e("div",la,[e("div",ia,[e("div",null,[o[37]||(o[37]=e("h4",{class:"text-lg font-semibold mb-3"},"Suma de Efectivo",-1)),e("div",da,[e("div",ca,[o[35]||(o[35]=e("div",{class:"text-sm font-medium"},"Total Efectivo CUP",-1)),e("div",ua,S(M(m.value.sumEfectivoCUP??0,2)),1)]),e("div",pa,[o[36]||(o[36]=e("div",{class:"text-sm font-medium"},"Total Efectivo USD",-1)),e("div",ma,S(M(m.value.sumEfectivoUSD??0,2)),1)])])]),e("div",null,[o[40]||(o[40]=e("h4",{class:"text-lg font-semibold mb-3"},"Suma de Transferencia",-1)),e("div",fa,[e("div",ba,[o[38]||(o[38]=e("div",{class:"text-sm font-medium"},"Total Transferencia CUP",-1)),e("div",va,S(M(m.value.sumTransferenciaCUP??0,2)),1)]),e("div",ga,[o[39]||(o[39]=e("div",{class:"text-sm font-medium"},"Total Transferencia USD",-1)),e("div",ya,S(M(m.value.sumTransferenciaUSD??0,2)),1)])])])])])])):N("",!0)]),te(ot,{modelValue:F.value,"onUpdate:modelValue":o[13]||(o[13]=l=>F.value=l),listaVenta:z.value},null,8,["modelValue","listaVenta"]),Q.value?(_(),$("div",xa,[...o[41]||(o[41]=[e("div",{class:"bg-white rounded p-6 flex flex-col items-center gap-4"},[e("div",{class:"loader-border w-12 h-12 border-4 border-primary rounded-full animate-spin"}),e("div",null,"Cargando lista de venta...")],-1)])])):N("",!0),te(no,{modelValue:j.value,"onUpdate:modelValue":o[14]||(o[14]=l=>j.value=l),mode:pe.value,initialData:oe.value,onSubmit:Ee,onOpenComprobante:Pe},null,8,["modelValue","mode","initialData"]),te(Vo,{modelValue:Y.value,"onUpdate:modelValue":o[15]||(o[15]=l=>Y.value=l),data:de.value},null,8,["modelValue","data"])]))}},Ta=Te(ha,[["__scopeId","data-v-f2bf4a4b"]]);export{Ta as default};
