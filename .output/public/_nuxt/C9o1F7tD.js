import{r as c,M as be,k as Y,y,F as C,z as x,A as e,C as N,B as W,J as ye,K as g,L as v,E as ne,_ as xe,o as we,R as D,H as oe,n as ke,q as J,h as M}from"#entry";import{S as he}from"./CC2Sf2Ne.js";import{N as Ce}from"./DTHag2Fn.js";import{D as ae}from"./DIpJa8iN.js";import{_ as re}from"./CP6NTKUH.js";import{_ as Ee}from"./DWLPyndB.js";import{u as F,w as te}from"./3SA47z_C.js";import"./BzLCLO6P.js";const _e={key:0,class:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center"},Ve={key:0,class:"fixed top-6 left-1/2 transform -translate-x-1/2 z-[9999] w-full max-w-md px-4 pointer-events-none"},$e={class:"bg-white rounded-lg p-6 w-full max-w-2xl max-h-[80vh] overflow-y-auto"},Se={class:"flex justify-between items-center mb-6"},Te={class:"text-2xl font-bold text-gray-800"},Ie={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},je=["readonly","disabled"],De=["readonly","disabled"],Ne=["readonly","disabled"],Pe=["readonly","disabled"],Oe=["readonly","disabled"],Be=["readonly","disabled"],Ue=["readonly","disabled"],ze=["readonly","disabled"],Ae=["readonly","disabled"],Me=["readonly","disabled"],Fe={key:0,class:"flex justify-end space-x-4 mt-6"},Le=["disabled"],Re=["disabled"],He={key:0,class:"flex items-center"},Ke={key:1},Je={key:0,class:"mt-8"},qe={key:1,class:"text-red-600 text-sm mt-2"},Ge=10,We={__name:"EntidadModal",props:{modelValue:{type:Boolean,required:!0},entidad:{type:Object,default:()=>({})},isEditing:{type:Boolean,default:!1},isViewing:{type:Boolean,default:!1}},emits:["update:modelValue","submit"],setup(P,{emit:E}){const l=P,_=E,n=c({nombre:"",direccion:"",telefono:"",email:"",cuenta_bancaria:"",tipo_entidad:"",codigo_reeup:"",codigo_nit:"",organismo:"",consecutivo:""}),m=c(""),p=c(!1),w=c(null);be(()=>l.entidad,r=>{r&&Object.keys(r).length>0?n.value={...r}:n.value={nombre:"",direccion:"",telefono:"",email:"",cuenta_bancaria:"",tipo_entidad:"",codigo_reeup:"",codigo_nit:"",organismo:"",consecutivo:""}},{immediate:!0});function V(r){let o=r.target.value;o=o.replace(/[^0-9+-]/g,""),o.startsWith("+")?o="+"+o.slice(1).replace(/\+/g,""):o=o.replace(/\+/g,""),n.value.telefono=o}function $(r){let o=r.target.value;o=o.replace(/[^0-9]/g,"");let s="";for(let b=0;b<o.length&&b<16;b++)b>0&&b%4===0&&s.split("-").length<=3&&(s+="-"),s+=o[b];n.value.cuenta_bancaria=s}const A=async()=>{if(m.value="",!n.value.nombre||n.value.nombre.trim()===""){m.value="El nombre es obligatorio.";return}if(!n.value.direccion||n.value.direccion.trim()===""){m.value="La dirección es obligatoria.";return}if(!n.value.telefono||n.value.telefono.trim()===""){m.value="El teléfono es obligatorio.";return}if(!n.value.tipo_entidad||n.value.tipo_entidad.trim()===""){m.value="El tipo de entidad es obligatorio.";return}if(!/^\+?[0-9-]+$/.test(n.value.telefono)){m.value="El teléfono solo puede contener un símbolo + al inicio, números y guiones.";return}if(n.value.cuenta_bancaria&&n.value.cuenta_bancaria.trim()!==""&&!/^\d{4}-\d{4}-\d{4}-\d{4}$/.test(n.value.cuenta_bancaria)){m.value="La cuenta bancaria debe tener el formato 0000-0000-0000-0000 (16 dígitos y 3 guiones).";return}p.value=!0,w.value={title:l.isEditing?"Guardando Entidad":"Creando Entidad",description:"Comunicando con el servidor, espere por favor...",type:"warning"};try{await new Promise((r,o)=>{_("submit",n.value),setTimeout(r,100)})}catch(r){console.error("Error en handleSubmit:",r)}finally{setTimeout(()=>{p.value=!1,w.value=null},500)}},O=[{key:"num_consecutivo",label:"Num. Consecutivo"},{key:"fecha_inicio",label:"Fecha Inicio",cellRenderer:r=>r?`<span class="px-2 py-1 rounded text-sm">${r.substring(0,10)}</span>`:""},{key:"fecha_fin",label:"Fecha Fin",cellRenderer:r=>{if(!r)return"";const o=r.substring(0,10),s=new Date,b=new Date(r);return`<span class="px-2 py-1 rounded text-sm font-medium ${s>b?"bg-red-100 text-red-800":"bg-green-100 text-green-800"}">${o}</span>`}},{key:"ClienteOProveedor",label:"Cliente o Proveedor",cellRenderer:r=>r?`<span class="px-2 py-1 rounded text-sm font-medium ${r==="Cliente"?"bg-blue-100 text-blue-800":"bg-orange-100 text-orange-800"}">${r}</span>`:""},{key:"tipoContratoNombre",label:"Tipo de Contrato"}],I=Y(()=>!l.entidad||!Array.isArray(l.entidad.contratos)?[]:l.entidad.contratos.map(r=>({num_consecutivo:r.num_consecutivo,fecha_inicio:r.fecha_inicio?r.fecha_inicio.split("T")[0]:"",fecha_fin:r.fecha_fin?r.fecha_fin.split("T")[0]:"",clasificacion:r.clasificacion||"",ClienteOProveedor:r.ClienteOProveedor||"",entidadNombre:l.entidad.nombre||"",tipoContratoNombre:r.tipoContrato?.nombre||""}))),S=Y(()=>I.value.length),B=c(1),j=r=>{B.value=r};return(r,o)=>P.modelValue?(x(),y("div",_e,[w.value?(x(),y("div",Ve,[N(re,{title:w.value.title,description:w.value.description,type:w.value.type,onClose:o[0]||(o[0]=s=>w.value=null),class:"pointer-events-auto"},null,8,["title","description","type"])])):C("",!0),e("div",$e,[e("div",Se,[e("h2",Te,W(l.isViewing?"Detalles de Entidad":P.isEditing?"Editar Entidad":"Nueva Entidad"),1),e("button",{onClick:o[1]||(o[1]=s=>r.$emit("update:modelValue",!1)),class:"text-gray-500 hover:text-gray-700"},[...o[13]||(o[13]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("form",{onSubmit:ye(A,["prevent"]),class:"space-y-4"},[e("div",Ie,[e("div",null,[o[14]||(o[14]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Nombre",-1)),g(e("input",{"onUpdate:modelValue":o[2]||(o[2]=s=>n.value.nombre=s),type:"text",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary",required:"",readonly:l.isViewing,disabled:l.isViewing||p.value,placeholder:"Ingrese el nombre"},null,8,je),[[v,n.value.nombre]])]),e("div",null,[o[15]||(o[15]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Dirección",-1)),g(e("input",{"onUpdate:modelValue":o[3]||(o[3]=s=>n.value.direccion=s),type:"text",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",required:"",readonly:l.isViewing,disabled:l.isViewing||p.value,placeholder:"Ingrese la dirección"},null,8,De),[[v,n.value.direccion]])]),e("div",null,[o[16]||(o[16]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Teléfono",-1)),g(e("input",{"onUpdate:modelValue":o[4]||(o[4]=s=>n.value.telefono=s),type:"tel",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",required:"",readonly:l.isViewing,disabled:l.isViewing||p.value,onInput:V,placeholder:"Ej: +50312345678"},null,40,Ne),[[v,n.value.telefono]])]),e("div",null,[o[17]||(o[17]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Email",-1)),g(e("input",{"onUpdate:modelValue":o[5]||(o[5]=s=>n.value.email=s),type:"email",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",readonly:l.isViewing,disabled:l.isViewing||p.value,placeholder:"ejemplo@correo.com"},null,8,Pe),[[v,n.value.email]])]),e("div",null,[o[18]||(o[18]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Cuenta Bancaria",-1)),g(e("input",{"onUpdate:modelValue":o[6]||(o[6]=s=>n.value.cuenta_bancaria=s),type:"text",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",readonly:l.isViewing,disabled:l.isViewing||p.value,maxlength:"19",onInput:$,placeholder:"0000-0000-0000-0000"},null,40,Oe),[[v,n.value.cuenta_bancaria]])]),e("div",null,[o[19]||(o[19]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Tipo de Entidad",-1)),g(e("input",{"onUpdate:modelValue":o[7]||(o[7]=s=>n.value.tipo_entidad=s),type:"text",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ingrese el tipo de entidad",required:"",readonly:l.isViewing,disabled:l.isViewing||p.value},null,8,Be),[[v,n.value.tipo_entidad]])]),e("div",null,[o[20]||(o[20]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Código REEUP",-1)),g(e("input",{"onUpdate:modelValue":o[8]||(o[8]=s=>n.value.codigo_reeup=s),type:"text",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",readonly:l.isViewing,disabled:l.isViewing||p.value,placeholder:"Ingrese el código REEUP"},null,8,Ue),[[v,n.value.codigo_reeup]])]),e("div",null,[o[21]||(o[21]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Código NIT",-1)),g(e("input",{"onUpdate:modelValue":o[9]||(o[9]=s=>n.value.codigo_nit=s),type:"text",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",readonly:l.isViewing,disabled:l.isViewing||p.value,placeholder:"Ingrese el código NIT"},null,8,ze),[[v,n.value.codigo_nit]])]),e("div",null,[o[22]||(o[22]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Organismo",-1)),g(e("input",{"onUpdate:modelValue":o[10]||(o[10]=s=>n.value.organismo=s),type:"text",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",readonly:l.isViewing,disabled:l.isViewing||p.value,placeholder:"Ingrese el organismo"},null,8,Ae),[[v,n.value.organismo]])]),e("div",null,[o[23]||(o[23]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Consecutivo",-1)),g(e("input",{"onUpdate:modelValue":o[11]||(o[11]=s=>n.value.consecutivo=s),type:"text",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",readonly:l.isViewing,disabled:l.isViewing||p.value,placeholder:"Ingrese el consecutivo"},null,8,Me),[[v,n.value.consecutivo]])])]),l.isViewing?C("",!0):(x(),y("div",Fe,[e("button",{type:"button",onClick:o[12]||(o[12]=s=>r.$emit("update:modelValue",!1)),class:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-500",disabled:p.value}," Cancelar ",8,Le),e("button",{type:"submit",class:"px-4 py-2 text-neutral bg-primary rounded-lg hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-primary disabled:opacity-50 disabled:cursor-not-allowed",disabled:p.value},[p.value?(x(),y("span",He,[o[24]||(o[24]=e("svg",{class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)),ne(" "+W(P.isEditing?"Guardando...":"Creando..."),1)])):(x(),y("span",Ke,W(P.isEditing?"Guardar Cambios":"Crear Entidad"),1))],8,Re)]))],32),l.isViewing||P.isEditing?(x(),y("div",Je,[o[25]||(o[25]=e("h3",{class:"text-lg font-semibold mb-2"},"Datos De Contratos",-1)),N(ae,{columns:O,items:I.value,"total-items":S.value,"items-per-page":Ge,"current-page":B.value,"is-loading":!1,onPageChange:j},null,8,["items","total-items","current-page"])])):C("",!0),m.value?(x(),y("div",qe,W(m.value),1)):C("",!0)])])):C("",!0)}},Qe={class:"min-h-screen bg-gradient-to-br via-secondary/40 from-accent/30 to-neutral"},Xe={key:0,class:"fixed top-6 left-1/2 transform -translate-x-1/2 z-[9999] w-full max-w-md px-4 pointer-events-none"},Ye={key:1,class:"fixed top-24 left-1/2 transform -translate-x-1/2 z-[10000] w-full max-w-md px-4 pointer-events-auto"},Ze={class:"w-[95%] mx-auto px-4 py-4 md:py-4 mt-20 md:mt-0"},eo={class:"bg-white rounded-lg shadow-md p-4"},oo={class:"mb-4"},to={class:"relative"},no={class:"md:hidden flex justify-between items-center mb-4"},ao={class:"w-full"},ro={class:"relative"},io={class:"w-full"},lo={class:"w-full"},so={class:"w-full"},uo={class:"w-full"},co={class:"w-full"},po={class:"w-full"},go={class:"flex justify-end mt-4 gap-2"},vo={class:"w-[95%] mx-auto px-4 py-4"},mo={class:"flex justify-between items-center mb-4"},fo={__name:"entidades",setup(P){const E=c(""),l=c(""),_=c(""),n=c(""),m=c(""),p=c(""),w=c(""),V=c(""),$=c(""),A=c(!1),O=c(!1),I=c({}),S=c(!1),B=c(!1),j=ke(),r=[{key:"consecutivo",label:"Consecutivo"},{key:"nombre",label:"Nombre de la Entidad"},{key:"organismo",label:"Organismo"},{key:"cuenta_bancaria",label:"Cuenta Bancaria"},{key:"tipo_entidad",label:"Tipo de Entidad"},{key:"codigo_reo",label:"Reo"},{key:"codigo_nit",label:"Nit"}],o=c(1),s=c(0),b=c(!1),U=c(20),Z=c([]),q=Y(()=>{try{const i=JSON.parse(localStorage.getItem("usuario")||"null"),t=i&&(i.rol||i.role||i.perfil&&i.perfil.rol||i.profile&&i.profile.role);return t&&String(t).trim().toLowerCase()==="invitado"}catch{return!1}}),L=async(i=1,t=20,a="",f="",k="",H="",z="",K="",u="",h="",me="")=>{try{b.value=!0;const Q=localStorage.getItem("token"),fe={nombre:a,direccion:f,telefono:k,cuenta_bancaria:H,tipo_entidad:z,codigo_reo:K,codigo_nit:u,organismo:h,consecutivo:me},X=await fetch(`${j.public.backendHost}/entidad/filter/${i}/${t}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:Q,Accept:"application/json"},body:JSON.stringify(fe)});if(X.status===401){d.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{J("/")},3e3);return}if(X.status===403){d.value={title:"Acceso Denegado",description:"No tienes permisos para realizar esta acción o acceder a esta información.",type:"error"};return}const ee=await X.json();Z.value=ee.data,s.value=ee.pagination.total}catch(Q){console.error("Error al cargar las entidades:",Q)}finally{b.value=!1}},ie=i=>{o.value=i,L(i,U.value,E.value,l.value,_.value,n.value,m.value,p.value,w.value,V.value,$.value)},le=i=>{I.value=i,S.value=!1,B.value=!0,O.value=!0};we(()=>{L(1,U.value,E.value,l.value,_.value,n.value,m.value,p.value,w.value,V.value,$.value)});const se=[{name:"Editar",icon:{render(){return M("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[M("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})])}},buttonClass:"px-3 py-1 bg-accent text-neutral rounded-md hover:bg-accent/90",handler:i=>{I.value=i,S.value=!0,B.value=!1,O.value=!0}},{name:"Eliminar",icon:{render(){return M("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[M("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})])}},buttonClass:"px-3 py-1 bg-danger text-neutral rounded-md hover:bg-danger/90",handler:i=>{R.value=i,G.value=!0}}],T=async()=>{try{b.value=!0,await L(1,U.value,E.value,l.value,_.value,n.value,m.value,p.value,w.value,V.value,$.value)}catch(i){console.error("Error al buscar entidades:",i)}finally{b.value=!1}},de=async i=>{try{const t=localStorage.getItem("token"),a=S.value?`${j.public.backendHost}/entidad/UpdateEntidad/${I.value.id_entidad}`:`${j.public.backendHost}/entidad/CreateEntidad`,f=await fetch(a,{method:S.value?"PUT":"POST",headers:{"Content-Type":"application/json",Authorization:t,Accept:"application/json"},body:JSON.stringify(i)});if(f.status===401){d.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{J("/")},3e3);return}if(f.status===403){d.value={title:"Acceso Denegado",description:"No tienes permisos para realizar esta acción o acceder a esta información.",type:"error"};return}if(f.status===400||f.status===500){const k=await f.json();k.error?d.value={title:`Errores de validación: ${f.status}`,description:k.error,type:"error"}:d.value={title:`Error: ${f.status}`,description:JSON.stringify(k),type:"error"};return}f.ok?(S.value?d.value={title:`Entidad Actualizada: ${f.status}`,description:`La entidad ${i.nombre} se actualizó con éxito`,type:"success"}:d.value={title:`Entidad Creada: ${f.status}`,description:`La entidad ${i.nombre} se creo con éxito`,type:"success"},await L(o.value,U.value)):console.error("Error al guardar la entidad")}catch(t){console.error("Error:",t)}},ue=()=>{I.value={},S.value=!1,B.value=!1,O.value=!0},d=c(null),G=c(!1),R=c(null),ce={render(){return M("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-neutral",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[M("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})])}};async function pe(){if(G.value=!1,!!R.value)try{const i=localStorage.getItem("token"),t=await fetch(`${j.public.backendHost}/entidad/DeleteEntidad/${R.value.id_entidad}`,{method:"DELETE",headers:{Authorization:i,Accept:"application/json"}});if(t.status===401){d.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{J("/")},3e3);return}if(t.status===403){d.value={title:"Acceso Denegado",description:"No tienes permisos para realizar esta acción o acceder a esta información.",type:"error"};return}if(!t.ok){const a=await t.json();d.value={title:`Error al eliminar: ${t.status}`,description:a.error||JSON.stringify(a),type:"error"};return}d.value={title:"Entidad eliminada",description:`La entidad ${R.value.nombre} fue eliminada correctamente`,type:"success"},await L(o.value,U.value)}catch(i){d.value={title:"Error",description:i.message,type:"error"}}finally{R.value=null}}async function ge(){d.value={title:"Consultando datos",description:"Se están consultando los datos, la descarga comenzará en breve.",type:"info"};try{const i=localStorage.getItem("token"),t={nombre:E.value,direccion:l.value,telefono:_.value,cuenta_bancaria:n.value,tipo_entidad:m.value,codigo_reo:p.value,codigo_nit:w.value,organismo:V.value,consecutivo:$.value},a=await fetch(`${j.public.backendHost}/entidad/filter/1/${s.value}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:i,Accept:"application/json"},body:JSON.stringify(t)});if(a.status===401){d.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{J("/")},3e3);return}if(a.status===403){d.value={title:"Acceso Denegado",description:"No tienes permisos para realizar esta acción o acceder a esta información.",type:"error"};return}if(!a.ok){const u=await a.json();d.value={title:"Error al consultar datos",description:u.error||"Ocurrió un error al consultar los datos.",type:"error"};return}const k=(await a.json()).data.map(u=>({Consecutivo:u.consecutivo,Nombre:u.nombre,Dirección:u.direccion,Organismo:u.organismo,"Cuenta Bancaria":u.cuenta_bancaria,"Tipo de Entidad":u.tipo_entidad,"Código REEUP":u.codigo_reo,"Código NIT":u.codigo_nit,Teléfono:u.telefono})),H=F.json_to_sheet(k),z=F.book_new();F.book_append_sheet(z,H,"Entidades");const K=new Date().toISOString().split("T")[0];te(z,`entidades_${K}.xlsx`),d.value=null}catch(i){console.error("Error al exportar a Excel:",i),d.value={title:"Error",description:"Ocurrió un error al exportar los datos.",type:"error"}}}async function ve(){d.value={title:"Consultando datos",description:"Se están consultando los datos, la descarga comenzará en breve.",type:"info"};try{const i=localStorage.getItem("token"),t={nombre:E.value,direccion:l.value,telefono:_.value,cuenta_bancaria:n.value,tipo_entidad:m.value,codigo_reo:p.value,codigo_nit:w.value,organismo:V.value,consecutivo:$.value},a=await fetch(`${j.public.backendHost}/entidad/filter/1/${s.value}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:i,Accept:"application/json"},body:JSON.stringify(t)});if(a.status===401){d.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{J("/")},3e3);return}if(a.status===403){d.value={title:"Acceso Denegado",description:"No tienes permisos para realizar esta acción o acceder a esta información.",type:"error"};return}if(!a.ok){const u=await a.json();d.value={title:"Error al consultar datos",description:u.error||"Ocurrió un error al consultar los datos.",type:"error"};return}const f=await a.json(),k=[];f.data.forEach(u=>{u.contratos&&u.contratos.length>0&&u.contratos.forEach(h=>{k.push({"Consecutivo Entidad":u.consecutivo,"Nombre Entidad":u.nombre,"Dirección Entidad":u.direccion,"Organismo Entidad":u.organismo,"Cuenta Bancaria Entidad":u.cuenta_bancaria,"Tipo de Entidad":u.tipo_entidad,"Código REEUP":u.codigo_reo,"Código NIT":u.codigo_nit,"Teléfono Entidad":u.telefono,"Consecutivo Contrato":h.num_consecutivo,"Fecha Inicio":h.fecha_inicio,"Fecha Fin":h.fecha_fin,"Tipo de Contrato":h.tipoContrato?.nombre||"","Cliente o Proveedor":h.ClienteOProveedor,"Vigencia Facturas (Días)":h.vigenciaFacturasDias,Clasificación:h.clasificacion,Nota:h.nota})})});const H=F.json_to_sheet(k),z=F.book_new();F.book_append_sheet(z,H,"Entidades con Contratos");const K=new Date().toISOString().split("T")[0];te(z,`entidades_contratos_${K}.xlsx`),d.value=null}catch(i){console.error("Error al exportar a Excel con contratos:",i),d.value={title:"Error",description:"Ocurrió un error al exportar los datos.",type:"error"}}}return(i,t)=>(x(),y("div",Qe,[N(he,{title:"Entidades - Contract Manager",description:"Gestiona proveedores, clientes y otras entidades.",canonical:"/entidades"}),N(Ce),d.value?(x(),y("div",Xe,[N(re,{title:d.value.title,description:d.value.description,type:d.value.type,onClose:t[0]||(t[0]=a=>d.value=null),class:"pointer-events-auto"},null,8,["title","description","type"])])):C("",!0),G.value?(x(),y("div",Ye,[N(Ee,{title:"¿Estás seguro que deseas eliminar esta entidad?",description:"Esta acción no se puede deshacer.",icon:ce,type:"warning",onConfirm:pe,onClose:t[1]||(t[1]=a=>G.value=!1)})])):C("",!0),e("div",Ze,[e("div",eo,[e("div",oo,[t[13]||(t[13]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Buscar por nombre",-1)),e("div",to,[g(e("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=a=>E.value=a),placeholder:"Ingrese el nombre...",class:"w-full pl-10 pr-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary",onKeyup:D(T,["enter"])},null,544),[[v,E.value]]),t[12]||(t[12]=e("div",{class:"absolute left-3 top-2.5"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))])]),e("div",no,[e("button",{onClick:t[3]||(t[3]=a=>A.value=!A.value),class:"flex items-center text-primary hover:brightness-90"},[t[15]||(t[15]=e("span",{class:"mr-2"},"Filtros adicionales",-1)),(x(),y("svg",{xmlns:"http://www.w3.org/2000/svg",class:oe(["h-5 w-5 transform transition-transform",{"rotate-180":A.value}]),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[...t[14]||(t[14]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))])]),e("div",{class:oe(["grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-4",{"hidden md:grid":!A.value}])},[e("div",ao,[t[17]||(t[17]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Buscar por dirección",-1)),e("div",ro,[g(e("input",{type:"text","onUpdate:modelValue":t[4]||(t[4]=a=>l.value=a),placeholder:"Ingrese la dirección...",class:"w-full pl-10 pr-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary",onKeyup:D(T,["enter"])},null,544),[[v,l.value]]),t[16]||(t[16]=e("div",{class:"absolute left-3 top-2.5"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))])]),e("div",io,[t[18]||(t[18]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Teléfono",-1)),g(e("input",{type:"text","onUpdate:modelValue":t[5]||(t[5]=a=>_.value=a),placeholder:"Ingrese teléfono",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary",onKeyup:D(T,["enter"])},null,544),[[v,_.value]])]),e("div",lo,[t[19]||(t[19]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Cuenta bancaria",-1)),g(e("input",{type:"text","onUpdate:modelValue":t[6]||(t[6]=a=>n.value=a),placeholder:"Ingrese cuenta bancaria",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",onKeyup:D(T,["enter"])},null,544),[[v,n.value]])]),e("div",so,[t[20]||(t[20]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Tipo de entidad",-1)),g(e("input",{type:"text","onUpdate:modelValue":t[7]||(t[7]=a=>m.value=a),placeholder:"Ingrese tipo de entidad",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",onKeyup:D(T,["enter"])},null,544),[[v,m.value]])]),e("div",uo,[t[21]||(t[21]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Código REEUP",-1)),g(e("input",{type:"text","onUpdate:modelValue":t[8]||(t[8]=a=>p.value=a),placeholder:"Ingrese código REEUP",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",onKeyup:D(T,["enter"])},null,544),[[v,p.value]])]),e("div",co,[t[22]||(t[22]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Organismo",-1)),g(e("input",{type:"text","onUpdate:modelValue":t[9]||(t[9]=a=>V.value=a),placeholder:"Ingrese organismo",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary",onKeyup:D(T,["enter"])},null,544),[[v,V.value]])]),e("div",po,[t[23]||(t[23]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Consecutivo",-1)),g(e("input",{type:"text","onUpdate:modelValue":t[10]||(t[10]=a=>$.value=a),placeholder:"Ingrese consecutivo",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary",onKeyup:D(T,["enter"])},null,544),[[v,$.value]])])],2),e("div",go,[e("button",{onClick:T,class:"px-6 py-2 bg-primary text-neutral rounded-lg hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition-colors"}," Buscar "),q.value?C("",!0):(x(),y("button",{key:0,onClick:ge,class:"px-6 py-2 bg-success text-neutral rounded-lg hover:bg-success/90 focus:outline-none focus:ring-2 focus:ring-success focus:ring-offset-2 transition-colors"}," Exportar a Excel ")),q.value?C("",!0):(x(),y("button",{key:1,onClick:ve,class:"px-6 py-2 bg-info text-neutral rounded-lg hover:bg-info/90 focus:outline-none focus:ring-2 focus:ring-info focus:ring-offset-2 transition-colors"}," Exportar a Excel con Contratos "))])])]),e("div",vo,[e("div",mo,[t[25]||(t[25]=e("h2",{class:"text-2xl font-bold"},"Entidades",-1)),q.value?C("",!0):(x(),y("button",{key:0,onClick:ue,class:"px-4 py-2 bg-primary text-neutral rounded-lg hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-primary flex items-center"},[...t[24]||(t[24]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),ne(" Nueva Entidad ",-1)])]))]),N(ae,{columns:r,items:Z.value,actions:q.value?[]:se,"total-items":s.value,"items-per-page":U.value,"current-page":o.value,"is-loading":b.value,onPageChange:ie,onRowClick:le},null,8,["items","actions","total-items","items-per-page","current-page","is-loading"])]),N(We,{modelValue:O.value,"onUpdate:modelValue":t[11]||(t[11]=a=>O.value=a),entidad:I.value,"is-editing":S.value,"is-viewing":B.value,onSubmit:de},null,8,["modelValue","entidad","is-editing","is-viewing"])]))}},_o=xe(fo,[["__scopeId","data-v-b48338b8"]]);export{_o as default};
