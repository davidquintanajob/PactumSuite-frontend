import{Q as Ue,r as i,k as ee,M as _e,n as J,y as m,F as P,z as g,A as e,C as G,B as R,J as ke,K as C,L as N,H as pe,E as ce,O as Oe,P as ze,u as Ae,o as He,R as xe,$ as Be,h as Ce}from"#entry";import{S as Le}from"./CC2Sf2Ne.js";import{N as Re}from"./DTHag2Fn.js";import{D as $e}from"./DIpJa8iN.js";import{_ as je}from"./CP6NTKUH.js";import{_ as Je}from"./DWLPyndB.js";import{u as O,w as Ne}from"./3SA47z_C.js";import"./BzLCLO6P.js";const qe=Ue("/camera.png"),We={key:0,class:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center"},Ke={key:0,class:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/50"},Ge={key:1,class:"fixed top-6 left-1/2 transform -translate-x-1/2 z-[9999] w-full max-w-md px-4 pointer-events-none"},Qe={class:"flex justify-between items-center mb-6"},Xe={class:"text-2xl font-bold text-gray-800"},Ye=["disabled"],Ze={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},eo=["readonly","disabled"],oo=["readonly","disabled"],to=["readonly","disabled"],ro={key:0},ao=["readonly","disabled"],no={key:1},so=["readonly","disabled"],lo={key:2},io=["readonly","disabled"],uo=["readonly","disabled"],co=["readonly","disabled"],po=["readonly","disabled"],vo={class:"relative mt-2"},fo=["disabled"],mo={key:0,class:"w-full h-full flex flex-col items-center justify-center gap-3"},go={class:"flex items-center justify-center gap-2"},bo=["disabled"],yo=["disabled"],xo={key:1,class:"text-center px-4"},wo={class:"flex items-center justify-center gap-2"},ho=["disabled"],ko=["disabled"],Co={key:2,class:"flex items-center justify-center w-full h-full"},No={key:3,class:"w-full h-full flex items-center justify-center p-2"},Po=["src"],So={key:3},Vo=["required"],Eo=["readonly","disabled"],Mo={key:0,class:"flex justify-end space-x-4 mt-6"},_o=["disabled"],Do=["disabled"],$o={key:0,class:"flex items-center"},jo={key:1},Io={key:0,class:"mt-6"},Fo={class:"overflow-x-auto"},To={class:"min-w-full bg-white border border-gray-300"},Uo={class:"bg-white divide-y divide-gray-200"},Oo={class:"px-4 py-2 whitespace-nowrap text-sm text-gray-900"},zo={class:"px-4 py-2 whitespace-nowrap text-sm"},Ao=["innerHTML"],Ho={class:"px-4 py-2 whitespace-nowrap text-sm text-gray-900"},Bo={class:"px-4 py-2 whitespace-nowrap text-sm"},Lo=["innerHTML"],Ro={class:"px-4 py-2 whitespace-nowrap text-sm text-gray-900"},Jo={class:"px-4 py-2 whitespace-nowrap text-sm text-gray-900"},qo={class:"px-4 py-2 whitespace-nowrap text-sm text-gray-900"},Wo={key:1,class:"text-red-600 text-sm mt-2"},Ko={__name:"ProductoModal",props:{modelValue:{type:Boolean,required:!0},producto:{type:Object,default:()=>({})},isEditing:{type:Boolean,default:!1},isViewing:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1}},emits:["update:modelValue","submit"],setup(p,{emit:Q}){const j=p,q=Q,s=i({codigo:"",nombre:"",precio:"",nota:"",unidadMedida:"",tipoProducto:"",cantidadExistencia:0,costo:0,precio_usd:"",costo_usd:"",precio_inspectores_cup:0}),M=i(1);i(!1),i(!1),i(!1),i(!1);const k=i(null),T=i(null),S=i(!1),I=i(!1),B=i(null),D=i(!1),L=J(),U=i(!1),_=i(null),W=i(null),X=ee(()=>{try{const r=localStorage.getItem("usuario");if(!r)return!1;const t=JSON.parse(r),a=t&&(t.rol||t.role||t.perfil&&t.perfil.rol||t.profile&&t.profile.role)?t.rol||t.role||t.perfil&&t.perfil.rol||t.profile&&t.profile.role:null;return a?String(a).trim().toLowerCase()==="vendedor":!1}catch{return!1}}),u=ee(()=>{try{const r=localStorage.getItem("usuario");if(!r)return!1;const t=JSON.parse(r),a=t&&(t.rol||t.role||t.perfil&&t.perfil.rol||t.profile&&t.profile.role)?t.rol||t.role||t.perfil&&t.perfil.rol||t.profile&&t.profile.role:null;if(!a)return!1;const f=String(a).trim().toLowerCase();return f==="administrador"||f==="admin"}catch{return!1}}),z=i(""),h=i(!1),V=i(null);_e(()=>j.producto,r=>{r&&Object.keys(r).length>0?(s.value={codigo:r.codigo||"",nombre:r.nombre||"",precio:r.precio||"",nota:r.nota||"",unidadMedida:r.unidadMedida||"",tipoProducto:r.tipoProducto||"",cantidadExistencia:r.cantidadExistencia||0,costo:r.costo||0,precio_usd:r.precio_usd!==void 0&&r.precio_usd!==null?String(r.precio_usd):"",costo_usd:r.costo_usd!==void 0&&r.costo_usd!==null?String(r.costo_usd):"",precio_inspectores_cup:r.precio_inspectores_cup!==void 0&&r.precio_inspectores_cup!==null?Number(r.precio_inspectores_cup):0},r.foto?(typeof r.foto=="string"&&(r.foto.startsWith("http")||r.foto.startsWith("data:"))?k.value=r.foto:k.value=`${L.public.backendHost}${r.foto}`,T.value="imagen_producto",S.value=!1):(k.value=null,T.value=null,S.value=!1)):(s.value={codigo:"",nombre:"",precio:"",nota:"",unidadMedida:"",tipoProducto:"",cantidadExistencia:0,costo:0,precio_usd:"",costo_usd:"",precio_inspectores_cup:0},k.value=null,T.value=null,S.value=!1)},{immediate:!0}),_e(()=>j.modelValue,r=>{if(r){Ve();try{const t=localStorage.getItem("config");if(t){const a=JSON.parse(t),f=Number(a?.cambio_moneda);!isNaN(f)&&f>0?M.value=f:M.value=1}else M.value=1}catch{M.value=1}}else k.value=null,T.value=null,S.value=!1,D.value=!1,ie()});function oe(r){const t=r&&r.target?r.target.value:s.value.precio,a=Number(M.value)||1,f=Number(t);if(isNaN(f)){s.value.precio_usd="";return}const b=f/a;s.value.precio_usd=b.toFixed(5)}function te(r){const t=r&&r.target?r.target.value:s.value.precio_usd,a=Number(M.value)||1,f=Number(t);if(isNaN(f)){s.value.precio="";return}const b=f*a;s.value.precio=b.toFixed(5)}function Y(r){const t=r&&r.target?r.target.value:s.value.costo,a=Number(M.value)||1,f=Number(t);if(isNaN(f)){s.value.costo_usd="";return}const b=f/a;s.value.costo_usd=b.toFixed(5)}function ve(r){const t=r&&r.target?r.target.value:s.value.costo_usd,a=Number(M.value)||1,f=Number(t);if(isNaN(f)){s.value.costo="";return}const b=f*a;s.value.costo=b.toFixed(5)}function fe(r){const t=r&&r.target?r.target.value:s.value.precio_inspectores_cup,a=Number(t);if(isNaN(a)||a<0){s.value.precio_inspectores_cup=0;return}s.value.precio_inspectores_cup=a}const me=async()=>{z.value="";const t=["codigo","nombre","unidadMedida","tipoProducto"].filter(a=>!s.value[a]);if(t.length>0){z.value="Los campos "+t.join(", ")+" son obligatorios.";return}h.value=!0,V.value={title:j.isEditing?"Guardando Producto":"Creando Producto",description:"Comunicando con el servidor, espere por favor...",type:"warning"};try{await new Promise((a,f)=>{const b={codigo:s.value.codigo,nombre:s.value.nombre,nota:s.value.nota,unidadMedida:s.value.unidadMedida,tipoProducto:s.value.tipoProducto,cantidadExistencia:j.isEditing?Number(s.value.cantidadExistencia):0};s.value.precio!==""&&s.value.precio!==null&&!isNaN(Number(s.value.precio))&&(b.precio=Number(s.value.precio)),s.value.costo!==""&&s.value.costo!==null&&!isNaN(Number(s.value.costo))&&(b.costo=Number(s.value.costo)),u.value&&(s.value.precio_usd!==""&&s.value.precio_usd!==null&&!isNaN(Number(s.value.precio_usd))&&(b.precio_usd=Number(s.value.precio_usd)),s.value.costo_usd!==""&&s.value.costo_usd!==null&&!isNaN(Number(s.value.costo_usd))&&(b.costo_usd=Number(s.value.costo_usd)));const A=Number(s.value.precio_inspectores_cup);!isNaN(A)&&A>=0?b.precio_inspectores_cup=A:b.precio_inspectores_cup=0,S.value&&k.value&&(b.foto=k.value),q("submit",b),setTimeout(a,100)})}catch(a){console.error("Error en handleSubmit:",a)}finally{setTimeout(()=>{h.value=!1,V.value=null},500)}};function re(r){const t=r.target&&r.target.files?r.target.files[0]:null;t&&(D.value=!0,ye(t).then(a=>{k.value=a,T.value=t.name,S.value=!0}).catch(()=>{z.value="No se pudo procesar la imagen seleccionada."}).finally(()=>{D.value=!1}))}function ge(){k.value=null,T.value=null,S.value=!0}function ae(){B.value&&B.value.click()}function ne(){I.value=!0}function se(){I.value=!1}function le(r){I.value=!1;const t=r.dataTransfer&&r.dataTransfer.files?r.dataTransfer.files[0]:null;t&&(D.value=!0,ye(t).then(a=>{k.value=a,T.value=t.name,S.value=!0}).catch(()=>{z.value="No se pudo procesar la imagen arrastrada."}).finally(()=>{D.value=!1}))}async function Pe(){U.value=!0,await Se()}async function Se(){try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)return;const r=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"},audio:!1});W.value=r,_.value&&(_.value.srcObject=r),_.value&&await _.value.play()}catch(r){console.error("No se pudo acceder a la cámara",r),U.value=!1}}function ie(){try{W.value&&(W.value.getTracks().forEach(r=>r.stop()),W.value=null),_.value&&_.value.pause&&_.value.pause()}catch{}}async function we(){if(!_.value)return;const r=_.value,t=r.videoWidth,a=r.videoHeight,f=document.createElement("canvas");return f.width=t,f.height=a,f.getContext("2d").drawImage(r,0,0,t,a),new Promise((A,ue)=>{f.toBlob(async $=>{if(!$)return ue(new Error("no_blob"));try{const F=new File([$],"camera.jpg",{type:$.type||"image/jpeg"}),Z=await ye(F);k.value=Z,T.value=F.name,S.value=!0,A()}catch(F){ue(F)}},"image/jpeg")}).finally(()=>{ie(),U.value=!1})}function be(){ie(),U.value=!1}function ye(r){return new Promise((a,f)=>{const b=new Image,A=new FileReader;A.onerror=()=>f(new Error("read_error")),A.onload=ue=>{b.onload=()=>{let{width:$,height:F}=b,Z=1;($>1280||F>1280)&&(Z=Math.min(1280/$,1280/F),$=Math.round($*Z),F=Math.round(F*Z));const de=document.createElement("canvas");de.width=$,de.height=F,de.getContext("2d").drawImage(b,0,0,$,F),de.toBlob(he=>{if(!he)return f(new Error("compress_error"));const H=new FileReader;H.onload=()=>a(H.result),H.onerror=()=>f(new Error("read_blob_error")),H.readAsDataURL(he)},"image/webp",.9)},b.onerror=()=>f(new Error("image_load_error")),b.src=ue.target.result},A.readAsDataURL(r)})}function Ve(){const r=j.producto||{};if(r&&r.foto){const t=typeof r.foto=="string"&&(r.foto.startsWith("http")||r.foto.startsWith("data:"))?r.foto:`${L.public.backendHost}${r.foto}`;if(t.startsWith("data:")){k.value=t,S.value=!1,D.value=!1;return}D.value=!0;const a=new Image;a.crossOrigin="anonymous",a.onload=()=>{k.value=t,S.value=!1,D.value=!1},a.onerror=()=>{k.value=null,S.value=!1,D.value=!1},a.src=t}else k.value=null,S.value=!1,D.value=!1}function Ee(r){if(!r)return"";let t="",a="";return r==="Facturado"?(t="bg-green-100",a="text-green-800"):r==="No Facturado"?(t="bg-yellow-100",a="text-yellow-800"):r==="Cancelado"&&(t="bg-red-100",a="text-red-800"),`<span class="px-2 py-1 rounded-full text-sm font-medium ${t} ${a}">${r}</span>`}function Me(r){if(!r)return"";let t="",a="";if(r==="Proveedor")t="bg-yellow-100",a="text-yellow-800";else if(r==="Cliente")t="bg-blue-100",a="text-blue-800";else return"";return`<span class="px-2 py-1 rounded-full text-sm font-medium ${t} ${a}">${r}</span>`}return(r,t)=>p.modelValue?(g(),m("div",We,[h.value?(g(),m("div",Ke,[...t[14]||(t[14]=[e("div",{class:"bg-white rounded-lg p-8 shadow-xl flex flex-col items-center gap-4"},[e("div",{class:"w-12 h-12 border-4 border-gray-200 border-t-primary rounded-full animate-spin"}),e("p",{class:"text-gray-700 font-medium"},"Procesando, espere...")],-1)])])):P("",!0),V.value?(g(),m("div",Ge,[G(je,{title:V.value.title,description:V.value.description,type:V.value.type,onClose:t[0]||(t[0]=a=>V.value=null),class:"pointer-events-auto"},null,8,["title","description","type"])])):P("",!0),e("div",{class:pe(["bg-white rounded-lg p-6 w-full max-w-4xl max-h-[80vh] overflow-y-auto",h.value&&"pointer-events-none opacity-50"])},[e("div",Qe,[e("h2",Xe,R(p.isViewing?"Detalles de Producto":p.isEditing?"Editar Producto":"Nuevo Producto"),1),e("button",{onClick:t[1]||(t[1]=a=>r.$emit("update:modelValue",!1)),disabled:h.value,class:"text-gray-500 hover:text-gray-700 disabled:opacity-50 disabled:cursor-not-allowed"},[...t[15]||(t[15]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,Ye)]),e("form",{onSubmit:ke(me,["prevent"]),class:"space-y-4"},[e("div",Ze,[e("div",null,[t[16]||(t[16]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Código",-1)),C(e("input",{"onUpdate:modelValue":t[2]||(t[2]=a=>s.value.codigo=a),type:"text",required:"",readonly:p.isViewing,disabled:p.isViewing||h.value,class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ingrese el código del producto"},null,8,eo),[[N,s.value.codigo]])]),e("div",null,[t[17]||(t[17]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Nombre",-1)),C(e("input",{"onUpdate:modelValue":t[3]||(t[3]=a=>s.value.nombre=a),type:"text",required:"",readonly:p.isViewing,disabled:p.isViewing||h.value,class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ingrese el nombre del producto"},null,8,oo),[[N,s.value.nombre]])]),e("div",null,[t[18]||(t[18]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Precio",-1)),C(e("input",{"onUpdate:modelValue":t[4]||(t[4]=a=>s.value.precio=a),onInput:oe,type:"number",step:"any",readonly:p.isViewing,disabled:p.isViewing||h.value,class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ingrese el precio"},null,40,to),[[N,s.value.precio]])]),X.value?P("",!0):(g(),m("div",ro,[t[19]||(t[19]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Costo",-1)),C(e("input",{"onUpdate:modelValue":t[5]||(t[5]=a=>s.value.costo=a),onInput:Y,type:"number",step:"any",readonly:p.isViewing,disabled:p.isViewing||h.value,class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ingrese el costo"},null,40,ao),[[N,s.value.costo]])])),u.value?(g(),m("div",no,[t[20]||(t[20]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Precio USD",-1)),C(e("input",{"onUpdate:modelValue":t[6]||(t[6]=a=>s.value.precio_usd=a),onInput:te,type:"number",step:"any",readonly:p.isViewing,disabled:p.isViewing||h.value,class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ingrese el precio en USD"},null,40,so),[[N,s.value.precio_usd]])])):P("",!0),u.value?(g(),m("div",lo,[t[21]||(t[21]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Costo USD",-1)),C(e("input",{"onUpdate:modelValue":t[7]||(t[7]=a=>s.value.costo_usd=a),onInput:ve,type:"number",step:"any",readonly:p.isViewing,disabled:p.isViewing||h.value,class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ingrese el costo en USD"},null,40,io),[[N,s.value.costo_usd]])])):P("",!0),e("div",null,[t[22]||(t[22]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Costo Inspectores CUP",-1)),C(e("input",{"onUpdate:modelValue":t[8]||(t[8]=a=>s.value.precio_inspectores_cup=a),onInput:fe,type:"number",step:"any",min:"0",readonly:p.isViewing,disabled:p.isViewing||h.value,class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ingrese el precio para inspectores (CUP)"},null,40,uo),[[N,s.value.precio_inspectores_cup]])]),e("div",null,[t[23]||(t[23]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Unidad de Medida",-1)),C(e("input",{"onUpdate:modelValue":t[9]||(t[9]=a=>s.value.unidadMedida=a),type:"text",required:"",readonly:p.isViewing,disabled:p.isViewing||h.value,class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ingrese la unidad de medida"},null,8,co),[[N,s.value.unidadMedida]])]),e("div",null,[t[24]||(t[24]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Tipo de Producto",-1)),C(e("input",{"onUpdate:modelValue":t[10]||(t[10]=a=>s.value.tipoProducto=a),type:"text",required:"",readonly:p.isViewing,disabled:p.isViewing||h.value,class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ingrese el tipo de producto"},null,8,po),[[N,s.value.tipoProducto]])]),e("div",null,[t[29]||(t[29]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Foto",-1)),e("div",vo,[e("div",{class:pe(["w-full h-40 rounded border-dashed border-2 flex items-center justify-center bg-gray-50",I.value?"border-blue-400 bg-blue-50":"border-gray-300"]),onDragover:ke(ne,["prevent"]),onDragleave:ke(se,["prevent"]),onDrop:ke(le,["prevent"])},[e("input",{ref_key:"hiddenFileInput",ref:B,type:"file",accept:"image/*",class:"hidden",onChange:re,disabled:p.isViewing||h.value},null,40,fo),U.value?(g(),m("div",mo,[e("video",{ref_key:"videoRef",ref:_,class:"w-full h-full object-contain rounded",autoplay:"",playsinline:""},null,512),e("div",go,[e("button",{type:"button",onClick:we,disabled:p.isViewing||h.value,class:"px-4 py-2 bg-primary text-white rounded shadow"},"Tomar foto",8,bo),e("button",{type:"button",onClick:be,disabled:p.isViewing||h.value,class:"px-4 py-2 bg-white border rounded"},"Cancelar",8,yo)])])):!k.value&&!D.value?(g(),m("div",xo,[t[26]||(t[26]=e("p",{class:"text-sm text-gray-500 mb-2"},"Arrastra la foto aquí",-1)),e("div",wo,[e("button",{type:"button",onClick:ae,disabled:p.isViewing||h.value,class:"px-4 py-2 bg-primary text-white rounded shadow flex items-center gap-2"}," Elegir foto ",8,ho),e("button",{type:"button",onClick:Pe,disabled:p.isViewing||h.value,class:"px-3 py-2 bg-white border rounded flex items-center gap-2"},[...t[25]||(t[25]=[e("img",{src:qe,alt:"cam",class:"w-5 h-5 bg-white rounded"},null,-1),e("span",{class:"text-sm text-gray-700"},"Cámara",-1)])],8,ko)])])):D.value?(g(),m("div",Co,[...t[27]||(t[27]=[e("svg",{class:"animate-spin h-8 w-8 text-gray-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})],-1)])])):(g(),m("div",No,[e("img",{src:k.value,alt:"Previsualización",class:"max-h-full object-contain rounded"},null,8,Po)]))],34),k.value?(g(),m("button",{key:0,type:"button",onClick:ge,class:"absolute top-2 right-2 bg-red-600 text-white rounded-full w-8 h-8 flex items-center justify-center shadow"},[...t[28]||(t[28]=[e("span",{class:"text-sm font-bold"},"×",-1)])])):P("",!0)])]),p.isEditing||p.isViewing?(g(),m("div",So,[t[30]||(t[30]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Cantidad en Existencia",-1)),C(e("input",{"onUpdate:modelValue":t[11]||(t[11]=a=>s.value.cantidadExistencia=a),type:"number",required:p.isEditing,readonly:!0,disabled:!0,class:"w-full px-4 py-2 rounded-lg border bg-gray-100 text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ingrese la cantidad en existencia"},null,8,Vo),[[N,s.value.cantidadExistencia]])])):P("",!0)]),e("div",null,[t[31]||(t[31]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Nota",-1)),C(e("textarea",{"onUpdate:modelValue":t[12]||(t[12]=a=>s.value.nota=a),readonly:p.isViewing,disabled:p.isViewing||h.value,class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ingrese una nota (opcional)",rows:"3"},null,8,Eo),[[N,s.value.nota]])]),p.isViewing?P("",!0):(g(),m("div",Mo,[e("button",{type:"button",onClick:t[13]||(t[13]=a=>r.$emit("update:modelValue",!1)),class:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-500 disabled:opacity-50 disabled:cursor-not-allowed",disabled:h.value}," Cancelar ",8,_o),e("button",{type:"submit",class:"px-4 py-2 text-neutral bg-primary rounded-lg hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-primary disabled:opacity-50 disabled:cursor-not-allowed",disabled:h.value},[h.value?(g(),m("span",$o,[t[32]||(t[32]=e("svg",{class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)),ce(" "+R(p.isEditing?"Guardando...":"Creando..."),1)])):(g(),m("span",jo,R(p.isEditing?"Guardar Cambios":"Crear Producto"),1))],8,Do)]))],32),(p.isViewing||p.isEditing)&&j.producto.facturaProductos&&j.producto.facturaProductos.length>0?(g(),m("div",Io,[t[34]||(t[34]=e("h3",{class:"text-lg font-semibold text-gray-800 mb-4"},"Historial de Facturas",-1)),e("div",Fo,[e("table",To,[t[33]||(t[33]=e("thead",null,[e("tr",{class:"bg-gray-50"},[e("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"N° Consecu"),e("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Cliente/Proveedor"),e("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Fecha"),e("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Estado"),e("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Cantidad"),e("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Precio Venta"),e("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Costo Venta")])],-1)),e("tbody",Uo,[(g(!0),m(Oe,null,ze(j.producto.facturaProductos,a=>(g(),m("tr",{key:a.id_factura_producto},[e("td",Oo,R(a.factura.num_consecutivo),1),e("td",zo,[e("span",{innerHTML:Me(a.factura.contrato.ClienteOProveedor)},null,8,Ao)]),e("td",Ho,R(new Date(a.factura.fecha).toLocaleDateString()),1),e("td",Bo,[e("span",{innerHTML:Ee(a.factura.estado)},null,8,Lo)]),e("td",Ro,R(a.cantidad),1),e("td",Jo,R(a.precioVenta),1),e("td",qo,R(a.costoVenta),1)]))),128))])])])])):P("",!0),z.value?(g(),m("div",Wo,R(z.value),1)):P("",!0)],2)])):P("",!0)}},Go={class:"min-h-screen bg-gradient-to-br via-secondary/40 from-accent/30 to-neutral"},Qo={key:0,class:"fixed top-6 left-1/2 transform -translate-x-1/2 z-[9999] w-full max-w-md px-4 pointer-events-none"},Xo={key:1,class:"fixed top-24 left-1/2 transform -translate-x-1/2 z-[10000] w-full max-w-md px-4 pointer-events-auto"},Yo={key:2,class:"w-[95%] mx-auto px-4 py-4 md:py-4 mt-20 md:mt-0"},Zo={class:"bg-white rounded-lg shadow-md p-4"},et={class:"grid grid-cols-1 md:grid-cols-3 gap-4 items-end mb-4 md:mb-2"},ot={class:"relative"},tt={class:"flex space-x-2"},rt={class:"flex-1"},at={class:"flex-1"},nt={class:"flex justify-end mt-4 gap-2 flex-wrap"},st={class:"flex justify-between items-center mb-4 mt-2"},lt={class:"flex items-center gap-2 flex-wrap"},it={key:3,class:"w-[95%] mx-auto px-4 py-4"},ut={key:4,class:"w-[95%] mx-auto px-4 py-4"},dt={class:"bg-white rounded-lg shadow-md p-4 mb-4"},ct={class:"grid grid-cols-1 md:grid-cols-3 gap-4 items-end"},pt={class:"flex items-center gap-2 flex-wrap"},ht={__name:"productos",setup(p){const{navigateTo:Q}=Ae(),j=i(""),q=i(""),s=i(""),M=i(""),k=i(""),T=i([]),S=i(0),I=i(10),B=i(1),D=i(!1),L=i(!1),U=i(null),_=i(!1),W=i(!1),X=i(!1),u=i(null),z=i(!1),h=i(null),V=i("productos"),oe=i([]),te=i(0),Y=i(1),ve=i(!1),fe=i(""),me=i(""),re=i(""),ge=i(""),ae=i(""),ne=i(""),se=i(""),le=i(""),Pe=[{key:"productoCodigo",label:"Código"},{key:"productoNombre",label:"Nombre"},{key:"productoUnidad",label:"Unidad de Medida"},{key:"cantidad",label:"Cantidad"},{key:"precioVenta",label:"Precio Venta"},{key:"total",label:"Total (Cant x Precio)"},{key:"numConsecutivo",label:"N° Consecutivo factura"},{key:"fechaFactura",label:"Fecha"}],Se=[];let ie={};const we=()=>{const l={nombre_producto:me.value||void 0,codigo_producto:fe.value||void 0,num_consecutivo:re.value?Number(re.value):void 0,estado:ge.value||void 0,fecha_desde:ae.value?new Date(ae.value).toISOString():void 0,fecha_hasta:ne.value?new Date(ne.value).toISOString():void 0,precio_min:se.value!==""?Number(se.value):void 0,precio_max:le.value!==""?Number(le.value):void 0};return Object.keys(l).forEach(o=>l[o]===void 0&&delete l[o]),l},be=async(l=Y.value,o=I.value)=>{ve.value=!0;try{const n=localStorage.getItem("token"),c=J(),x=await(await fetch(`${c.public.backendHost}/FacturaProducto/filterFacturaProductos/${l}/${o}`,{method:"POST",headers:{Authorization:n,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(ie)})).json(),E=Array.isArray(x.data)?x.data:[];oe.value=E.map(v=>({id:v.id_factura_producto,productoCodigo:v.producto?.codigo??"",productoNombre:v.producto?.nombre??"",productoUnidad:v.producto?.unidadMedida??"",cantidad:Number(v.cantidad??0).toFixed(2),precioVenta:Number(v.precioVenta??0).toFixed(2),total:(Number(v.cantidad??0)*Number(v.precioVenta??0)).toFixed(2),numConsecutivo:v.factura?.num_consecutivo??"",fechaFactura:v.factura?.fecha?new Date(v.factura.fecha).toLocaleDateString("es-ES"):""})),te.value=x.pagination?.total||0}catch{oe.value=[],te.value=0}finally{ve.value=!1}},ye=l=>{Y.value=l,be(l)},Ve=async()=>{ie=we(),Y.value=1,await be(1,I.value)};_e(V,async l=>{l==="ventas"&&oe.value.length===0&&await be(Y.value,I.value)});async function Ee(){u.value={title:"Consultando datos",description:"Se están consultando los datos de ventas, la descarga comenzará en breve.",type:"info"};try{const l=localStorage.getItem("token"),o=J(),n=we(),c=await fetch(`${o.public.backendHost}/FacturaProducto/filterFacturaProductos/1/${te.value||1e5}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:l,Accept:"application/json"},body:JSON.stringify(n)});if(!c.ok){const d=await c.json();u.value={title:"Error al consultar datos",description:d.error||"Ocurrió un error al consultar los datos de ventas.",type:"error"};return}const y=await c.json(),x=(Array.isArray(y.data)?y.data:[]).map(d=>({"Código Producto":d.producto?.codigo??"","Nombre Producto":d.producto?.nombre??"","Unidad de Medida":d.producto?.unidadMedida??"",Cantidad:Number(d.cantidad??0).toFixed(2),"Precio Venta":Number(d.precioVenta??0).toFixed(2),"Total (Cant x Precio)":(Number(d.cantidad??0)*Number(d.precioVenta??0)).toFixed(2),"N° Consecutivo factura":d.factura?.num_consecutivo??"","Fecha Factura":d.factura?.fecha?new Date(d.factura.fecha).toLocaleDateString("es-ES"):""})),E=O.json_to_sheet(x),v=O.book_new();O.book_append_sheet(v,E,"Ventas");const K=new Date().toISOString().split("T")[0];Ne(v,`ventas_${K}.xlsx`),u.value=null}catch{u.value={title:"Error",description:"Ocurrió un error al exportar los datos de ventas.",type:"error"}}}const Me=[{key:"codigo",label:"Código"},{key:"nombre",label:"Nombre"},{key:"unidadMedida",label:"Unidad de Medida"},{key:"precio",label:"Precio"},{key:"costo",label:"Costo"},{key:"precio_usd",label:"Precio USD"},{key:"costo_usd",label:"Costo USD"},{key:"tipoProducto",label:"Tipo de Producto"},{key:"cantidadExistencia",label:"Existencia"}],t=[{name:"Editar",icon:{render(){return Ce("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[Ce("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})])}},handler:l=>{U.value=l,_.value=!0,X.value=!1,L.value=!0},buttonClass:"px-3 py-1 bg-accent text-neutral rounded-md hover:bg-accent/90"},{name:"Eliminar",icon:{render(){return Ce("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-neutral",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[Ce("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})])}},handler:l=>{h.value=l,z.value=!0},buttonClass:"px-3 py-1 bg-danger text-neutral rounded-md hover:bg-danger/90"}],a=ee(()=>{try{const l=localStorage.getItem("usuario");if(!l)return!1;const o=JSON.parse(l),n=o&&(o.rol||o.role||o.perfil&&o.perfil.rol||o.profile&&o.profile.role)?o.rol||o.role||o.perfil&&o.perfil.rol||o.profile&&o.profile.role:null;return n?String(n).trim().toLowerCase()==="vendedor":!1}catch{return!1}}),f=ee(()=>{try{const l=localStorage.getItem("usuario");if(!l)return!1;const o=JSON.parse(l),n=o&&(o.rol||o.role||o.perfil&&o.perfil.rol||o.profile&&o.profile.role)?o.rol||o.role||o.perfil&&o.perfil.rol||o.profile&&o.profile.role:null;if(!n)return!1;const c=String(n).trim().toLowerCase();return c==="administrador"||c==="admin"}catch{return!1}}),b=ee(()=>{try{const l=localStorage.getItem("usuario");if(!l)return!1;const o=JSON.parse(l),n=o&&(o.rol||o.role||o.perfil&&o.perfil.rol||o.profile&&o.profile.role)?o.rol||o.role||o.perfil&&o.perfil.rol||o.profile&&o.profile.role:null;return n?String(n).trim().toLowerCase()==="invitado":!1}catch{return!1}}),A=ee(()=>Me.filter(l=>!(a.value&&l.key==="costo"||!f.value&&(l.key==="precio_usd"||l.key==="costo_usd")))),ue=ee(()=>a.value||b.value?[]:t),$=async(l=B.value,o=I.value)=>{D.value=!0;try{const n=localStorage.getItem("token"),c=J(),y={codigo:j.value,nombre:q.value,precio:{min:s.value?Number(s.value):void 0,max:M.value?Number(M.value):void 0},nota:k.value};!y.precio.min&&!y.precio.max?delete y.precio:(y.precio.min||delete y.precio.min,y.precio.max||delete y.precio.max);const E=await(await fetch(`${c.public.backendHost}/Producto/filterProductos/${l}/${o}`,{method:"POST",headers:{Authorization:n,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(y)})).json();T.value=Array.isArray(E.data)?E.data.map(v=>({...v,precio:v.precio!==void 0&&v.precio!==null?Number(v.precio).toFixed(2):"",precio_usd:v.precio_usd!==void 0&&v.precio_usd!==null?Number(v.precio_usd).toFixed(2):"",costo_usd:v.costo_usd!==void 0&&v.costo_usd!==null?Number(v.costo_usd).toFixed(2):""})):[],S.value=E.pagination?.total||0}catch{T.value=[],S.value=0}finally{D.value=!1}},F=l=>{B.value=l,$(l)},Z=l=>{U.value=l,_.value=!1,X.value=!0,L.value=!0};He(()=>{$()});const de=async l=>{W.value=!0;try{const o=localStorage.getItem("token"),n=J(),c=_.value?`${n.public.backendHost}/Producto/updateProducto/${U.value.id_producto}`:`${n.public.backendHost}/Producto/createProducto`,y=await fetch(c,{method:_.value?"PUT":"POST",headers:{"Content-Type":"application/json",Authorization:o,Accept:"application/json"},body:JSON.stringify(l)});if(y.status===401){u.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{Q("/")},3e3);return}if(y.status===403){u.value={title:"Acceso Denegado",description:"No tienes permisos para realizar esta acción o acceder a esta información.",type:"error"};return}let x=null;try{x=await y.json()}catch{x=null}if(!y.ok){let E="Error desconocido";x&&x.errors&&Array.isArray(x.errors)?E=x.errors.join(`
• `):x&&typeof x.error=="string"?E=x.error:x&&(x.message||x.description)?E=x.message||x.description:x&&(E=JSON.stringify(x)),u.value={title:`Error ${y.status}`,description:E,type:"error"};return}y.ok?(_.value?u.value={title:`Producto Actualizado: ${y.status}`,description:`El producto ${l.nombre} se actualizó con éxito`,type:"success"}:u.value={title:`Producto Creado: ${y.status}`,description:`El producto ${l.nombre} se creó con éxito`,type:"success"},await $(B.value,I.value),L.value=!1,U.value=null,_.value=!1,X.value=!1):console.error("Error al guardar el producto")}catch(o){console.error("Error:",o),u.value={title:"Error",description:o.message,type:"error"}}finally{W.value=!1}},De=()=>{U.value={},_.value=!1,X.value=!1,L.value=!0};async function he(){if(z.value=!1,!!h.value)try{const l=localStorage.getItem("token"),o=J(),n=await fetch(`${o.public.backendHost}/Producto/DeleteProducto/${h.value.id_producto}`,{method:"DELETE",headers:{Authorization:l,Accept:"application/json"}});if(n.status===401){u.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{Q("/")},3e3);return}if(n.status===403){u.value={title:"Acceso Denegado",description:"No tienes permisos para realizar esta acción o acceder a esta información.",type:"error"};return}if(!n.ok){const c=await n.json();u.value={title:`Error al eliminar: ${n.status}`,description:c.message||JSON.stringify(c),type:"error"};return}u.value={title:"Producto eliminado",description:"El producto fue eliminado correctamente",type:"success"},await $(B.value,I.value)}catch(l){u.value={title:"Error",description:l.message,type:"error"}}finally{h.value=null}}const H=async()=>{try{D.value=!0,await $(1,I.value)}catch(l){console.error("Error al buscar productos:",l)}finally{D.value=!1}};async function Ie(){u.value={title:"Consultando datos",description:"Se están consultando los datos, la descarga comenzará en breve.",type:"info"};try{const l=localStorage.getItem("token"),o=J(),n={codigo:j.value,nombre:q.value,precio:{min:s.value?Number(s.value):void 0,max:M.value?Number(M.value):void 0},nota:k.value};!n.precio.min&&!n.precio.max?delete n.precio:(n.precio.min||delete n.precio.min,n.precio.max||delete n.precio.max);const c=await fetch(`${o.public.backendHost}/Producto/filterProductos/1/${S.value}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:l,Accept:"application/json"},body:JSON.stringify(n)});if(c.status===401){u.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{Q("/")},3e3);return}if(c.status===403){u.value={title:"Acceso Denegado",description:"No tienes permisos para realizar esta acción o acceder a esta información.",type:"error"};return}if(!c.ok){const d=await c.json();u.value={title:"Error al consultar datos",description:d.error||"Ocurrió un error al consultar los datos.",type:"error"};return}const x=(await c.json()).data.map(d=>{const w={Código:d.codigo,Nombre:d.nombre,"Unidad de Medida":d.unidadMedida,Precio:Number(d.precio).toFixed(2),Costo:Number(d.costo).toFixed(2),"Cantidad Existencia":d.cantidadExistencia,Nota:d.nota};return a.value||(w["Precio USD"]=d.precio_usd!==void 0?Number(d.precio_usd).toFixed(2):"",w["Costo USD"]=d.costo_usd!==void 0?Number(d.costo_usd).toFixed(2):""),w}),E=O.json_to_sheet(x),v=O.book_new();O.book_append_sheet(v,E,"Productos");const K=new Date().toISOString().split("T")[0];Ne(v,`productos_${K}.xlsx`),u.value=null}catch(l){console.error("Error al exportar a Excel:",l),u.value={title:"Error",description:"Ocurrió un error al exportar los datos.",type:"error"}}}async function Fe(){u.value={title:"Consultando datos",description:"Se están consultando los datos, la descarga comenzará en breve.",type:"info"};try{const l=localStorage.getItem("token"),o=J(),n={codigo:j.value,nombre:q.value,precio:{min:s.value?Number(s.value):void 0,max:M.value?Number(M.value):void 0},nota:k.value};!n.precio.min&&!n.precio.max?delete n.precio:(n.precio.min||delete n.precio.min,n.precio.max||delete n.precio.max);const c=await fetch(`${o.public.backendHost}/Producto/filterProductos/1/${S.value}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:l,Accept:"application/json"},body:JSON.stringify(n)});if(c.status===401){u.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{Q("/")},3e3);return}if(c.status===403){u.value={title:"Acceso Denegado",description:"No tienes permisos para realizar esta acción o acceder a esta información.",type:"error"};return}if(!c.ok){const d=await c.json();u.value={title:"Error al consultar datos",description:d.error||"Ocurrió un error al consultar los datos.",type:"error"};return}const y=await c.json(),x=[];y.data.forEach(d=>{Array.isArray(d.facturaProductos)&&d.facturaProductos.forEach(w=>{x.push({"Código Producto":d.codigo,"Nombre Producto":d.nombre,"Unidad Medida Producto":d.unidadMedida,"Precio Producto":Number(d.precio).toFixed(2),"Costo Producto":Number(d.costo).toFixed(2),"Tipo Producto":d.tipoProducto,"Existencia Producto":d.cantidadExistencia,"Nota Producto":d.nota,"Número Consecutivo Factura":w.factura.num_consecutivo,"Fecha Factura":w.factura.fecha?new Date(w.factura.fecha).toLocaleDateString("es-ES"):"","Estado Factura":w.factura.estado,"Nota Factura":w.factura.nota,Cantidad:Number(w.cantidad).toFixed(2),"Precio Venta":Number(w.precioVenta).toFixed(2),"Número Consecutivo Contrato":w.factura.contrato.num_consecutivo,"Fecha Inicio Contrato":w.factura.contrato.fecha_inicio?new Date(w.factura.contrato.fecha_inicio).toLocaleDateString("es-ES"):"","Fecha Fin Contrato":w.factura.contrato.fecha_fin?new Date(w.factura.contrato.fecha_fin).toLocaleDateString("es-ES"):"","Nota Contrato":w.factura.contrato.nota,"Cliente/Proveedor":w.factura.contrato.ClienteOProveedor,"Vigencia Facturas (Días)":w.factura.contrato.vigenciaFacturasDias})})});const E=O.json_to_sheet(x),v=O.book_new();O.book_append_sheet(v,E,"Productos con Ventas y Compras");const K=new Date().toISOString().split("T")[0];Ne(v,`productos_ventas_compras_${K}.xlsx`),u.value=null}catch(l){console.error("Error al exportar a Excel con ventas y compras:",l),u.value={title:"Error",description:"Ocurrió un error al exportar los datos.",type:"error"}}}async function Te(){u.value={title:"Consultando datos",description:"Se están consultando los datos, la descarga comenzará en breve.",type:"info"};const l=o=>{const n=Number(o);if(isNaN(n))return"";const c=n.toFixed(2).split(".");return c[0]=c[0].replace(/\B(?=(\d{3})+(?!\d))/g," "),"$"+c.join(",")};try{const o=localStorage.getItem("token"),n=J(),c={codigo:j.value,nombre:q.value,precio:{min:s.value?Number(s.value):void 0,max:M.value?Number(M.value):void 0},nota:k.value};!c.precio.min&&!c.precio.max?delete c.precio:(c.precio.min||delete c.precio.min,c.precio.max||delete c.precio.max);const y=await fetch(`${n.public.backendHost}/Producto/filterProductos/1/${S.value}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:o,Accept:"application/json"},body:JSON.stringify(c)});if(y.status===401){u.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{Q("/")},3e3);return}if(y.status===403){u.value={title:"Acceso Denegado",description:"No tienes permisos para realizar esta acción o acceder a esta información.",type:"error"};return}if(!y.ok){const w=await y.json();u.value={title:"Error al consultar datos",description:w.error||"Ocurrió un error al consultar los datos.",type:"error"};return}const E=(await y.json()).data.filter(w=>Number(w.cantidadExistencia||0)>0).map(w=>({Producto:w.nombre,UM:w.unidadMedida,"P.Costo":l(w.precio_inspectores_cup),"Hasta +30%":l(Number(w.precio_inspectores_cup)*1.3),"P.Venta":l(w.precio),"F.Venc":""})),v=O.json_to_sheet(E),K=O.book_new();O.book_append_sheet(K,v,"Precios +30%");const d=new Date().toISOString().split("T")[0];Ne(K,`precios_mas_30_${d}.xlsx`),u.value=null}catch(o){console.error("Error al exportar precios +30%:",o),u.value={title:"Error",description:"Ocurrió un error al exportar los datos.",type:"error"}}}return(l,o)=>(g(),m("div",Go,[G(Le,{title:"Productos - Contract Manager",description:"Registra y gestiona productos.",canonical:"/productos"}),G(Re),u.value?(g(),m("div",Qo,[G(je,{title:u.value.title,description:u.value.description,type:u.value.type,onClose:o[0]||(o[0]=n=>u.value=null),class:"pointer-events-auto"},null,8,["title","description","type"])])):P("",!0),z.value?(g(),m("div",Xo,[G(Je,{title:"¿Estás seguro que deseas eliminar este producto?",description:"Esta acción no se puede deshacer.",type:"warning",onConfirm:he,onClose:o[1]||(o[1]=n=>z.value=!1)})])):P("",!0),V.value==="productos"?(g(),m("div",Yo,[e("div",Zo,[e("div",et,[e("div",null,[o[21]||(o[21]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Buscar por código",-1)),e("div",ot,[C(e("input",{type:"text","onUpdate:modelValue":o[2]||(o[2]=n=>j.value=n),placeholder:"Ingrese el código...",class:"w-full pl-10 pr-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary",onKeyup:xe(H,["enter"])},null,544),[[N,j.value]]),o[20]||(o[20]=e("div",{class:"absolute left-3 top-2.5"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))])]),e("div",null,[o[22]||(o[22]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Buscar por nombre",-1)),C(e("input",{type:"text","onUpdate:modelValue":o[3]||(o[3]=n=>q.value=n),placeholder:"Ingrese el nombre...",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary",onKeyup:xe(H,["enter"])},null,544),[[N,q.value]])]),e("div",tt,[e("div",rt,[o[23]||(o[23]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Precio mínimo",-1)),C(e("input",{type:"number","onUpdate:modelValue":o[4]||(o[4]=n=>s.value=n),placeholder:"Precio min...",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",onKeyup:xe(H,["enter"])},null,544),[[N,s.value]])]),e("div",at,[o[24]||(o[24]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Precio máximo",-1)),C(e("input",{type:"number","onUpdate:modelValue":o[5]||(o[5]=n=>M.value=n),placeholder:"Precio max...",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",onKeyup:xe(H,["enter"])},null,544),[[N,M.value]])])]),e("div",null,[o[25]||(o[25]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Nota",-1)),C(e("input",{type:"text","onUpdate:modelValue":o[6]||(o[6]=n=>k.value=n),placeholder:"Nota...",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",onKeyup:xe(H,["enter"])},null,544),[[N,k.value]])])]),e("div",nt,[e("button",{onClick:H,class:"px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors"}," Buscar "),!a.value&&!b.value?(g(),m("button",{key:0,onClick:Ie,class:"px-6 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition-colors flex items-center"},[...o[26]||(o[26]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 5a2 2 0 012-2h4a2 2 0 012 2v2H8V5z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 12h2v2H7v-2zM11 12h2v2h-2v-2zM15 12h2v2h-2v-2z"})],-1),ce(" Exportar a Excel ",-1)])])):P("",!0),f.value?(g(),m("button",{key:1,onClick:Te,class:"px-6 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 transition-colors flex items-center"},[...o[27]||(o[27]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"})],-1),ce(" Exportar Precios +30% ",-1)])])):P("",!0),!a.value&&!b.value?(g(),m("button",{key:2,onClick:Fe,class:"px-6 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition-colors flex items-center"},[...o[28]||(o[28]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})],-1),ce(" Exportar Ventas y Compras ",-1)])])):P("",!0)])]),e("div",st,[e("div",lt,[!a.value&&!b.value?(g(),m("button",{key:0,onClick:o[7]||(o[7]=n=>V.value="productos"),class:pe(["px-4 py-2 rounded-lg border transition-colors",V.value==="productos"?"bg-purple-600 text-white border-purple-600 hover:bg-purple-700":"bg-white text-gray-700 border-gray-300 hover:bg-gray-100"])}," Productos ",2)):P("",!0),!a.value&&!b.value?(g(),m("button",{key:1,onClick:o[8]||(o[8]=n=>V.value="ventas"),class:pe(["px-4 py-2 rounded-lg border transition-colors",V.value==="ventas"?"bg-purple-600 text-white border-purple-600 hover:bg-purple-700":"bg-white text-gray-700 border-gray-300 hover:bg-gray-100"])}," Ventas de facturas ",2)):P("",!0)]),!a.value&&!b.value?(g(),m("button",{key:0,onClick:De,class:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 flex items-center"},[...o[29]||(o[29]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),ce(" Nuevo Producto ",-1)])])):P("",!0)])])):P("",!0),V.value==="productos"?(g(),m("div",it,[o[30]||(o[30]=e("div",{class:"flex justify-between items-center mb-4"},[e("h2",{class:"text-2xl font-bold"},"Productos")],-1)),G($e,{columns:A.value,items:T.value,actions:ue.value,"total-items":S.value,"items-per-page":I.value,"current-page":B.value,"is-loading":D.value,"is-show-photos":!0,onPageChange:F,onRowClick:Z},null,8,["columns","items","actions","total-items","items-per-page","current-page","is-loading"])])):P("",!0),V.value==="ventas"?(g(),m("div",ut,[o[41]||(o[41]=e("div",{class:"flex justify-between items-center mb-4"},[e("h2",{class:"text-2xl font-bold"},"Ventas")],-1)),e("div",dt,[e("div",ct,[e("div",null,[o[31]||(o[31]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Código de producto",-1)),C(e("input",{type:"text","onUpdate:modelValue":o[9]||(o[9]=n=>fe.value=n),placeholder:"Código...",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary"},null,512),[[N,fe.value]])]),e("div",null,[o[32]||(o[32]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Nombre de producto",-1)),C(e("input",{type:"text","onUpdate:modelValue":o[10]||(o[10]=n=>me.value=n),placeholder:"Nombre...",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary"},null,512),[[N,me.value]])]),e("div",null,[o[33]||(o[33]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"N° consecutivo factura",-1)),C(e("input",{type:"number","onUpdate:modelValue":o[11]||(o[11]=n=>re.value=n),placeholder:"Consecutivo...",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary"},null,512),[[N,re.value]])]),e("div",null,[o[35]||(o[35]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Estado factura",-1)),C(e("select",{"onUpdate:modelValue":o[12]||(o[12]=n=>ge.value=n),class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary"},[...o[34]||(o[34]=[e("option",{value:""},"Todos",-1),e("option",{value:"Facturado"},"Facturado",-1),e("option",{value:"No Facturado"},"No Facturado",-1)])],512),[[Be,ge.value]])]),e("div",null,[o[36]||(o[36]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Fecha desde",-1)),C(e("input",{type:"date","onUpdate:modelValue":o[13]||(o[13]=n=>ae.value=n),class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary"},null,512),[[N,ae.value]])]),e("div",null,[o[37]||(o[37]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Fecha hasta",-1)),C(e("input",{type:"date","onUpdate:modelValue":o[14]||(o[14]=n=>ne.value=n),class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary"},null,512),[[N,ne.value]])]),e("div",null,[o[38]||(o[38]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Precio mínimo",-1)),C(e("input",{type:"number","onUpdate:modelValue":o[15]||(o[15]=n=>se.value=n),placeholder:"Mínimo...",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary"},null,512),[[N,se.value]])]),e("div",null,[o[39]||(o[39]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Precio máximo",-1)),C(e("input",{type:"number","onUpdate:modelValue":o[16]||(o[16]=n=>le.value=n),placeholder:"Máximo...",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary"},null,512),[[N,le.value]])])]),e("div",{class:"flex justify-end gap-2 flex-wrap"},[e("button",{onClick:Ee,class:"px-6 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition-colors flex items-center"},[...o[40]||(o[40]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 5a2 2 0 012-2h4a2 2 0 012 2v2H8V5z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 12h2v2H7v-2zM11 12h2v2h-2v-2zM15 12h2v2h-2v-2z"})],-1),ce(" Exportar a Excel ",-1)])]),e("button",{onClick:Ve,class:"px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500"},"Buscar")])]),e("div",pt,[e("button",{onClick:o[17]||(o[17]=n=>V.value="productos"),class:pe(["px-4 py-2 rounded-lg border transition-colors",V.value==="productos"?"bg-purple-600 text-white border-purple-600 hover:bg-purple-700":"bg-white text-gray-700 border-gray-300 hover:bg-gray-100"])}," Productos ",2),e("button",{onClick:o[18]||(o[18]=n=>V.value="ventas"),class:pe(["px-4 py-2 rounded-lg border transition-colors",V.value==="ventas"?"bg-purple-600 text-white border-purple-600 hover:bg-purple-700":"bg-white text-gray-700 border-gray-300 hover:bg-gray-100"])}," Ventas de facturas ",2)]),o[42]||(o[42]=e("div",{class:"flex justify-between items-center mb-4"},[e("h2",{class:"text-2xl font-bold"},"Ventas")],-1)),G($e,{columns:Pe,items:oe.value,actions:Se,"total-items":te.value,"items-per-page":I.value,"current-page":Y.value,"is-loading":ve.value,onPageChange:ye},null,8,["items","total-items","items-per-page","current-page","is-loading"])])):P("",!0),G(Ko,{modelValue:L.value,"onUpdate:modelValue":o[19]||(o[19]=n=>L.value=n),producto:U.value,"is-editing":_.value,"is-viewing":X.value,"is-loading":W.value,onSubmit:de},null,8,["modelValue","producto","is-editing","is-viewing","is-loading"])]))}};export{ht as default};
