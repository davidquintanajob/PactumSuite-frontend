const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./B3QBNKx_.js","./BVNNX7O1.js","./entry.9UJSYqx2.css"])))=>i.map(i=>d[i]);
import{r as f,M as pe,k as A,q as I,n as he,y,F as M,z as x,A as e,C as D,B as m,J as $e,H as se,K as S,L as P,O as ve,P as ye,E as k,_ as Te,o as Ee,W as Fe,R as we,h as me}from"#entry";import{N as Ie}from"./DTHag2Fn.js";import{S as De}from"./CC2Sf2Ne.js";import{D as Me}from"./DIpJa8iN.js";import{_ as Se}from"./CP6NTKUH.js";import{_ as Ne}from"./DWLPyndB.js";import{_ as ke}from"./baAHEXJQ.js";import{_ as be}from"./BYdYousv.js";import{u as te,w as Ce}from"./3SA47z_C.js";import"./BzLCLO6P.js";const ze={key:0,class:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center"},Ae={key:0,class:"fixed top-6 left-1/2 transform -translate-x-1/2 z-[9999] w-full max-w-md px-4 pointer-events-none"},Ue={class:"bg-white rounded-lg p-6 w-full max-w-4xl max-h-[80vh] overflow-y-auto"},Be={class:"flex justify-between items-center mb-6"},Oe={class:"text-2xl font-bold text-gray-800"},Le={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},He={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4"},Re={key:0},Ke={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4"},qe=["readonly","disabled"],Ge=["readonly","disabled"],Je={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4"},We=["readonly","disabled"],Ye=["readonly","disabled"],Ze={class:"mt-4"},Qe={class:"relative flex w-full"},Xe=["disabled"],et=["disabled"],tt={key:0,class:"mt-4"},ot=["onUpdate:modelValue"],at=["onUpdate:modelValue","onBlur","disabled"],rt=["onUpdate:modelValue","onBlur","readonly","disabled"],nt=["value"],it=["onClick","disabled"],lt=["disabled"],st={class:"mt-4 p-4 bg-gray-100 rounded-lg"},dt={key:1,class:"mt-4"},ut=["onUpdate:modelValue","disabled"],ct=["onUpdate:modelValue","disabled"],_t=["onUpdate:modelValue","onBlur","disabled"],mt=["onUpdate:modelValue","onBlur","disabled"],pt=["value"],vt=["onClick","disabled"],bt=["disabled"],ft={class:"mt-4 p-4 bg-gray-100 rounded-lg"},gt={key:2,class:"flex justify-end space-x-4 mt-6"},yt=["disabled"],xt=["disabled"],wt={key:0,class:"flex items-center"},ht={key:1},kt={key:0,class:"text-red-600 text-sm mt-2"},Ct={__name:"FacturaModal",props:{modelValue:{type:Boolean,required:!0},factura:{type:Object,default:()=>({})},isEditing:{type:Boolean,default:!1},isViewing:{type:Boolean,default:!1},contratos:{type:Array,default:()=>[]},entidades:{type:Array,default:()=>[]},trabajadores:{type:Array,default:()=>[]},usuarios:{type:Array,default:()=>[]}},emits:["update:modelValue","submit"],setup(c,{emit:W}){const l=c,Y=W,u=f({id_entidad:"",id_contrato:"",id_usuario:"",id_trabajador_autorizado:"",num_consecutivo:"",fecha:"",estado:"",nota:"",cargoAdicional:""}),p=f("productos");pe(()=>l.factura,r=>{r&&r.tipoFactura?p.value=r.tipoFactura:p.value="productos"});function E(r){l.isViewing||l.isLoading||(p.value=r,u.value.tipoFactura=r)}const L=f([{label:"Facturado",value:"Facturado"},{label:"No Facturado",value:"No Facturado"},{label:"Cancelado",value:"Cancelado"}]),V=f([{descripcion:"",unidadMedida:"",cantidad:0,importe:0}]),C=f([{id_producto:"",nombre:"",unidadMedida:"",cantidad:0,precio:0}]),N=f(""),h=f(!1),j=f(null),O=f([]),de=f(null),w=f(null),Z=f(null),R=A(()=>O.value.find(r=>r.id_contrato===u.value.id_contrato)),K=A(()=>R.value?R.value.ClienteOProveedor!=="Cliente":!1);async function Q(){const r=localStorage.getItem("token");if(!r){I("/");return}try{const o=he(),n=new Date().getFullYear(),g=await fetch(`${o.public.backendHost}/Factura/nextConsecutivo/${n}`,{method:"GET",headers:{Authorization:r}});if(g.status===401||g.status===403){errorBanner.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{I("/")},3e3);return}if(g.ok){const v=await g.json();v.data&&v.data.nextConsecutivo&&(u.value.num_consecutivo=v.data.nextConsecutivo,localStorage.setItem("num_consecutivo_guardado",v.data.nextConsecutivo))}else console.error("Error al obtener el siguiente consecutivo")}catch(o){console.error("Error al obtener el siguiente consecutivo:",o)}}pe(()=>l.modelValue,async r=>{r&&(!l.isEditing&&!l.isViewing?await Q():l.isViewing&&await Q())}),pe(()=>l.factura,async r=>{if(r&&Object.keys(r).length>0){if(u.value={id_entidad:r.contrato?.id_entidad||"",id_contrato:r.id_contrato||"",id_usuario:r.id_usuario||"",id_trabajador_autorizado:r.id_trabajador_autorizado||"",num_consecutivo:r.num_consecutivo||"",fecha:r.fecha?r.fecha.substring(0,10):"",estado:r.estado||"",nota:r.nota||"",cargoAdicional:r.cargoAdicional||""},r.servicio&&r.servicio.length>0?(p.value="servicios",V.value=[...r.servicio],u.value.services=[...r.servicio],C.value=[{id_producto:"",nombre:"",unidadMedida:"",cantidad:0,precio:0}],u.value.products=[]):(p.value="productos",r.productos&&r.productos.length>0?(C.value=r.productos.map(o=>({id_producto:o.id_producto,nombre:o.nombre,unidadMedida:o.unidadMedida,cantidad:o.factura_producto?.cantidad||0,precio:o.factura_producto?.precioVenta||o.precio})),u.value.products=[...r.productos]):(C.value=[{id_producto:"",nombre:"",unidadMedida:"",cantidad:0,precio:0}],u.value.products=[]),V.value=[{descripcion:"",unidadMedida:"",cantidad:0,importe:0}],u.value.services=[]),r.contrato?.id_entidad&&await ce(r.contrato.id_entidad),(l.isViewing||l.isEditing)&&(r.id_usuario&&await ge(r.id_usuario),r.id_trabajador_autorizado&&await d(r.id_trabajador_autorizado)),!l.isViewing){const o=O.value.find(n=>n.id_contrato===u.value.id_contrato);if(o&&o.ClienteOProveedor==="Cliente"){const n=localStorage.getItem("num_consecutivo_guardado");n&&(u.value.num_consecutivo=n,console.log("Carga inicial (crear/editar): Número consecutivo establecido a:",n))}}}else u.value={id_entidad:"",id_contrato:"",id_usuario:"",id_trabajador_autorizado:"",num_consecutivo:"",fecha:"",estado:"",nota:"",cargoAdicional:""},O.value=[],de.value=null,w.value=null,Z.value=null,C.value=[{id_producto:"",nombre:"",unidadMedida:"",cantidad:0,precio:0}],V.value=[{descripcion:"",unidadMedida:"",cantidad:0,importe:0}]},{immediate:!0}),pe(()=>u.value.id_contrato,r=>{if(!l.isViewing&&r){const o=O.value.find(n=>n.id_contrato===r);if(o&&o.ClienteOProveedor==="Cliente"){const n=localStorage.getItem("num_consecutivo_guardado");n&&(u.value.num_consecutivo=n,console.log("Selección de contrato (crear/editar): Número consecutivo establecido a:",n))}}}),pe(()=>C.value,r=>{if(r.length>0&&!l.isViewing){const o=r[r.length-1];o.id_producto&&o.unidadMedida&&o.cantidad>0&&o.precio>0&&C.value.push({id_producto:"",nombre:"",unidadMedida:"",cantidad:0,precio:0})}},{deep:!0}),pe(()=>V.value,r=>{if(r.length>0&&!l.isViewing){const o=r[r.length-1];o.descripcion&&o.unidadMedida&&o.cantidad>0&&o.importe>0&&V.value.push({descripcion:"",unidadMedida:"",cantidad:0,importe:0})}},{deep:!0});const fe=async()=>{if(N.value="",p.value==="productos"?(u.value.products=C.value.filter(r=>r.id_producto&&r.cantidad>0),delete u.value.services):(u.value.services=V.value.filter(r=>r.descripcion&&r.unidadMedida&&r.cantidad>0&&r.importe>0),delete u.value.products),!l.isEditing&&!l.isViewing){const r=localStorage.getItem("usuario");if(r)try{const o=JSON.parse(r);o&&o.id_usuario&&(u.value.id_usuario=o.id_usuario)}catch(o){console.error("Error al parsear datos de usuario del localStorage:",o)}}if(!u.value.id_contrato){N.value="Debe seleccionar un Contrato.";return}if(!u.value.id_usuario){N.value="Debe seleccionar un Usuario.";return}if(!u.value.num_consecutivo){N.value="Debe ingresar el Número Consecutivo.";return}if(!u.value.fecha){N.value="Debe ingresar la Fecha.";return}if(!u.value.estado){N.value="Debe seleccionar un Estado.";return}h.value=!0,j.value={title:l.isEditing?"Guardando Factura":"Creando Factura",description:"Comunicando con el servidor, espere por favor...",type:"warning"};try{Y("submit",{...u.value})}catch(r){console.error("Error en handleSubmit:",r)}finally{setTimeout(()=>{h.value=!1,j.value=null},500)}},oe=A(()=>l.factura&&l.factura.contrato&&l.factura.contrato.entidad&&l.factura.contrato.entidad.nombre||""),ae=A(()=>w.value?w.value.nombre||"":l.factura&&l.factura.usuario&&l.factura.usuario.nombre||""),z=A(()=>Z.value?Z.value.nombre||"":l.factura&&l.factura.trabajador_autorizado&&l.factura.trabajador_autorizado.nombre||""),ue=async r=>{r&&r.id_entidad?(u.value.id_contrato="",await ce(r.id_entidad)):(O.value=[],u.value.id_contrato="")};async function ce(r){if(!r){O.value=[];return}const o=localStorage.getItem("token");if(!o){I("/");return}j.value={title:"Cargando Datos de la Base de Datos",description:"Obteniendo contratos de la base de datos...",type:"info"};try{const n=he(),g=await fetch(`${n.public.backendHost}/entidad/${r}`,{method:"GET",headers:{Authorization:o}});if(g.status===401||g.status===403){errorBanner.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{I("/")},3e3);return}if(g.ok){const v=await g.json();de.value=v;const G=v?.contratos||[];O.value=G.map(ie=>({...ie,displayLabel:`${ie.num_consecutivo} - ${ie.tipoContrato?.nombre||""} - ${ie.ClienteOProveedor||""}`}))}else console.error("Error en la respuesta:",g.status),O.value=[]}catch(n){console.error("Error al cargar contratos:",n),O.value=[]}finally{setTimeout(()=>{j.value=null},3e3)}}async function ge(r){if(!r)return;const o=localStorage.getItem("token");if(!o){I("/");return}try{const n=he(),g=await fetch(`${n.public.backendHost}/Usuario/${r}`,{method:"GET",headers:{Authorization:o}});if(g.status===401||g.status===403){errorBanner.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{I("/")},3e3);return}if(g.ok){const v=await g.json();w.value={nombre:v.nombre}}else console.error("Error al cargar usuario:",g.status)}catch(n){console.error("Error al cargar usuario:",n)}}async function d(r){if(!r)return;const o=localStorage.getItem("token");if(!o){I("/");return}try{const n=he(),g=await fetch(`${n.public.backendHost}/trabajadorAutorizado/${r}`,{method:"GET",headers:{Authorization:o}});if(g.status===401||g.status===403){errorBanner.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{I("/")},3e3);return}if(g.ok){const v=await g.json();Z.value={nombre:v.nombre}}else console.error("Error al cargar trabajador:",g.status)}catch(n){console.error("Error al cargar trabajador:",n)}}function t(){V.value.push({descripcion:"",unidadMedida:"",cantidad:0,importe:0})}function _(r){V.value.length>1&&V.value.splice(r,1)}function T(){C.value.push({id_producto:"",nombre:"",unidadMedida:"",cantidad:0,precio:0})}function U(r,o){if(o>=0&&o<C.value.length)if(r){let n=0,g=r.precio||0;if(l.factura&&l.factura.id_factura&&r.facturaProductos){const v=r.facturaProductos.find(G=>G.id_factura===l.factura.id_factura);v&&(n=Number(v.cantidad)||0,g=Number(v.precioVenta)||r.precio||0)}C.value[o]={...C.value[o],id_producto:r.id_producto,nombre:r.nombre,unidadMedida:r.unidadMedida||"",cantidad:n,precio:g}}else C.value[o]={...C.value[o],id_producto:"",nombre:"",unidadMedida:"",cantidad:0,precio:0}}function ee(r){C.value.length>1&&C.value.splice(r,1)}const q=r=>{r.cantidad!==void 0&&r.cantidad!==null&&(r.cantidad=Number(r.cantidad).toFixed(2))},re=r=>{r.precio!==void 0&&r.precio!==null&&(r.precio=Number(r.precio).toFixed(2))},_e=r=>{r.importe!==void 0&&r.importe!==null&&(r.importe=Number(r.importe).toFixed(2))};function J(r){const o=Number(r.cantidad)||0,n=Number(r.precio)||0,g=Number(r.importe)||0,v=r.precio!==void 0?n:g;return(o*v).toFixed(2)}const ne=A(()=>(C.value.reduce((o,n)=>o+Number(n.cantidad)*Number(n.precio),0)+(Number(u.value.cargoAdicional)||0)).toFixed(2)),X=A(()=>(V.value.reduce((o,n)=>o+Number(n.cantidad)*Number(n.importe),0)+(Number(u.value.cargoAdicional)||0)).toFixed(2));return(r,o)=>c.modelValue?(x(),y("div",ze,[j.value?(x(),y("div",Ae,[D(Se,{title:j.value.title,description:j.value.description,type:j.value.type,onClose:o[0]||(o[0]=n=>j.value=null),class:"pointer-events-auto"},null,8,["title","description","type"])])):M("",!0),e("div",Ue,[e("div",Be,[e("h2",Oe,m(c.isViewing?"Detalles de Factura":c.isEditing?"Editar Factura":"Nueva Factura"),1),e("button",{onClick:o[1]||(o[1]=n=>r.$emit("update:modelValue",!1)),class:"text-gray-500 hover:text-gray-700"},[...o[14]||(o[14]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("form",{onSubmit:$e(fe,["prevent"]),class:"space-y-4"},[e("div",Le,[e("div",null,[o[15]||(o[15]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Entidad",-1)),D(be,{modelValue:u.value.id_entidad,"onUpdate:modelValue":o[2]||(o[2]=n=>u.value.id_entidad=n),endpoint:"/entidad/filter/1/10",method:"POST","search-key":"nombre","label-key":"nombre","value-key":"id_entidad",placeholder:"Buscar entidad por nombre...",disabled:c.isViewing||h.value,"initial-label":oe.value,onEntidadSeleccionada:ue},null,8,["modelValue","disabled","initial-label"])]),e("div",null,[o[16]||(o[16]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Contrato",-1)),D(ke,{modelValue:u.value.id_contrato,"onUpdate:modelValue":o[3]||(o[3]=n=>u.value.id_contrato=n),options:O.value,labelKey:"displayLabel",valueKey:"id_contrato",disabled:c.isViewing||h.value||!u.value.id_entidad,class:se({"opacity-50":!u.value.id_entidad}),placeholder:"Seleccione primero una entidad..."},null,8,["modelValue","options","disabled","class"])])]),e("div",He,[c.isViewing||c.isEditing?(x(),y("div",Re,[o[17]||(o[17]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Usuario",-1)),D(be,{modelValue:u.value.id_usuario,"onUpdate:modelValue":o[4]||(o[4]=n=>u.value.id_usuario=n),endpoint:"/Usuario/filterUsers",method:"POST","search-key":"nombre_usuario","label-key":"nombre_usuario","value-key":"id_usuario",placeholder:"Buscar usuario por nombre...",disabled:!0,"initial-label":ae.value,"direct-data":!0,class:se({"opacity-50":c.isViewing||c.isEditing})},null,8,["modelValue","initial-label","class"])])):M("",!0),e("div",null,[o[18]||(o[18]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Trabajador Autorizado",-1)),D(be,{modelValue:u.value.id_trabajador_autorizado,"onUpdate:modelValue":o[5]||(o[5]=n=>u.value.id_trabajador_autorizado=n),endpoint:"/trabajadorAutorizado/filter/1/10",method:"POST","search-key":"nombre","label-key":"nombre","value-key":"id_trabajador",placeholder:"Buscar trabajador por nombre...",disabled:c.isViewing||h.value,"initial-label":z.value},null,8,["modelValue","disabled","initial-label"])])]),e("div",Ke,[e("div",null,[o[19]||(o[19]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Número Consecutivo",-1)),S(e("input",{"onUpdate:modelValue":o[6]||(o[6]=n=>u.value.num_consecutivo=n),type:"number",readonly:c.isViewing||!K.value,disabled:h.value,class:se(["w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",{"bg-gray-100 text-gray-500":c.isViewing||!K.value}]),required:""},null,10,qe),[[P,u.value.num_consecutivo]])]),e("div",null,[o[20]||(o[20]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Fecha",-1)),S(e("input",{"onUpdate:modelValue":o[7]||(o[7]=n=>u.value.fecha=n),type:"date",readonly:c.isViewing,disabled:c.isViewing||h.value,class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",required:""},null,8,Ge),[[P,u.value.fecha]])])]),e("div",Je,[e("div",null,[o[21]||(o[21]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Estado",-1)),D(ke,{modelValue:u.value.estado,"onUpdate:modelValue":o[8]||(o[8]=n=>u.value.estado=n),options:L.value,labelKey:"label",valueKey:"value",disabled:c.isViewing||h.value,placeholder:"Selecciona un estado"},null,8,["modelValue","options","disabled"])]),e("div",null,[o[22]||(o[22]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Cargo Adicional",-1)),S(e("input",{"onUpdate:modelValue":o[9]||(o[9]=n=>u.value.cargoAdicional=n),type:"number",readonly:c.isViewing,disabled:c.isViewing||h.value,class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ingrese cargo adicional (opcional)"},null,8,We),[[P,u.value.cargoAdicional]])])]),e("div",null,[o[23]||(o[23]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Nota",-1)),S(e("textarea",{"onUpdate:modelValue":o[10]||(o[10]=n=>u.value.nota=n),readonly:c.isViewing,disabled:c.isViewing||h.value,class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",rows:"2",placeholder:"Ingrese una nota opcional"},null,8,Ye),[[P,u.value.nota]])]),e("div",Ze,[o[24]||(o[24]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2 text-center"},"Tipo de Factura",-1)),e("div",Qe,[e("div",{class:se(["absolute top-0 left-0 w-1/2 h-full bg-primary rounded-lg transition-transform duration-300",p.value==="productos"?"transform translate-x-0":"transform translate-x-full"])},null,2),e("button",{type:"button",onClick:o[11]||(o[11]=n=>E("productos")),class:se(["relative flex-1 px-4 py-2 rounded-lg font-medium transition-all duration-300 z-10",p.value==="productos"?"text-neutral bg-transparent":"text-dark bg-secondary"]),disabled:c.isViewing||h.value}," Venta Productos ",10,Xe),e("button",{type:"button",onClick:o[12]||(o[12]=n=>E("servicios")),class:se(["relative flex-1 px-4 py-2 rounded-lg font-medium transition-all duration-300 z-10",p.value==="servicios"?"text-neutral bg-transparent":"text-dark bg-secondary"]),disabled:c.isViewing||h.value}," Prestación de Servicios ",10,et)])]),p.value==="productos"?(x(),y("div",tt,[o[27]||(o[27]=e("h3",{class:"text-lg font-semibold mb-2"},"Productos",-1)),o[28]||(o[28]=e("div",{class:"grid grid-cols-1 md:grid-cols-7 gap-4 mb-2 font-semibold text-gray-700"},[e("span",{class:"col-span-2"},"Producto"),e("span",null,"Uni/Medida"),e("span",null,"Cantidad"),e("span",null,"Precio"),e("span",null,"Total"),e("span",null,"Acción")],-1)),(x(!0),y(ve,null,ye(C.value,(n,g)=>(x(),y("div",{key:g,class:"grid grid-cols-1 md:grid-cols-7 gap-4 mb-2"},[D(be,{modelValue:n.id_producto,"onUpdate:modelValue":v=>n.id_producto=v,endpoint:"/producto/filterProductos/1/10",method:"POST","search-key":"nombre","label-key":"nombre","value-key":"id_producto",placeholder:"Buscar producto por nombre...",disabled:c.isViewing||h.value,"initial-label":n.nombre||"",onProductoSeleccionado:v=>U(v,g),class:"col-span-2"},null,8,["modelValue","onUpdate:modelValue","disabled","initial-label","onProductoSeleccionado"]),S(e("input",{"onUpdate:modelValue":v=>n.unidadMedida=v,type:"text",placeholder:"Uni/Medida",readonly:"",class:"px-4 py-2 border-2 border-gray-400 rounded-lg opacity-50"},null,8,ot),[[P,n.unidadMedida]]),S(e("input",{"onUpdate:modelValue":v=>n.cantidad=v,onBlur:v=>q(n),type:"number",step:"0.01",placeholder:"Cantidad",class:"px-4 py-2 border-2 border-gray-400 rounded-lg",disabled:c.isViewing||h.value},null,40,at),[[P,n.cantidad,void 0,{number:!0}]]),S(e("input",{"onUpdate:modelValue":v=>n.precio=v,onBlur:v=>re(n),type:"number",step:"0.01",placeholder:"Precio",readonly:!c.isEditing||c.isViewing,disabled:c.isViewing||h.value,class:se(["px-4 py-2 border-2 border-gray-400 rounded-lg",{"opacity-50":!c.isEditing||c.isViewing}])},null,42,rt),[[P,n.precio,void 0,{number:!0}]]),e("input",{value:J(n),type:"text",readonly:"",class:"px-4 py-2 border-2 border-blue-400 bg-blue-50 rounded-lg font-bold text-blue-800"},null,8,nt),e("button",{onClick:v=>ee(g),type:"button",class:"px-4 py-2 bg-red-500 text-white rounded-lg flex items-center",disabled:c.isViewing||h.value},[...o[25]||(o[25]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),k(" Eliminar ",-1)])],8,it)]))),128)),e("button",{onClick:T,type:"button",class:"px-4 py-2 bg-purple-500 text-white rounded-lg mt-2 flex items-center",disabled:c.isViewing||h.value},[...o[26]||(o[26]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})],-1),k(" Producto ",-1)])],8,lt),e("div",st,[e("strong",null,"Importe Total Productos: "+m(ne.value),1)])])):M("",!0),p.value==="servicios"?(x(),y("div",dt,[o[31]||(o[31]=e("h3",{class:"text-lg font-semibold mb-2"},"Servicios",-1)),o[32]||(o[32]=e("div",{class:"grid grid-cols-1 md:grid-cols-7 gap-4 mb-2 font-semibold text-gray-700"},[e("span",{class:"col-span-2"},"Descripción"),e("span",null,"Uni/Medida"),e("span",null,"Cantidad"),e("span",null,"Importe"),e("span",null,"Total"),e("span",null,"Acción")],-1)),(x(!0),y(ve,null,ye(V.value,(n,g)=>(x(),y("div",{key:n.id_servicio,class:"grid grid-cols-1 md:grid-cols-7 gap-4 mb-2"},[S(e("input",{"onUpdate:modelValue":v=>n.descripcion=v,type:"text",placeholder:"Descripción",class:"col-span-2 px-4 py-2 border-2 border-gray-400 rounded-lg",disabled:c.isViewing||h.value},null,8,ut),[[P,n.descripcion]]),S(e("input",{"onUpdate:modelValue":v=>n.unidadMedida=v,type:"text",placeholder:"Uni/Medida",class:"px-4 py-2 border-2 border-gray-400 rounded-lg",disabled:c.isViewing||h.value},null,8,ct),[[P,n.unidadMedida]]),S(e("input",{"onUpdate:modelValue":v=>n.cantidad=v,onBlur:v=>q(n),type:"number",step:"0.01",placeholder:"Cantidad",class:"px-4 py-2 border-2 border-gray-400 rounded-lg",disabled:c.isViewing||h.value},null,40,_t),[[P,n.cantidad,void 0,{number:!0}]]),S(e("input",{"onUpdate:modelValue":v=>n.importe=v,onBlur:v=>_e(n),type:"number",step:"0.01",placeholder:"Importe",class:"px-4 py-2 border-2 border-gray-400 rounded-lg",disabled:c.isViewing||h.value},null,40,mt),[[P,n.importe,void 0,{number:!0}]]),e("input",{value:J(n),type:"text",readonly:"",class:"px-4 py-2 border-2 border-blue-400 bg-blue-50 rounded-lg font-bold text-blue-800"},null,8,pt),e("button",{onClick:v=>_(g),type:"button",class:"px-4 py-2 bg-red-500 text-white rounded-lg flex items-center",disabled:c.isViewing||h.value},[...o[29]||(o[29]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),k(" Eliminar ",-1)])],8,vt)]))),128)),e("button",{onClick:t,type:"button",class:"px-4 py-2 bg-purple-500 text-white rounded-lg mt-2 flex items-center",disabled:c.isViewing||h.value},[...o[30]||(o[30]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})],-1),k(" Servicio ",-1)])],8,bt),e("div",ft,[e("strong",null,"Importe Total Servicios: "+m(X.value),1)])])):M("",!0),c.isViewing?M("",!0):(x(),y("div",gt,[e("button",{type:"button",onClick:o[13]||(o[13]=n=>r.$emit("update:modelValue",!1)),class:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-500",disabled:h.value}," Cancelar ",8,yt),e("button",{type:"submit",class:"px-4 py-2 text-neutral bg-primary rounded-lg hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-primary disabled:opacity-50 disabled:cursor-not-allowed",disabled:h.value},[h.value?(x(),y("span",wt,[o[33]||(o[33]=e("svg",{class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)),k(" "+m(c.isEditing?"Guardando...":"Creando..."),1)])):(x(),y("span",ht,m(c.isEditing?"Guardar Cambios":"Crear Factura"),1))],8,xt)]))],32),N.value?(x(),y("div",kt,m(N.value),1)):M("",!0)])])):M("",!0)}},Ft={key:0,class:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4"},Vt={class:"bg-white rounded-lg p-2 w-full max-w-5xl max-h-[95vh] overflow-y-auto shadow-2xl"},$t={class:"flex justify-between items-center mb-6"},Et={class:"flex space-x-2"},St=["disabled"],Pt=["disabled"],jt={key:0,class:"mb-6 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg"},Tt={class:"mt-2 list-disc list-inside"},It={id:"factura-content",class:"bg-white p-6 max-w-full mx-auto",style:{"font-family":"Arial, sans-serif","font-size":"14px","line-height":"1.4"}},Dt={class:"text-center mb-4"},Mt={class:"text-xl font-bold mb-3",style:{"font-size":"24px"}},Nt={class:"flex justify-end mb-4"},zt={class:"text-right"},At={class:"mb-1 text-lg"},Ut={class:"grid grid-cols-2 gap-10 mb-4"},Bt={class:"space-y-0.5"},Ot={class:"flex items-center justify-between"},Lt={class:"flex items-center justify-between"},Ht={class:"flex items-center justify-between"},Rt={class:"flex items-center justify-between"},Kt={class:"flex items-center justify-between"},qt={class:"flex items-center justify-between"},Gt={class:"flex items-center justify-between"},Jt={class:"space-y-0.5"},Wt={class:"flex items-center justify-between"},Yt={class:"flex items-center justify-between"},Zt={class:"flex items-center justify-between"},Qt={class:"flex items-center justify-between"},Xt={class:"w-full border-collapse border border-black mb-4"},eo={class:"border border-black p-2"},to={class:"border border-black p-2"},oo={class:"border border-black p-2 text-right"},ao={class:"border border-black p-2 text-right"},ro={class:"border border-black p-2 text-right"},no={class:"border border-black p-2"},io={class:"border border-black p-2"},lo={class:"border border-black p-2 text-right"},so={class:"border border-black p-2 text-right"},uo={class:"border border-black p-2 text-right"},co={class:"text-right mb-4"},_o={class:"text-lg font-bold"},mo={class:"grid grid-cols-2 gap-10 mt-6"},po={class:"space-y-0.5"},vo={class:"space-y-0.5"},bo={key:1,class:"fixed inset-0 bg-black bg-opacity-50 z-70 flex items-center justify-center p-4"},fo={class:"bg-white rounded-lg p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto shadow-2xl"},go={key:0,class:"text-red-500 text-xs mt-1"},yo={key:0,class:"text-red-500 text-xs mt-1"},xo={key:0,class:"text-red-500 text-xs mt-1"},Ve="factura_vendor_data",wo=10,ho={__name:"FacturaPDFModal",props:{modelValue:{type:Boolean,required:!0},factura:{type:Object,default:()=>({})}},emits:["update:modelValue"],setup(c,{emit:W}){const l=c,Y=W,u=f(!1),p=f({nombre:"",carnet_identidad:"",identificacion_fiscal:"",cuenta_bancaria:"",agencia_bancaria:"",direccion_particular:"",telefono:""}),E=f({carnet_identidad:"",cuenta_bancaria:"",telefono:""}),L=d=>d?/^\d+$/.test(d)?d.length>12?"El carné de identidad no puede tener más de 12 caracteres.":"":"El carné de identidad solo puede contener números.":"",V=d=>{if(!d)return"";const t=d.replace(/-/g,"");return t.length!==16||!/^\d+$/.test(t)?"La cuenta bancaria debe tener exactamente 16 dígitos.":""},C=d=>d?/^[\d-]+$/.test(d)?"":"El teléfono solo puede contener números y guiones.":"",N=d=>{let t=d.target.value;t=t.replace(/\D/g,"").substring(0,11),p.value.carnet_identidad=t,E.value.carnet_identidad=L(t)},h=d=>{let t=d.target.value;const _=t.replace(/[^0-9-]/g,""),T=_.replace(/-/g,"");T.length>16?t=T.substring(0,16).replace(/(\d{4})(?=\d)/g,"$1-"):t=_.replace(/(\d{4})(?=\d)/g,"$1-"),p.value.cuenta_bancaria=t,E.value.cuenta_bancaria=V(t)},j=d=>{let t=d.target.value;t=t.replace(/[^0-9-]/g,""),p.value.telefono=t,E.value.telefono=C(t)},O=()=>{try{const d=localStorage.getItem(Ve);d&&(p.value={...p.value,...JSON.parse(d)})}catch(d){console.error("Error cargando datos del vendedor:",d)}},de=()=>{if(E.value.carnet_identidad=L(p.value.carnet_identidad),E.value.cuenta_bancaria=V(p.value.cuenta_bancaria),E.value.telefono=C(p.value.telefono),!Object.values(E.value).some(t=>t!==""))try{localStorage.setItem(Ve,JSON.stringify(p.value)),R()}catch(t){console.error("Error guardando datos del vendedor:",t)}},w=d=>{const t=p.value[d];return t&&t.trim()!==""?t:"_________________"},Z=()=>{Y("update:modelValue",!1),u.value=!0},R=()=>{u.value=!1};Ee(()=>{O()});const K=A(()=>["nombre","carnet_identidad","identificacion_fiscal","cuenta_bancaria","agencia_bancaria","direccion_particular","telefono"].every(t=>{const _=p.value[t];return _&&_.trim()!==""})),Q=A(()=>["nombre","carnet_identidad","identificacion_fiscal","cuenta_bancaria","agencia_bancaria","direccion_particular","telefono"].filter(t=>{const _=p.value[t];return!_||_.trim()===""})),fe=d=>({nombre:"Nombre Completo",carnet_identidad:"Carné de Identidad",identificacion_fiscal:"Identificación Fiscal (RC-05)",cuenta_bancaria:"Cuenta Bancaria",agencia_bancaria:"Agencia Bancaria",direccion_particular:"Dirección Particular",telefono:"Teléfono"})[d]||d,oe=A(()=>l.factura.contrato?.ClienteOProveedor==="Proveedor");A(()=>oe.value?{title:"Comprador",nombre:l.factura.contrato?.entidad?.nombre||"_________________",codigo:l.factura.contrato?.entidad?.consecutivo||"_________________",direccion:l.factura.contrato?.entidad?.direccion||"_________________",cuenta_bancaria:l.factura.contrato?.entidad?.cuenta_bancaria||"_________________",showConfigButton:!1}:{title:"Vendedor",nombre:w("nombre"),carnet_identidad:w("carnet_identidad"),identificacion_fiscal:w("identificacion_fiscal"),cuenta_bancaria:w("cuenta_bancaria"),agencia_bancaria:w("agencia_bancaria"),direccion_particular:w("direccion_particular"),telefono:w("telefono"),showConfigButton:!0}),A(()=>oe.value?{title:"Vendedor",nombre:w("nombre"),carnet_identidad:w("carnet_identidad"),identificacion_fiscal:w("identificacion_fiscal"),cuenta_bancaria:w("cuenta_bancaria"),agencia_bancaria:w("agencia_bancaria"),direccion_particular:w("direccion_particular"),telefono:w("telefono"),showConfigButton:!0}:{title:"Comprador",nombre:l.factura.contrato?.entidad?.nombre||"_________________",codigo:l.factura.contrato?.entidad?.consecutivo||"_________________",direccion:l.factura.contrato?.entidad?.direccion||"_________________",cuenta_bancaria:l.factura.contrato?.entidad?.cuenta_bancaria||"_________________",showConfigButton:!1}),A(()=>oe.value?{title:"Recibido",nombre:z()?.nombre||"________________________",cargo:z()?.cargo||"________________________",carnet_identidad:z()?.carnet_identidad||"________________________",fecha:"________________________"}:{title:"Emitido",nombre:l.factura.usuario?.nombre||"_________________",cargo:l.factura.usuario?.cargo||"_________________",carnet_identidad:l.factura.usuario?.carnet_identidad||"_________________",fecha:"___________"}),A(()=>oe.value?{title:"Emitido",nombre:l.factura.usuario?.nombre||"_________________",cargo:l.factura.usuario?.cargo||"_________________",carnet_identidad:l.factura.usuario?.carnet_identidad||"_________________",fecha:"___________"}:{title:"Recibido",nombre:z()?.nombre||"________________________",cargo:z()?.cargo||"________________________",carnet_identidad:z()?.carnet_identidad||"________________________",fecha:"________________________"});const ae=d=>d?parseFloat(d).toLocaleString("es-ES",{minimumFractionDigits:2,maximumFractionDigits:2}).replace(/\./g," ").replace(",",","):"0,00",z=()=>l.factura.contrato?.trabajadorAutorizado?l.factura.contrato.trabajadorAutorizado:l.factura.trabajadorAutorizado?l.factura.trabajadorAutorizado:null,ue=()=>{try{const d=document.getElementById("factura-content"),t=document.body.innerHTML,_=document.title,T=window.open("","_blank");T.document.write(`
      <html>
        <head>
          <title>Factura ${l.factura.num_consecutivo}</title>
          <style>
            body { 
              font-family: Arial, sans-serif; 
              margin: 0; 
              padding: 20px; 
              font-size: 12px;
            }
            @media print {
              body { margin: 0; padding: 10px; }
              .no-print { display: none; }
            }
            table { border-collapse: collapse; width: 100%; }
            th, td { border: 1px solid #000; padding: 8px; text-align: left; }
            th { background-color: #f0f0f0; font-weight: bold; }
            .text-center { text-align: center; }
            .text-right { text-align: right; }
            .font-bold { font-weight: bold; }
            .border-b { border-bottom: 1px solid #000; }
          </style>
        </head>
        <body>
          ${d.innerHTML}
        </body>
      </html>
    `),T.document.close(),T.focus(),T.print(),T.close()}catch(d){console.error("Error imprimiendo:",d),alert("Error al imprimir. Intente nuevamente.")}},ce=async()=>{try{const[{default:d},{default:t}]=await Promise.all([Fe(()=>import("./B3QBNKx_.js").then(G=>G.j),__vite__mapDeps([0,1,2]),import.meta.url),Fe(()=>import("./B0tyYwQk.js"),[],import.meta.url)]),_=document.getElementById("factura-content"),T=_.querySelectorAll(".no-print"),U=[];T.forEach(G=>{U.push(G.style.display),G.style.display="none"});const ee=await t(_,{scale:2,useCORS:!0,allowTaint:!0,backgroundColor:"#ffffff"});T.forEach((G,ie)=>{G.style.display=U[ie]});const q=ee.toDataURL("image/png"),re=new d("p","mm","a4"),_e=210,J=295,ne=ee.height*_e/ee.width;let X=ne,r=0;for(re.addImage(q,"PNG",0,r,_e,ne),X-=J;X>=0;)r=X-ne,re.addPage(),re.addImage(q,"PNG",0,r,_e,ne),X-=J;const o=l.factura.num_consecutivo||"",n=l.factura.contrato?.entidad?.nombre||"",g=l.factura.contrato?.ClienteOProveedor||"",v=`Factura ${o} ${n} - ${g}.pdf`.replace(/[^a-zA-Z0-9\s\-_.]/g,"").trim();re.save(v)}catch(d){console.error("Error generando PDF:",d),alert("Error al generar el PDF. Intente nuevamente.")}},ge=A(()=>{const d=l.factura.servicio?l.factura.servicio.length:0,t=l.factura.productos?l.factura.productos.length:0,_=d+t,T=wo-_;return T>0?Array.from({length:T},(U,ee)=>ee+1):[]});return(d,t)=>(x(),y(ve,null,[c.modelValue?(x(),y("div",Ft,[e("div",Vt,[e("div",$t,[t[9]||(t[9]=e("h2",{class:"text-2xl font-bold text-gray-800"},"Vista PDF de Factura",-1)),e("div",Et,[e("button",{onClick:ue,class:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600",disabled:!K.value}," Imprimir ",8,St),e("button",{onClick:ce,class:"px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600",disabled:!K.value}," Descargar PDF ",8,Pt),e("button",{onClick:t[0]||(t[0]=_=>d.$emit("update:modelValue",!1)),class:"text-gray-500 hover:text-gray-700"},[...t[8]||(t[8]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])]),K.value?M("",!0):(x(),y("div",jt,[t[10]||(t[10]=e("div",{class:"flex items-center"},[e("svg",{class:"w-5 h-5 mr-2",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})]),e("strong",null,"Error:"),k(" Faltan datos del vendedor. Complete la información requerida antes de imprimir o descargar el PDF. ")],-1)),e("ul",Tt,[(x(!0),y(ve,null,ye(Q.value,_=>(x(),y("li",{key:_},m(fe(_)),1))),128))])])),e("div",It,[e("div",Dt,[t[11]||(t[11]=e("h1",{class:"text-lx font-bold mb-2",style:{color:"#dc2626","font-size":"40px","letter-spacing":"1px"}},"FACTURA",-1)),t[12]||(t[12]=e("div",{class:"border-b border-blue-500 w-full mb-3",style:{"border-color":"#3b82f6"}},null,-1)),e("p",Mt,"Nombre del Trabajo: "+m(c.factura.contrato?.ClienteOProveedor==="Cliente"?"Servicio Prestado":"Compra Realizada"),1)]),e("div",Nt,[e("div",zt,[e("p",At,[e("strong",null,"Factura N: "+m(c.factura.num_consecutivo),1)]),t[13]||(t[13]=e("p",{class:"mb-1 text-lg"},[e("strong",null,"Fecha: ___________")],-1))])]),e("div",Ut,[e("div",null,[e("div",{class:"flex justify-between items-center mb-2"},[t[15]||(t[15]=e("h3",{class:"font-bold",style:{color:"#2563eb","font-size":"18px"}},"Vendedor",-1)),e("button",{onClick:Z,class:"text-blue-500 hover:text-blue-700 text-xs px-2 py-1 border border-blue-500 rounded no-print",title:"Configurar datos del vendedor"},[...t[14]||(t[14]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)])])]),e("div",Bt,[e("div",Ot,[e("p",null,[t[16]||(t[16]=e("strong",null,"Nombre:",-1)),k(" "+m(w("nombre")),1)])]),e("div",Lt,[e("p",null,[t[17]||(t[17]=e("strong",null,"Carné Identidad:",-1)),k(" "+m(w("carnet_identidad")),1)])]),e("div",Ht,[e("p",null,[t[18]||(t[18]=e("strong",null,"Identificación Fiscal (RC-05):",-1)),k(" "+m(w("identificacion_fiscal")),1)])]),e("div",Rt,[e("p",null,[t[19]||(t[19]=e("strong",null,"Cuenta Bancaria:",-1)),k(" "+m(w("cuenta_bancaria").replace(/-/g,"")),1)])]),e("div",Kt,[e("p",null,[t[20]||(t[20]=e("strong",null,"Agencia Bancaria:",-1)),k(" "+m(w("agencia_bancaria")),1)])]),e("div",qt,[e("p",null,[t[21]||(t[21]=e("strong",null,"Dirección Particular:",-1)),k(" "+m(w("direccion_particular")),1)])]),e("div",Gt,[e("p",null,[t[22]||(t[22]=e("strong",null,"Teléfono:",-1)),k(" "+m(w("telefono")),1)])])])]),e("div",null,[t[27]||(t[27]=e("h3",{class:"font-bold mb-2",style:{color:"#2563eb","font-size":"18px"}},"Comprador",-1)),e("div",Jt,[e("div",Wt,[e("p",null,[t[23]||(t[23]=e("strong",null,"Nombre:",-1)),k(" "+m(c.factura.contrato?.entidad?.nombre||"_________________"),1)])]),e("div",Yt,[e("p",null,[t[24]||(t[24]=e("strong",null,"Código:",-1)),k(" "+m(c.factura.contrato?.entidad?.consecutivo||"_________________"),1)])]),e("div",Zt,[e("p",null,[t[25]||(t[25]=e("strong",null,"Dirección:",-1)),k(" "+m(c.factura.contrato?.entidad?.direccion||"_________________"),1)])]),e("div",Qt,[e("p",null,[t[26]||(t[26]=e("strong",null,"Cuenta Bancaria:",-1)),k(" "+m((c.factura.contrato?.entidad?.cuenta_bancaria||"_________________").replace(/-/g,"")),1)])])])])]),t[44]||(t[44]=e("div",{class:"border-b border-black w-full mb-3"},null,-1)),e("table",Xt,[t[29]||(t[29]=e("thead",null,[e("tr",{style:{"background-color":"#f0f0f0"}},[e("th",{class:"border border-black p-2 text-center font-bold"},"Descripción"),e("th",{class:"border border-black p-2 text-center font-bold"},"U/M"),e("th",{class:"border border-black p-2 text-center font-bold"},"Cantidad"),e("th",{class:"border border-black p-2 text-center font-bold"},"Precio en CUP"),e("th",{class:"border border-black p-2 text-center font-bold"},"Precio Total")])],-1)),e("tbody",null,[(x(!0),y(ve,null,ye(c.factura.servicio,_=>(x(),y("tr",{key:_.id_servicio},[e("td",eo,m(_.descripcion),1),e("td",to,m(_.unidadMedida),1),e("td",oo,m(parseFloat(_.cantidad).toFixed(2)),1),e("td",ao,m(parseFloat(_.importe).toFixed(2)),1),e("td",ro,m((_.cantidad*parseFloat(_.importe)).toFixed(2)),1)]))),128)),(x(!0),y(ve,null,ye(c.factura.productos,_=>(x(),y("tr",{key:_.id_producto},[e("td",no,m(_.nombre),1),e("td",io,m(_.unidadMedida),1),e("td",lo,m(parseFloat(_.factura_producto?.cantidad||0).toFixed(2)),1),e("td",so,m(parseFloat(_.factura_producto?.precioVenta||0).toFixed(2)),1),e("td",uo,m(((_.factura_producto?.cantidad||0)*parseFloat(_.factura_producto?.precioVenta||0)).toFixed(2)),1)]))),128)),(x(!0),y(ve,null,ye(ge.value,_=>(x(),y("tr",{key:`empty-${_}`},[...t[28]||(t[28]=[e("td",{class:"border border-black p-2 h-6"},null,-1),e("td",{class:"border border-black p-2"},null,-1),e("td",{class:"border border-black p-2"},null,-1),e("td",{class:"border border-black p-2"},null,-1),e("td",{class:"border border-black p-2"},null,-1)])]))),128))])]),e("div",co,[e("p",_o,[e("strong",null,"Cantidad Total a Cobrar: $ "+m(ae(c.factura.suma_general)),1)])]),e("div",mo,[e("div",null,[t[34]||(t[34]=e("div",{class:"border-b border-black w-full mb-2"},null,-1)),t[35]||(t[35]=e("p",{class:"font-bold mb-2 text-center"},"Emitido",-1)),e("div",po,[e("p",null,[t[30]||(t[30]=e("strong",null,"Nombre:",-1)),k(" "+m(c.factura.usuario?.nombre||"_________________"),1)]),e("p",null,[t[31]||(t[31]=e("strong",null,"Cargo:",-1)),k(" "+m(c.factura.usuario?.cargo||"_________________"),1)]),e("p",null,[t[32]||(t[32]=e("strong",null,"C. Identidad:",-1)),k(" "+m(c.factura.usuario?.carnet_identidad||"_________________"),1)]),t[33]||(t[33]=e("p",null,[e("strong",null,"Fecha:"),k(" ___________")],-1))]),t[36]||(t[36]=e("div",{class:"mt-3"},[e("div",{class:"border-b border-black w-full mb-1"}),e("p",{class:"font-bold text-center"},"Cuño")],-1))]),e("div",null,[t[41]||(t[41]=e("div",{class:"border-b border-black w-full mb-2"},null,-1)),t[42]||(t[42]=e("p",{class:"font-bold mb-2 text-center"},"Recibido",-1)),e("div",vo,[e("p",null,[t[37]||(t[37]=e("strong",null,"Nombre:",-1)),k(" "+m(z()?.nombre||"________________________"),1)]),e("p",null,[t[38]||(t[38]=e("strong",null,"Cargo:",-1)),k(" "+m(z()?.cargo||"________________________"),1)]),e("p",null,[t[39]||(t[39]=e("strong",null,"C. Identidad:",-1)),k(" "+m(z()?.carnet_identidad||"________________________"),1)]),t[40]||(t[40]=e("p",null,[e("strong",null,"Fecha:"),k(" ________________________")],-1))]),t[43]||(t[43]=e("div",{class:"mt-3"},[e("div",{class:"border-b border-black w-full mb-1"}),e("p",{class:"font-bold text-center"},"Cuño")],-1))])])])])])):M("",!0),u.value?(x(),y("div",bo,[e("div",fo,[e("div",{class:"flex justify-between items-center mb-6"},[t[46]||(t[46]=e("h2",{class:"text-2xl font-bold text-gray-800"},"Configurar Datos del Vendedor",-1)),e("button",{onClick:R,class:"text-gray-500 hover:text-gray-700"},[...t[45]||(t[45]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("form",{onSubmit:$e(de,["prevent"]),class:"space-y-4"},[e("div",null,[t[47]||(t[47]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Nombre Completo",-1)),S(e("input",{"onUpdate:modelValue":t[1]||(t[1]=_=>p.value.nombre=_),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ingrese el nombre completo"},null,512),[[P,p.value.nombre]])]),e("div",null,[t[48]||(t[48]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Carné de Identidad",-1)),S(e("input",{"onUpdate:modelValue":t[2]||(t[2]=_=>p.value.carnet_identidad=_),onInput:N,type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ingrese el carné de identidad"},null,544),[[P,p.value.carnet_identidad]]),E.value.carnet_identidad?(x(),y("p",go,m(E.value.carnet_identidad),1)):M("",!0)]),e("div",null,[t[49]||(t[49]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Identificación Fiscal (RC-05)",-1)),S(e("input",{"onUpdate:modelValue":t[3]||(t[3]=_=>p.value.identificacion_fiscal=_),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ingrese la identificación fiscal"},null,512),[[P,p.value.identificacion_fiscal]])]),e("div",null,[t[50]||(t[50]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Cuenta Bancaria",-1)),S(e("input",{"onUpdate:modelValue":t[4]||(t[4]=_=>p.value.cuenta_bancaria=_),onInput:h,type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ingrese la cuenta bancaria"},null,544),[[P,p.value.cuenta_bancaria]]),E.value.cuenta_bancaria?(x(),y("p",yo,m(E.value.cuenta_bancaria),1)):M("",!0)]),e("div",null,[t[51]||(t[51]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Agencia Bancaria",-1)),S(e("input",{"onUpdate:modelValue":t[5]||(t[5]=_=>p.value.agencia_bancaria=_),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ingrese la agencia bancaria"},null,512),[[P,p.value.agencia_bancaria]])]),e("div",null,[t[52]||(t[52]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Dirección Particular",-1)),S(e("input",{"onUpdate:modelValue":t[6]||(t[6]=_=>p.value.direccion_particular=_),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ingrese la dirección particular"},null,512),[[P,p.value.direccion_particular]])]),e("div",null,[t[53]||(t[53]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Teléfono",-1)),S(e("input",{"onUpdate:modelValue":t[7]||(t[7]=_=>p.value.telefono=_),onInput:j,type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ingrese el teléfono"},null,544),[[P,p.value.telefono]]),E.value.telefono?(x(),y("p",xo,m(E.value.telefono),1)):M("",!0)]),e("div",{class:"flex justify-end space-x-3 pt-4"},[e("button",{type:"button",onClick:R,class:"px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50"}," Cancelar "),t[54]||(t[54]=e("button",{type:"submit",class:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600"}," Guardar Datos ",-1))])],32)])])):M("",!0)],64))}},ko=Te(ho,[["__scopeId","data-v-027e2079"]]),Co={class:"min-h-screen bg-gradient-to-br via-secondary/40 from-accent/30 to-neutral"},Fo={key:0,class:"fixed top-6 left-1/2 transform -translate-x-1/2 z-[9999] w-full max-w-md px-4 pointer-events-none"},Vo={key:1,class:"fixed top-24 left-1/2 transform -translate-x-1/2 z-[10000] w-full max-w-md px-4 pointer-events-auto"},$o={class:"w-[95%] mx-auto px-4 py-4 md:py-4 mt-20 md:mt-0"},Eo={class:"bg-white rounded-lg shadow-md p-4"},So={class:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-4"},Po={class:"w-full"},jo={class:"w-full"},To={class:"w-full"},Io={class:"w-full"},Do={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"},Mo={class:"w-full"},No={class:"w-full"},zo={class:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-4"},Ao={class:"w-full"},Uo={class:"w-full"},Bo={class:"w-full"},Oo={class:"w-full"},Lo={class:"flex justify-end mt-4 gap-2 flex-wrap"},Ho={class:"w-[95%] mx-auto px-4 py-4"},Ro={class:"flex justify-between items-center mb-4"},Ko={class:"mt-6 bg-white rounded-lg shadow-md p-4 w-[95%] mx-auto"},qo={class:"grid grid-cols-2 md:grid-cols-4 gap-4 text-center"},Go={class:"bg-orange-100 text-orange-800 rounded p-3"},Jo={class:"text-lg font-bold"},Wo={class:"text-lg font-bold"},Yo={class:"text-lg font-bold"},Zo={class:"bg-blue-100 text-blue-800 rounded p-3"},Qo={class:"text-lg font-bold"},Xo={class:"text-lg font-bold"},ea={class:"text-lg font-bold"},ta={class:"bg-orange-100 text-orange-800 rounded p-3"},oa={class:"text-lg font-bold"},aa={class:"text-lg font-bold"},ra={class:"text-lg font-bold"},na={class:"bg-blue-100 text-blue-800 rounded p-3"},ia={class:"text-lg font-bold"},la={class:"text-lg font-bold"},sa={class:"text-lg font-bold"},ya={__name:"facturas",setup(c){const W=f(""),l=f(""),Y=f(""),u=f(""),p=f(""),E=f(""),L=f(""),V=f(""),C=f(""),N=f(""),h=f([{label:"Todos",value:null},{label:"Facturado",value:"Facturado"},{label:"No Facturado",value:"No Facturado"},{label:"Cancelado",value:"Cancelado"}]),j=f([]),O=f(null),de=f(null),w=f(!1),Z=f(!1),R=f({}),K=f(!1),Q=A(()=>{try{const i=localStorage.getItem("usuario");if(!i)return!1;const a=JSON.parse(i),s=a&&(a.rol||a.role||a.perfil&&a.perfil.rol||a.profile&&a.profile.role)?a.rol||a.role||a.perfil&&a.perfil.rol||a.profile&&a.profile.role:null;return s?String(s).trim().toLowerCase()==="invitado":!1}catch{return!1}}),fe=f(!1),oe=[{key:"num_consecutivo",label:"Num. Consecutivo"},{key:"fecha",label:"Fecha",cellRenderer:i=>i?`<span class="px-2 py-1 rounded text-sm">${i.substring(0,10)}</span>`:""},{key:"estado",label:"Estado",cellRenderer:i=>{if(!i)return"";let a="";return i==="Facturado"?a="bg-green-100 text-green-800":i==="No Facturado"?a="bg-yellow-100 text-yellow-800":i==="Cancelado"&&(a="bg-red-100 text-red-800"),`<span class="px-2 py-1 rounded-full text-sm font-medium ${a}">${i}</span>`}},{key:"contrato.ClienteOProveedor",label:"Cliente o Proveedor",cellRenderer:i=>i?`<span class="px-2 py-1 rounded-full text-sm font-medium ${i==="Cliente"?"bg-blue-100 text-blue-800":"bg-orange-100 text-orange-800"}">${i}</span>`:""},{key:"contrato.num_consecutivo",label:"Contrato"},{key:"contrato.tipoContrato.nombre",label:"Tipo Contrato"},{key:"suma_general",label:"Importe",cellRenderer:i=>{if(i==null||i==="")return"";const a=parseFloat(i);return isNaN(a)?i:`<span class="px-2 py-1 rounded text-sm">${a.toFixed(2)}</span>`}},{key:"contrato.entidad.nombre",label:"Entidad"},{key:"usuario.nombre",label:"Creado por"}],ae=f(1),z=f(0),ue=f(!1),ce=f(10),ge=f([]),d=f({}),t=f(null),_=f(!1),T=f(null),U=he(),ee=[{name:"Editar",icon:{render(){return me("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[me("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5M18.5 2.5a2.121 2.121 0 113 3L12 15l-4 1 1-4 7.5-7.5z"})])}},handler:i=>X(i,"editar"),iconOnly:!1,buttonClass:"px-3 py-1 bg-accent text-neutral rounded-md hover:bg-accent/90"},{name:"Ver en PDF",icon:{render(){return me("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[me("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"}),me("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 9h6m-6 4h6m-6 4h6"})])}},handler:i=>o(i),iconOnly:!1,buttonClass:"px-3 py-1 bg-blue-500 text-white rounded-md hover:bg-blue-600"}],q=async()=>{try{ue.value=!0,await J(1)}catch(i){console.error("Error al buscar facturas:",i)}finally{ue.value=!1}};function re(i){J(i)}function _e(i){X(i,"ver")}async function J(i=1){const a=localStorage.getItem("token");if(!a){I("/");return}try{const s={id_contrato:L.value||0,id_entidad:V.value||0,consecutivoEntidad:W.value||void 0,organismoEntidad:l.value||void 0,num_consecutivo:Y.value||0,fecha_desde:u.value||void 0,fecha_hasta:p.value||void 0,estado:E.value||void 0,id_trabajador_autorizado:C.value||0,id_usuario:N.value||0},F=await fetch(`${U.public.backendHost}/Factura/filterFacturas/${i}/${ce.value}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:a},body:JSON.stringify(s)});if(F.status===401){t.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{I("/")},3e3);return}if(F.status===403){t.value={title:"Acceso Denegado",description:"No tienes permisos para realizar esta acción o acceder a esta información.",type:"error"};return}const $=await F.json();ge.value=$.data||[],z.value=$.pagination?.total||0,ae.value=$.pagination?.currentPage||1,d.value=$.pagination}catch{t.value={title:"Error",description:"No se pudieron cargar las facturas",type:"error"}}}async function ne(i){if(!i){j.value=[];return}const a=localStorage.getItem("token");if(!a){I("/");return}try{const s=await fetch(`${U.public.backendHost}/entidad/${i}`,{method:"GET",headers:{Authorization:a}});if(s.status===401||s.status===403){t.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{I("/")},3e3);return}if(s.ok){const F=await s.json();O.value=F;const $=F?.contratos||[];j.value=$.map(B=>({...B,displayLabel:`${B.num_consecutivo} - ${B.tipoContrato?.nombre||""} - ${B.ClienteOProveedor||""}`}))}else console.error("Error en la respuesta:",s.status),j.value=[]}catch(s){console.error("Error al cargar contratos:",s),j.value=[]}}function X(i,a){R.value=i?{...i}:{},K.value=a==="editar",fe.value=a==="ver",w.value=!0}function r(){X({},"crear")}function o(i){R.value={...i},Z.value=!0}async function n(){if(!T.value)return;const i=localStorage.getItem("token");if(!i){I("/");return}try{const a=await fetch(`${U.public.backendHost}/Factura/deleteFactura/${T.value.id_factura}`,{method:"DELETE",headers:{Authorization:i}});if(a.status===401){t.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{I("/")},3e3);return}if(a.status===403){t.value={title:"Acceso Denegado",description:"No tienes permisos para realizar esta acción o acceder a esta información.",type:"error"};return}if(!a.ok){let s="No se pudo eliminar la factura";try{const F=await a.json();F&&F.message&&(s=F.message)}catch{}throw new Error(s)}t.value={title:"Éxito",description:"Factura eliminada correctamente",type:"success"},J(ae.value)}catch(a){t.value={title:"Error",description:a.message,type:"error"}}finally{_.value=!1,T.value=null}}const g=async i=>{const a=localStorage.getItem("token");if(!a){I("/");return}try{const s=K.value?`${U.public.backendHost}/Factura/updateFactura/${R.value.id_factura}`:`${U.public.backendHost}/Factura/createFactura`,F=await fetch(s,{method:K.value?"PUT":"POST",headers:{"Content-Type":"application/json",Authorization:a,Accept:"application/json"},body:JSON.stringify(i)});if(F.status===401){t.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{I("/")},3e3);return}if(F.status===403){t.value={title:"Acceso Denegado",description:"No tienes permisos para realizar esta acción.",type:"error"};return}if(F.status===400||F.status===500){const $=await F.json();$.errors&&Array.isArray($.errors)?t.value={title:`Errores de validación: ${F.status}`,description:$.errors.join(`
`),type:"error"}:$.error?t.value={title:`Error: ${F.status}`,description:$.error,type:"error"}:t.value={title:`Error: ${F.status}`,description:JSON.stringify($),type:"error"};return}if(!F.ok){let $="No se pudo guardar la factura";try{const B=await F.json();B&&B.message&&($=B.message)}catch{}throw new Error($)}t.value={title:"Éxito",description:K.value?"Factura actualizada correctamente":"Factura creada correctamente",type:"success"},w.value=!1,J(ae.value)}catch(s){t.value={title:"Error",description:s.message,type:"error"}}};async function v(){t.value={title:"Consultando datos",description:"Se están consultando los datos, la descarga comenzará en breve.",type:"info"};try{const i=localStorage.getItem("token"),a={id_contrato:L.value||0,id_entidad:V.value||0,consecutivoEntidad:W.value||void 0,organismoEntidad:l.value||void 0,num_consecutivo:Y.value||0,fecha_desde:u.value||void 0,fecha_hasta:p.value||void 0,estado:E.value||void 0,id_trabajador_autorizado:C.value||0,id_usuario:N.value||0},s=await fetch(`${U.public.backendHost}/Factura/filterFacturas/1/${z.value}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:i,Accept:"application/json"},body:JSON.stringify(a)});if(s.status===401){t.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{I("/")},3e3);return}if(s.status===403){t.value={title:"Acceso Denegado",description:"No tienes permisos para realizar esta acción o acceder a esta información.",type:"error"};return}if(!s.ok){const b=await s.json();t.value={title:"Error al consultar datos",description:b.error||"Ocurrió un error al consultar los datos.",type:"error"};return}const $=(await s.json()).data.map(b=>({"Num. Consecutivo":b.num_consecutivo,Fecha:b.fecha?b.fecha.substring(0,10):"",Estado:b.estado,"Creado por":b.usuario?.nombre||"","Cliente o Proveedor":b.contrato?.ClienteOProveedor||"",Contrato:b.contrato?.num_consecutivo||"","Tipo Contrato":b.contrato?.tipoContrato?.nombre||"",Importe:b.suma_general?parseFloat(b.suma_general).toFixed(2):"",Entidad:b.contrato?.entidad?.nombre||""})),B=te.json_to_sheet($),le=te.book_new();te.book_append_sheet(le,B,"Facturas");const xe=new Date().toISOString().split("T")[0];Ce(le,`facturas_${xe}.xlsx`),t.value=null}catch(i){console.error("Error al exportar a Excel:",i),t.value={title:"Error",description:"Ocurrió un error al exportar los datos.",type:"error"}}}async function G(){t.value={title:"Consultando datos",description:"Se están consultando los datos, la descarga comenzará en breve.",type:"info"};try{const i=localStorage.getItem("token"),a={id_contrato:L.value||0,id_entidad:V.value||0,consecutivoEntidad:W.value||void 0,organismoEntidad:l.value||void 0,num_consecutivo:Y.value||0,fecha_desde:u.value||void 0,fecha_hasta:p.value||void 0,estado:E.value||void 0,id_trabajador_autorizado:C.value||0,id_usuario:N.value||0},s=await fetch(`${U.public.backendHost}/Factura/filterFacturas/1/${z.value}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:i,Accept:"application/json"},body:JSON.stringify(a)});if(s.status===401){t.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{I("/")},3e3);return}if(s.status===403){t.value={title:"Acceso Denegado",description:"No tienes permisos para realizar esta acción o acceder a esta información.",type:"error"};return}if(!s.ok){const b=await s.json();t.value={title:"Error al consultar datos",description:b.error||"Ocurrió un error al consultar los datos.",type:"error"};return}const F=await s.json(),$=[];F.data.forEach(b=>{b.productos&&b.productos.length>0&&b.productos.forEach(H=>{$.push({"Num. Consecutivo Factura":b.num_consecutivo,"Fecha Factura":b.fecha?b.fecha.substring(0,10):"","Estado Factura":b.estado,"Creado por":b.usuario?.nombre||"","Cliente o Proveedor":b.contrato?.ClienteOProveedor||"",Contrato:b.contrato?.num_consecutivo||"","Tipo Contrato":b.contrato?.tipoContrato?.nombre||"",Entidad:b.contrato?.entidad?.nombre||"","Código Producto":H.codigo,"Nombre Producto":H.nombre,"Unidad de Medida":H.unidadMedida,"Nota Producto":H.nota,"Tipo Producto":H.tipoProducto,"Cantidad Existencia":H.cantidadExistencia,"Cantidad Facturada":H.factura_producto?.cantidad||"","Precio Venta":Number(H.factura_producto?.precioVenta).toFixed(2)||""})})});const B=te.json_to_sheet($),le=te.book_new();te.book_append_sheet(le,B,"Facturas con Productos");const xe=new Date().toISOString().split("T")[0];Ce(le,`facturas_con_productos_${xe}.xlsx`),t.value=null}catch(i){console.error("Error al exportar a Excel con productos:",i),t.value={title:"Error",description:"Ocurrió un error al exportar los datos con productos.",type:"error"}}}async function ie(){t.value={title:"Consultando datos",description:"Se están consultando los datos, la descarga comenzará en breve.",type:"info"};try{const i=localStorage.getItem("token"),a={id_contrato:L.value||0,id_entidad:V.value||0,consecutivoEntidad:W.value||void 0,organismoEntidad:l.value||void 0,num_consecutivo:Y.value||0,fecha_desde:u.value||void 0,fecha_hasta:p.value||void 0,estado:E.value||void 0,id_trabajador_autorizado:C.value||0,id_usuario:N.value||0},s=await fetch(`${U.public.backendHost}/Factura/filterFacturas/1/${z.value}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:i,Accept:"application/json"},body:JSON.stringify(a)});if(s.status===401){t.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{I("/")},3e3);return}if(s.status===403){t.value={title:"Acceso Denegado",description:"No tienes permisos para realizar esta acción o acceder a esta información.",type:"error"};return}if(!s.ok){const b=await s.json();t.value={title:"Error al consultar datos",description:b.error||"Ocurrió un error al consultar los datos.",type:"error"};return}const F=await s.json(),$=[];F.data.forEach(b=>{b.servicio&&b.servicio.length>0&&b.servicio.forEach(H=>{$.push({"Num. Consecutivo Factura":b.num_consecutivo,"Fecha Factura":b.fecha?b.fecha.substring(0,10):"","Estado Factura":b.estado,"Creado por":b.usuario?.nombre||"","Cliente o Proveedor":b.contrato?.ClienteOProveedor||"",Contrato:b.contrato?.num_consecutivo||"","Tipo Contrato":b.contrato?.tipoContrato?.nombre||"",Entidad:b.contrato?.entidad?.nombre||"","Descripción Servicio":H.descripcion,"Importe Servicio":H.importe,"Cantidad Servicio":H.cantidad,"Unidad de Medida":H.unidadMedida})})});const B=te.json_to_sheet($),le=te.book_new();te.book_append_sheet(le,B,"Facturas con Servicios");const xe=new Date().toISOString().split("T")[0];Ce(le,`facturas_con_servicios_${xe}.xlsx`),t.value=null}catch(i){console.error("Error al exportar a Excel con servicios:",i),t.value={title:"Error",description:"Ocurrió un error al exportar los datos con servicios.",type:"error"}}}function Pe(i){i.value=i,i&&i.contratos?j.value=i.contratos.map(a=>({...a,displayLabel:`${a.num_consecutivo} - ${a.tipoContrato?.nombre||""} - ${a.ClienteOProveedor||""}`})):j.value=[],L.value=""}pe(V,(i,a)=>{i&&!de.value?ne(i):i||(j.value=[],L.value="",de.value=null)},{immediate:!0}),Ee(()=>{if(!localStorage.getItem("token")){I("/");return}J()});const je={render(){return me("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-neutral",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[me("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})])}};return(i,a)=>(x(),y("div",Co,[D(De,{title:"Facturas - Pactum",description:"Lista y gestión de facturas en Pactum. Filtra, exporta y administra facturas.",canonical:"/facturas"}),D(Ie),t.value?(x(),y("div",Fo,[D(Se,{title:t.value.title,description:t.value.description,type:t.value.type,onClose:a[0]||(a[0]=s=>t.value=null),class:"pointer-events-auto"},null,8,["title","description","type"])])):M("",!0),_.value?(x(),y("div",Vo,[D(Ne,{title:"¿Estás seguro que deseas eliminar esta factura?",description:"Esta acción no se puede deshacer.",icon:je,type:"warning",onConfirm:n,onClose:a[1]||(a[1]=s=>_.value=!1)})])):M("",!0),e("div",$o,[e("div",Eo,[e("div",So,[e("div",Po,[a[14]||(a[14]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Consecutivo Entidad",-1)),S(e("input",{type:"text","onUpdate:modelValue":a[2]||(a[2]=s=>W.value=s),placeholder:"Ingrese consecutivo entidad...",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary",onKeyup:we(q,["enter"])},null,544),[[P,W.value]])]),e("div",jo,[a[15]||(a[15]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Organismo Entidad",-1)),S(e("input",{type:"text","onUpdate:modelValue":a[3]||(a[3]=s=>l.value=s),placeholder:"Ingrese organismo entidad...",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary",onKeyup:we(q,["enter"])},null,544),[[P,l.value]])]),e("div",To,[a[16]||(a[16]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Num. Consecutivo",-1)),S(e("input",{type:"number","onUpdate:modelValue":a[4]||(a[4]=s=>Y.value=s),placeholder:"Número consecutivo",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary",onKeyup:we(q,["enter"])},null,544),[[P,Y.value,void 0,{number:!0}]])]),e("div",Io,[a[17]||(a[17]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Estado",-1)),D(ke,{modelValue:E.value,"onUpdate:modelValue":a[5]||(a[5]=s=>E.value=s),options:h.value,labelKey:"label",valueKey:"value",placeholder:"Seleccionar estado..."},null,8,["modelValue","options"])])]),e("div",Do,[e("div",Mo,[a[18]||(a[18]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Fecha Desde",-1)),S(e("input",{type:"date","onUpdate:modelValue":a[6]||(a[6]=s=>u.value=s),class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary",onKeyup:we(q,["enter"])},null,544),[[P,u.value]])]),e("div",No,[a[19]||(a[19]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Fecha Hasta",-1)),S(e("input",{type:"date","onUpdate:modelValue":a[7]||(a[7]=s=>p.value=s),class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary",onKeyup:we(q,["enter"])},null,544),[[P,p.value]])])]),e("div",zo,[e("div",Ao,[a[20]||(a[20]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Entidad por Nombre",-1)),D(be,{modelValue:V.value,"onUpdate:modelValue":a[8]||(a[8]=s=>V.value=s),endpoint:"/entidad/filter/1/10",method:"POST","search-key":"nombre","label-key":"nombre","value-key":"id_entidad",placeholder:"Buscar entidad por nombre...",onEntidadSeleccionada:Pe},null,8,["modelValue"])]),e("div",Uo,[a[21]||(a[21]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Contrato por número consecutivo",-1)),D(ke,{modelValue:L.value,"onUpdate:modelValue":a[9]||(a[9]=s=>L.value=s),options:j.value,labelKey:"displayLabel",valueKey:"id_contrato",disabled:!V.value,class:se({"opacity-50":!V.value}),placeholder:"Seleccione primero una entidad..."},null,8,["modelValue","options","disabled","class"])]),e("div",Bo,[a[22]||(a[22]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Trabajador Autorizado por Nombre",-1)),D(be,{modelValue:C.value,"onUpdate:modelValue":a[10]||(a[10]=s=>C.value=s),endpoint:"/trabajadorAutorizado/filter/1/10",method:"POST","search-key":"nombre","label-key":"nombre","value-key":"id_trabajador",placeholder:"Buscar trabajador por nombre..."},null,8,["modelValue"])]),e("div",Oo,[a[23]||(a[23]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Usuario por Nombre",-1)),D(be,{modelValue:N.value,"onUpdate:modelValue":a[11]||(a[11]=s=>N.value=s),endpoint:"/Usuario/filterUsers",method:"POST","search-key":"nombre_usuario","label-key":"nombre_usuario","value-key":"id_usuario",placeholder:"Buscar usuario por nombre...","direct-data":!0},null,8,["modelValue"])])]),e("div",Lo,[e("button",{onClick:q,class:"px-6 py-2 bg-primary text-neutral rounded-lg hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition-colors"}," Buscar "),Q.value?M("",!0):(x(),y("button",{key:0,onClick:v,class:"px-6 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition-colors flex items-center"},[...a[24]||(a[24]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 5a2 2 0 012-2h4a2 2 0 012 2v2H8V5z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 12h2v2H7v-2zM11 12h2v2h-2v-2zM15 12h2v2h-2v-2z"})],-1),k(" Exportar a Excel ",-1)])])),Q.value?M("",!0):(x(),y("button",{key:1,onClick:G,class:"px-6 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition-colors flex items-center"},[...a[25]||(a[25]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})],-1),k(" Exportar a Excel con Productos ",-1)])])),Q.value?M("",!0):(x(),y("button",{key:2,onClick:ie,class:"px-6 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition-colors flex items-center"},[...a[26]||(a[26]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})],-1),k(" Exportar a Excel con Servicios ",-1)])]))])])]),e("div",Ho,[e("div",Ro,[a[28]||(a[28]=e("h2",{class:"text-2xl font-bold"},"Facturas",-1)),Q.value?M("",!0):(x(),y("button",{key:0,onClick:r,class:"px-4 py-2 bg-primary text-neutral rounded-lg hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-primary flex items-center"},[...a[27]||(a[27]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),k(" Nueva Factura ",-1)])]))]),D(Me,{columns:oe,items:ge.value,actions:Q.value?[]:ee,"total-items":z.value,"items-per-page":ce.value,"current-page":ae.value,"is-loading":ue.value,onPageChange:re,onRowClick:_e},null,8,["items","actions","total-items","items-per-page","current-page","is-loading"]),e("div",Ko,[a[33]||(a[33]=e("h3",{class:"text-xl font-semibold mb-4"},"Resumen de Información Filtrada",-1)),e("div",qo,[e("div",Go,[a[29]||(a[29]=e("div",{class:"text-sm font-medium"},"Suma: Servicios que los Proveedores han prestado",-1)),e("div",Jo,"Facturado: "+m((d.value.serviciosProveedoresFacturados??0).toFixed(2)),1),e("div",Wo,"No Facturado: "+m(((d.value.serviciosProveedores??0).toFixed(2)-(d.value.serviciosProveedoresFacturados??0).toFixed(2)).toFixed(2)),1),e("div",Yo,"Total: "+m((d.value.serviciosProveedores??0).toFixed(2)),1)]),e("div",Zo,[a[30]||(a[30]=e("div",{class:"text-sm font-medium"},"Suma: Servicios prestados a Clientes",-1)),e("div",Qo,"Facturado: "+m((d.value.serviciosClientesFacturados??0).toFixed(2)),1),e("div",Xo,"No Facturado: "+m(((d.value.serviciosClientes??0).toFixed(2)-(d.value.serviciosClientesFacturados??0).toFixed(2)).toFixed(2)),1),e("div",ea,"Total: "+m((d.value.serviciosClientes??0).toFixed(2)),1)]),e("div",ta,[a[31]||(a[31]=e("div",{class:"text-sm font-medium"},"Suma: Productos comprados a Proveedores",-1)),e("div",oa,"Facturado: "+m((d.value.productosProveedorFacturados??0).toFixed(2)),1),e("div",aa,"No Facturado: "+m(((d.value.productosProveedor??0).toFixed(2)-(d.value.productosProveedorFacturados??0).toFixed(2)).toFixed(2)),1),e("div",ra,"Total: "+m((d.value.productosProveedor??0).toFixed(2)),1)]),e("div",na,[a[32]||(a[32]=e("div",{class:"text-sm font-medium"},"Suma: Productos vendidos a Clientes",-1)),e("div",ia,"Facturado: "+m((d.value.productosClientesFacturados??0).toFixed(2)),1),e("div",la,"No Facturado: "+m(((d.value.productosClientes??0).toFixed(2)-(d.value.productosClientesFacturados??0).toFixed(2)).toFixed(2)),1),e("div",sa,"Total: "+m((d.value.productosClientes??0).toFixed(2)),1)])])])]),D(Ct,{modelValue:w.value,"onUpdate:modelValue":a[12]||(a[12]=s=>w.value=s),factura:R.value,"is-editing":K.value,"is-viewing":fe.value,contratos:j.value,entidades:[],trabajadores:[],usuarios:[],onSubmit:g},null,8,["modelValue","factura","is-editing","is-viewing","contratos"]),D(ko,{modelValue:Z.value,"onUpdate:modelValue":a[13]||(a[13]=s=>Z.value=s),factura:R.value},null,8,["modelValue","factura"])]))}};export{ya as default};
