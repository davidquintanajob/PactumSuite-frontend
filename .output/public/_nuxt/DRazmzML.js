import{U as ae,r,M as J,o as R,I as oe,z as f,D as T,A as e,y,F as P,B as p,C as $,K as v,L as b,O as ie,P as le,k as se,q as j,R as C,E as re,n as ne,h as O}from"#entry";import{N as de}from"./DTHag2Fn.js";import{S as ue}from"./CC2Sf2Ne.js";import{D as ce}from"./DIpJa8iN.js";import{_ as me}from"./CP6NTKUH.js";import{_ as pe}from"./DWLPyndB.js";import{_ as fe}from"./D9EgduSG.js";import{_ as ge}from"./BYdYousv.js";import"./BzLCLO6P.js";const ve={class:"text-lg font-semibold text-gray-900"},be={key:0,class:"space-y-6"},ye={class:"bg-gray-50 rounded-lg p-4"},xe={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},we={class:"mt-1 text-sm text-gray-900"},ke={class:"mt-1 text-sm text-gray-900"},he={class:"bg-blue-50 rounded-lg p-4"},Se={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ce={class:"mt-1 text-sm text-gray-900"},$e={class:"mt-1 text-sm text-gray-900"},Ve={class:"md:col-span-2"},Ne={class:"mt-1 text-sm text-gray-900"},Ee={class:"bg-gray-50 rounded-lg p-4"},_e={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ae={class:"mt-1 text-sm text-gray-900"},De={class:"mt-1 text-sm text-gray-900"},Pe={class:"mt-1 text-sm text-gray-900"},Ue={key:1,class:"space-y-6"},Ie={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},je=["value"],Oe={class:"md:col-span-2"},Be={key:0,class:"bg-red-50 border border-red-200 text-red-700 p-3 rounded"},Te={class:"flex justify-end gap-2"},Le={__name:"SalidaModal",props:{modelValue:{type:Boolean,default:!1},salida:{type:Object,default:()=>({})},isViewing:{type:Boolean,default:!0},isEditing:{type:Boolean,default:!1}},emits:["update:modelValue","submit"],setup(n,{emit:E}){const g=n,_=E,o=ae({id_producto:null,id_usuario:null,cantidad:null,descripcion:"",fecha:""}),x=r(""),m=r(""),c=r([]);J(()=>g.salida,l=>{if(l&&Object.keys(l).length)o.id_producto=l.id_producto||l.producto?.id_producto||null,m.value=l.producto?.nombre||"",o.cantidad=l.cantidad||null,o.descripcion=l.descripcion||"",o.fecha=l.fecha?l.fecha.substring(0,10):"",o.id_usuario=l.id_usuario||null,x.value=l.usuario?.nombre||"";else{o.id_producto=null,m.value="",o.cantidad=null,o.descripcion="",o.fecha="";{const a=JSON.parse(localStorage.getItem("usuario"));a&&(o.id_usuario=a.id_usuario,x.value=a.nombre)}}},{immediate:!0,deep:!0});function h(l){l?(o.id_producto=l.id_producto,m.value=l.nombre):(o.id_producto=null,m.value="")}function w(){if(c.value=[],o.id_producto||c.value.push("Debe seleccionar un producto"),(o.cantidad==null||Number(o.cantidad)<=0)&&c.value.push("La cantidad debe ser mayor que 0"),o.fecha||c.value.push("Debe seleccionar una fecha"),o.descripcion||c.value.push("Debe añadir una descripción"),c.value.length)return;const l={id_producto:o.id_producto,id_usuario:o.id_usuario,fecha:o.fecha,descripcion:o.descripcion,cantidad:Number(o.cantidad)};_("submit",l)}return J(()=>g.modelValue,l=>{if(l){if(!g.isEditing&&!g.isViewing){const a=JSON.parse(localStorage.getItem("usuario"));a&&(o.id_usuario=a.id_usuario,x.value=a.nombre)}}else c.value=[]}),R(()=>{{const l=JSON.parse(localStorage.getItem("usuario"));l&&(!g.isEditing&&!g.isViewing&&(o.id_usuario=l.id_usuario),x.value=l.nombre)}}),(l,a)=>(f(),oe(fe,{show:n.modelValue,onClose:a[5]||(a[5]=d=>l.$emit("update:modelValue",!1)),size:"2xl"},{title:T(()=>[e("h3",ve,p(n.isViewing?"Detalles de la Salida":n.isEditing?"Editar Salida":"Nueva Salida"),1)]),content:T(()=>[n.isViewing?(f(),y("div",be,[e("div",ye,[a[8]||(a[8]=e("h4",{class:"text-md font-medium text-gray-900 mb-3"},"Información del Producto",-1)),e("div",xe,[e("div",null,[a[6]||(a[6]=e("label",{class:"block text-sm font-medium text-gray-700"},"Nombre",-1)),e("p",we,p(n.salida.producto?.nombre||"N/A"),1)]),e("div",null,[a[7]||(a[7]=e("label",{class:"block text-sm font-medium text-gray-700"},"Código",-1)),e("p",ke,p(n.salida.producto?.codigo||"N/A"),1)])])]),e("div",he,[a[12]||(a[12]=e("h4",{class:"text-md font-medium text-gray-900 mb-3"},"Información de la Salida",-1)),e("div",Se,[e("div",null,[a[9]||(a[9]=e("label",{class:"block text-sm font-medium text-gray-700"},"Cantidad",-1)),e("p",Ce,p(n.salida.cantidad),1)]),e("div",null,[a[10]||(a[10]=e("label",{class:"block text-sm font-medium text-gray-700"},"Fecha",-1)),e("p",$e,p(n.salida.fecha?new Date(n.salida.fecha).toLocaleDateString("es-ES"):"N/A"),1)]),e("div",Ve,[a[11]||(a[11]=e("label",{class:"block text-sm font-medium text-gray-700"},"Descripción",-1)),e("p",Ne,p(n.salida.descripcion||"Sin descripción"),1)])])]),e("div",Ee,[a[16]||(a[16]=e("h4",{class:"text-md font-medium text-gray-900 mb-3"},"Información del Sistema",-1)),e("div",_e,[e("div",null,[a[13]||(a[13]=e("label",{class:"block text-sm font-medium text-gray-700"},"Creado por",-1)),e("p",Ae,p(n.salida.usuario?.nombre||"N/A"),1)]),e("div",null,[a[14]||(a[14]=e("label",{class:"block text-sm font-medium text-gray-700"},"Creado",-1)),e("p",De,p(n.salida.createdAt?new Date(n.salida.createdAt).toLocaleString("es-ES"):"N/A"),1)]),e("div",null,[a[15]||(a[15]=e("label",{class:"block text-sm font-medium text-gray-700"},"Última Actualización",-1)),e("p",Pe,p(n.salida.updatedAt?new Date(n.salida.updatedAt).toLocaleString("es-ES"):"N/A"),1)])])])])):(f(),y("div",Ue,[e("div",Ie,[e("div",null,[a[17]||(a[17]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Producto",-1)),$(ge,{modelValue:o.id_producto,"onUpdate:modelValue":a[0]||(a[0]=d=>o.id_producto=d),endpoint:"/Producto/filterProductos/1/10",method:"POST","search-key":"nombre","label-key":"nombre","value-key":"id_producto",placeholder:"Buscar producto...","initial-label":m.value,onProductoSeleccionado:h},null,8,["modelValue","initial-label"])]),e("div",null,[a[18]||(a[18]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Fecha",-1)),v(e("input",{type:"date","onUpdate:modelValue":a[1]||(a[1]=d=>o.fecha=d),class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary"},null,512),[[b,o.fecha]])]),e("div",null,[a[19]||(a[19]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Cantidad",-1)),v(e("input",{type:"number","onUpdate:modelValue":a[2]||(a[2]=d=>o.cantidad=d),min:"0",step:"0.01",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary"},null,512),[[b,o.cantidad,void 0,{number:!0}]])]),e("div",null,[a[20]||(a[20]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Usuario",-1)),e("input",{type:"text",value:x.value,class:"w-full px-4 py-2 rounded-lg border border-gray-300 bg-gray-100",disabled:""},null,8,je)]),e("div",Oe,[a[21]||(a[21]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Descripción",-1)),v(e("input",{type:"text","onUpdate:modelValue":a[3]||(a[3]=d=>o.descripcion=d),class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"Descripción..."},null,512),[[b,o.descripcion]])])]),c.value.length?(f(),y("div",Be,[(f(!0),y(ie,null,le(c.value,(d,V)=>(f(),y("div",{key:V},p(d),1))),128))])):P("",!0)]))]),footer:T(()=>[e("div",Te,[n.isViewing?P("",!0):(f(),y("button",{key:0,onClick:w,class:"px-4 py-2 bg-primary text-neutral rounded-lg hover:bg-primary/90"},p(n.isEditing?"Guardar":"Crear"),1)),e("button",{onClick:a[4]||(a[4]=d=>l.$emit("update:modelValue",!1)),class:"px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400"},"Cerrar")])]),_:1},8,["show"]))}},ze={class:"min-h-screen bg-gradient-to-br via-secondary/40 from-accent/30 to-neutral"},Me={key:0,class:"fixed top-6 left-1/2 transform -translate-x-1/2 z-[9999] w-full max-w-md px-4 pointer-events-none"},Fe={key:1,class:"fixed top-24 left-1/2 transform -translate-x-1/2 z-[10000] w-full max-w-md px-4 pointer-events-auto"},Ke={class:"w-[95%] mx-auto px-4 py-4 md:py-4 mt-20 md:mt-0"},He={class:"bg-white rounded-lg shadow-md p-4"},Je={class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4"},Re={class:"w-full"},qe={class:"w-full"},Ge={class:"w-full"},Qe={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"},We={class:"w-full"},Xe={class:"w-full"},Ye={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"},Ze={class:"w-full"},et={class:"w-full"},tt={class:"w-[95%] mx-auto px-4 py-4"},at={class:"flex justify-between items-center mb-4"},mt={__name:"salidas",setup(n){const E=r(""),g=r(""),_=r(""),o=r(""),x=r(""),m=r(""),c=r(""),h=r(!1),w=r({}),l=r(!1),a=r(!1),d=r(!1),V=r(null),q=[{key:"fecha",label:"Fecha",cellRenderer:s=>s?`<span class="px-2 py-1 rounded text-sm">${s.substring(0,10)}</span>`:""},{key:"producto.nombre",label:"Producto"},{key:"cantidad",label:"Cantidad"},{key:"descripcion",label:"Descripción"},{key:"usuario.nombre",label:"Usuario"}],U=r(1),L=r(0),A=r(!1),z=r(20),M=r([]),u=r(null),I=ne(),F=se(()=>{try{const s=localStorage.getItem("usuario");if(!s)return!1;const t=JSON.parse(s),i=t&&(t.rol||t.role||t.perfil&&t.perfil.rol||t.profile&&t.profile.role)?t.rol||t.role||t.perfil&&t.perfil.rol||t.profile&&t.profile.role:null;return i?String(i).trim().toLowerCase()==="invitado":!1}catch{return!1}}),K={render(){return O("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[O("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})])}},G=[{name:"Editar",icon:{render(){return O("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[O("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})])}},handler:s=>H(s,"editar"),iconOnly:!1,buttonClass:"px-3 py-1 bg-accent text-neutral rounded-md hover:bg-accent/90"},{name:"Eliminar",icon:K,handler:s=>X(s),iconOnly:!1,buttonClass:"px-3 py-1 bg-danger text-neutral rounded-md hover:bg-danger/90"}];async function D(s=1){const t=localStorage.getItem("token");if(!t){j("/");return}try{A.value=!0;const i={descripcion:E.value||void 0,fecha_desde:g.value||void 0,fecha_hasta:_.value||void 0,producto_nombre:o.value||void 0,usuario_nombre:x.value||void 0};(m.value!==""||c.value!=="")&&(i.cantidad={},m.value!==""&&(i.cantidad.min=m.value),c.value!==""&&(i.cantidad.max=c.value));const S=await fetch(`${I.public.backendHost}/salida/filterSalidas/${s}/${z.value}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:t},body:JSON.stringify(i)});if(S.status===401){u.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{j("/")},3e3);return}if(S.status===403){u.value={title:"Acceso Denegado",description:"No tienes permisos para realizar esta acción o acceder a esta información.",type:"error"};return}const N=await S.json();M.value=N.data||[],L.value=N.pagination?.total||0,U.value=N.pagination?.currentPage||1}catch{u.value={title:"Error",description:"No se pudieron cargar las salidas",type:"error"}}finally{A.value=!1}}function H(s,t){w.value={...s},l.value=t==="ver",a.value=t==="editar",h.value=!0}function Q(s){H(s,"ver")}function W(){w.value=null,l.value=!1,a.value=!1,h.value=!0}function X(s){V.value=s,d.value=!0}async function Y(){if(V.value)try{const s=localStorage.getItem("token"),t=await fetch(`${I.public.backendHost}/salida/deleteSalida/${V.value.id_salida}`,{method:"DELETE",headers:{Authorization:s,Accept:"application/json"}});if(t.status===401){u.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{j("/")},3e3);return}if(t.status===403){u.value={title:"Acceso Denegado",description:"No tienes permisos para realizar esta acción o acceder a esta información.",type:"error"};return}if(!t.ok){const i=await t.json().catch(()=>({})),S=Array.isArray(i.errors)?i.errors.join(`
`):i.error||"No se pudo eliminar la salida";u.value={title:"Error",description:S,type:"error"};return}u.value={title:"Salida eliminada",description:"Se eliminó correctamente",type:"success"},await D(U.value)}catch{u.value={title:"Error",description:"Ocurrió un error al eliminar",type:"error"}}finally{d.value=!1,V.value=null}}async function Z(s){try{const t=localStorage.getItem("token"),i=a.value&&w.value?.id_salida?`${I.public.backendHost}/salida/updateSalida/${w.value.id_salida}`:`${I.public.backendHost}/salida/createSalida`,S=a.value?"PUT":"POST",N=await fetch(i,{method:S,headers:{"Content-Type":"application/json",Authorization:t,Accept:"application/json"},body:JSON.stringify(s)});if(!N.ok){const B=await N.json().catch(()=>({})),te=Array.isArray(B.errors)?B.errors.join(`
`):B.error||"Error en la operación";u.value={title:"Error",description:te,type:"error"};return}u.value={title:a.value?"Salida actualizada":"Salida creada",description:"Operación exitosa",type:"success"},h.value=!1,w.value={},a.value=!1,l.value=!1,await D(U.value)}catch{u.value={title:"Error",description:"Ocurrió un error al guardar",type:"error"}}}const k=async()=>{try{A.value=!0,await D(1)}catch(s){console.error("Error al buscar salidas:",s)}finally{A.value=!1}};function ee(s){D(s)}return R(async()=>{if(!localStorage.getItem("token")){j("/");return}await D()}),(s,t)=>(f(),y("div",ze,[$(ue,{title:"Salidas - Pactum",description:"Lista y gestión de salidas de productos.",canonical:"/salidas"}),$(de),u.value?(f(),y("div",Me,[$(me,{title:u.value.title,description:u.value.description,type:u.value.type,onClose:t[0]||(t[0]=i=>u.value=null),class:"pointer-events-auto"},null,8,["title","description","type"])])):P("",!0),d.value?(f(),y("div",Fe,[$(pe,{title:"¿Estás seguro que deseas eliminar esta salida?",description:"Esta acción no se puede deshacer.",icon:K,type:"warning",onConfirm:Y,onClose:t[1]||(t[1]=i=>d.value=!1)})])):P("",!0),e("div",Ke,[e("div",He,[e("div",Je,[e("div",Re,[t[10]||(t[10]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Descripción",-1)),v(e("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=i=>E.value=i),placeholder:"Descripción...",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary",onKeyup:C(k,["enter"])},null,544),[[b,E.value]])]),e("div",qe,[t[11]||(t[11]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Nombre del Producto",-1)),v(e("input",{type:"text","onUpdate:modelValue":t[3]||(t[3]=i=>o.value=i),placeholder:"Nombre del producto...",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary",onKeyup:C(k,["enter"])},null,544),[[b,o.value]])]),e("div",Ge,[t[12]||(t[12]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Nombre de Usuario",-1)),v(e("input",{type:"text","onUpdate:modelValue":t[4]||(t[4]=i=>x.value=i),placeholder:"Nombre de usuario...",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary",onKeyup:C(k,["enter"])},null,544),[[b,x.value]])])]),e("div",Qe,[e("div",We,[t[13]||(t[13]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Cantidad mínima",-1)),v(e("input",{type:"number","onUpdate:modelValue":t[5]||(t[5]=i=>m.value=i),placeholder:"Cantidad min...",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary",onKeyup:C(k,["enter"])},null,544),[[b,m.value,void 0,{number:!0}]])]),e("div",Xe,[t[14]||(t[14]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Cantidad máxima",-1)),v(e("input",{type:"number","onUpdate:modelValue":t[6]||(t[6]=i=>c.value=i),placeholder:"Cantidad max...",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary",onKeyup:C(k,["enter"])},null,544),[[b,c.value,void 0,{number:!0}]])])]),e("div",Ye,[e("div",Ze,[t[15]||(t[15]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Fecha desde",-1)),v(e("input",{type:"date","onUpdate:modelValue":t[7]||(t[7]=i=>g.value=i),class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary",onKeyup:C(k,["enter"])},null,544),[[b,g.value]])]),e("div",et,[t[16]||(t[16]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Fecha hasta",-1)),v(e("input",{type:"date","onUpdate:modelValue":t[8]||(t[8]=i=>_.value=i),class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary",onKeyup:C(k,["enter"])},null,544),[[b,_.value]])])]),e("div",{class:"flex justify-end mt-4"},[e("button",{onClick:k,class:"px-6 py-2 bg-primary text-neutral rounded-lg hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition-colors"}," Buscar ")])])]),e("div",tt,[e("div",at,[t[18]||(t[18]=e("h2",{class:"text-2xl font-bold"},"Salidas",-1)),F.value?P("",!0):(f(),y("button",{key:0,onClick:W,class:"px-4 py-2 bg-primary text-neutral rounded-lg hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-primary flex items-center"},[...t[17]||(t[17]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),re(" Nueva Salida ",-1)])]))]),$(ce,{columns:q,items:M.value,actions:F.value?[]:G,"total-items":L.value,"items-per-page":z.value,"current-page":U.value,"is-loading":A.value,onPageChange:ee,onRowClick:Q},null,8,["items","actions","total-items","items-per-page","current-page","is-loading"])]),$(Le,{modelValue:h.value,"onUpdate:modelValue":t[9]||(t[9]=i=>h.value=i),salida:w.value,"is-editing":a.value,"is-viewing":l.value,onSubmit:Z},null,8,["modelValue","salida","is-editing","is-viewing"])]))}};export{mt as default};
