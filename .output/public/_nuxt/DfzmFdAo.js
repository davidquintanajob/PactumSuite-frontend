const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./B3QBNKx_.js","./BVNNX7O1.js","./entry.9UJSYqx2.css"])))=>i.map(i=>d[i]);
import{r as g,M as te,y as n,F as A,z as r,A as t,C as T,B as m,J as we,O as se,P as de,K as c,L as f,E as w,H as G,S as ne,_ as xe,U as he,V as re,W as le,o as ke,R as ie,n as Ce,q as X,h as q}from"#entry";import{S as Pe}from"./CC2Sf2Ne.js";import{N as Ve}from"./DTHag2Fn.js";import{D as _e}from"./DIpJa8iN.js";import{_ as ue}from"./CP6NTKUH.js";import{_ as Ee}from"./DWLPyndB.js";import{_ as Q}from"./baAHEXJQ.js";import{u as ee,w as $e}from"./3SA47z_C.js";import"./BzLCLO6P.js";const Ue={key:0,class:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center"},De={key:0,class:"fixed top-6 left-1/2 transform -translate-x-1/2 z-[9999] w-full max-w-md px-4 pointer-events-none"},Oe={class:"bg-white rounded-lg p-6 w-full max-w-lg max-h-[80vh] overflow-y-auto"},Se={class:"flex justify-between items-center mb-6"},Te={class:"text-2xl font-bold text-gray-800"},Ae={class:"space-y-4"},Ie={class:"space-y-2"},Fe=["onUpdate:modelValue","readonly","disabled","required","placeholder","onInput"],Ne=["onClick","disabled"],je=["disabled"],Le=["readonly","disabled"],ze=["readonly","disabled"],Me={class:"space-y-2"},Be=["disabled"],Re={class:"w-4 h-4 border-2 border-current rounded-full mr-3 flex items-center justify-center"},He={key:0,class:"w-2 h-2 bg-white rounded-full"},Ke=["disabled"],qe={class:"w-4 h-4 border-2 border-current rounded-full mr-3 flex items-center justify-center"},Ge={key:0,class:"w-2 h-2 bg-white rounded-full"},Je={key:0,class:"flex justify-end space-x-4 mt-6"},We=["disabled"],Ye=["disabled"],Xe={key:0,class:"flex items-center"},Qe={key:1},Ze={key:0,class:"text-red-600 text-sm mt-2"},et={__name:"OfertaModal",props:{modelValue:{type:Boolean,required:!0},oferta:{type:Object,default:()=>({})},isEditing:{type:Boolean,default:!1},isViewing:{type:Boolean,default:!1},usuarios:{type:Array,default:()=>[]},contratos:{type:Array,default:()=>[]},id_usuario:{type:[Number,null],default:null},id_contrato:{type:[Number,null],default:null}},emits:["update:modelValue","submit"],setup(y,{emit:N}){const u=y,U=N,l=g({fecha_inicio:"",fecha_fin:"",id_contrato:"",id_usuario:"",estado:"no_facturada"}),o=g([""]),D=g(""),x=g(!1),_=g(null);te(()=>[u.oferta,u.id_usuario,u.id_contrato],([a,i,s])=>{a&&Object.keys(a).length>0?(l.value={fecha_inicio:a.fecha_inicio?a.fecha_inicio.split("T")[0]:"",fecha_fin:a.fecha_fin?a.fecha_fin.split("T")[0]:"",id_contrato:s!=null?u.contratos.find(h=>h.id_contrato===s)?.id_contrato??null:Number(a.id_contrato||a.contrato?.id_contrato||0)||null,id_usuario:i!=null?u.usuarios.find(h=>h.id_usuario===i)?.id_usuario??null:Number(a.id_usuario||a.usuario?.id_usuario||0)||null,estado:a.estado==="facturada"?"facturada":"no_facturada"},a.descripciones&&Array.isArray(a.descripciones)?(o.value=a.descripciones.map(h=>h.descripcion||""),o.value.length>0&&o.value.push("")):o.value=[""]):(l.value={fecha_inicio:"",fecha_fin:"",id_contrato:null,id_usuario:null,estado:"no_facturada"},o.value=[""])},{immediate:!0}),te([()=>u.usuarios,()=>u.contratos,()=>u.id_usuario,()=>u.id_contrato],([a,i,s,h])=>{u.oferta&&Object.keys(u.oferta).length>0&&(h!=null?l.value.id_contrato=u.contratos.find(P=>P.id_contrato===h)?.id_contrato??null:l.value.id_contrato=Number(u.oferta.id_contrato||u.oferta.contrato?.id_contrato||0)||null,s!=null?l.value.id_usuario=u.usuarios.find(P=>P.id_usuario===s)?.id_usuario??null:l.value.id_usuario=Number(u.oferta.id_usuario||u.oferta.usuario?.id_usuario||0)||null)});const E=()=>{o.value.length<15&&o.value.push("")},I=a=>{o.value.length>1&&o.value.splice(a,1)},k=a=>{a===o.value.length-1&&o.value[a].trim()!==""&&o.value.length<15&&o.value.push("")},e=async()=>{D.value="";const a=o.value.filter(i=>i.trim()!=="");if(a.length===0||!l.value.fecha_inicio||!l.value.fecha_fin||!l.value.id_contrato||!l.value.id_usuario||!l.value.estado){D.value="Todos los campos son obligatorios.";return}x.value=!0,_.value={title:u.isEditing?"Guardando Oferta":"Creando Oferta",description:"Comunicando con el servidor, espere por favor...",type:"warning"};try{const i={...l.value,descripciones:a.map(s=>({descripcion:s.trim()}))};await new Promise((s,h)=>{U("submit",i),setTimeout(s,100)})}catch(i){console.error("Error en handleSubmit:",i)}finally{setTimeout(()=>{x.value=!1,_.value=null},500)}};return(a,i)=>y.modelValue?(r(),n("div",Ue,[_.value?(r(),n("div",De,[T(ue,{title:_.value.title,description:_.value.description,type:_.value.type,onClose:i[0]||(i[0]=s=>_.value=null),class:"pointer-events-auto"},null,8,["title","description","type"])])):A("",!0),t("div",Oe,[t("div",Se,[t("h2",Te,m(y.isViewing?"Detalles de Oferta":y.isEditing?"Editar Oferta":"Nueva Oferta"),1),t("button",{onClick:i[1]||(i[1]=s=>a.$emit("update:modelValue",!1)),class:"text-gray-500 hover:text-gray-700"},[...i[9]||(i[9]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),t("form",{onSubmit:we(e,["prevent"]),class:"space-y-4"},[t("div",Ae,[t("div",null,[i[12]||(i[12]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Descripciones",-1)),t("div",Ie,[(r(!0),n(se,null,de(o.value,(s,h)=>(r(),n("div",{key:h,class:"flex items-start space-x-2"},[c(t("textarea",{"onUpdate:modelValue":P=>o.value[h]=P,readonly:y.isViewing,disabled:y.isViewing||x.value,required:h===0,rows:"2",class:"flex-1 px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:`Descripción ${h+1}${h===0?" (requerida)":""}`,onInput:P=>k(h)},null,40,Fe),[[f,o.value[h]]]),!y.isViewing&&o.value.length>1?(r(),n("button",{key:0,type:"button",onClick:P=>I(h),class:"mt-2 p-1 text-red-500 hover:text-red-700 focus:outline-none",disabled:x.value},[...i[10]||(i[10]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,Ne)):A("",!0)]))),128)),!y.isViewing&&o.value.length<15?(r(),n("button",{key:0,type:"button",onClick:E,class:"w-full px-4 py-2 text-primary border-2 border-dashed border-accent/60 rounded-lg hover:border-accent/80 hover:brightness-90 focus:outline-none focus:ring-2 focus:ring-primary transition-colors",disabled:x.value},[...i[11]||(i[11]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 inline mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),w(" Agregar descripción ",-1)])],8,je)):A("",!0)])]),t("div",null,[i[13]||(i[13]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Fecha inicio",-1)),c(t("input",{"onUpdate:modelValue":i[2]||(i[2]=s=>l.value.fecha_inicio=s),type:"date",readonly:y.isViewing,disabled:y.isViewing||x.value,required:"",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500"},null,8,Le),[[f,l.value.fecha_inicio]])]),t("div",null,[i[14]||(i[14]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Fecha fin",-1)),c(t("input",{"onUpdate:modelValue":i[3]||(i[3]=s=>l.value.fecha_fin=s),type:"date",readonly:y.isViewing,disabled:y.isViewing||x.value,required:"",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500"},null,8,ze),[[f,l.value.fecha_fin]])]),t("div",null,[i[15]||(i[15]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Contrato",-1)),T(Q,{modelValue:l.value.id_contrato,"onUpdate:modelValue":i[4]||(i[4]=s=>l.value.id_contrato=s),options:y.contratos,labelKey:s=>`${s.entidad?.nombre}: ${s?.num_consecutivo} - ${s.tipoContrato?.nombre} - (${s.fecha_inicio?.substring(0,4)})`,valueKey:"id_contrato",placeholder:"Buscar contrato...",disabled:y.isViewing||x.value,required:""},null,8,["modelValue","options","labelKey","disabled"])]),t("div",null,[i[16]||(i[16]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Usuario",-1)),T(Q,{modelValue:l.value.id_usuario,"onUpdate:modelValue":i[5]||(i[5]=s=>l.value.id_usuario=s),options:y.usuarios,labelKey:"nombre",valueKey:"id_usuario",placeholder:"Buscar usuario...",disabled:y.isViewing||x.value,required:""},null,8,["modelValue","options","disabled"])]),t("div",null,[i[19]||(i[19]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Estado",-1)),t("div",Me,[t("label",{class:G(["flex items-center cursor-pointer",{"opacity-50":y.isViewing||x.value}])},[c(t("input",{type:"radio","onUpdate:modelValue":i[6]||(i[6]=s=>l.value.estado=s),value:"facturada",disabled:y.isViewing||x.value,class:"sr-only"},null,8,Be),[[ne,l.value.estado]]),t("div",{class:G(["px-4 py-2 rounded-lg border-2 transition-all duration-200 flex items-center",l.value.estado==="facturada"?"bg-primary border-primary text-neutral shadow-md":"bg-blue-100 border-blue-300 text-blue-700 hover:bg-blue-200"])},[t("div",Re,[l.value.estado==="facturada"?(r(),n("div",He)):A("",!0)]),i[17]||(i[17]=t("span",{class:"font-medium"},"Facturada",-1))],2)],2),t("label",{class:G(["flex items-center cursor-pointer",{"opacity-50":y.isViewing||x.value}])},[c(t("input",{type:"radio","onUpdate:modelValue":i[7]||(i[7]=s=>l.value.estado=s),value:"no_facturada",disabled:y.isViewing||x.value,class:"sr-only"},null,8,Ke),[[ne,l.value.estado]]),t("div",{class:G(["px-4 py-2 rounded-lg border-2 transition-all duration-200 flex items-center",l.value.estado==="no_facturada"?"bg-gray-500 border-gray-600 text-white shadow-md":"bg-gray-100 border-gray-300 text-gray-700 hover:bg-gray-200"])},[t("div",qe,[l.value.estado==="no_facturada"?(r(),n("div",Ge)):A("",!0)]),i[18]||(i[18]=t("span",{class:"font-medium"},"No Facturada",-1))],2)],2)])])]),y.isViewing?A("",!0):(r(),n("div",Je,[t("button",{type:"button",onClick:i[8]||(i[8]=s=>a.$emit("update:modelValue",!1)),class:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-500",disabled:x.value}," Cancelar ",8,We),t("button",{type:"submit",class:"px-4 py-2 text-white bg-blue-500 rounded-lg hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",disabled:x.value},[x.value?(r(),n("span",Xe,[i[20]||(i[20]=t("svg",{class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)),w(" "+m(y.isEditing?"Guardando...":"Creando..."),1)])):(r(),n("span",Qe,m(y.isEditing?"Guardar Cambios":"Crear Oferta"),1))],8,Ye)]))],32),D.value?(r(),n("div",Ze,m(D.value),1)):A("",!0)])])):A("",!0)}},tt={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50"},ot={class:"bg-neutral rounded-lg shadow-lg w-full max-w-3xl p-6 relative",style:{"max-height":"95vh","overflow-y":"auto"}},at={class:"overflow-y-auto",style:{"max-height":"80vh"}},nt={class:"flex items-center border-b-2 border-primary"},rt={class:"flex-1 text-center text-2xl font-bold text-primary py-2"},lt={key:0},it={class:"flex-1 text-center text-2xl font-bold text-primary py-2 border-l-2 border-primary"},st={key:0},dt={class:"w-20 text-right text-2xl font-bold text-primary py-2 border-l-2 border-primary pr-2"},ut={key:0},ct={class:"p-2 border-b border-primary"},pt={key:0},mt={key:2},ft={class:"font-bold"},vt={key:0},bt={class:"font-bold"},gt={key:0},yt={key:4},wt={class:"p-2 border-b border-primary"},xt={key:0},ht={key:1},kt={key:3},Ct={key:5},Pt={key:7},Vt={key:9},_t={class:"w-full border-collapse border-primary",style:{"font-size":"12px","table-layout":"fixed"}},Et={class:"border border-primary px-1",style:{"vertical-align":"middle"}},$t={key:0},Ut=["onUpdate:modelValue"],Dt={class:"border border-primary px-1",style:{"vertical-align":"middle"}},Ot={key:0},St=["onUpdate:modelValue"],Tt={class:"border border-primary px-1",style:{"vertical-align":"middle"}},At={key:0},It=["onUpdate:modelValue"],Ft={class:"border border-primary px-1",style:{"vertical-align":"middle"}},Nt={key:0},jt=["onUpdate:modelValue","onInput"],Lt={class:"border border-primary px-1",style:{"vertical-align":"middle"}},zt={key:0},Mt=["onUpdate:modelValue","onInput"],Bt={class:"border border-primary px-1",style:{"vertical-align":"middle"}},Rt={key:0},Ht=["onUpdate:modelValue"],Kt={style:{height:"40px"}},qt={class:"border border-primary px-1 text-right font-bold",style:{"vertical-align":"middle"}},Gt={key:0},Jt={class:"border border-primary px-1 text-right font-bold",style:{"vertical-align":"middle"}},Wt={key:0},Yt={class:"flex border-t border-primary mt-0"},Xt={class:"w-1/2 p-2 border-r border-primary"},Qt={key:0},Zt={key:2},eo={key:4},to={key:6},oo={key:8},ao={key:10},no={class:"w-1/2 p-2"},ro={key:0},lo={key:2},io={key:4},so={key:6},uo={key:8},co={class:"p-2 border-t border-primary"},po={key:0},mo={class:"font-bold"},fo={key:0},vo={class:"text-red-600 font-bold"},bo={__name:"ModalPDF",props:{show:Boolean,ofertaData:{type:Object,default:()=>({})}},emits:["close"],setup(y,{emit:N}){const u=y,U=g(null),l=g(!1),o=he({empresa:"SOLUTEL S.R.L",titulo:"OFERTA COMERCIAL",numero:"/25",proveedor:"SOLUTEL S.R.L",domicilioProveedor:"Calle Ernesto Valdez Muñoz No. 10 entre Independencia y Céspedes,",cupProveedor:"1252354000140315",usdProveedor:"1299750000010836",nitProveedor:"50004182197",domicilioCliente:"",cupCliente:"",sucursalCliente:"",reeupCliente:"",nitCliente:"",tabla:Array.from({length:9},(k,e)=>({no:e===0?"No.1":"",descripcion:"",um:"",cantidad:"",precio:"",importe:""})),totalPrecio:"0.00",totalImporte:"0.00",nombreProveedor:"Belkis Martínez Arevalo",ciProveedor:"70081403279",cargoProveedor:"Especialista",fechaEntregaProveedor:"",firmaProveedor:"",cunoProveedor:"",nombreCliente:"",ciCliente:"",cargoCliente:"",fechaEntregaCliente:"",firmaCliente:"",observaciones:"",pagoA:"SOLUTEL S.R.L Cuenta Bancaria: CUP:1252354000140315",validez:""}),D={empresa:"SOLUTEL S.R.L",titulo:"OFERTA COMERCIAL",numero:"/25",proveedor:"SOLUTEL S.R.L",domicilioProveedor:"Calle Ernesto Valdez Muñoz No. 10 entre Independencia y Céspedes,",cupProveedor:"1252354000140315",usdProveedor:"1299750000010836",nitProveedor:"50004182197",domicilioCliente:"",cupCliente:"",sucursalCliente:"",reeupCliente:"",nitCliente:"",tabla:Array.from({length:9},(k,e)=>({no:e===0?"No.1":"",descripcion:"",um:"",cantidad:"",precio:"",importe:""})),totalPrecio:"0.00",totalImporte:"0.00",nombreProveedor:"Belkis Martínez Arevalo",ciProveedor:"70081403279",cargoProveedor:"Especialista",fechaEntregaProveedor:"",firmaProveedor:"",cunoProveedor:"",nombreCliente:"",ciCliente:"",cargoCliente:"",fechaEntregaCliente:"",firmaCliente:"",observaciones:"",pagoA:"SOLUTEL S.R.L Cuenta Bancaria: CUP:1252354000140315",validez:"La Oferta válida por 7 días"};function x(){Object.assign(o,JSON.parse(JSON.stringify(D)))}function _(k){const e=o.tabla[k],a=parseFloat(e.cantidad)||0,i=parseFloat(e.precio)||0,s=a*i;e.importe=s.toFixed(2),E()}function E(){let k=0,e=0;o.tabla.forEach(a=>{const i=parseFloat(a.precio)||0,s=parseFloat(a.importe)||0;if(u.ofertaData.fecha_inicio&&u.ofertaData.fecha_fin){const h=new Date(u.ofertaData.fecha_inicio),V=new Date(u.ofertaData.fecha_fin)-h,B=Math.ceil(V/(1e3*60*60*24));o.validez=`La Oferta válida por ${B} días`}else o.validez="La Oferta válida por 7 días";k+=i,e+=s}),o.totalPrecio=k.toFixed(2),o.totalImporte=e.toFixed(2)}te(()=>u.show,k=>{if(k&&x(),k&&u.ofertaData){if(u.ofertaData.contrato&&u.ofertaData.contrato.entidad){const e=u.ofertaData.contrato.entidad;o.domicilioCliente=e.direccion||"",o.cupCliente=e.cuenta_bancaria||"",o.sucursalCliente="",o.reeupCliente=e.codigo_reo||"",o.nitCliente=e.codigo_nit||""}u.ofertaData.descripciones&&Array.isArray(u.ofertaData.descripciones)?(o.tabla.forEach(e=>{e.descripcion=""}),u.ofertaData.descripciones.forEach((e,a)=>{a<o.tabla.length&&(o.tabla[a].descripcion=e.descripcion||"",o.tabla[a].no=`No.${a+1}`)}),E()):u.ofertaData.descripcion&&(o.tabla[0].descripcion=u.ofertaData.descripcion,E())}k||x()});async function I(){l.value=!0,await re();try{if(typeof window>"u"){console.warn("exportarPDF called on server - aborting");return}const k=await le(()=>import("./B0tyYwQk.js"),[],import.meta.url),e=k&&(k.default||k),a=await le(()=>import("./B3QBNKx_.js").then(O=>O.j),__vite__mapDeps([0,1,2]),import.meta.url),i=a&&(a.jsPDF||a.default||a);await new Promise(O=>setTimeout(O,100));const s=U.value,P=(await e(s,{scale:2,useCORS:!0,allowTaint:!0,backgroundColor:"#ffffff",logging:!1,width:s.scrollWidth,height:s.scrollHeight,scrollX:0,scrollY:0,windowWidth:s.scrollWidth,windowHeight:s.scrollHeight})).toDataURL("image/png",1),V=new i({orientation:"portrait",unit:"mm",format:"a4"}),B=V.internal.pageSize.getWidth(),b=V.internal.pageSize.getHeight(),R=V.getImageProperties(P),j=B-10,$=R.height*j/R.width;if($<=b-10)V.addImage(P,"PNG",5,5,j,$);else{let O=$,M=5;for(V.addImage(P,"PNG",5,M,j,$),O-=b-10;O>=0;)M=O-$+5,V.addPage(),V.addImage(P,"PNG",5,M,j,$),O-=b-10}V.save("Oferta.pdf")}catch(k){console.error("Error al generar el PDF:",k),alert("Error al generar el PDF.")}finally{l.value=!1,await re()}}return(k,e)=>y.show?(r(),n("div",tt,[t("div",ot,[t("button",{onClick:e[0]||(e[0]=a=>k.$emit("close")),class:"absolute top-2 right-2 text-gray-500 hover:text-gray-700 text-xl"},"×"),t("div",at,[t("div",{ref_key:"pdfContent",ref:U,class:"bg-neutral border-2 border-primary p-0 text-xs font-sans",style:{"min-width":"700px"}},[t("div",nt,[t("div",rt,[l.value?(r(),n("span",lt,m(o.empresa),1)):c((r(),n("input",{key:1,"onUpdate:modelValue":e[1]||(e[1]=a=>o.empresa=a),class:"w-full text-center font-bold text-primary bg-transparent outline-none"},null,512)),[[f,o.empresa]])]),t("div",it,[l.value?(r(),n("span",st,m(o.titulo),1)):c((r(),n("input",{key:1,"onUpdate:modelValue":e[2]||(e[2]=a=>o.titulo=a),class:"w-full text-center font-bold text-primary bg-transparent outline-none"},null,512)),[[f,o.titulo]])]),t("div",dt,[l.value?(r(),n("span",ut,m(o.numero),1)):c((r(),n("input",{key:1,"onUpdate:modelValue":e[3]||(e[3]=a=>o.numero=a),class:"w-full text-right font-bold text-primary bg-transparent outline-none"},null,512)),[[f,o.numero]])])]),t("div",ct,[e[31]||(e[31]=t("span",{class:"font-bold text-primary"},"Datos del Proveedor:",-1)),l.value?(r(),n("span",pt,m(o.proveedor),1)):c((r(),n("input",{key:1,"onUpdate:modelValue":e[4]||(e[4]=a=>o.proveedor=a),class:"font-bold bg-transparent outline-none"},null,512)),[[f,o.proveedor]]),e[32]||(e[32]=t("br",null,null,-1)),e[33]||(e[33]=w(" Domicilio Legal: ",-1)),l.value?(r(),n("span",mt,m(o.domicilioProveedor),1)):c((r(),n("input",{key:3,"onUpdate:modelValue":e[5]||(e[5]=a=>o.domicilioProveedor=a),class:"bg-transparent outline-none w-2/3"},null,512)),[[f,o.domicilioProveedor]]),e[34]||(e[34]=t("br",null,null,-1)),e[35]||(e[35]=w(" Cuentas Bancarias en ",-1)),t("span",ft,[e[29]||(e[29]=w("CUP:",-1)),l.value?(r(),n("span",vt,m(o.cupProveedor),1)):c((r(),n("input",{key:1,"onUpdate:modelValue":e[6]||(e[6]=a=>o.cupProveedor=a),class:"bg-transparent outline-none w-32 font-bold"},null,512)),[[f,o.cupProveedor]])]),e[36]||(e[36]=w(" en ",-1)),t("span",bt,[e[30]||(e[30]=w("USD: ",-1)),l.value?(r(),n("span",gt,m(o.usdProveedor),1)):c((r(),n("input",{key:1,"onUpdate:modelValue":e[7]||(e[7]=a=>o.usdProveedor=a),class:"bg-transparent outline-none w-40 font-bold"},null,512)),[[f,o.usdProveedor]])]),e[37]||(e[37]=t("br",null,null,-1)),e[38]||(e[38]=w(" NIT: ",-1)),l.value?(r(),n("span",yt,m(o.nitProveedor),1)):c((r(),n("input",{key:5,"onUpdate:modelValue":e[8]||(e[8]=a=>o.nitProveedor=a),class:"bg-transparent outline-none w-40"},null,512)),[[f,o.nitProveedor]])]),t("div",wt,[e[39]||(e[39]=t("span",{class:"font-bold text-primary"},"Datos del Cliente:",-1)),u.ofertaData&&u.ofertaData.contrato&&u.ofertaData.contrato.entidad&&u.ofertaData.contrato.entidad.nombre?(r(),n("span",xt,m(u.ofertaData.contrato.entidad.nombre),1)):A("",!0),e[40]||(e[40]=t("br",null,null,-1)),e[41]||(e[41]=w(" Domicilio Legal: ",-1)),l.value?(r(),n("span",ht,m(o.domicilioCliente),1)):c((r(),n("input",{key:2,"onUpdate:modelValue":e[9]||(e[9]=a=>o.domicilioCliente=a),class:"bg-transparent outline-none w-2/3"},null,512)),[[f,o.domicilioCliente]]),e[42]||(e[42]=t("br",null,null,-1)),e[43]||(e[43]=w(" Cuentas Bancarias en CUP: ",-1)),l.value?(r(),n("span",kt,m(o.cupCliente),1)):c((r(),n("input",{key:4,"onUpdate:modelValue":e[10]||(e[10]=a=>o.cupCliente=a),class:"bg-transparent outline-none w-32"},null,512)),[[f,o.cupCliente]]),e[44]||(e[44]=w(" Sucursal: ",-1)),l.value?(r(),n("span",Ct,m(o.sucursalCliente),1)):c((r(),n("input",{key:6,"onUpdate:modelValue":e[11]||(e[11]=a=>o.sucursalCliente=a),class:"bg-transparent outline-none w-32"},null,512)),[[f,o.sucursalCliente]]),e[45]||(e[45]=t("br",null,null,-1)),e[46]||(e[46]=w(" Código REEUP: ",-1)),l.value?(r(),n("span",Pt,m(o.reeupCliente),1)):c((r(),n("input",{key:8,"onUpdate:modelValue":e[12]||(e[12]=a=>o.reeupCliente=a),class:"bg-transparent outline-none w-32"},null,512)),[[f,o.reeupCliente]]),e[47]||(e[47]=w(" NIT: ",-1)),l.value?(r(),n("span",Vt,m(o.nitCliente),1)):c((r(),n("input",{key:10,"onUpdate:modelValue":e[13]||(e[13]=a=>o.nitCliente=a),class:"bg-transparent outline-none w-32"},null,512)),[[f,o.nitCliente]])]),t("table",_t,[e[49]||(e[49]=t("thead",null,[t("tr",{class:"bg-accent/40 text-primary",style:{height:"40px"}},[t("th",{class:"border border-primary px-1",style:{width:"8%"}},"No"),t("th",{class:"border border-primary px-1",style:{width:"35%"}},"Descripción"),t("th",{class:"border border-primary px-1",style:{width:"12%"}},"U/M"),t("th",{class:"border border-primary px-1",style:{width:"15%"}},"Cantidad"),t("th",{class:"border border-primary px-1",style:{width:"15%"}},"Precio"),t("th",{class:"border border-primary px-1",style:{width:"15%"}},"Importe")])],-1)),t("tbody",null,[(r(!0),n(se,null,de(o.tabla,(a,i)=>(r(),n("tr",{key:i,style:{height:"40px"}},[t("td",Et,[l.value?(r(),n("span",$t,m(a.no),1)):c((r(),n("input",{key:1,"onUpdate:modelValue":s=>a.no=s,class:"w-full bg-transparent outline-none text-center"},null,8,Ut)),[[f,a.no]])]),t("td",Dt,[l.value?(r(),n("span",Ot,m(a.descripcion),1)):c((r(),n("input",{key:1,"onUpdate:modelValue":s=>a.descripcion=s,class:"w-full bg-transparent outline-none"},null,8,St)),[[f,a.descripcion]])]),t("td",Tt,[l.value?(r(),n("span",At,m(a.um),1)):c((r(),n("input",{key:1,"onUpdate:modelValue":s=>a.um=s,class:"w-full bg-transparent outline-none text-center"},null,8,It)),[[f,a.um]])]),t("td",Ft,[l.value?(r(),n("span",Nt,m(a.cantidad),1)):c((r(),n("input",{key:1,"onUpdate:modelValue":s=>a.cantidad=s,class:"w-full bg-transparent outline-none text-center",onInput:s=>_(i)},null,40,jt)),[[f,a.cantidad]])]),t("td",Lt,[l.value?(r(),n("span",zt,m(a.precio),1)):c((r(),n("input",{key:1,"onUpdate:modelValue":s=>a.precio=s,class:"w-full bg-transparent outline-none text-center",onInput:s=>_(i)},null,40,Mt)),[[f,a.precio]])]),t("td",Bt,[l.value?(r(),n("span",Rt,m(a.importe),1)):c((r(),n("input",{key:1,"onUpdate:modelValue":s=>a.importe=s,class:"w-full bg-transparent outline-none text-center",readonly:""},null,8,Ht)),[[f,a.importe]])])]))),128)),t("tr",Kt,[e[48]||(e[48]=t("td",{class:"border border-primary px-1 text-right font-bold",colspan:"4",style:{"vertical-align":"middle"}},"Totales",-1)),t("td",qt,[l.value?(r(),n("span",Gt,m(o.totalPrecio),1)):c((r(),n("input",{key:1,"onUpdate:modelValue":e[14]||(e[14]=a=>o.totalPrecio=a),class:"w-full bg-transparent outline-none text-right font-bold"},null,512)),[[f,o.totalPrecio]])]),t("td",Jt,[l.value?(r(),n("span",Wt,m(o.totalImporte),1)):c((r(),n("input",{key:1,"onUpdate:modelValue":e[15]||(e[15]=a=>o.totalImporte=a),class:"w-full bg-transparent outline-none text-right font-bold"},null,512)),[[f,o.totalImporte]])])])])]),t("div",Yt,[t("div",Xt,[e[50]||(e[50]=t("div",{class:"font-bold text-primary"},"REPRESENTANTE DEL PROVEEDOR",-1)),e[51]||(e[51]=w(" Nombre: ",-1)),l.value?(r(),n("span",Qt,m(o.nombreProveedor),1)):c((r(),n("input",{key:1,"onUpdate:modelValue":e[16]||(e[16]=a=>o.nombreProveedor=a),class:"bg-transparent outline-none w-40"},null,512)),[[f,o.nombreProveedor]]),e[52]||(e[52]=t("br",null,null,-1)),e[53]||(e[53]=w(" CI: ",-1)),l.value?(r(),n("span",Zt,m(o.ciProveedor),1)):c((r(),n("input",{key:3,"onUpdate:modelValue":e[17]||(e[17]=a=>o.ciProveedor=a),class:"bg-transparent outline-none w-32"},null,512)),[[f,o.ciProveedor]]),e[54]||(e[54]=t("br",null,null,-1)),e[55]||(e[55]=w(" Cargo: ",-1)),l.value?(r(),n("span",eo,m(o.cargoProveedor),1)):c((r(),n("input",{key:5,"onUpdate:modelValue":e[18]||(e[18]=a=>o.cargoProveedor=a),class:"bg-transparent outline-none w-32"},null,512)),[[f,o.cargoProveedor]]),e[56]||(e[56]=t("br",null,null,-1)),e[57]||(e[57]=w(" Fecha de Entrega: ",-1)),l.value?(r(),n("span",to,m(o.fechaEntregaProveedor),1)):c((r(),n("input",{key:7,"onUpdate:modelValue":e[19]||(e[19]=a=>o.fechaEntregaProveedor=a),class:"bg-transparent outline-none w-32"},null,512)),[[f,o.fechaEntregaProveedor]]),e[58]||(e[58]=t("br",null,null,-1)),e[59]||(e[59]=w(" Firma: ",-1)),l.value?(r(),n("span",oo,m(o.firmaProveedor),1)):c((r(),n("input",{key:9,"onUpdate:modelValue":e[20]||(e[20]=a=>o.firmaProveedor=a),class:"bg-transparent outline-none w-32"},null,512)),[[f,o.firmaProveedor]]),e[60]||(e[60]=t("br",null,null,-1)),e[61]||(e[61]=w(" Cuño: ",-1)),l.value?(r(),n("span",ao,m(o.cunoProveedor),1)):c((r(),n("input",{key:11,"onUpdate:modelValue":e[21]||(e[21]=a=>o.cunoProveedor=a),class:"bg-transparent outline-none w-32"},null,512)),[[f,o.cunoProveedor]])]),t("div",no,[e[62]||(e[62]=t("div",{class:"font-bold text-primary"},"REPRESENTANTE DEL CLIENTE",-1)),e[63]||(e[63]=w(" Nombre: ",-1)),l.value?(r(),n("span",ro,m(o.nombreCliente),1)):c((r(),n("input",{key:1,"onUpdate:modelValue":e[22]||(e[22]=a=>o.nombreCliente=a),class:"bg-transparent outline-none w-40"},null,512)),[[f,o.nombreCliente]]),e[64]||(e[64]=t("br",null,null,-1)),e[65]||(e[65]=w(" CI: ",-1)),l.value?(r(),n("span",lo,m(o.ciCliente),1)):c((r(),n("input",{key:3,"onUpdate:modelValue":e[23]||(e[23]=a=>o.ciCliente=a),class:"bg-transparent outline-none w-32"},null,512)),[[f,o.ciCliente]]),e[66]||(e[66]=t("br",null,null,-1)),e[67]||(e[67]=w(" Cargo: ",-1)),l.value?(r(),n("span",io,m(o.cargoCliente),1)):c((r(),n("input",{key:5,"onUpdate:modelValue":e[24]||(e[24]=a=>o.cargoCliente=a),class:"bg-transparent outline-none w-32"},null,512)),[[f,o.cargoCliente]]),e[68]||(e[68]=t("br",null,null,-1)),e[69]||(e[69]=w(" Fecha de Entrega: ",-1)),l.value?(r(),n("span",so,m(o.fechaEntregaCliente),1)):c((r(),n("input",{key:7,"onUpdate:modelValue":e[25]||(e[25]=a=>o.fechaEntregaCliente=a),class:"bg-transparent outline-none w-32"},null,512)),[[f,o.fechaEntregaCliente]]),e[70]||(e[70]=t("br",null,null,-1)),e[71]||(e[71]=w(" Firma: ",-1)),l.value?(r(),n("span",uo,m(o.firmaCliente),1)):c((r(),n("input",{key:9,"onUpdate:modelValue":e[26]||(e[26]=a=>o.firmaCliente=a),class:"bg-transparent outline-none w-32"},null,512)),[[f,o.firmaCliente]])])]),t("div",co,[e[73]||(e[73]=t("span",{class:"font-bold text-primary"},"Observaciones:",-1)),e[74]||(e[74]=t("br",null,null,-1)),l.value?(r(),n("span",po,m(o.observaciones),1)):c((r(),n("textarea",{key:1,"onUpdate:modelValue":e[27]||(e[27]=a=>o.observaciones=a),class:"w-full bg-transparent outline-none resize-none",rows:"2"},null,512)),[[f,o.observaciones]]),e[75]||(e[75]=t("br",null,null,-1)),t("span",mo,[e[72]||(e[72]=w("Paguese a: ",-1)),l.value?(r(),n("span",fo,m(o.pagoA),1)):c((r(),n("input",{key:1,"onUpdate:modelValue":e[28]||(e[28]=a=>o.pagoA=a),class:"bg-transparent outline-none w-96 font-bold"},null,512)),[[f,o.pagoA]])]),e[76]||(e[76]=t("br",null,null,-1)),t("span",vo,m(o.validez),1)])],512)]),t("div",{class:"flex justify-end mt-4"},[t("button",{onClick:I,class:"px-6 py-2 bg-primary text-neutral rounded hover:bg-primary/90 flex items-center"},[...e[77]||(e[77]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),w(" Exportar a PDF ",-1)])])])])])):A("",!0)}},go=xe(bo,[["__scopeId","data-v-ba4eb84b"]]),yo={class:"min-h-screen bg-gradient-to-br via-secondary/40 from-accent/30 to-neutral"},wo={key:0,class:"fixed top-6 left-1/2 transform -translate-x-1/2 z-[9999] w-full max-w-md px-4 pointer-events-none"},xo={key:1,class:"fixed top-24 left-1/2 transform -translate-x-1/2 z-[10000] w-full max-w-md px-4 pointer-events-auto"},ho={class:"w-[95%] mx-auto px-4 py-4 md:py-4 mt-20 md:mt-0"},ko={class:"bg-white rounded-lg shadow-md p-4"},Co={class:"md:hidden flex justify-between items-center mb-4"},Po={class:"w-full"},Vo={class:"w-full"},_o={class:"w-full"},Eo={class:"w-full"},$o={class:"w-[95%] mx-auto px-4 py-4"},jo={__name:"ofertas",setup(y){const N=g(""),u=g(""),U=g(""),l=g(""),o=g(!1),D=g([]),x=g([]),_=g(!1),E=g({}),I=g(!1),k=g(!1),e=g(!1),a=g({}),i=[{key:"fecha_inicio",label:"Fecha Inicio"},{key:"fecha_fin",label:"Fecha Fin"},{key:"contrato.entidad.nombre",label:"Entidad"},{key:"contrato.num_consecutivo",label:"Num Contrato"},{key:"usuario.nombre",label:"Usuario"},{key:"estado",label:"Estado",cellRenderer:p=>{if(!p)return"";switch(p.toLowerCase()){case"facturada":return'<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-accent/30 text-primary">Facturada</span>';case"vigente":return'<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">Vigente</span>';case"vencida":return'<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">Vencida</span>';default:return p}}}],s=g(1),h=g(0),P=g(!1),V=g(20),B=g([]),b=g(null),R=g(!1),j=g(null),$=Ce(),O=async()=>{try{const p=localStorage.getItem("token"),v=await(await fetch(`${$.public.backendHost}/usuario`,{method:"GET",headers:{Authorization:p,Accept:"application/json"}})).json();D.value=Array.isArray(v.data)?v.data:v;const S=await(await fetch(`${$.public.backendHost}/contrato`,{method:"GET",headers:{Authorization:p,Accept:"application/json"}})).json();x.value=Array.isArray(S.data)?S.data:S}catch(p){console.error("Error al cargar usuarios o contratos:",p)}},M=async(p=1,d=20,v="",K="",S="",L="",z="")=>{try{P.value=!0;const H=localStorage.getItem("token"),W={descripcion:z,fecha_inicio:v,fecha_fin:K,id_contrato:S,id_usuario:L,page:p,limit:d},J=await fetch(`${$.public.backendHost}/oferta/filterOfertas`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:H,Accept:"application/json"},body:JSON.stringify(W)});if(J.status===401){b.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{X("/")},3e3);return}if(J.status===403){b.value={title:"Acceso Denegado",description:"No tienes permisos para realizar esta acción o acceder a esta información.",type:"error"};return}const C=await J.json(),Y=F=>F?F.split("T")[0]:"",ye=(C||[]).map(F=>({...F,fecha_inicio:Y(F.fecha_inicio),fecha_fin:Y(F.fecha_fin),contrato:F.contrato?{...F.contrato,fecha_inicio:Y(F.contrato.fecha_inicio),fecha_fin:Y(F.contrato.fecha_fin)}:F.contrato}));B.value=ye,h.value=B.value.length}catch(H){console.error("Error al cargar las ofertas:",H)}finally{P.value=!1}},Z=()=>{M(1,V.value,N.value,u.value,l.value,U.value,"")},ce=p=>{s.value=p,M(p,V.value,N.value,u.value,l.value,U.value,"")},pe=p=>{ae(p,"ver")};ke(()=>{O(),M(1,V.value,"","","","","")});const oe={render(){return q("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-neutral",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[q("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})])}};async function ae(p,d){(!D.value.length||!x.value.length)&&await O(),E.value={...p},I.value=d==="editar",k.value=d==="ver",_.value=!0}const me=[{name:"Editar",icon:{render(){return q("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[q("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})])}},handler:p=>{ae(p,"editar")},buttonClass:"px-3 py-1 bg-accent text-neutral rounded-md hover:bg-accent/90"},{name:"Ver PDF",icon:{render(){return q("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[q("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})])}},handler:p=>{a.value={...p},e.value=!0},buttonClass:"px-3 py-1 bg-primary text-neutral rounded-md hover:bg-primary/90"},{name:"Eliminar",icon:oe,handler:p=>{j.value=p,R.value=!0},buttonClass:"px-3 py-1 bg-danger text-neutral rounded-md hover:bg-danger/90"}];async function fe(){(!D.value.length||!x.value.length)&&(b.value={title:"Obteniendo Datos",description:"Obteniendo datos de usuarios y contratos necesarios para la creación de una nueva oferta.",type:"warning"},await O()),E.value={},I.value=!1,k.value=!1,_.value=!0}function ve(){if(R.value=!1,!!j.value)try{const p=localStorage.getItem("token");fetch(`${$.public.backendHost}/oferta/DeleteOferta/${j.value.id_oferta}`,{method:"DELETE",headers:{Authorization:p,Accept:"application/json"}}).then(async d=>{if(d.status===401){b.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{X("/")},3e3);return}if(d.status===403){b.value={title:"Acceso Denegado",description:"No tienes permisos para realizar esta acción o acceder a esta información.",type:"error"};return}if(!d.ok){const v=await d.json();b.value={title:`Error al eliminar: ${d.status}`,description:v.message||JSON.stringify(v),type:"error"};return}b.value={title:"Oferta eliminada",description:"La oferta fue eliminada correctamente",type:"success"},await M(s.value,V.value,N.value,u.value,l.value,U.value,"")}).catch(d=>{b.value={title:"Error",description:d.message,type:"error"}}).finally(()=>{j.value=null})}catch(p){b.value={title:"Error",description:p.message,type:"error"},j.value=null}}const be=async p=>{try{let d;if(p.estado==="facturada")d="facturada";else{const z=new Date,H=new Date(p.fecha_fin);z>H?d="vencida":d="vigente"}const v={fecha_inicio:p.fecha_inicio,fecha_fin:p.fecha_fin,id_contrato:p.id_contrato,id_usuario:p.id_usuario,estado:d,descripciones:p.descripciones.map(z=>z.descripcion)},K=localStorage.getItem("token"),S=I.value?`${$.public.backendHost}/oferta/UpdateOferta/${E.value.id_oferta}`:`${$.public.backendHost}/oferta/CreateOferta`,L=await fetch(S,{method:I.value?"PUT":"POST",headers:{"Content-Type":"application/json",Authorization:K,Accept:"application/json"},body:JSON.stringify(v)});if(L.status===401){b.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{X("/")},3e3);return}if(L.status===403){b.value={title:"Acceso Denegado",description:"No tienes permisos para realizar esta acción o acceder a esta información.",type:"error"};return}if(L.status===400||L.status===500){const z=await L.json();b.value={title:`Error: ${L.status}`,description:z.message||JSON.stringify(z),type:"error"};return}L.ok?(b.value={title:I.value?"Oferta actualizada":"Oferta creada",description:`La oferta se ${I.value?"actualizó":"creó"} correctamente`,type:"success"},await M(s.value,V.value,N.value,u.value,l.value,U.value,""),_.value=!1):console.error("Error al guardar la oferta")}catch(d){console.error("Error:",d)}};async function ge(){b.value={title:"Consultando datos",description:"Se están consultando los datos, la descarga comenzará en breve.",type:"info"};try{const p=localStorage.getItem("token"),d={descripcion:"",fecha_inicio:N.value,fecha_fin:u.value,id_contrato:l.value,id_usuario:U.value,page:1,limit:1e4},v=await fetch(`${$.public.backendHost}/oferta/filterOfertas`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:p,Accept:"application/json"},body:JSON.stringify(d)});if(v.status===401){b.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{X("/")},3e3);return}if(v.status===403){b.value={title:"Acceso Denegado",description:"No tienes permisos para realizar esta acción o acceder a esta información.",type:"error"};return}if(!v.ok){const C=await v.json();b.value={title:"Error al consultar datos",description:C.error||"Ocurrió un error al consultar los datos.",type:"error"};return}const K=await v.json(),S=C=>C?C.split("T")[0]:"",z=(K||[]).map(C=>({...C,fecha_inicio:S(C.fecha_inicio),fecha_fin:S(C.fecha_fin),contrato:C.contrato?{...C.contrato,fecha_inicio:S(C.contrato.fecha_inicio),fecha_fin:S(C.contrato.fecha_fin)}:C.contrato})).map(C=>({"Fecha Inicio":C.fecha_inicio,"Fecha Fin":C.fecha_fin,Entidad:C.contrato?.entidad?.nombre||"","Num Contrato":C.contrato?.num_consecutivo||"",Usuario:C.usuario?.nombre||"",Estado:C.estado?C.estado.charAt(0).toUpperCase()+C.estado.slice(1):""})),H=ee.json_to_sheet(z),W=ee.book_new();ee.book_append_sheet(W,H,"Ofertas");const J=new Date().toISOString().split("T")[0];$e(W,`ofertas_${J}.xlsx`),b.value=null}catch(p){console.error("Error al exportar a Excel:",p),b.value={title:"Error",description:"Ocurrió un error al exportar los datos.",type:"error"}}}return(p,d)=>(r(),n("div",yo,[T(Pe,{title:"Ofertas - Pactum",description:"Consulta y administra ofertas asociadas a contratos.",canonical:"/ofertas"}),T(Ve),b.value?(r(),n("div",wo,[T(ue,{title:b.value.title,description:b.value.description,type:b.value.type,onClose:d[0]||(d[0]=v=>b.value=null),class:"pointer-events-auto"},null,8,["title","description","type"])])):A("",!0),R.value?(r(),n("div",xo,[T(Ee,{title:"¿Estás seguro que deseas eliminar esta oferta?",description:"Esta acción no se puede deshacer.",icon:oe,type:"warning",onConfirm:ve,onClose:d[1]||(d[1]=v=>R.value=!1)})])):A("",!0),t("div",ho,[t("div",ko,[t("div",Co,[t("button",{onClick:d[2]||(d[2]=v=>o.value=!o.value),class:"flex items-center text-primary hover:brightness-90"},[d[11]||(d[11]=t("span",{class:"mr-2"},"Filtros adicionales",-1)),(r(),n("svg",{xmlns:"http://www.w3.org/2000/svg",class:G(["h-5 w-5 transform transition-transform",{"rotate-180":o.value}]),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[...d[10]||(d[10]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))])]),t("div",{class:G(["grid grid-cols-1 md:grid-cols-4 gap-4 mb-4",{"hidden md:grid":!o.value}])},[t("div",Po,[d[12]||(d[12]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Fecha inicio",-1)),c(t("input",{type:"date","onUpdate:modelValue":d[3]||(d[3]=v=>N.value=v),class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary",onKeyup:ie(Z,["enter"])},null,544),[[f,N.value]])]),t("div",Vo,[d[13]||(d[13]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Fecha fin",-1)),c(t("input",{type:"date","onUpdate:modelValue":d[4]||(d[4]=v=>u.value=v),class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary",onKeyup:ie(Z,["enter"])},null,544),[[f,u.value]])]),t("div",_o,[d[14]||(d[14]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Nombre de usuario",-1)),T(Q,{modelValue:U.value,"onUpdate:modelValue":d[5]||(d[5]=v=>U.value=v),options:D.value,labelKey:"nombre",valueKey:"id_usuario",placeholder:"Buscar usuario..."},null,8,["modelValue","options"])]),t("div",Eo,[d[15]||(d[15]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Contrato",-1)),T(Q,{modelValue:l.value,"onUpdate:modelValue":d[6]||(d[6]=v=>l.value=v),options:x.value,labelKey:v=>`${v.entidad?.nombre}: ${v?.num_consecutivo} - ${v.tipoContrato?.nombre} - (${v.fecha_inicio?.substring(0,4)})`,valueKey:"id_contrato",placeholder:"Buscar contrato..."},null,8,["modelValue","options","labelKey"])])],2),t("div",{class:"flex justify-end mt-4 gap-2"},[t("button",{onClick:Z,class:"px-6 py-2 bg-primary text-neutral rounded-lg hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition-colors"}," Buscar "),t("button",{onClick:ge,class:"px-6 py-2 bg-success text-neutral rounded-lg hover:bg-success/90 focus:outline-none focus:ring-2 focus:ring-success focus:ring-offset-2 transition-colors"}," Exportar a Excel ")])])]),t("div",$o,[t("div",{class:"flex justify-between items-center mb-4"},[d[17]||(d[17]=t("h2",{class:"text-2xl font-bold"},"Ofertas",-1)),t("button",{onClick:fe,class:"px-4 py-2 bg-primary text-neutral rounded-lg hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-primary flex items-center"},[...d[16]||(d[16]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),w(" Nueva Oferta ",-1)])])]),T(_e,{columns:i,items:B.value,actions:me,"total-items":h.value,"items-per-page":V.value,"current-page":s.value,"is-loading":P.value,onPageChange:ce,onRowClick:pe},null,8,["items","total-items","items-per-page","current-page","is-loading"])]),T(et,{modelValue:_.value,"onUpdate:modelValue":d[7]||(d[7]=v=>_.value=v),oferta:E.value,"is-editing":I.value,"is-viewing":k.value,usuarios:D.value,contratos:x.value,id_usuario:E.value.id_usuario??E.value.usuario?.id_usuario??null,id_contrato:E.value.id_contrato??E.value.contrato?.id_contrato??null,onSubmit:be},null,8,["modelValue","oferta","is-editing","is-viewing","usuarios","contratos","id_usuario","id_contrato"]),T(go,{show:e.value,"onUpdate:show":d[8]||(d[8]=v=>e.value=v),"oferta-data":a.value,onClose:d[9]||(d[9]=v=>e.value=!1)},null,8,["show","oferta-data"])]))}};export{jo as default};
