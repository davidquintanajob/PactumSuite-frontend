import{u as D,r as c,k as E,o as I,y as m,C as u,F as x,A as o,K as j,L as A,R as M,n as h,z as f}from"#entry";import{S as O}from"./CC2Sf2Ne.js";import{N as z}from"./DTHag2Fn.js";import{D as B}from"./DIpJa8iN.js";import{_ as F}from"./CP6NTKUH.js";import{u as v,w as $}from"./3SA47z_C.js";import"./BzLCLO6P.js";const L={class:"min-h-screen bg-gradient-to-br via-secondary/40 from-accent/30 to-neutral"},P={key:0,class:"fixed top-6 left-1/2 transform -translate-x-1/2 z-[9999] w-full max-w-md px-4 pointer-events-none"},R={class:"w-[95%] mx-auto px-4 py-4 md:py-4 mt-20 md:mt-0"},V={class:"bg-white rounded-lg shadow-md p-4"},J={class:"grid grid-cols-1 md:grid-cols-3 gap-4 items-end mb-4 md:mb-2"},K={class:"relative"},U={class:"flex justify-end mt-4 gap-2"},H={class:"w-[95%] mx-auto px-4 py-4"},oe={__name:"servicios",setup(q){const{navigateTo:w}=D(),n=c(""),l=c([]),d=c(!1),r=c(null),k=E(()=>{try{const t=localStorage.getItem("usuario");if(!t)return!1;const e=JSON.parse(t),s=e&&(e.rol||e.role||e.perfil&&e.perfil.rol||e.profile&&e.profile.role)?e.rol||e.role||e.perfil&&e.perfil.rol||e.profile&&e.profile.role:null;return s?String(s).trim().toLowerCase()==="invitado":!1}catch{return!1}}),_=[{key:"descripcion",label:"Descripción"},{key:"importe",label:"Importe"},{key:"cantidad",label:"Cantidad"},{key:"importe_total",label:"Importe Total"},{key:"unidadMedida",label:"Unidad de Medida"},{key:"factura.num_consecutivo",label:"Número Consecutivo Factura"}],g=async()=>{d.value=!0;try{const t=localStorage.getItem("token"),e=h(),s={descripcion:n.value},p=await(await fetch(`${e.public.backendHost}/Servicio/filter`,{method:"POST",headers:{Authorization:t,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(s)})).json();l.value=Array.isArray(p)?p:[]}catch{l.value=[],r.value={title:"Error",description:"Error al cargar los servicios.",type:"error"}}finally{d.value=!1}};I(()=>{g()});const y=async()=>{try{await g()}catch(t){console.error("Error al buscar servicios:",t)}};async function S(){r.value={title:"Consultando datos",description:"Se están consultando los datos, la descarga comenzará en breve.",type:"info"};try{const t=localStorage.getItem("token"),e=h(),s={descripcion:n.value},i=await fetch(`${e.public.backendHost}/Servicio/filter`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:t,Accept:"application/json"},body:JSON.stringify(s)});if(i.status===401){r.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{w("/")},3e3);return}if(i.status===403){r.value={title:"Acceso Denegado",description:"No tienes permisos para realizar esta acción o acceder a esta información.",type:"error"};return}if(!i.ok){const a=await i.json();r.value={title:"Error al consultar datos",description:a.error||"Ocurrió un error al consultar los datos.",type:"error"};return}const C=(await i.json()).map(a=>({Descripción:a.descripcion,Importe:Number(a.importe).toFixed(2),Cantidad:a.cantidad,"Importe Total":Number(a.importe_total).toFixed(2),"Unidad de Medida":a.unidadMedida,"Número Consecutivo Factura":a.factura?.num_consecutivo||""})),N=v.json_to_sheet(C),b=v.book_new();v.book_append_sheet(b,N,"Servicios");const T=new Date().toISOString().split("T")[0];$(b,`servicios_${T}.xlsx`),r.value=null}catch(t){console.error("Error al exportar a Excel:",t),r.value={title:"Error",description:"Ocurrió un error al exportar los datos.",type:"error"}}}return(t,e)=>(f(),m("div",L,[u(O,{title:"Servicios - Pactum",description:"Lista de servicios.",canonical:"/servicios"}),u(z),r.value?(f(),m("div",P,[u(F,{title:r.value.title,description:r.value.description,type:r.value.type,onClose:e[0]||(e[0]=s=>r.value=null),class:"pointer-events-auto"},null,8,["title","description","type"])])):x("",!0),o("div",R,[o("div",V,[o("div",J,[o("div",null,[e[3]||(e[3]=o("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Buscar por descripción",-1)),o("div",K,[j(o("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=s=>n.value=s),placeholder:"Ingrese la descripción...",class:"w-full pl-10 pr-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary",onKeyup:M(y,["enter"])},null,544),[[A,n.value]]),e[2]||(e[2]=o("div",{class:"absolute left-3 top-2.5"},[o("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))])])]),o("div",U,[o("button",{onClick:y,class:"px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors"}," Buscar "),k.value?x("",!0):(f(),m("button",{key:0,onClick:S,class:"px-6 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition-colors"}," Exportar a Excel "))])])]),o("div",H,[e[4]||(e[4]=o("div",{class:"flex justify-between items-center mb-4"},[o("h2",{class:"text-2xl font-bold"},"Servicios")],-1)),u(B,{columns:_,items:l.value,"total-items":l.value.length,"items-per-page":1e3,"current-page":1,"is-loading":d.value},null,8,["items","total-items","is-loading"])])]))}};export{oe as default};
