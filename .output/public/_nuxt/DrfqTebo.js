import{r as c,o as g,n as x,k as v,y as o,C as y,A as t,K as _,B as u,L as h,F as k,E as w,H as N,z as n}from"#entry";import{N as C}from"./DTHag2Fn.js";import"./BzLCLO6P.js";const S={class:"p-4 max-w-md mx-auto"},E={class:"mb-6 p-4 bg-gray-50 rounded-lg border"},U={class:"flex items-center mb-2"},j={class:"flex-1"},z={class:"flex justify-between items-center"},D={class:"font-semibold"},H={key:0},R={key:1,class:"text-gray-400"},V={class:"flex items-center mt-3 pt-3 border-t"},F={class:"flex-1"},P={class:"flex justify-between items-center"},T={class:"font-semibold"},$={key:0},A={key:1,class:"text-gray-400"},B={class:"text-xs text-gray-500 mt-1"},M={key:0,class:"text-blue-500"},O={key:1},J={key:2,class:"text-amber-600"},G=["disabled"],I={class:"flex items-center justify-between"},K={class:"text-sm text-gray-500"},L={key:0},q=["disabled"],Z={__name:"config",setup(Q){const r=x(),l=c(""),m=c(!1),a=c(null),b=c(null),i=c(!1);g(async()=>{f();try{const s=await fetch(`${r.public.backendHost}/config`);if(!s.ok){console.warn(`No se pudo obtener la configuración desde ${r.public.backendHost}/config`);return}const e=await s.json();e.cambio_moneda!=null&&(l.value=String(e.cambio_moneda))}catch(s){console.error("Error al obtener configuración:",s)}});const f=async()=>{i.value=!0;try{const s=await fetch(`${r.public.backendHost}/exchange-rate`);if(!s.ok){console.warn(`No se pudo obtener la tasa desde ${r.public.backendHost}/exchange-rate`);return}const e=await s.json();e.rate!=null&&(a.value=Number(e.rate)),e.eur!=null&&(b.value=Number(e.eur))}catch(s){console.error("Error al obtener tasa:",s)}finally{i.value=!1}};v(()=>a.value?(1/a.value).toFixed(6):null);const p=async()=>{m.value=!0;try{const s={cambio_moneda:Number(l.value)};await fetch(`${r.public.backendHost}/config`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});try{const e=localStorage.getItem("config"),d=e?JSON.parse(e):{};d.cambio_moneda=s.cambio_moneda,console.log(d),localStorage.setItem("config",JSON.stringify(d))}catch(e){console.warn("No se pudo actualizar localStorage",e)}alert("Cambios guardados")}catch(s){console.error(s),alert("Error al guardar cambios")}finally{m.value=!1}};return(s,e)=>(n(),o("div",S,[y(C),e[9]||(e[9]=t("h1",{class:"text-xl font-semibold mb-4"},"Configuración",-1)),t("div",E,[e[7]||(e[7]=t("h2",{class:"font-medium mb-3 text-gray-700"},"Tasa actual del mercado",-1)),t("div",U,[e[3]||(e[3]=t("div",{class:"w-8 h-6 bg-gray-200 rounded flex items-center justify-center mr-3"},[t("span",{class:"text-sm"},"EU")],-1)),t("div",j,[t("div",z,[e[2]||(e[2]=t("span",{class:"text-gray-600"},"1 Euro (EUR)",-1)),t("span",D,[b.value?(n(),o("span",H,u(b.value.toFixed(2)),1)):(n(),o("span",R,"--.--")),e[1]||(e[1]=t("span",{class:"text-gray-500 text-sm ml-1"},"CUP",-1))])])])]),t("div",V,[e[6]||(e[6]=t("div",{class:"w-8 h-6 bg-gray-200 rounded flex items-center justify-center mr-3"},[t("span",{class:"text-sm"},"US")],-1)),t("div",F,[t("div",P,[e[5]||(e[5]=t("span",{class:"text-gray-600"},"1 Dólar estadounidense (USD)",-1)),t("span",T,[a.value?(n(),o("span",$,u(a.value.toFixed(2)),1)):(n(),o("span",A,"--.--")),e[4]||(e[4]=t("span",{class:"text-gray-500 text-sm ml-1"},"CUP",-1))])]),t("div",B,[i.value?(n(),o("span",M,"Actualizando...")):a.value?(n(),o("span",O,"Valor obtenido del mercado informal")):(n(),o("span",J,"No disponible"))])])]),t("button",{onClick:f,disabled:i.value,class:"mt-4 text-sm text-blue-600 hover:text-blue-800 disabled:text-gray-400"},u(i.value?"Actualizando...":"Actualizar tasa"),9,G)]),e[10]||(e[10]=t("label",{class:"block mb-2 font-medium"},"Cambio Moneda del Software (USD ↔ CUP)",-1)),e[11]||(e[11]=t("p",{class:"text-sm text-gray-500 mb-3"}," Este valor se usará en la aplicación para calcular automaticamente precios y costos por todos los usuarios del sistema. ",-1)),_(t("input",{type:"number","onUpdate:modelValue":e[0]||(e[0]=d=>l.value=d),placeholder:"Ej: 485.00",step:"0.01",min:"0",class:"border border-gray-300 p-3 w-full mb-4 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[h,l.value]]),t("div",I,[t("div",K,[a.value&&l.value?(n(),o("span",L,[e[8]||(e[8]=w(" Diferencia: ",-1)),t("span",{class:N(Math.abs(Number(l.value)-a.value)>5?"text-amber-600":"text-green-600")},u((Number(l.value)-a.value).toFixed(2))+" CUP ",3)])):k("",!0)]),t("button",{onClick:p,disabled:m.value||!l.value,class:"bg-blue-600 hover:bg-blue-700 text-white py-2 px-6 rounded font-medium disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors"},u(m.value?"Guardando...":"Guardar cambios"),9,q)])]))}};export{Z as default};
