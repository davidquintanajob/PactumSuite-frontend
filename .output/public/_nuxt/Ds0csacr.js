import{r as u,y as p,C as x,F as g,I as h,A as t,J as k,K as b,L as v,z as m,n as _,q as S}from"#entry";import{_ as j}from"./BM2ibBGv.js";import{S as N}from"./CC2Sf2Ne.js";import{_ as I}from"./CP6NTKUH.js";import"./BzLCLO6P.js";const E={class:"flex min-h-screen flex-1 flex-col justify-center px-6 py-12 bg-gradient-to-br via-secondary/40 from-accent/30 to-neutral"},A={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/50"},C={class:"mt-10 sm:mx-auto sm:w-full sm:max-w-sm"},O={class:"mt-2"},J=["disabled"],T={class:"mt-2"},$=["disabled"],M=["disabled"],L={__name:"login",setup(R){const d=u(""),f=u(""),l=u(""),i=u(!1),n=u(!1),r=_(),y=async()=>{if(l.value="",i.value=!1,!d.value||!f.value){l.value="Por favor, completa todos los campos.",i.value=!0;return}n.value=!0;try{const c=await fetch(`${r.public.backendHost}/usuario/login`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({nombre_usuario:d.value,contrasenna:f.value})});if(!c.ok){const s=await c.json();l.value="Usuario o contraseña incorrectos.",i.value=!0,n.value=!1;return}const e=await c.json();if(e.token&&e.usuario){localStorage.setItem("token",e.token),localStorage.setItem("usuario",JSON.stringify(e.usuario));try{const s=await fetch(`${r.public.backendHost}/config`);if(s.ok){const o=await s.json().catch(()=>null);if(o&&o.cambio_moneda!=null){const a={cambio_moneda:Number(o.cambio_moneda)};localStorage.setItem("config",JSON.stringify(a))}else try{const a=await fetch(`${r.public.backendHost}/config`,{method:"GET",headers:{Accept:"application/json",Authorization:e.token||""}});if(a.ok){const w=await a.json();localStorage.setItem("config",JSON.stringify(w))}else console.warn("No se pudo obtener /config:",a.status)}catch(a){console.warn("Error al obtener /config:",a)}}else try{const o=await fetch(`${r.public.backendHost}/config`,{method:"GET",headers:{Accept:"application/json",Authorization:e.token||""}});if(o.ok){const a=await o.json();localStorage.setItem("config",JSON.stringify(a))}else console.warn("No se pudo obtener /config:",o.status)}catch(o){console.warn("Error al obtener /config:",o)}}catch{try{const o=await fetch(`${r.public.backendHost}/config`,{method:"GET",headers:{Accept:"application/json",Authorization:e.token||""}});if(o.ok){const a=await o.json();localStorage.setItem("config",JSON.stringify(a))}else console.warn("No se pudo obtener /config:",o.status)}catch(o){console.warn("Error al obtener /config:",o)}}S("/")}else l.value="Respuesta inesperada del servidor.",i.value=!0,n.value=!1}catch{l.value="Error de conexión con el servidor.",i.value=!0,n.value=!1}};return(c,e)=>(m(),p("div",E,[x(N,{title:"Iniciar Sesión - Contract Manager",description:"Accede a Contract Manager para gestionar contratos y entidades.",canonical:"/login"}),n.value?(m(),p("div",A,[...e[3]||(e[3]=[t("div",{class:"bg-white rounded-lg p-8 shadow-xl flex flex-col items-center gap-4"},[t("div",{class:"w-12 h-12 border-4 border-gray-200 border-t-primary rounded-full animate-spin"}),t("p",{class:"text-gray-700 font-medium"},"Iniciando sesión...")],-1)])])):g("",!0),i.value?(m(),h(I,{key:1,title:"Error al iniciar sesión",description:l.value,type:"error",onClose:e[0]||(e[0]=s=>i.value=!1)},null,8,["description"])):g("",!0),e[6]||(e[6]=t("div",{class:"sm:mx-auto sm:w-full sm:max-w-sm"},[t("img",{class:"mx-auto h-24 w-24 rounded-full shadow mt-8",src:j,alt:"Logo"}),t("h2",{class:"mt-8 text-center text-2xl font-bold tracking-tight text-gray-900"},"Inicia sesión en tu cuenta")],-1)),t("div",C,[t("form",{class:"space-y-6",onSubmit:k(y,["prevent"])},[t("div",null,[e[4]||(e[4]=t("label",{for:"username",class:"block text-sm font-medium text-gray-900"},"Nombre de usuario",-1)),t("div",O,[b(t("input",{id:"username",name:"username",type:"text",autocomplete:"username",required:"","onUpdate:modelValue":e[1]||(e[1]=s=>d.value=s),disabled:n.value,class:"block w-full rounded-md bg-white px-3 py-2 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-blue-600 sm:text-sm disabled:opacity-50 disabled:cursor-not-allowed",placeholder:"Usuario"},null,8,J),[[v,d.value]])])]),t("div",null,[e[5]||(e[5]=t("div",{class:"flex items-center justify-between"},[t("label",{for:"password",class:"block text-sm font-medium text-gray-900"},"Contraseña")],-1)),t("div",T,[b(t("input",{id:"password",name:"password",type:"password",autocomplete:"current-password",required:"","onUpdate:modelValue":e[2]||(e[2]=s=>f.value=s),disabled:n.value,class:"block w-full rounded-md bg-white px-3 py-2 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-blue-600 sm:text-sm disabled:opacity-50 disabled:cursor-not-allowed",placeholder:"Contraseña"},null,8,$),[[v,f.value]])])]),t("div",null,[t("button",{type:"submit",disabled:n.value,class:"flex w-full justify-center rounded-md bg-primary px-3 py-2 text-sm font-semibold text-neutral shadow hover:bg-primary/90 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary disabled:opacity-50 disabled:cursor-not-allowed"}," Ingresar ",8,M)])],32)])]))}};export{L as default};
