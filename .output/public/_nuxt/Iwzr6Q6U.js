import{r as l,M as de,k as ne,y as f,F as V,z as g,A as e,C as S,B as k,J as xe,K as q,L as R,E as G,o as ge,V as he,N as we,n as K,O as ve,P as pe,q as me,u as ke,R as le,h as oe}from"#entry";import{S as Ce}from"./CC2Sf2Ne.js";import{N as je}from"./DTHag2Fn.js";import{D as be}from"./DIpJa8iN.js";import{_ as ue}from"./CP6NTKUH.js";import{_ as re}from"./baAHEXJQ.js";import{_ as _e}from"./DWLPyndB.js";import{u as ae,w as fe}from"./3SA47z_C.js";import"./BzLCLO6P.js";const Te={key:0,class:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center"},Se={key:0,class:"fixed top-6 left-1/2 transform -translate-x-1/2 z-[9999] w-full max-w-md px-4 pointer-events-none"},Ee={class:"bg-white rounded-lg p-6 w-full max-w-4xl max-h-[80vh] overflow-y-auto"},$e={class:"flex justify-between items-center mb-6"},Ae={class:"text-2xl font-bold text-gray-800"},Ve={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ze=["readonly","disabled"],Ie=["readonly","disabled"],De=["readonly","disabled"],Me=["readonly","disabled"],Ne={class:"mt-4"},Oe={key:0,class:"flex justify-end space-x-4 mt-6"},Pe=["disabled"],Be=["disabled"],Fe={key:0,class:"flex items-center"},He={key:1},Le={key:0,class:"mt-8"},Ue={key:1,class:"text-red-600 text-sm mt-2"},Ke=5,Je={__name:"TrabajadorModal",props:{modelValue:{type:Boolean,required:!0},trabajador:{type:Object,default:()=>({})},isEditing:{type:Boolean,default:!1},isViewing:{type:Boolean,default:!1}},emits:["update:modelValue","submit"],setup(m,{emit:J}){const j=m,P=J,d=l({nombre:"",cargo:"",carnet_identidad:"",num_telefono:"",firma:""}),D=l([{label:"Concidia",value:"Concidia"},{label:"Firma",value:"Firma"},{label:"Concidia y Firma",value:"Concidia y Firma"}]),_=l(""),y=l(!1),w=l(null);de(()=>j.trabajador,s=>{s&&Object.keys(s).length>0?d.value={nombre:s.nombre||"",cargo:s.cargo||"",carnet_identidad:s.carnet_identidad||"",num_telefono:s.num_telefono||"",firma:s.funcion||""}:d.value={nombre:"",cargo:"",carnet_identidad:"",num_telefono:"",firma:""}},{immediate:!0});const M=async()=>{if(_.value="",!d.value.nombre||!d.value.carnet_identidad||!d.value.firma){_.value="Todos los campos son obligatorios.";return}y.value=!0,w.value={title:j.isEditing?"Guardando Trabajador":"Creando Trabajador",description:"Comunicando con el servidor, espere por favor...",type:"warning"};try{await new Promise((s,n)=>{P("submit",{nombre:d.value.nombre,cargo:d.value.cargo,carnet_identidad:d.value.carnet_identidad,num_telefono:d.value.num_telefono,funcion:d.value.firma}),setTimeout(s,100)})}catch(s){console.error("Error en handleSubmit:",s)}finally{setTimeout(()=>{y.value=!1,w.value=null},500)}},N=s=>{let n=s.target.value.replace(/\D/g,"");n.length>11&&(n=n.slice(0,11)),d.value.carnet_identidad=n},z=s=>{let n=s.target.value;n=n.replace(/[^0-9+\-]/g,""),d.value.num_telefono=n},p=[{key:"id_contrato",label:"ID Contrato"},{key:"fecha_inicio",label:"Fecha de Inicio"},{key:"fecha_fin",label:"Fecha de Fin"},{key:"entidad_nombre",label:"Entidad"},{key:"tipo_contrato_nombre",label:"Tipo de Contrato"}],O=ne(()=>!j.trabajador||!Array.isArray(j.trabajador.contratos)?[]:j.trabajador.contratos.map(s=>({id_contrato:s.id_contrato,fecha_inicio:s.fecha_inicio?s.fecha_inicio.split("T")[0]:"",fecha_fin:s.fecha_fin?s.fecha_fin.split("T")[0]:"",entidad_nombre:s.entidad?.nombre||"",tipo_contrato_nombre:s.tipoContrato?.nombre||""}))),B=ne(()=>O.value.length),x=l(1),C=s=>{x.value=s};return(s,n)=>m.modelValue?(g(),f("div",Te,[w.value?(g(),f("div",Se,[S(ue,{title:w.value.title,description:w.value.description,type:w.value.type,onClose:n[0]||(n[0]=i=>w.value=null),class:"pointer-events-auto"},null,8,["title","description","type"])])):V("",!0),e("div",Ee,[e("div",$e,[e("h2",Ae,k(m.isViewing?"Detalles de Trabajador":m.isEditing?"Editar Trabajador":"Nuevo Trabajador"),1),e("button",{onClick:n[1]||(n[1]=i=>s.$emit("update:modelValue",!1)),class:"text-gray-500 hover:text-gray-700"},[...n[8]||(n[8]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("form",{onSubmit:xe(M,["prevent"]),class:"space-y-4"},[e("div",Ve,[e("div",null,[n[9]||(n[9]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Nombre",-1)),q(e("input",{"onUpdate:modelValue":n[2]||(n[2]=i=>d.value.nombre=i),type:"text",required:"",readonly:m.isViewing,disabled:m.isViewing||y.value,class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ingrese el nombre del trabajador"},null,8,ze),[[R,d.value.nombre]])]),e("div",null,[n[10]||(n[10]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Cargo",-1)),q(e("input",{"onUpdate:modelValue":n[3]||(n[3]=i=>d.value.cargo=i),type:"text",readonly:m.isViewing,disabled:m.isViewing||y.value,class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ingrese el cargo"},null,8,Ie),[[R,d.value.cargo]])]),e("div",null,[n[11]||(n[11]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Carnet de Identidad",-1)),q(e("input",{"onUpdate:modelValue":n[4]||(n[4]=i=>d.value.carnet_identidad=i),type:"text",required:"",readonly:m.isViewing,disabled:m.isViewing||y.value,class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ingrese el carnet de identidad",maxlength:"11",onInput:N},null,40,De),[[R,d.value.carnet_identidad]])]),e("div",null,[n[12]||(n[12]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Teléfono",-1)),q(e("input",{"onUpdate:modelValue":n[5]||(n[5]=i=>d.value.num_telefono=i),type:"text",readonly:m.isViewing,disabled:m.isViewing||y.value,class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ingrese el número de teléfono",onInput:z},null,40,Me),[[R,d.value.num_telefono]])])]),e("div",Ne,[n[13]||(n[13]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Función",-1)),S(re,{modelValue:d.value.firma,"onUpdate:modelValue":n[6]||(n[6]=i=>d.value.firma=i),options:D.value,labelKey:"label",valueKey:"value",placeholder:"Seleccionar función...",readonly:m.isViewing,disabled:m.isViewing||y.value,required:""},null,8,["modelValue","options","readonly","disabled"])]),m.isViewing?V("",!0):(g(),f("div",Oe,[e("button",{type:"button",onClick:n[7]||(n[7]=i=>s.$emit("update:modelValue",!1)),class:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-500",disabled:y.value}," Cancelar ",8,Pe),e("button",{type:"submit",class:"px-4 py-2 text-neutral bg-primary rounded-lg hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-primary disabled:opacity-50 disabled:cursor-not-allowed",disabled:y.value},[y.value?(g(),f("span",Fe,[n[14]||(n[14]=e("svg",{class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)),G(" "+k(m.isEditing?"Guardando...":"Creando..."),1)])):(g(),f("span",He,k(m.isEditing?"Guardar Cambios":"Crear Trabajador"),1))],8,Be)]))],32),m.isViewing||m.isEditing?(g(),f("div",Le,[n[15]||(n[15]=e("h3",{class:"text-lg font-semibold mb-2"},"Contratos Asociados",-1)),S(be,{columns:p,items:O.value,"total-items":B.value,"items-per-page":Ke,"current-page":x.value,"is-loading":!1,"show-actions":!1,onPageChange:C},null,8,["items","total-items","current-page"])])):V("",!0),_.value?(g(),f("div",Ue,k(_.value),1)):V("",!0)])])):V("",!0)}},qe={key:0,class:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4"},Re={class:"bg-white rounded-lg w-full max-w-7xl max-h-[90vh] overflow-hidden flex flex-col"},Ge={key:0,class:"fixed top-6 left-1/2 transform -translate-x-1/2 z-[9999] w-full max-w-md px-4 pointer-events-none"},We={class:"p-6 border-b border-gray-200"},Ye={class:"flex justify-between items-center mb-4"},Qe={key:0,class:"text-sm text-gray-600 mt-1"},Xe={class:"font-medium"},Ze={class:"font-medium"},et={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},tt={class:"flex-1 flex overflow-hidden"},ot={key:0,class:"flex justify-center items-center py-8"},at={key:1,class:"space-y-2"},nt=["onClick"],rt={class:"flex items-center justify-between"},st={class:"flex-1"},it={class:"font-bold text-gray-900"},lt={class:"text-sm text-gray-600"},dt={class:"text-sm text-gray-600"},ut={class:"text-xs text-gray-500"},ct={key:0,class:"flex justify-center items-center py-4"},vt={class:"w-1/2 p-4 overflow-y-auto"},pt={class:"space-y-2"},mt=["onClick"],ft={class:"flex items-center justify-between"},gt={class:"flex-1"},bt={class:"font-bold text-gray-900"},yt={class:"text-sm text-gray-600"},xt={class:"text-sm text-gray-600"},ht={class:"text-xs text-gray-500"},wt={class:"p-4 border-t border-gray-200 bg-gray-50"},kt={class:"flex justify-between items-center"},Ct={class:"text-sm text-gray-600"},jt={class:"font-medium"},_t={class:"font-medium"},Tt={class:"flex space-x-3"},St={__name:"TrabajadorAsociacionModal",props:{modelValue:{type:Boolean,required:!0},trabajador:{type:Object,default:()=>({})},entidades:{type:Array,default:()=>[]}},emits:["update:modelValue","save-associations"],setup(m,{emit:J}){const j=m,P=J,d=ne(()=>j.trabajador),D=l(!1),_=l(!1),y=l([]),w=l([]),M=l(1),N=l(!0),z=l(null),p=l({numConsecutivo:"",entidad:null,tipoContrato:null}),O=ne(()=>j.entidades.map(u=>({value:u.id_entidad,label:u.nombre}))),B=l([]),x=l([]),C=l([]),s=l([]),n=u=>u?new Date(u).toLocaleDateString("es-ES"):"Sin fecha",i=async(u=1,t=!1)=>{u===1?D.value=!0:_.value=!0;try{const a=localStorage.getItem("token"),I=K(),$={},Q=await fetch(`${I.public.backendHost}/contrato/filter/${u}/700`,{method:"POST",headers:{Authorization:a,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify($)});if(Q.status===401||Q.status===403){E.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{me("/")},3e3);return}const F=await Q.json();if(F.data&&Array.isArray(F.data)){if(t){const A=[...x.value,...F.data];x.value=A}else x.value=F.data;if(!t)d.value&&d.value.contratos?C.value=d.value.contratos.map(A=>A.id_contrato):C.value=[],s.value=x.value.map(A=>A.id_contrato).filter(A=>!C.value.includes(A));else{const A=F.data.map(X=>X.id_contrato).filter(X=>!C.value.includes(X));s.value.push(...A.filter(X=>!s.value.includes(X)))}te(),F.pagination&&(N.value=F.pagination.hasNextPage,M.value=F.pagination.currentPage)}else t||(y.value=[],w.value=[])}catch(a){console.error("Error al cargar contratos:",a),t||(y.value=[],w.value=[])}finally{D.value=!1,_.value=!1}},ee=async()=>{N.value&&!_.value&&await i(M.value+1,!0)},W=async u=>{const{scrollTop:t,scrollHeight:a,clientHeight:I}=u.target;a-t-I<100&&await ee()},Y=(u,t)=>{if(t==="izquierda"){const a=s.value.indexOf(u.id_contrato);a!==-1&&(s.value.splice(a,1),C.value.push(u.id_contrato),te())}else{const a=C.value.indexOf(u.id_contrato);a!==-1&&(C.value.splice(a,1),s.value.push(u.id_contrato),te())}},E=l(null),ce=async()=>{const u=localStorage.getItem("token"),t=K(),a=d.value?.id_trabajador_autorizado,I=C.value;if(!a){E.value={title:"Error",description:"No se encontró el ID del trabajador.",type:"error"};return}if(!u){window.location.href="/";return}try{const $=await fetch(`${t.public.backendHost}/contratoTrabajador/syncTrabajadorContratos`,{method:"POST",headers:{Authorization:u,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({id_trabajador_autorizado:a,ids_contratos:I})});if($.status===401||$.status===403){E.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{me("/")},3e3);return}if($.ok)E.value={title:"¡Asociaciones guardadas correctamente!",description:"Las asociaciones del trabajador fueron actualizadas.",type:"success"},setTimeout(()=>{P("update:modelValue",!1),P("save-associations",{id_trabajador_autorizado:a,ids_contratos:I}),E.value=null},1200);else{const Q=await $.json();E.value={title:"Error al guardar asociaciones",description:Q.message||$.status,type:"error"}}}catch($){E.value={title:"Error de red al guardar asociaciones",description:$.message,type:"error"}}};function te(){let u=x.value.filter(a=>s.value.includes(a.id_contrato)),t=x.value.filter(a=>C.value.includes(a.id_contrato));p.value.numConsecutivo&&(u=u.filter(a=>String(a.num_consecutivo).includes(String(p.value.numConsecutivo))),t=t.filter(a=>String(a.num_consecutivo).includes(String(p.value.numConsecutivo)))),p.value.entidad&&(u=u.filter(a=>String(a.entidad?.id_entidad)===String(p.value.entidad)),t=t.filter(a=>String(a.entidad?.id_entidad)===String(p.value.entidad))),p.value.tipoContrato&&(u=u.filter(a=>String(a.tipoContrato?.id_tipo_contrato)===String(p.value.tipoContrato)),t=t.filter(a=>String(a.tipoContrato?.id_tipo_contrato)===String(p.value.tipoContrato))),y.value=u,w.value=t}de(p,u=>{te()},{deep:!0}),de(()=>j.modelValue,async u=>{u&&(await se(),H())}),ge(async()=>{j.modelValue&&H(),await he(),z.value&&z.value.addEventListener("scroll",W)}),we(()=>{z.value&&z.value.removeEventListener("scroll",W)});const se=async()=>{try{const u=localStorage.getItem("token"),t=K(),I=await(await fetch(`${t.public.backendHost}/tipoContrato`,{method:"GET",headers:{Authorization:u,Accept:"application/json"}})).json();B.value=Array.isArray(I.data)?I.data.map($=>({value:$.id_tipo_contrato,label:$.nombre})):[]}catch{B.value=[]}},H=()=>{M.value=1,N.value=!0,y.value=[],w.value=[],x.value=[],s.value=[],C.value=[],i(1,!1)};return(u,t)=>m.modelValue?(g(),f("div",qe,[e("div",Re,[E.value?(g(),f("div",Ge,[S(ue,{title:E.value.title,description:E.value.description,type:E.value.type,onClose:t[0]||(t[0]=a=>E.value=null),class:"pointer-events-auto"},null,8,["title","description","type"])])):V("",!0),e("div",We,[e("div",Ye,[e("div",null,[t[8]||(t[8]=e("h2",{class:"text-2xl font-bold text-gray-800"},"Asociar Trabajador a Contratos",-1)),d.value?(g(),f("p",Qe,[t[6]||(t[6]=G(" Trabajador: ",-1)),e("span",Xe,k(d.value.nombre),1),t[7]||(t[7]=G(" - ",-1)),e("span",Ze,k(d.value.cargo),1)])):V("",!0)]),e("button",{onClick:t[1]||(t[1]=a=>u.$emit("update:modelValue",!1)),class:"text-gray-500 hover:text-gray-700"},[...t[9]||(t[9]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",et,[e("div",null,[t[10]||(t[10]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Número consecutivo",-1)),q(e("input",{"onUpdate:modelValue":t[2]||(t[2]=a=>p.value.numConsecutivo=a),type:"number",min:"0",class:"w-full px-3 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Buscar por número..."},null,512),[[R,p.value.numConsecutivo]])]),e("div",null,[t[11]||(t[11]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Entidad",-1)),S(re,{modelValue:p.value.entidad,"onUpdate:modelValue":t[3]||(t[3]=a=>p.value.entidad=a),options:O.value,labelKey:"label",valueKey:"value",placeholder:"Seleccionar entidad...",class:"w-full"},null,8,["modelValue","options"])]),e("div",null,[t[12]||(t[12]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Tipo de Contrato",-1)),S(re,{modelValue:p.value.tipoContrato,"onUpdate:modelValue":t[4]||(t[4]=a=>p.value.tipoContrato=a),options:B.value,labelKey:"label",valueKey:"value",placeholder:"Seleccionar tipo...",class:"w-full"},null,8,["modelValue","options"])])])]),e("div",tt,[e("div",{class:"w-1/2 border-r border-gray-200 p-4 overflow-y-auto",ref_key:"scrollContainer",ref:z},[t[16]||(t[16]=e("h3",{class:"text-lg font-semibold mb-4 text-primary"},"Contratos Existentes",-1)),D.value&&y.value.length===0?(g(),f("div",ot,[...t[13]||(t[13]=[e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"},null,-1)])])):(g(),f("div",at,[(g(!0),f(ve,null,pe(y.value,a=>(g(),f("div",{key:a.id_contrato,onClick:I=>Y(a,"izquierda"),class:"p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-accent/10 hover:border-accent/40 transition-colors"},[e("div",rt,[e("div",st,[e("h4",it,k(a.entidad?.nombre||"Sin entidad"),1),e("p",lt,"N° "+k(a.num_consecutivo),1),e("p",dt,k(a.tipoContrato?.nombre||"Sin tipo"),1),e("p",ut,k(n(a.fecha_inicio))+" - "+k(n(a.fecha_fin)),1)]),t[14]||(t[14]=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1))])],8,nt))),128)),_.value?(g(),f("div",ct,[...t[15]||(t[15]=[e("div",{class:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-500"},null,-1)])])):V("",!0)]))],512),e("div",vt,[t[18]||(t[18]=e("h3",{class:"text-lg font-semibold mb-4 text-green-600"},"Contratos Asociados",-1)),e("div",pt,[(g(!0),f(ve,null,pe(w.value,a=>(g(),f("div",{key:a.id_contrato,onClick:I=>Y(a,"derecha"),class:"p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-success/10 hover:border-success/40 transition-colors"},[e("div",ft,[e("div",gt,[e("h4",bt,k(a.entidad?.nombre||"Sin entidad"),1),e("p",yt,"N° "+k(a.num_consecutivo),1),e("p",xt,k(a.tipoContrato?.nombre||"Sin tipo"),1),e("p",ht,k(n(a.fecha_inicio))+" - "+k(n(a.fecha_fin)),1)]),t[17]||(t[17]=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1))])],8,mt))),128))])])]),e("div",wt,[e("div",kt,[e("div",Ct,[e("span",jt,k(y.value.length),1),t[19]||(t[19]=G(" contratos disponibles | ",-1)),e("span",_t,k(w.value.length),1),t[20]||(t[20]=G(" contratos asociados ",-1))]),e("div",Tt,[e("button",{onClick:t[5]||(t[5]=a=>u.$emit("update:modelValue",!1)),class:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-500"}," Cancelar "),e("button",{onClick:ce,class:"px-4 py-2 text-white bg-blue-500 rounded-lg hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500"}," Guardar Asociaciones ")])])])])])):V("",!0)}},Et={class:"min-h-screen bg-gradient-to-br via-secondary/40 from-accent/30 to-neutral"},$t={key:0,class:"fixed top-6 left-1/2 transform -translate-x-1/2 z-[9999] w-full max-w-md px-4 pointer-events-none"},At={key:1,class:"fixed top-24 left-1/2 transform -translate-x-1/2 z-[10000] w-full max-w-md px-4 pointer-events-auto"},Vt={class:"w-[95%] mx-auto px-4 py-4 md:py-4 mt-20 md:mt-0"},zt={class:"bg-white rounded-lg shadow-md p-4"},It={class:"grid grid-cols-1 md:grid-cols-3 gap-4 items-end mb-4 md:mb-2"},Dt={class:"relative"},Mt={class:"flex justify-end mt-4 gap-2 flex-wrap"},Nt={class:"w-[95%] mx-auto px-4 py-4"},Ot={class:"flex justify-between items-center mb-4"},Rt={__name:"trabajadores",setup(m){const{navigateTo:J}=ke(),j=l(""),P=l(""),d=l(""),D=l(""),_=l(""),y=l([{label:"Todos",value:""},{label:"Concidia",value:"Concidia"},{label:"Firma",value:"Firma"},{label:"Concidia y Firma",value:"Concidia y Firma"}]),w=l([]),M=l(0),N=l(10),z=l(1),p=l(!1),O=l(!1),B=l(!1),x=l(null),C=l([]),s=l(!1),n=l(!1),i=l(null),ee=l(!1),W=l(null),Y=ne(()=>{try{const r=JSON.parse(localStorage.getItem("usuario")||"null"),o=r&&(r.rol||r.role||r.perfil&&r.perfil.rol||r.profile&&r.profile.role);return o&&String(o).trim().toLowerCase()==="invitado"}catch{return!1}}),E=[{key:"nombre",label:"Nombre"},{key:"cargo",label:"Cargo"},{key:"carnet_identidad",label:"Carnet"},{key:"funcion",label:"Función"},{key:"contratosAsociados",label:"Contratos Asociados"}],te=[{name:"Editar",icon:{render(){return oe("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[oe("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})])}},handler:r=>{x.value=r,s.value=!0,n.value=!1,O.value=!0},buttonClass:"px-3 py-1 bg-accent text-neutral rounded-md hover:bg-accent/90"},{name:"Asociar",icon:{render(){return oe("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[oe("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})])}},handler:r=>{x.value=r,B.value=!0},buttonClass:"px-3 py-1 bg-primary text-neutral rounded-md hover:bg-primary/90"},{name:"Eliminar",icon:{render(){return oe("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-neutral",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[oe("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})])}},handler:r=>{W.value=r,ee.value=!0},buttonClass:"px-3 py-1 bg-danger text-neutral rounded-md hover:bg-danger/90"}],se=async()=>{try{const r=localStorage.getItem("token"),o=K(),b=await(await fetch(`${o.public.backendHost}/entidad`,{method:"GET",headers:{Authorization:r,Accept:"application/json"}})).json();C.value=Array.isArray(b.data)?b.data:[]}catch{C.value=[]}},H=async(r=z.value,o=N.value)=>{p.value=!0;try{const c=localStorage.getItem("token"),b=K(),T={nombre:j.value,cargo:P.value,carnet_identidad:d.value,id_entidad:D.value,funcion:_.value},Z=await(await fetch(`${b.public.backendHost}/trabajadorAutorizado/filter/${r}/${o}`,{method:"POST",headers:{Authorization:c,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(T)})).json();w.value=Array.isArray(Z.data)?Z.data.map(U=>({...U,contratosAsociados:Array.isArray(U.contratos)?U.contratos.length:0})):[],M.value=Z.pagination?.total||0}catch{w.value=[],M.value=0}finally{p.value=!1}},u=r=>{z.value=r,H(r)},t=r=>{x.value=r,s.value=!1,n.value=!0,O.value=!0};ge(()=>{H(),se()});const a=async r=>{try{const o=localStorage.getItem("token"),c=K(),b=s.value?`${c.public.backendHost}/trabajadorAutorizado/UpdateTrabajadorAutorizado/${x.value.id_trabajador_autorizado}`:`${c.public.backendHost}/trabajadorAutorizado/createTrabajadorAutorizado`,T=await fetch(b,{method:s.value?"PUT":"POST",headers:{"Content-Type":"application/json",Authorization:o,Accept:"application/json"},body:JSON.stringify(r)});if(T.status===401){i.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{J("/")},3e3);return}if(T.status===403){i.value={title:"Acceso Denegado",description:"No tienes permisos para realizar esta acción o acceder a esta información.",type:"error"};return}if(T.status===400||T.status===500){const L=await T.json();L.error?i.value={title:`Errores de validación: ${T.status}`,description:L.message,type:"error"}:i.value={title:`Error: ${T.status}`,description:JSON.stringify(L),type:"error"};return}T.ok?(s.value?i.value={title:`Trabajador Actualizado: ${T.status}`,description:`El trabajador ${r.nombre} se actualizó con éxito`,type:"success"}:i.value={title:`Trabajador Creado: ${T.status}`,description:`El trabajador ${r.nombre} se creó con éxito`,type:"success"},await H(z.value,N.value),O.value=!1,x.value=null,s.value=!1,n.value=!1):console.error("Error al guardar el trabajador")}catch(o){console.error("Error:",o),i.value={title:"Error",description:o.message,type:"error"}}},I=r=>{let o=r.target.value.replace(/\D/g,"");o.length>11&&(o=o.slice(0,11)),d.value=o},$=()=>{x.value=null,s.value=!1,n.value=!1,O.value=!0},Q=r=>{console.log("Guardando asociaciones:",r),B.value=!1,H()};async function F(){if(ee.value=!1,!!W.value)try{const r=localStorage.getItem("token"),o=K(),c=await fetch(`${o.public.backendHost}/trabajadorAutorizado/DeleteTrabajadorAutorizado/${W.value.id_trabajador_autorizado}`,{method:"DELETE",headers:{Authorization:r,Accept:"application/json"}});if(c.status===401){i.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{J("/")},3e3);return}if(c.status===403){i.value={title:"Acceso Denegado",description:"No tienes permisos para realizar esta acción o acceder a esta información.",type:"error"};return}if(!c.ok){const b=await c.json();i.value={title:`Error al eliminar: ${c.status}`,description:b.message||JSON.stringify(b),type:"error"};return}i.value={title:"Trabajador eliminado",description:"El trabajador fue eliminado correctamente",type:"success"},await H(z.value,N.value)}catch(r){i.value={title:"Error",description:r.message,type:"error"}}finally{W.value=null}}const A=async()=>{try{p.value=!0,await H(1,N.value)}catch(r){console.error("Error al buscar trabajadores:",r)}finally{p.value=!1}};async function X(){i.value={title:"Consultando datos",description:"Se están consultando los datos, la descarga comenzará en breve.",type:"info"};try{const r=localStorage.getItem("token"),o=K(),c={nombre:j.value,cargo:P.value,carnet_identidad:d.value,id_entidad:D.value,funcion:_.value},b=await fetch(`${o.public.backendHost}/trabajadorAutorizado/filter/1/${M.value}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:r,Accept:"application/json"},body:JSON.stringify(c)});if(b.status===401){i.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{J("/")},3e3);return}if(b.status===403){i.value={title:"Acceso Denegado",description:"No tienes permisos para realizar esta acción o acceder a esta información.",type:"error"};return}if(!b.ok){const h=await b.json();i.value={title:"Error al consultar datos",description:h.error||"Ocurrió un error al consultar los datos.",type:"error"};return}const L=(await b.json()).data.map(h=>({Nombre:h.nombre,Cargo:h.cargo,"Carnet de Identidad":h.carnet_identidad,Teléfono:h.num_telefono,Función:h.funcion,"Contratos Asociados":Array.isArray(h.contratos)?h.contratos.length:0})),Z=ae.json_to_sheet(L),U=ae.book_new();ae.book_append_sheet(U,Z,"Trabajadores");const ie=new Date().toISOString().split("T")[0];fe(U,`trabajadores_${ie}.xlsx`),i.value=null}catch(r){console.error("Error al exportar a Excel:",r),i.value={title:"Error",description:"Ocurrió un error al exportar los datos.",type:"error"}}}async function ye(){i.value={title:"Consultando datos",description:"Se están consultando los datos, la descarga comenzará en breve.",type:"info"};try{const r=localStorage.getItem("token"),o=K(),c={nombre:j.value,cargo:P.value,carnet_identidad:d.value,id_entidad:D.value,funcion:_.value},b=await fetch(`${o.public.backendHost}/trabajadorAutorizado/filter/1/${M.value}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:r,Accept:"application/json"},body:JSON.stringify(c)});if(b.status===401){i.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{J("/")},3e3);return}if(b.status===403){i.value={title:"Acceso Denegado",description:"No tienes permisos para realizar esta acción o acceder a esta información.",type:"error"};return}if(!b.ok){const h=await b.json();i.value={title:"Error al consultar datos",description:h.error||"Ocurrió un error al consultar los datos.",type:"error"};return}const T=await b.json(),L=[];T.data.forEach(h=>{Array.isArray(h.contratos)&&h.contratos.forEach(v=>{L.push({"Nombre Trabajador":h.nombre,"Cargo Trabajador":h.cargo,"Función Trabajador":h.funcion,"Carnet Identidad":h.carnet_identidad,"Teléfono Trabajador":h.num_telefono,"ID Contrato":v.id_contrato,"Número Consecutivo":v.num_consecutivo,"Fecha Inicio":v.fecha_inicio?new Date(v.fecha_inicio).toLocaleDateString("es-ES"):"","Fecha Fin":v.fecha_fin?new Date(v.fecha_fin).toLocaleDateString("es-ES"):"",Clasificación:v.clasificacion,Nota:v.nota,"Cliente/Proveedor":v.ClienteOProveedor,"Vigencia Facturas (Días)":v.vigenciaFacturasDias,"Tipo Contrato":v.tipoContrato?v.tipoContrato.nombre:"",Entidad:v.entidad?v.entidad.nombre:"","Dirección Entidad":v.entidad?v.entidad.direccion:"","Teléfono Entidad":v.entidad?v.entidad.telefono:"","Email Entidad":v.entidad?v.entidad.email:"",Organismo:v.entidad?v.entidad.organismo:"","Tipo Entidad":v.entidad?v.entidad.tipo_entidad:"","Código REO":v.entidad?v.entidad.codigo_reo:"","Código NIT":v.entidad?v.entidad.codigo_nit:""})})});const Z=ae.json_to_sheet(L),U=ae.book_new();ae.book_append_sheet(U,Z,"Trabajadores con Contratos");const ie=new Date().toISOString().split("T")[0];fe(U,`trabajadores_contratos_${ie}.xlsx`),i.value=null}catch(r){console.error("Error al exportar a Excel con contratos:",r),i.value={title:"Error",description:"Ocurrió un error al exportar los datos.",type:"error"}}}return(r,o)=>(g(),f("div",Et,[S(Ce,{title:"Trabajadores - Contract Manager",description:"Registra y gestiona trabajadores autorizados y sus contratos.",canonical:"/trabajadores"}),S(je),i.value?(g(),f("div",$t,[S(ue,{title:i.value.title,description:i.value.description,type:i.value.type,onClose:o[0]||(o[0]=c=>i.value=null),class:"pointer-events-auto"},null,8,["title","description","type"])])):V("",!0),ee.value?(g(),f("div",At,[S(_e,{title:"¿Estás seguro que deseas eliminar este trabajador?",description:"Esta acción no se puede deshacer.",type:"warning",onConfirm:F,onClose:o[1]||(o[1]=c=>ee.value=!1)})])):V("",!0),e("div",Vt,[e("div",zt,[e("div",It,[e("div",null,[o[10]||(o[10]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Buscar por nombre",-1)),e("div",Dt,[q(e("input",{type:"text","onUpdate:modelValue":o[2]||(o[2]=c=>j.value=c),placeholder:"Ingrese el nombre...",class:"w-full pl-10 pr-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary",onKeyup:le(A,["enter"])},null,544),[[R,j.value]]),o[9]||(o[9]=e("div",{class:"absolute left-3 top-2.5"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))])]),e("div",null,[o[11]||(o[11]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Buscar por cargo",-1)),q(e("input",{type:"text","onUpdate:modelValue":o[3]||(o[3]=c=>P.value=c),placeholder:"Ingrese el cargo...",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary",onKeyup:le(A,["enter"])},null,544),[[R,P.value]])]),e("div",null,[o[12]||(o[12]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Carnet de Identidad",-1)),q(e("input",{type:"text","onUpdate:modelValue":o[4]||(o[4]=c=>d.value=c),placeholder:"Carnet de identidad...",maxlength:"11",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",onInput:I,onKeyup:le(A,["enter"])},null,544),[[R,d.value]])]),e("div",null,[o[13]||(o[13]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Entidad",-1)),S(re,{modelValue:D.value,"onUpdate:modelValue":o[5]||(o[5]=c=>D.value=c),options:C.value,labelKey:"nombre",valueKey:"id_entidad",placeholder:"Buscar entidad..."},null,8,["modelValue","options"])]),e("div",null,[o[14]||(o[14]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Función",-1)),S(re,{modelValue:_.value,"onUpdate:modelValue":o[6]||(o[6]=c=>_.value=c),options:y.value,labelKey:"label",valueKey:"value",placeholder:"Seleccionar función..."},null,8,["modelValue","options"])])]),e("div",Mt,[e("button",{onClick:A,class:"px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors"}," Buscar "),Y.value?V("",!0):(g(),f("button",{key:0,onClick:X,class:"px-6 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition-colors flex items-center"},[...o[15]||(o[15]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 5a2 2 0 012-2h4a2 2 0 012 2v2H8V5z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 12h2v2H7v-2zM11 12h2v2h-2v-2zM15 12h2v2h-2v-2z"})],-1),G(" Exportar a Excel ",-1)])])),Y.value?V("",!0):(g(),f("button",{key:1,onClick:ye,class:"px-6 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition-colors flex items-center"},[...o[16]||(o[16]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 5a2 2 0 012-2h4a2 2 0 012 2v2H8V5z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 12h2v2H7v-2zM11 12h2v2h-2v-2zM15 12h2v2h-2v-2z"})],-1),G(" Exportar a Excel con Contratos ",-1)])]))])])]),e("div",Nt,[e("div",Ot,[o[18]||(o[18]=e("h2",{class:"text-2xl font-bold"},"Trabajadores Autorizados",-1)),Y.value?V("",!0):(g(),f("button",{key:0,onClick:$,class:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 flex items-center"},[...o[17]||(o[17]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),G(" Nuevo Trabajador ",-1)])]))]),S(be,{columns:E,items:w.value,actions:Y.value?[]:te,"total-items":M.value,"items-per-page":N.value,"current-page":z.value,"is-loading":p.value,onPageChange:u,onRowClick:t},null,8,["items","actions","total-items","items-per-page","current-page","is-loading"])]),S(Je,{modelValue:O.value,"onUpdate:modelValue":o[7]||(o[7]=c=>O.value=c),trabajador:x.value,"is-editing":s.value,"is-viewing":n.value,onSubmit:a},null,8,["modelValue","trabajador","is-editing","is-viewing"]),S(St,{modelValue:B.value,"onUpdate:modelValue":o[8]||(o[8]=c=>B.value=c),trabajador:x.value,entidades:C.value,onSaveAssociations:Q},null,8,["modelValue","trabajador","entidades"])]))}};export{Rt as default};
