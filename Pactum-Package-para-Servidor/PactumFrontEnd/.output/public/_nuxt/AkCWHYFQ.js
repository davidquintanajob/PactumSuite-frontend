import{u as T,r as c,o as D,x as b,B as d,E as N,z as e,G as j,H as I,Q as M,n as x,y as h}from"./DLx_sSSf.js";import{S as B}from"./tYk8DSAs.js";import{N as z}from"./uqRIYar1.js";import{D as A}from"./B1U57Od_.js";import{_ as O}from"./DTo_Qbs3.js";import{u as m,w as F}from"./3SA47z_C.js";import"./ETKJmL_A.js";const $={class:"min-h-screen bg-gradient-to-br via-secondary/40 from-accent/30 to-neutral"},V={key:0,class:"fixed top-6 left-1/2 transform -translate-x-1/2 z-[9999] w-full max-w-md px-4 pointer-events-none"},H={class:"w-[95%] mx-auto px-4 py-4 md:py-4 mt-20 md:mt-0"},P={class:"bg-white rounded-lg shadow-md p-4"},U={class:"grid grid-cols-1 md:grid-cols-3 gap-4 items-end mb-4 md:mb-2"},J={class:"relative"},K={class:"w-[95%] mx-auto px-4 py-4"},Z={__name:"servicios",setup(L){const{navigateTo:w}=T(),n=c(""),l=c([]),u=c(!1),t=c(null),k=[{key:"descripcion",label:"Descripción"},{key:"importe",label:"Importe"},{key:"cantidad",label:"Cantidad"},{key:"importe_total",label:"Importe Total"},{key:"unidadMedida",label:"Unidad de Medida"},{key:"factura.num_consecutivo",label:"Número Consecutivo Factura"}],v=async()=>{u.value=!0;try{const r=localStorage.getItem("token"),o=x(),a={descripcion:n.value},p=await(await fetch(`${o.public.backendHost}/Servicio/filter`,{method:"POST",headers:{Authorization:r,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(a)})).json();l.value=Array.isArray(p)?p:[]}catch{l.value=[],t.value={title:"Error",description:"Error al cargar los servicios.",type:"error"}}finally{u.value=!1}};D(()=>{v()});const f=async()=>{try{await v()}catch(r){console.error("Error al buscar servicios:",r)}};async function _(){t.value={title:"Consultando datos",description:"Se están consultando los datos, la descarga comenzará en breve.",type:"info"};try{const r=localStorage.getItem("token"),o=x(),a={descripcion:n.value},i=await fetch(`${o.public.backendHost}/Servicio/filter`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:r,Accept:"application/json"},body:JSON.stringify(a)});if(i.status===401){t.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{w("/")},3e3);return}if(i.status===403){t.value={title:"Acceso Denegado",description:"No tienes permisos para realizar esta acción o acceder a esta información.",type:"error"};return}if(!i.ok){const s=await i.json();t.value={title:"Error al consultar datos",description:s.error||"Ocurrió un error al consultar los datos.",type:"error"};return}const S=(await i.json()).map(s=>{var y;return{Descripción:s.descripcion,Importe:Number(s.importe).toFixed(2),Cantidad:s.cantidad,"Importe Total":Number(s.importe_total).toFixed(2),"Unidad de Medida":s.unidadMedida,"Número Consecutivo Factura":((y=s.factura)==null?void 0:y.num_consecutivo)||""}}),C=m.json_to_sheet(S),g=m.book_new();m.book_append_sheet(g,C,"Servicios");const E=new Date().toISOString().split("T")[0];F(g,`servicios_${E}.xlsx`),t.value=null}catch(r){console.error("Error al exportar a Excel:",r),t.value={title:"Error",description:"Ocurrió un error al exportar los datos.",type:"error"}}}return(r,o)=>(h(),b("div",$,[d(B,{title:"Servicios - Contract Manager",description:"Lista de servicios.",canonical:"/servicios"}),d(z),t.value?(h(),b("div",V,[d(O,{title:t.value.title,description:t.value.description,type:t.value.type,onClose:o[0]||(o[0]=a=>t.value=null),class:"pointer-events-auto"},null,8,["title","description","type"])])):N("",!0),e("div",H,[e("div",P,[e("div",U,[e("div",null,[o[3]||(o[3]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Buscar por descripción",-1)),e("div",J,[j(e("input",{type:"text","onUpdate:modelValue":o[1]||(o[1]=a=>n.value=a),placeholder:"Ingrese la descripción...",class:"w-full pl-10 pr-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary",onKeyup:M(f,["enter"])},null,544),[[I,n.value]]),o[2]||(o[2]=e("div",{class:"absolute left-3 top-2.5"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))])])]),e("div",{class:"flex justify-end mt-4 gap-2"},[e("button",{onClick:f,class:"px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors"}," Buscar "),e("button",{onClick:_,class:"px-6 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition-colors"}," Exportar a Excel ")])])]),e("div",K,[o[4]||(o[4]=e("div",{class:"flex justify-between items-center mb-4"},[e("h2",{class:"text-2xl font-bold"},"Servicios")],-1)),d(A,{columns:k,items:l.value,"total-items":l.value.length,"items-per-page":1e3,"current-page":1,"is-loading":u.value},null,8,["items","total-items","is-loading"])])]))}};export{Z as default};
