import{r as c,J as fe,k as Q,x as S,E as H,y as V,z as e,B as y,A as te,F as Ce,G as T,H as F,I as _e,D as X,q as b,n as ve,o as Ee,Q as oe,h as M}from"./DLx_sSSf.js";import{N as Se}from"./uqRIYar1.js";import{S as Ve}from"./tYk8DSAs.js";import{D as ie}from"./B1U57Od_.js";import{_ as pe}from"./DTo_Qbs3.js";import{_ as Te}from"./DlY85phm.js";import{_ as Z}from"./BiJ7237f.js";import{u as D,w as ne}from"./3SA47z_C.js";import"./ETKJmL_A.js";const Fe={key:0,class:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center"},Pe={key:0,class:"fixed top-6 left-1/2 transform -translate-x-1/2 z-[9999] w-full max-w-md px-4 pointer-events-none"},De={class:"bg-white rounded-lg p-6 w-full max-w-3xl max-h-[80vh] overflow-y-auto"},je={class:"flex justify-between items-center mb-6"},$e={class:"text-2xl font-bold text-gray-800"},ze={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ie=["readonly","disabled"],Oe=["readonly","disabled"],Ne=["readonly","disabled"],Ae=["readonly","disabled"],Me=["readonly","disabled"],He={class:"md:col-span-2"},Be=["readonly","disabled"],Ue={key:0,class:"flex justify-end space-x-4 mt-6"},Ke=["disabled"],qe=["disabled"],Ge={key:0,class:"flex items-center"},Le={key:1},Je={key:0,class:"mt-8 space-y-8"},Re={key:1,class:"text-red-600 text-sm mt-2"},Ye=5,We=5,Qe={__name:"ContratoModal",props:{modelValue:{type:Boolean,required:!0},contrato:{type:Object,default:()=>({})},isEditing:{type:Boolean,default:!1},isViewing:{type:Boolean,default:!1},entidades:{type:Array,default:()=>[]},tiposContrato:{type:Array,default:()=>[]}},emits:["update:modelValue","submit"],setup(d,{emit:j}){const v=d,$=j,s=c({id_entidad:"",id_tipo_contrato:"",fecha_inicio:"",fecha_fin:"",num_consecutivo:"",clasificacion:"",ClienteOProveedor:"",vigenciaFacturasDias:30,nota:""}),z=c([{label:"Cliente",value:"Cliente"},{label:"Proveedor",value:"Proveedor"}]),p=c(""),g=c(!1),w=c(null);async function B(){const i=localStorage.getItem("token");if(!i){b("/");return}try{const t=new Date().getFullYear(),u=ve(),x=await fetch(`${u.public.backendHost}/contrato/next-consecutivo/${t}`,{method:"GET",headers:{Authorization:i}});if(x.status===401||x.status===403){errorBanner.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{b("/")},3e3);return}if(x.ok){const k=await x.json();k.data&&k.data.siguiente_consecutivo&&(s.value.num_consecutivo=k.data.siguiente_consecutivo)}else console.error("Error al obtener el siguiente consecutivo")}catch(t){console.error("Error al obtener el siguiente consecutivo:",t)}}fe(()=>v.modelValue,async i=>{i&&!v.isEditing&&!v.isViewing&&await B()}),fe(()=>v.contrato,i=>{i&&Object.keys(i).length>0?s.value={id_entidad:i.id_entidad||"",id_tipo_contrato:i.id_tipo_contrato||"",fecha_inicio:i.fecha_inicio?i.fecha_inicio.substring(0,10):"",fecha_fin:i.fecha_fin?i.fecha_fin.substring(0,10):"",num_consecutivo:i.num_consecutivo||"",clasificacion:i.clasificacion||"",ClienteOProveedor:i.ClienteOProveedor||"",vigenciaFacturasDias:i.vigenciaFacturasDias||30,nota:i.nota||""}:s.value={id_entidad:"",id_tipo_contrato:"",fecha_inicio:"",fecha_fin:"",num_consecutivo:"",clasificacion:"",ClienteOProveedor:"",vigenciaFacturasDias:30,nota:""}},{immediate:!0});const U=async()=>{if(p.value="",!s.value.id_entidad){p.value="Debe seleccionar una Entidad.";return}if(!s.value.id_tipo_contrato){p.value="Debe seleccionar un Tipo de Contrato.";return}if(!s.value.fecha_inicio){p.value="Debe ingresar la Fecha de Inicio.";return}if(!s.value.fecha_fin){p.value="Debe ingresar la Fecha de Fin.";return}if(!s.value.num_consecutivo){p.value="Debe ingresar el Número Consecutivo.";return}const i=s.value.num_consecutivo,t=i.indexOf("/");if(t===-1){if(!/^\d+$/.test(i)){p.value='El Número Consecutivo debe contener solo números si no tiene "/".';return}}else{const u=i.substring(0,t);if(!u||!/^\d+$/.test(u)){p.value='La parte izquierda del "/" debe contener solo números y no puede estar vacía.';return}}if(!s.value.ClienteOProveedor){p.value="Debe seleccionar si este contrato es como Cliente o Proveedor.";return}if(!s.value.vigenciaFacturasDias||s.value.vigenciaFacturasDias<0){p.value='El campo "Vigencia de pago/cobro facturas (días)" es obligatorio y debe ser un número mayor o igual a 0.';return}g.value=!0,w.value={title:v.isEditing?"Guardando Contrato":"Creando Contrato",description:"Comunicando con el servidor, espere por favor...",type:"warning"};try{await new Promise((u,x)=>{$("submit",{...s.value}),setTimeout(u,100)})}catch(u){console.error("Error en handleSubmit:",u)}finally{setTimeout(()=>{g.value=!1,w.value=null},500)}},G=()=>{if(!v.isEditing&&!v.isViewing&&s.value.fecha_inicio){const i=new Date(s.value.fecha_inicio),t=new Date(i);t.setFullYear(t.getFullYear()+5);const u=t.toISOString().split("T")[0];s.value.fecha_fin=u}},O=[{key:"nombre",label:"Nombre"},{key:"cargo",label:"Cargo"},{key:"carnet_identidad",label:"Carnet de Identidad"},{key:"num_telefono",label:"Teléfono"}],L=c(1),ee=Q(()=>!v.contrato||!Array.isArray(v.contrato.trabajadoresAutorizados)?[]:v.contrato.trabajadoresAutorizados),K=Q(()=>ee.value.length),N=i=>{L.value=i},J=[{key:"id_oferta",label:"ID Oferta"},{key:"descripcion",label:"Descripción"},{key:"fecha_inicio",label:"Fecha Inicio",format:i=>i==null?void 0:i.substring(0,10)},{key:"fecha_fin",label:"Fecha Fin",format:i=>i==null?void 0:i.substring(0,10)}],R=c(1),Y=Q(()=>!v.contrato||!Array.isArray(v.contrato.oferta)?[]:v.contrato.oferta.map(i=>({...i,fecha_inicio:i.fecha_inicio?i.fecha_inicio.substring(0,10):"",fecha_fin:i.fecha_fin?i.fecha_fin.substring(0,10):""}))),l=Q(()=>Y.value.length),q=i=>{R.value=i},A=Q(()=>s.value.ClienteOProveedor&&s.value.ClienteOProveedor!=="Cliente"),_=i=>{let t=i.target.value;if(t.indexOf("/")===-1){const k=t.search(/\D/);k!==-1&&(t=t.slice(0,k)+"/"+t.slice(k))}const x=t.split("/");x.length>1?(x[0]=x[0].replace(/\D/g,""),t=x[0]+"/"+x.slice(1).join("/")):t=t.replace(/\D/g,""),s.value.num_consecutivo=t};return(i,t)=>d.modelValue?(V(),S("div",Fe,[w.value?(V(),S("div",Pe,[y(pe,{title:w.value.title,description:w.value.description,type:w.value.type,onClose:t[0]||(t[0]=u=>w.value=null),class:"pointer-events-auto"},null,8,["title","description","type"])])):H("",!0),e("div",De,[e("div",je,[e("h2",$e,te(d.isViewing?"Detalles de Contrato":d.isEditing?"Editar Contrato":"Nuevo Contrato"),1),e("button",{onClick:t[1]||(t[1]=u=>i.$emit("update:modelValue",!1)),class:"text-gray-500 hover:text-gray-700"},[...t[12]||(t[12]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("form",{onSubmit:Ce(U,["prevent"]),class:"space-y-4"},[e("div",ze,[e("div",null,[t[13]||(t[13]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Entidad",-1)),y(Z,{modelValue:s.value.id_entidad,"onUpdate:modelValue":t[2]||(t[2]=u=>s.value.id_entidad=u),options:d.entidades,labelKey:"nombre",valueKey:"id_entidad",disabled:d.isViewing||g.value,placeholder:"Selecciona una entidad"},null,8,["modelValue","options","disabled"])]),e("div",null,[t[14]||(t[14]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Tipo de Contrato",-1)),y(Z,{modelValue:s.value.id_tipo_contrato,"onUpdate:modelValue":t[3]||(t[3]=u=>s.value.id_tipo_contrato=u),options:d.tiposContrato,labelKey:"nombre",valueKey:"id_tipo_contrato",disabled:d.isViewing||g.value,placeholder:"Selecciona un tipo de contrato"},null,8,["modelValue","options","disabled"])]),e("div",null,[t[15]||(t[15]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Fecha de Inicio",-1)),T(e("input",{"onUpdate:modelValue":t[4]||(t[4]=u=>s.value.fecha_inicio=u),type:"date",readonly:d.isViewing,disabled:d.isViewing||g.value,class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",onChange:G,required:""},null,40,Ie),[[F,s.value.fecha_inicio]])]),e("div",null,[t[16]||(t[16]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Fecha de Fin",-1)),T(e("input",{"onUpdate:modelValue":t[5]||(t[5]=u=>s.value.fecha_fin=u),type:"date",readonly:d.isViewing,disabled:d.isViewing||g.value,class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",required:""},null,8,Oe),[[F,s.value.fecha_fin]])]),e("div",null,[t[17]||(t[17]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Número Consecutivo",-1)),T(e("input",{"onUpdate:modelValue":t[6]||(t[6]=u=>s.value.num_consecutivo=u),type:"text",readonly:d.isViewing||!A.value,disabled:d.isViewing||g.value,onInput:_,class:_e(["w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",{"opacity-50":!A.value}]),required:""},null,42,Ne),[[F,s.value.num_consecutivo]])]),e("div",null,[t[18]||(t[18]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Clasificación",-1)),T(e("input",{"onUpdate:modelValue":t[7]||(t[7]=u=>s.value.clasificacion=u),type:"text",readonly:d.isViewing,disabled:d.isViewing||g.value,class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500"},null,8,Ae),[[F,s.value.clasificacion]])]),e("div",null,[t[19]||(t[19]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Cliente o Proveedor",-1)),y(Z,{modelValue:s.value.ClienteOProveedor,"onUpdate:modelValue":t[8]||(t[8]=u=>s.value.ClienteOProveedor=u),options:z.value,labelKey:"label",valueKey:"value",disabled:d.isViewing||g.value,placeholder:"Selecciona..."},null,8,["modelValue","options","disabled"])]),e("div",null,[t[20]||(t[20]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Vigencia de pago/cobro facturas (días)",-1)),T(e("input",{"onUpdate:modelValue":t[9]||(t[9]=u=>s.value.vigenciaFacturasDias=u),type:"number",readonly:d.isViewing,disabled:d.isViewing||g.value,class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",min:"0",required:""},null,8,Me),[[F,s.value.vigenciaFacturasDias,void 0,{number:!0}]])]),e("div",He,[t[21]||(t[21]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Nota",-1)),T(e("textarea",{"onUpdate:modelValue":t[10]||(t[10]=u=>s.value.nota=u),readonly:d.isViewing,disabled:d.isViewing||g.value,class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",rows:"2",placeholder:"Ingrese una nota opcional"},null,8,Be),[[F,s.value.nota]])])]),d.isViewing?H("",!0):(V(),S("div",Ue,[e("button",{type:"button",onClick:t[11]||(t[11]=u=>i.$emit("update:modelValue",!1)),class:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-500",disabled:g.value}," Cancelar ",8,Ke),e("button",{type:"submit",class:"px-4 py-2 text-neutral bg-primary rounded-lg hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-primary disabled:opacity-50 disabled:cursor-not-allowed",disabled:g.value},[g.value?(V(),S("span",Ge,[t[22]||(t[22]=e("svg",{class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)),X(" "+te(d.isEditing?"Guardando...":"Creando..."),1)])):(V(),S("span",Le,te(d.isEditing?"Guardar Cambios":"Crear Contrato"),1))],8,qe)]))],32),d.isViewing||d.isEditing?(V(),S("div",Je,[e("div",null,[t[23]||(t[23]=e("h3",{class:"text-lg font-semibold mb-2"},"Trabajadores Autorizados",-1)),y(ie,{columns:O,items:ee.value,"total-items":K.value,"items-per-page":Ye,"current-page":L.value,"is-loading":!1,onPageChange:N},null,8,["items","total-items","current-page"])]),e("div",null,[t[24]||(t[24]=e("h3",{class:"text-lg font-semibold mb-2"},"Ofertas",-1)),y(ie,{columns:J,items:Y.value,"total-items":l.value,"items-per-page":We,"current-page":R.value,"is-loading":!1,onPageChange:q},null,8,["items","total-items","current-page"])])])):H("",!0),p.value?(V(),S("div",Re,te(p.value),1)):H("",!0)])])):H("",!0)}},Xe={class:"min-h-screen bg-gradient-to-br via-secondary/40 from-accent/30 to-neutral"},Ze={key:0,class:"fixed top-6 left-1/2 transform -translate-x-1/2 z-[9999] w-full max-w-md px-4 pointer-events-none"},et={key:1,class:"fixed top-24 left-1/2 transform -translate-x-1/2 z-[10000] w-full max-w-md px-4 pointer-events-auto"},tt={class:"w-[95%] mx-auto px-4 py-4 md:py-4 mt-20 md:mt-0"},ot={class:"bg-white rounded-lg shadow-md p-4"},at={class:"mb-4"},nt={class:"relative"},it={class:"grid grid-cols-1 md:grid-cols-5 gap-4 mb-4"},rt={class:"w-full"},st={class:"w-full"},lt={class:"w-full"},ut={class:"w-full"},ct={class:"w-full"},dt={class:"w-[95%] mx-auto px-4 py-4"},xt={__name:"contratos",setup(d){const j=c(""),v=c(""),$=c(""),s=c(""),z=c(""),p=c("");c(!1);const g=c([{label:"Todos",value:""},{label:"Cliente",value:"Cliente"},{label:"Proveedor",value:"Proveedor"}]),w=c([]),B=c([]),U=c(!1),G=c({}),O=c(!1),L=c(!1),ee=[{key:"num_consecutivo",label:"Num. Consecutivo"},{key:"fecha_inicio",label:"Fecha Inicio",cellRenderer:a=>a?`<span class="px-2 py-1 rounded text-sm">${a.substring(0,10)}</span>`:""},{key:"fecha_fin",label:"Fecha Fin",cellRenderer:a=>{if(!a)return"";const o=a.substring(0,10),r=new Date,f=new Date(a);return`<span class="px-2 py-1 rounded text-sm font-medium ${r>f?"bg-red-100 text-red-800":"bg-green-100 text-green-800"}">${o}</span>`}},{key:"clasificacion",label:"Clasificación",class:"w-1/2 whitespace-normal break-words"},{key:"ClienteOProveedor",label:"Cliente o Proveedor",cellRenderer:a=>a?`<span class="px-2 py-1 rounded text-sm font-medium ${a==="Cliente"?"bg-blue-100 text-blue-800":"bg-orange-100 text-orange-800"}">${a}</span>`:""},{key:"entidad.nombre",label:"Entidad"},{key:"tipoContrato.nombre",label:"Tipo de Contrato"}],K=c(1),N=c(0),J=c(!1),R=c(10),Y=c([]),l=c(null),q=c(!1),A=c(null),_=ve(),i=[{name:"Editar",icon:{render(){return M("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[M("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5M18.5 2.5a2.121 2.121 0 113 3L12 15l-4 1 1-4 7.5-7.5z"})])}},handler:a=>ae(a,"editar"),iconOnly:!1,buttonClass:"px-3 py-1 bg-accent text-neutral rounded-md hover:bg-accent/90"},{name:"Eliminar",icon:{render(){return M("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[M("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 19a2 2 0 002 2h8a2 2 0 002-2V7H6v12z"}),M("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7V5a2 2 0 00-2-2H7a2 2 0 00-2 2v2"})])}},handler:a=>ge(a),iconOnly:!1,buttonClass:"px-3 py-1 bg-danger text-neutral rounded-md hover:bg-danger/90"}],t=async()=>{try{J.value=!0,await k(1)}catch(a){console.error("Error al buscar contratos:",a)}finally{J.value=!1}};function u(a){k(a)}function x(a){ae(a,"ver")}async function k(a=1){var r,f;const o=localStorage.getItem("token");if(!o){b("/");return}try{const h={nombre_entidad:j.value||void 0,id_tipo_contrato:v.value||void 0,fecha_inicio:$.value||void 0,fecha_fin:s.value||void 0,num_consecutivo:z.value||void 0,ClienteOProveedor:p.value||void 0},P=await fetch(`${_.public.backendHost}/contrato/filter/${a}/${R.value}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:o},body:JSON.stringify(h)});if(P.status===401){l.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{b("/")},3e3);return}if(P.status===403){l.value={title:"Acceso Denegado",description:"No tienes permisos para realizar esta acción o acceder a esta información.",type:"error"};return}const C=await P.json();Y.value=(C.data||[]).map(E=>({...E,fecha_inicio:E.fecha_inicio?E.fecha_inicio.substring(0,10):"",fecha_fin:E.fecha_fin?E.fecha_fin.substring(0,10):""})),N.value=((r=C.pagination)==null?void 0:r.total)||0,K.value=((f=C.pagination)==null?void 0:f.currentPage)||1}catch{l.value={title:"Error",description:"No se pudieron cargar los contratos",type:"error"}}}async function re(){const a=localStorage.getItem("token");if(!a){b("/");return}try{const o=await fetch(`${_.public.backendHost}/tipoContrato`,{method:"GET",headers:{Authorization:a}});if(o.status===401){l.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{b("/")},3e3);return}if(o.status===403){l.value={title:"Acceso Denegado",description:"No tienes permisos para realizar esta acción o acceder a esta información.",type:"error"};return}const r=await o.json();w.value=r.data||[]}catch{w.value=[]}}async function se(){const a=localStorage.getItem("token");if(!a){b("/");return}try{const o=await fetch(`${_.public.backendHost}/entidad`,{method:"GET",headers:{Authorization:a}});if(o.status===401){l.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{b("/")},3e3);return}if(o.status===403){l.value={title:"Acceso Denegado",description:"No tienes permisos para realizar esta acción o acceder a esta información.",type:"error"};return}const r=await o.json();B.value=r.data||[]}catch{B.value=[]}}function ae(a,o){G.value=a?{...a}:{},O.value=o==="editar",L.value=o==="ver",U.value=!0}async function me(){B.value.length||await se(),w.value.length||await re(),ae({},"crear")}function ge(a){A.value=a,q.value=!0}async function be(){if(!A.value)return;const a=localStorage.getItem("token");if(!a){b("/");return}try{const o=await fetch(`${_.public.backendHost}/contrato/deleteContrato/${A.value.id_contrato}`,{method:"DELETE",headers:{Authorization:a}});if(o.status===401){l.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{b("/")},3e3);return}if(o.status===403){l.value={title:"Acceso Denegado",description:"No tienes permisos para realizar esta acción o acceder a esta información.",type:"error"};return}if(!o.ok){let r="No se pudo eliminar el contrato";try{const f=await o.json();f&&f.message&&(r=f.message)}catch{}throw new Error(r)}l.value={title:"Éxito",description:"Contrato eliminado correctamente",type:"success"},k(K.value)}catch(o){l.value={title:"Error",description:o.message,type:"error"}}finally{q.value=!1,A.value=null}}const he=async a=>{const o=localStorage.getItem("token");if(!o){b("/");return}try{const r=O.value?`${_.public.backendHost}/contrato/UpdateContrato/${G.value.id_contrato}`:`${_.public.backendHost}/contrato/createContrato`,f=await fetch(r,{method:O.value?"PUT":"POST",headers:{"Content-Type":"application/json",Authorization:o,Accept:"application/json"},body:JSON.stringify(a)});if(f.status===401){l.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{b("/")},3e3);return}if(f.status===403){l.value={title:"Acceso Denegado",description:"No tienes permisos para realizar esta acción o acceder a esta información.",type:"error"};return}if(f.status===400||f.status===500){const h=await f.json();h.error?l.value={title:`Errores de validación: ${f.status}`,description:h.error,type:"error"}:l.value={title:`Error: ${f.status}`,description:JSON.stringify(h),type:"error"};return}f.ok?(O.value?l.value={title:`Contrato Actualizado: ${f.status}`,description:"El contrato se actualizó con éxito",type:"success"}:l.value={title:`Contrato Creado: ${f.status}`,description:"El contrato se creó con éxito",type:"success"},U.value=!1,await k(K.value)):console.error("Error al guardar el contrato")}catch(r){l.value={title:"Error",description:r.message,type:"error"}}};async function ye(){l.value={title:"Consultando datos",description:"Se están consultando los datos, la descarga comenzará en breve.",type:"info"};try{const a=localStorage.getItem("token"),o={nombre_entidad:j.value||void 0,id_tipo_contrato:v.value||void 0,fecha_inicio:$.value||void 0,fecha_fin:s.value||void 0,num_consecutivo:z.value||void 0,ClienteOProveedor:p.value||void 0},r=await fetch(`${_.public.backendHost}/contrato/filter/1/${N.value}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:a,Accept:"application/json"},body:JSON.stringify(o)});if(r.status===401){l.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{b("/")},3e3);return}if(r.status===403){l.value={title:"Acceso Denegado",description:"No tienes permisos para realizar esta acción o acceder a esta información.",type:"error"};return}if(!r.ok){const n=await r.json();l.value={title:"Error al consultar datos",description:n.error||"Ocurrió un error al consultar los datos.",type:"error"};return}const h=(await r.json()).data.map(n=>{var m,I;return{"Num. Consecutivo":n.num_consecutivo,"Fecha Inicio":n.fecha_inicio?n.fecha_inicio.substring(0,10):"","Fecha Fin":n.fecha_fin?n.fecha_fin.substring(0,10):"",Clasificación:n.clasificacion,"Cliente o Proveedor":n.ClienteOProveedor,Entidad:(m=n.entidad)==null?void 0:m.nombre,"Tipo de Contrato":(I=n.tipoContrato)==null?void 0:I.nombre,"Vigencia de pago/cobro facturas (días)":n.vigenciaFacturasDias,Nota:n.nota}}),P=D.json_to_sheet(h),C=D.book_new();D.book_append_sheet(C,P,"Contratos");const E=new Date().toISOString().split("T")[0];ne(C,`contratos_${E}.xlsx`),l.value=null}catch(a){console.error("Error al exportar a Excel:",a),l.value={title:"Error",description:"Ocurrió un error al exportar los datos.",type:"error"}}}async function we(){l.value={title:"Consultando datos",description:"Se están consultando los datos, la descarga comenzará en breve.",type:"info"};try{const a=localStorage.getItem("token"),o={nombre_entidad:j.value||void 0,id_tipo_contrato:v.value||void 0,fecha_inicio:$.value||void 0,fecha_fin:s.value||void 0,num_consecutivo:z.value||void 0,ClienteOProveedor:p.value||void 0},r=await fetch(`${_.public.backendHost}/contrato/filter/1/${N.value}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:a,Accept:"application/json"},body:JSON.stringify(o)});if(r.status===401){l.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{b("/")},3e3);return}if(r.status===403){l.value={title:"Acceso Denegado",description:"No tienes permisos para realizar esta acción o acceder a esta información.",type:"error"};return}if(!r.ok){const n=await r.json();l.value={title:"Error al consultar datos",description:n.error||"Ocurrió un error al consultar los datos.",type:"error"};return}const f=await r.json(),h=[];f.data.forEach(n=>{n.facturas&&n.facturas.length>0&&n.facturas.forEach(m=>{var I,W;h.push({"Num. Consecutivo Contrato":n.num_consecutivo,"Fecha Inicio Contrato":n.fecha_inicio?n.fecha_inicio.substring(0,10):"","Fecha Fin Contrato":n.fecha_fin?n.fecha_fin.substring(0,10):"","Clasificación Contrato":n.clasificacion,"Cliente o Proveedor":n.ClienteOProveedor,Entidad:(I=n.entidad)==null?void 0:I.nombre,"Tipo de Contrato":(W=n.tipoContrato)==null?void 0:W.nombre,"Vigencia Facturas (días)":n.vigenciaFacturasDias,"Nota Contrato":n.nota,"Num. Consecutivo Factura":m.num_consecutivo,"Fecha Factura":m.fecha?m.fecha.substring(0,10):"","Estado Factura":m.estado,"Nota Factura":m.nota,"Suma Servicios":Number(m.suma_servicios).toFixed(2),"Suma Productos":Number(m.suma_productos).toFixed(2),"Suma General":Number(m.suma_general).toFixed(2)})})});const P=D.json_to_sheet(h),C=D.book_new();D.book_append_sheet(C,P,"Contratos con Facturas");const E=new Date().toISOString().split("T")[0];ne(C,`contratos_facturas_${E}.xlsx`),l.value=null}catch(a){console.error("Error al exportar a Excel con facturas:",a),l.value={title:"Error",description:"Ocurrió un error al exportar los datos.",type:"error"}}}async function xe(){l.value={title:"Consultando datos",description:"Se están consultando los datos, la descarga comenzará en breve.",type:"info"};try{const a=localStorage.getItem("token"),o={nombre_entidad:j.value||void 0,id_tipo_contrato:v.value||void 0,fecha_inicio:$.value||void 0,fecha_fin:s.value||void 0,num_consecutivo:z.value||void 0,ClienteOProveedor:p.value||void 0},r=await fetch(`${_.public.backendHost}/contrato/filter/1/${N.value}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:a,Accept:"application/json"},body:JSON.stringify(o)});if(r.status===401){l.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{b("/")},3e3);return}if(r.status===403){l.value={title:"Acceso Denegado",description:"No tienes permisos para realizar esta acción o acceder a esta información.",type:"error"};return}if(!r.ok){const n=await r.json();l.value={title:"Error al consultar datos",description:n.error||"Ocurrió un error al consultar los datos.",type:"error"};return}const f=await r.json(),h=[];f.data.forEach(n=>{n.trabajadoresAutorizados&&n.trabajadoresAutorizados.length>0&&n.trabajadoresAutorizados.forEach(m=>{var I,W,le,ue,ce,de;h.push({"Num. Consecutivo Contrato":n.num_consecutivo,"Fecha Inicio Contrato":n.fecha_inicio?n.fecha_inicio.substring(0,10):"","Fecha Fin Contrato":n.fecha_fin?n.fecha_fin.substring(0,10):"","Clasificación Contrato":n.clasificacion,"Cliente o Proveedor":n.ClienteOProveedor,"Tipo de Contrato":(I=n.tipoContrato)==null?void 0:I.nombre,"Vigencia Facturas (días)":n.vigenciaFacturasDias,"Nota Contrato":n.nota,"Nombre Entidad":(W=n.entidad)==null?void 0:W.nombre,"Dirección Entidad":(le=n.entidad)==null?void 0:le.direccion,"Teléfono Entidad":(ue=n.entidad)==null?void 0:ue.telefono,"Email Entidad":(ce=n.entidad)==null?void 0:ce.email,"Tipo de Entidad":(de=n.entidad)==null?void 0:de.tipo_entidad,"Nombre Trabajador":m.nombre,"Cargo Trabajador":m.cargo,"Función Trabajador":m.funcion,"Carnet Identidad":m.carnet_identidad,"Teléfono Trabajador":m.num_telefono})})});const P=D.json_to_sheet(h),C=D.book_new();D.book_append_sheet(C,P,"Ficha de Clientes");const E=new Date().toISOString().split("T")[0];ne(C,`ficha_clientes_${E}.xlsx`),l.value=null}catch(a){console.error("Error al exportar ficha de cliente:",a),l.value={title:"Error",description:"Ocurrió un error al exportar los datos.",type:"error"}}}Ee(()=>{if(!localStorage.getItem("token")){b("/");return}se(),re(),k()});const ke={render(){return M("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-neutral",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[M("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})])}};return(a,o)=>(V(),S("div",Xe,[y(Ve,{title:"Contratos - Contract Manager",description:"Lista y gestión de contratos en Contract Manager. Filtra, exporta y administra contratos.",canonical:"/contratos"}),y(Se),l.value?(V(),S("div",Ze,[y(pe,{title:l.value.title,description:l.value.description,type:l.value.type,onClose:o[0]||(o[0]=r=>l.value=null),class:"pointer-events-auto"},null,8,["title","description","type"])])):H("",!0),q.value?(V(),S("div",et,[y(Te,{title:"¿Estás seguro que deseas eliminar este contrato?",description:"Esta acción no se puede deshacer.",icon:ke,type:"warning",onConfirm:be,onClose:o[1]||(o[1]=r=>q.value=!1)})])):H("",!0),e("div",tt,[e("div",ot,[e("div",at,[o[10]||(o[10]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Buscar por entidad",-1)),e("div",nt,[T(e("input",{type:"text","onUpdate:modelValue":o[2]||(o[2]=r=>j.value=r),placeholder:"Ingrese el nombre de la entidad...",class:"w-full pl-10 pr-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary",onKeyup:oe(t,["enter"])},null,544),[[F,j.value]]),o[9]||(o[9]=e("div",{class:"absolute left-3 top-2.5"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))])]),e("div",it,[e("div",rt,[o[11]||(o[11]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Tipo de contrato",-1)),y(Z,{modelValue:v.value,"onUpdate:modelValue":o[3]||(o[3]=r=>v.value=r),options:w.value,labelKey:"nombre",valueKey:"id_tipo_contrato",placeholder:"Buscar tipo de contrato..."},null,8,["modelValue","options"])]),e("div",st,[o[12]||(o[12]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Fecha inicio",-1)),T(e("input",{type:"date","onUpdate:modelValue":o[4]||(o[4]=r=>$.value=r),class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary",onKeyup:oe(t,["enter"])},null,544),[[F,$.value]])]),e("div",lt,[o[13]||(o[13]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Fecha fin",-1)),T(e("input",{type:"date","onUpdate:modelValue":o[5]||(o[5]=r=>s.value=r),class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary",onKeyup:oe(t,["enter"])},null,544),[[F,s.value]])]),e("div",ut,[o[14]||(o[14]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Num. consecutivo",-1)),T(e("input",{type:"number","onUpdate:modelValue":o[6]||(o[6]=r=>z.value=r),placeholder:"Número consecutivo",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary",onKeyup:oe(t,["enter"])},null,544),[[F,z.value,void 0,{number:!0}]])]),e("div",ct,[o[15]||(o[15]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Cliente o Proveedor",-1)),y(Z,{modelValue:p.value,"onUpdate:modelValue":o[7]||(o[7]=r=>p.value=r),options:g.value,labelKey:"label",valueKey:"value",placeholder:"Seleccionar..."},null,8,["modelValue","options"])])]),e("div",{class:"flex justify-end mt-4 gap-2 flex-wrap"},[e("button",{onClick:t,class:"px-6 py-2 bg-primary text-neutral rounded-lg hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition-colors"}," Buscar "),e("button",{onClick:ye,class:"px-6 py-2 bg-success text-neutral rounded-lg hover:bg-success/90 focus:outline-none focus:ring-2 focus:ring-success focus:ring-offset-2 transition-colors flex items-center"},[...o[16]||(o[16]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 5a2 2 0 012-2h4a2 2 0 012 2v2H8V5z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 12h2v2H7v-2zM11 12h2v2h-2v-2zM15 12h2v2h-2v-2z"})],-1),X(" Exportar a Excel ",-1)])]),e("button",{onClick:we,class:"px-6 py-2 bg-success text-neutral rounded-lg hover:bg-success/90 focus:outline-none focus:ring-2 focus:ring-success focus:ring-offset-2 transition-colors flex items-center"},[...o[17]||(o[17]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 5a2 2 0 012-2h4a2 2 0 012 2v2H8V5z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 12h2v2H7v-2zM11 12h2v2h-2v-2zM15 12h2v2h-2v-2z"})],-1),X(" Exportar a Excel con Facturas ",-1)])]),e("button",{onClick:xe,class:"px-6 py-2 bg-success text-neutral rounded-lg hover:bg-success/90 focus:outline-none focus:ring-2 focus:ring-success focus:ring-offset-2 transition-colors flex items-center"},[...o[18]||(o[18]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 5a2 2 0 012-2h4a2 2 0 012 2v2H8V5z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 12h2v2H7v-2zM11 12h2v2h-2v-2zM15 12h2v2h-2v-2z"})],-1),X(" Exportar a Excel con Ficha de Cliente ",-1)])])])])]),e("div",dt,[e("div",{class:"flex justify-between items-center mb-4"},[o[20]||(o[20]=e("h2",{class:"text-2xl font-bold"},"Contratos",-1)),e("button",{onClick:me,class:"px-4 py-2 bg-primary text-neutral rounded-lg hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-primary flex items-center"},[...o[19]||(o[19]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),X(" Nuevo Contrato ",-1)])])]),y(ie,{columns:ee,items:Y.value,actions:i,"total-items":N.value,"items-per-page":R.value,"current-page":K.value,"is-loading":J.value,onPageChange:u,onRowClick:x},null,8,["items","total-items","items-per-page","current-page","is-loading"])]),y(Qe,{modelValue:U.value,"onUpdate:modelValue":o[8]||(o[8]=r=>U.value=r),contrato:G.value,"is-editing":O.value,"is-viewing":L.value,entidades:B.value,"tipos-contrato":w.value,onSubmit:he},null,8,["modelValue","contrato","is-editing","is-viewing","entidades","tipos-contrato"])]))}};export{xt as default};
