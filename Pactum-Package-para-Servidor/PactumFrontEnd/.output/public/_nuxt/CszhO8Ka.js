const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./CWtp--US.js","./DLx_sSSf.js","./entry.9UJSYqx2.css"])))=>i.map(i=>d[i]);
import{r as g,J as oe,x as n,E as j,y as r,z as t,B as N,A as m,F as xe,K as ue,L as ce,G as c,H as f,D as w,I as J,M as le,_ as he,N as ke,O as ie,P as se,o as Ce,Q as de,n as Pe,q as X,h as G}from"./DLx_sSSf.js";import{S as Ve}from"./tYk8DSAs.js";import{N as _e}from"./uqRIYar1.js";import{D as Ee}from"./B1U57Od_.js";import{_ as pe}from"./DTo_Qbs3.js";import{_ as $e}from"./DlY85phm.js";import{_ as Z}from"./BiJ7237f.js";import{u as te,w as Ue}from"./3SA47z_C.js";import"./ETKJmL_A.js";const De={key:0,class:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center"},Oe={key:0,class:"fixed top-6 left-1/2 transform -translate-x-1/2 z-[9999] w-full max-w-md px-4 pointer-events-none"},Se={class:"bg-white rounded-lg p-6 w-full max-w-lg max-h-[80vh] overflow-y-auto"},Te={class:"flex justify-between items-center mb-6"},Ae={class:"text-2xl font-bold text-gray-800"},Ie={class:"space-y-4"},Fe={class:"space-y-2"},Ne=["onUpdate:modelValue","readonly","disabled","required","placeholder","onInput"],je=["onClick","disabled"],Le=["disabled"],ze=["readonly","disabled"],Me=["readonly","disabled"],Be={class:"space-y-2"},Re=["disabled"],He={class:"w-4 h-4 border-2 border-current rounded-full mr-3 flex items-center justify-center"},Ke={key:0,class:"w-2 h-2 bg-white rounded-full"},qe=["disabled"],Ge={class:"w-4 h-4 border-2 border-current rounded-full mr-3 flex items-center justify-center"},Je={key:0,class:"w-2 h-2 bg-white rounded-full"},We={key:0,class:"flex justify-end space-x-4 mt-6"},Ye=["disabled"],Qe=["disabled"],Xe={key:0,class:"flex items-center"},Ze={key:1},et={key:0,class:"text-red-600 text-sm mt-2"},tt={__name:"OfertaModal",props:{modelValue:{type:Boolean,required:!0},oferta:{type:Object,default:()=>({})},isEditing:{type:Boolean,default:!1},isViewing:{type:Boolean,default:!1},usuarios:{type:Array,default:()=>[]},contratos:{type:Array,default:()=>[]},id_usuario:{type:[Number,null],default:null},id_contrato:{type:[Number,null],default:null}},emits:["update:modelValue","submit"],setup(y,{emit:M}){const u=y,A=M,l=g({fecha_inicio:"",fecha_fin:"",id_contrato:"",id_usuario:"",estado:"no_facturada"}),o=g([""]),I=g(""),h=g(!1),E=g(null);oe(()=>[u.oferta,u.id_usuario,u.id_contrato],([a,i,s])=>{var k,V,x,O;a&&Object.keys(a).length>0?(l.value={fecha_inicio:a.fecha_inicio?a.fecha_inicio.split("T")[0]:"",fecha_fin:a.fecha_fin?a.fecha_fin.split("T")[0]:"",id_contrato:s!=null?((k=u.contratos.find(v=>v.id_contrato===s))==null?void 0:k.id_contrato)??null:Number(a.id_contrato||((V=a.contrato)==null?void 0:V.id_contrato)||0)||null,id_usuario:i!=null?((x=u.usuarios.find(v=>v.id_usuario===i))==null?void 0:x.id_usuario)??null:Number(a.id_usuario||((O=a.usuario)==null?void 0:O.id_usuario)||0)||null,estado:a.estado==="facturada"?"facturada":"no_facturada"},a.descripciones&&Array.isArray(a.descripciones)?(o.value=a.descripciones.map(v=>v.descripcion||""),o.value.length>0&&o.value.push("")):o.value=[""]):(l.value={fecha_inicio:"",fecha_fin:"",id_contrato:null,id_usuario:null,estado:"no_facturada"},o.value=[""])},{immediate:!0}),oe([()=>u.usuarios,()=>u.contratos,()=>u.id_usuario,()=>u.id_contrato],([a,i,s,k])=>{var V,x,O,v;u.oferta&&Object.keys(u.oferta).length>0&&(k!=null?l.value.id_contrato=((V=u.contratos.find(z=>z.id_contrato===k))==null?void 0:V.id_contrato)??null:l.value.id_contrato=Number(u.oferta.id_contrato||((x=u.oferta.contrato)==null?void 0:x.id_contrato)||0)||null,s!=null?l.value.id_usuario=((O=u.usuarios.find(z=>z.id_usuario===s))==null?void 0:O.id_usuario)??null:l.value.id_usuario=Number(u.oferta.id_usuario||((v=u.oferta.usuario)==null?void 0:v.id_usuario)||0)||null)});const $=()=>{o.value.length<15&&o.value.push("")},L=a=>{o.value.length>1&&o.value.splice(a,1)},C=a=>{a===o.value.length-1&&o.value[a].trim()!==""&&o.value.length<15&&o.value.push("")},e=async()=>{I.value="";const a=o.value.filter(i=>i.trim()!=="");if(a.length===0||!l.value.fecha_inicio||!l.value.fecha_fin||!l.value.id_contrato||!l.value.id_usuario||!l.value.estado){I.value="Todos los campos son obligatorios.";return}h.value=!0,E.value={title:u.isEditing?"Guardando Oferta":"Creando Oferta",description:"Comunicando con el servidor, espere por favor...",type:"warning"};try{const i={...l.value,descripciones:a.map(s=>({descripcion:s.trim()}))};await new Promise((s,k)=>{A("submit",i),setTimeout(s,100)})}catch(i){console.error("Error en handleSubmit:",i)}finally{setTimeout(()=>{h.value=!1,E.value=null},500)}};return(a,i)=>y.modelValue?(r(),n("div",De,[E.value?(r(),n("div",Oe,[N(pe,{title:E.value.title,description:E.value.description,type:E.value.type,onClose:i[0]||(i[0]=s=>E.value=null),class:"pointer-events-auto"},null,8,["title","description","type"])])):j("",!0),t("div",Se,[t("div",Te,[t("h2",Ae,m(y.isViewing?"Detalles de Oferta":y.isEditing?"Editar Oferta":"Nueva Oferta"),1),t("button",{onClick:i[1]||(i[1]=s=>a.$emit("update:modelValue",!1)),class:"text-gray-500 hover:text-gray-700"},[...i[9]||(i[9]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),t("form",{onSubmit:xe(e,["prevent"]),class:"space-y-4"},[t("div",Ie,[t("div",null,[i[12]||(i[12]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Descripciones",-1)),t("div",Fe,[(r(!0),n(ue,null,ce(o.value,(s,k)=>(r(),n("div",{key:k,class:"flex items-start space-x-2"},[c(t("textarea",{"onUpdate:modelValue":V=>o.value[k]=V,readonly:y.isViewing,disabled:y.isViewing||h.value,required:k===0,rows:"2",class:"flex-1 px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:`Descripción ${k+1}${k===0?" (requerida)":""}`,onInput:V=>C(k)},null,40,Ne),[[f,o.value[k]]]),!y.isViewing&&o.value.length>1?(r(),n("button",{key:0,type:"button",onClick:V=>L(k),class:"mt-2 p-1 text-red-500 hover:text-red-700 focus:outline-none",disabled:h.value},[...i[10]||(i[10]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,je)):j("",!0)]))),128)),!y.isViewing&&o.value.length<15?(r(),n("button",{key:0,type:"button",onClick:$,class:"w-full px-4 py-2 text-primary border-2 border-dashed border-accent/60 rounded-lg hover:border-accent/80 hover:brightness-90 focus:outline-none focus:ring-2 focus:ring-primary transition-colors",disabled:h.value},[...i[11]||(i[11]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 inline mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),w(" Agregar descripción ",-1)])],8,Le)):j("",!0)])]),t("div",null,[i[13]||(i[13]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Fecha inicio",-1)),c(t("input",{"onUpdate:modelValue":i[2]||(i[2]=s=>l.value.fecha_inicio=s),type:"date",readonly:y.isViewing,disabled:y.isViewing||h.value,required:"",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500"},null,8,ze),[[f,l.value.fecha_inicio]])]),t("div",null,[i[14]||(i[14]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Fecha fin",-1)),c(t("input",{"onUpdate:modelValue":i[3]||(i[3]=s=>l.value.fecha_fin=s),type:"date",readonly:y.isViewing,disabled:y.isViewing||h.value,required:"",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500"},null,8,Me),[[f,l.value.fecha_fin]])]),t("div",null,[i[15]||(i[15]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Contrato",-1)),N(Z,{modelValue:l.value.id_contrato,"onUpdate:modelValue":i[4]||(i[4]=s=>l.value.id_contrato=s),options:y.contratos,labelKey:s=>{var k,V,x;return`${(k=s.entidad)==null?void 0:k.nombre}: ${s==null?void 0:s.num_consecutivo} - ${(V=s.tipoContrato)==null?void 0:V.nombre} - (${(x=s.fecha_inicio)==null?void 0:x.substring(0,4)})`},valueKey:"id_contrato",placeholder:"Buscar contrato...",disabled:y.isViewing||h.value,required:""},null,8,["modelValue","options","labelKey","disabled"])]),t("div",null,[i[16]||(i[16]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Usuario",-1)),N(Z,{modelValue:l.value.id_usuario,"onUpdate:modelValue":i[5]||(i[5]=s=>l.value.id_usuario=s),options:y.usuarios,labelKey:"nombre",valueKey:"id_usuario",placeholder:"Buscar usuario...",disabled:y.isViewing||h.value,required:""},null,8,["modelValue","options","disabled"])]),t("div",null,[i[19]||(i[19]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Estado",-1)),t("div",Be,[t("label",{class:J(["flex items-center cursor-pointer",{"opacity-50":y.isViewing||h.value}])},[c(t("input",{type:"radio","onUpdate:modelValue":i[6]||(i[6]=s=>l.value.estado=s),value:"facturada",disabled:y.isViewing||h.value,class:"sr-only"},null,8,Re),[[le,l.value.estado]]),t("div",{class:J(["px-4 py-2 rounded-lg border-2 transition-all duration-200 flex items-center",l.value.estado==="facturada"?"bg-primary border-primary text-neutral shadow-md":"bg-blue-100 border-blue-300 text-blue-700 hover:bg-blue-200"])},[t("div",He,[l.value.estado==="facturada"?(r(),n("div",Ke)):j("",!0)]),i[17]||(i[17]=t("span",{class:"font-medium"},"Facturada",-1))],2)],2),t("label",{class:J(["flex items-center cursor-pointer",{"opacity-50":y.isViewing||h.value}])},[c(t("input",{type:"radio","onUpdate:modelValue":i[7]||(i[7]=s=>l.value.estado=s),value:"no_facturada",disabled:y.isViewing||h.value,class:"sr-only"},null,8,qe),[[le,l.value.estado]]),t("div",{class:J(["px-4 py-2 rounded-lg border-2 transition-all duration-200 flex items-center",l.value.estado==="no_facturada"?"bg-gray-500 border-gray-600 text-white shadow-md":"bg-gray-100 border-gray-300 text-gray-700 hover:bg-gray-200"])},[t("div",Ge,[l.value.estado==="no_facturada"?(r(),n("div",Je)):j("",!0)]),i[18]||(i[18]=t("span",{class:"font-medium"},"No Facturada",-1))],2)],2)])])]),y.isViewing?j("",!0):(r(),n("div",We,[t("button",{type:"button",onClick:i[8]||(i[8]=s=>a.$emit("update:modelValue",!1)),class:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-500",disabled:h.value}," Cancelar ",8,Ye),t("button",{type:"submit",class:"px-4 py-2 text-white bg-blue-500 rounded-lg hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",disabled:h.value},[h.value?(r(),n("span",Xe,[i[20]||(i[20]=t("svg",{class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)),w(" "+m(y.isEditing?"Guardando...":"Creando..."),1)])):(r(),n("span",Ze,m(y.isEditing?"Guardar Cambios":"Crear Oferta"),1))],8,Qe)]))],32),I.value?(r(),n("div",et,m(I.value),1)):j("",!0)])])):j("",!0)}},ot={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50"},at={class:"bg-neutral rounded-lg shadow-lg w-full max-w-3xl p-6 relative",style:{"max-height":"95vh","overflow-y":"auto"}},nt={class:"overflow-y-auto",style:{"max-height":"80vh"}},rt={class:"flex items-center border-b-2 border-primary"},lt={class:"flex-1 text-center text-2xl font-bold text-primary py-2"},it={key:0},st={class:"flex-1 text-center text-2xl font-bold text-primary py-2 border-l-2 border-primary"},dt={key:0},ut={class:"w-20 text-right text-2xl font-bold text-primary py-2 border-l-2 border-primary pr-2"},ct={key:0},pt={class:"p-2 border-b border-primary"},mt={key:0},ft={key:2},vt={class:"font-bold"},bt={key:0},gt={class:"font-bold"},yt={key:0},wt={key:4},xt={class:"p-2 border-b border-primary"},ht={key:0},kt={key:1},Ct={key:3},Pt={key:5},Vt={key:7},_t={key:9},Et={class:"w-full border-collapse border-primary",style:{"font-size":"12px","table-layout":"fixed"}},$t={class:"border border-primary px-1",style:{"vertical-align":"middle"}},Ut={key:0},Dt=["onUpdate:modelValue"],Ot={class:"border border-primary px-1",style:{"vertical-align":"middle"}},St={key:0},Tt=["onUpdate:modelValue"],At={class:"border border-primary px-1",style:{"vertical-align":"middle"}},It={key:0},Ft=["onUpdate:modelValue"],Nt={class:"border border-primary px-1",style:{"vertical-align":"middle"}},jt={key:0},Lt=["onUpdate:modelValue","onInput"],zt={class:"border border-primary px-1",style:{"vertical-align":"middle"}},Mt={key:0},Bt=["onUpdate:modelValue","onInput"],Rt={class:"border border-primary px-1",style:{"vertical-align":"middle"}},Ht={key:0},Kt=["onUpdate:modelValue"],qt={style:{height:"40px"}},Gt={class:"border border-primary px-1 text-right font-bold",style:{"vertical-align":"middle"}},Jt={key:0},Wt={class:"border border-primary px-1 text-right font-bold",style:{"vertical-align":"middle"}},Yt={key:0},Qt={class:"flex border-t border-primary mt-0"},Xt={class:"w-1/2 p-2 border-r border-primary"},Zt={key:0},eo={key:2},to={key:4},oo={key:6},ao={key:8},no={key:10},ro={class:"w-1/2 p-2"},lo={key:0},io={key:2},so={key:4},uo={key:6},co={key:8},po={class:"p-2 border-t border-primary"},mo={key:0},fo={class:"font-bold"},vo={key:0},bo={class:"text-red-600 font-bold"},go={__name:"ModalPDF",props:{show:Boolean,ofertaData:{type:Object,default:()=>({})}},emits:["close"],setup(y,{emit:M}){const u=y,A=g(null),l=g(!1),o=ke({empresa:"SOLUTEL S.R.L",titulo:"OFERTA COMERCIAL",numero:"/25",proveedor:"SOLUTEL S.R.L",domicilioProveedor:"Calle Ernesto Valdez Muñoz No. 10 entre Independencia y Céspedes,",cupProveedor:"1252354000140315",usdProveedor:"1299750000010836",nitProveedor:"50004182197",domicilioCliente:"",cupCliente:"",sucursalCliente:"",reeupCliente:"",nitCliente:"",tabla:Array.from({length:9},(C,e)=>({no:e===0?"No.1":"",descripcion:"",um:"",cantidad:"",precio:"",importe:""})),totalPrecio:"0.00",totalImporte:"0.00",nombreProveedor:"Belkis Martínez Arevalo",ciProveedor:"70081403279",cargoProveedor:"Especialista",fechaEntregaProveedor:"",firmaProveedor:"",cunoProveedor:"",nombreCliente:"",ciCliente:"",cargoCliente:"",fechaEntregaCliente:"",firmaCliente:"",observaciones:"",pagoA:"SOLUTEL S.R.L Cuenta Bancaria: CUP:1252354000140315",validez:""}),I={empresa:"SOLUTEL S.R.L",titulo:"OFERTA COMERCIAL",numero:"/25",proveedor:"SOLUTEL S.R.L",domicilioProveedor:"Calle Ernesto Valdez Muñoz No. 10 entre Independencia y Céspedes,",cupProveedor:"1252354000140315",usdProveedor:"1299750000010836",nitProveedor:"50004182197",domicilioCliente:"",cupCliente:"",sucursalCliente:"",reeupCliente:"",nitCliente:"",tabla:Array.from({length:9},(C,e)=>({no:e===0?"No.1":"",descripcion:"",um:"",cantidad:"",precio:"",importe:""})),totalPrecio:"0.00",totalImporte:"0.00",nombreProveedor:"Belkis Martínez Arevalo",ciProveedor:"70081403279",cargoProveedor:"Especialista",fechaEntregaProveedor:"",firmaProveedor:"",cunoProveedor:"",nombreCliente:"",ciCliente:"",cargoCliente:"",fechaEntregaCliente:"",firmaCliente:"",observaciones:"",pagoA:"SOLUTEL S.R.L Cuenta Bancaria: CUP:1252354000140315",validez:"La Oferta válida por 7 días"};function h(){Object.assign(o,JSON.parse(JSON.stringify(I)))}function E(C){const e=o.tabla[C],a=parseFloat(e.cantidad)||0,i=parseFloat(e.precio)||0,s=a*i;e.importe=s.toFixed(2),$()}function $(){let C=0,e=0;o.tabla.forEach(a=>{const i=parseFloat(a.precio)||0,s=parseFloat(a.importe)||0;if(u.ofertaData.fecha_inicio&&u.ofertaData.fecha_fin){const k=new Date(u.ofertaData.fecha_inicio),x=new Date(u.ofertaData.fecha_fin)-k,O=Math.ceil(x/(1e3*60*60*24));o.validez=`La Oferta válida por ${O} días`}else o.validez="La Oferta válida por 7 días";C+=i,e+=s}),o.totalPrecio=C.toFixed(2),o.totalImporte=e.toFixed(2)}oe(()=>u.show,C=>{if(C&&h(),C&&u.ofertaData){if(u.ofertaData.contrato&&u.ofertaData.contrato.entidad){const e=u.ofertaData.contrato.entidad;o.domicilioCliente=e.direccion||"",o.cupCliente=e.cuenta_bancaria||"",o.sucursalCliente="",o.reeupCliente=e.codigo_reo||"",o.nitCliente=e.codigo_nit||""}u.ofertaData.descripciones&&Array.isArray(u.ofertaData.descripciones)?(o.tabla.forEach(e=>{e.descripcion=""}),u.ofertaData.descripciones.forEach((e,a)=>{a<o.tabla.length&&(o.tabla[a].descripcion=e.descripcion||"",o.tabla[a].no=`No.${a+1}`)}),$()):u.ofertaData.descripcion&&(o.tabla[0].descripcion=u.ofertaData.descripcion,$())}C||h()});async function L(){l.value=!0,await ie();try{if(typeof window>"u"){console.warn("exportarPDF called on server - aborting");return}const C=await se(()=>import("./QH1iLAAe.js"),[],import.meta.url),e=C&&(C.default||C),a=await se(()=>import("./CWtp--US.js").then(F=>F.j),__vite__mapDeps([0,1,2]),import.meta.url),i=a&&(a.jsPDF||a.default||a);await new Promise(F=>setTimeout(F,100));const s=A.value,V=(await e(s,{scale:2,useCORS:!0,allowTaint:!0,backgroundColor:"#ffffff",logging:!1,width:s.scrollWidth,height:s.scrollHeight,scrollX:0,scrollY:0,windowWidth:s.scrollWidth,windowHeight:s.scrollHeight})).toDataURL("image/png",1),x=new i({orientation:"portrait",unit:"mm",format:"a4"}),O=x.internal.pageSize.getWidth(),v=x.internal.pageSize.getHeight(),z=x.getImageProperties(V),B=O-10,U=z.height*B/z.width;if(U<=v-10)x.addImage(V,"PNG",5,5,B,U);else{let F=U,H=5;for(x.addImage(V,"PNG",5,H,B,U),F-=v-10;F>=0;)H=F-U+5,x.addPage(),x.addImage(V,"PNG",5,H,B,U),F-=v-10}x.save("Oferta.pdf")}catch(C){console.error("Error al generar el PDF:",C),alert("Error al generar el PDF.")}finally{l.value=!1,await ie()}}return(C,e)=>y.show?(r(),n("div",ot,[t("div",at,[t("button",{onClick:e[0]||(e[0]=a=>C.$emit("close")),class:"absolute top-2 right-2 text-gray-500 hover:text-gray-700 text-xl"},"×"),t("div",nt,[t("div",{ref_key:"pdfContent",ref:A,class:"bg-neutral border-2 border-primary p-0 text-xs font-sans",style:{"min-width":"700px"}},[t("div",rt,[t("div",lt,[l.value?(r(),n("span",it,m(o.empresa),1)):c((r(),n("input",{key:1,"onUpdate:modelValue":e[1]||(e[1]=a=>o.empresa=a),class:"w-full text-center font-bold text-primary bg-transparent outline-none"},null,512)),[[f,o.empresa]])]),t("div",st,[l.value?(r(),n("span",dt,m(o.titulo),1)):c((r(),n("input",{key:1,"onUpdate:modelValue":e[2]||(e[2]=a=>o.titulo=a),class:"w-full text-center font-bold text-primary bg-transparent outline-none"},null,512)),[[f,o.titulo]])]),t("div",ut,[l.value?(r(),n("span",ct,m(o.numero),1)):c((r(),n("input",{key:1,"onUpdate:modelValue":e[3]||(e[3]=a=>o.numero=a),class:"w-full text-right font-bold text-primary bg-transparent outline-none"},null,512)),[[f,o.numero]])])]),t("div",pt,[e[31]||(e[31]=t("span",{class:"font-bold text-primary"},"Datos del Proveedor:",-1)),l.value?(r(),n("span",mt,m(o.proveedor),1)):c((r(),n("input",{key:1,"onUpdate:modelValue":e[4]||(e[4]=a=>o.proveedor=a),class:"font-bold bg-transparent outline-none"},null,512)),[[f,o.proveedor]]),e[32]||(e[32]=t("br",null,null,-1)),e[33]||(e[33]=w(" Domicilio Legal: ",-1)),l.value?(r(),n("span",ft,m(o.domicilioProveedor),1)):c((r(),n("input",{key:3,"onUpdate:modelValue":e[5]||(e[5]=a=>o.domicilioProveedor=a),class:"bg-transparent outline-none w-2/3"},null,512)),[[f,o.domicilioProveedor]]),e[34]||(e[34]=t("br",null,null,-1)),e[35]||(e[35]=w(" Cuentas Bancarias en ",-1)),t("span",vt,[e[29]||(e[29]=w("CUP:",-1)),l.value?(r(),n("span",bt,m(o.cupProveedor),1)):c((r(),n("input",{key:1,"onUpdate:modelValue":e[6]||(e[6]=a=>o.cupProveedor=a),class:"bg-transparent outline-none w-32 font-bold"},null,512)),[[f,o.cupProveedor]])]),e[36]||(e[36]=w(" en ",-1)),t("span",gt,[e[30]||(e[30]=w("USD: ",-1)),l.value?(r(),n("span",yt,m(o.usdProveedor),1)):c((r(),n("input",{key:1,"onUpdate:modelValue":e[7]||(e[7]=a=>o.usdProveedor=a),class:"bg-transparent outline-none w-40 font-bold"},null,512)),[[f,o.usdProveedor]])]),e[37]||(e[37]=t("br",null,null,-1)),e[38]||(e[38]=w(" NIT: ",-1)),l.value?(r(),n("span",wt,m(o.nitProveedor),1)):c((r(),n("input",{key:5,"onUpdate:modelValue":e[8]||(e[8]=a=>o.nitProveedor=a),class:"bg-transparent outline-none w-40"},null,512)),[[f,o.nitProveedor]])]),t("div",xt,[e[39]||(e[39]=t("span",{class:"font-bold text-primary"},"Datos del Cliente:",-1)),u.ofertaData&&u.ofertaData.contrato&&u.ofertaData.contrato.entidad&&u.ofertaData.contrato.entidad.nombre?(r(),n("span",ht,m(u.ofertaData.contrato.entidad.nombre),1)):j("",!0),e[40]||(e[40]=t("br",null,null,-1)),e[41]||(e[41]=w(" Domicilio Legal: ",-1)),l.value?(r(),n("span",kt,m(o.domicilioCliente),1)):c((r(),n("input",{key:2,"onUpdate:modelValue":e[9]||(e[9]=a=>o.domicilioCliente=a),class:"bg-transparent outline-none w-2/3"},null,512)),[[f,o.domicilioCliente]]),e[42]||(e[42]=t("br",null,null,-1)),e[43]||(e[43]=w(" Cuentas Bancarias en CUP: ",-1)),l.value?(r(),n("span",Ct,m(o.cupCliente),1)):c((r(),n("input",{key:4,"onUpdate:modelValue":e[10]||(e[10]=a=>o.cupCliente=a),class:"bg-transparent outline-none w-32"},null,512)),[[f,o.cupCliente]]),e[44]||(e[44]=w(" Sucursal: ",-1)),l.value?(r(),n("span",Pt,m(o.sucursalCliente),1)):c((r(),n("input",{key:6,"onUpdate:modelValue":e[11]||(e[11]=a=>o.sucursalCliente=a),class:"bg-transparent outline-none w-32"},null,512)),[[f,o.sucursalCliente]]),e[45]||(e[45]=t("br",null,null,-1)),e[46]||(e[46]=w(" Código REEUP: ",-1)),l.value?(r(),n("span",Vt,m(o.reeupCliente),1)):c((r(),n("input",{key:8,"onUpdate:modelValue":e[12]||(e[12]=a=>o.reeupCliente=a),class:"bg-transparent outline-none w-32"},null,512)),[[f,o.reeupCliente]]),e[47]||(e[47]=w(" NIT: ",-1)),l.value?(r(),n("span",_t,m(o.nitCliente),1)):c((r(),n("input",{key:10,"onUpdate:modelValue":e[13]||(e[13]=a=>o.nitCliente=a),class:"bg-transparent outline-none w-32"},null,512)),[[f,o.nitCliente]])]),t("table",Et,[e[49]||(e[49]=t("thead",null,[t("tr",{class:"bg-accent/40 text-primary",style:{height:"40px"}},[t("th",{class:"border border-primary px-1",style:{width:"8%"}},"No"),t("th",{class:"border border-primary px-1",style:{width:"35%"}},"Descripción"),t("th",{class:"border border-primary px-1",style:{width:"12%"}},"U/M"),t("th",{class:"border border-primary px-1",style:{width:"15%"}},"Cantidad"),t("th",{class:"border border-primary px-1",style:{width:"15%"}},"Precio"),t("th",{class:"border border-primary px-1",style:{width:"15%"}},"Importe")])],-1)),t("tbody",null,[(r(!0),n(ue,null,ce(o.tabla,(a,i)=>(r(),n("tr",{key:i,style:{height:"40px"}},[t("td",$t,[l.value?(r(),n("span",Ut,m(a.no),1)):c((r(),n("input",{key:1,"onUpdate:modelValue":s=>a.no=s,class:"w-full bg-transparent outline-none text-center"},null,8,Dt)),[[f,a.no]])]),t("td",Ot,[l.value?(r(),n("span",St,m(a.descripcion),1)):c((r(),n("input",{key:1,"onUpdate:modelValue":s=>a.descripcion=s,class:"w-full bg-transparent outline-none"},null,8,Tt)),[[f,a.descripcion]])]),t("td",At,[l.value?(r(),n("span",It,m(a.um),1)):c((r(),n("input",{key:1,"onUpdate:modelValue":s=>a.um=s,class:"w-full bg-transparent outline-none text-center"},null,8,Ft)),[[f,a.um]])]),t("td",Nt,[l.value?(r(),n("span",jt,m(a.cantidad),1)):c((r(),n("input",{key:1,"onUpdate:modelValue":s=>a.cantidad=s,class:"w-full bg-transparent outline-none text-center",onInput:s=>E(i)},null,40,Lt)),[[f,a.cantidad]])]),t("td",zt,[l.value?(r(),n("span",Mt,m(a.precio),1)):c((r(),n("input",{key:1,"onUpdate:modelValue":s=>a.precio=s,class:"w-full bg-transparent outline-none text-center",onInput:s=>E(i)},null,40,Bt)),[[f,a.precio]])]),t("td",Rt,[l.value?(r(),n("span",Ht,m(a.importe),1)):c((r(),n("input",{key:1,"onUpdate:modelValue":s=>a.importe=s,class:"w-full bg-transparent outline-none text-center",readonly:""},null,8,Kt)),[[f,a.importe]])])]))),128)),t("tr",qt,[e[48]||(e[48]=t("td",{class:"border border-primary px-1 text-right font-bold",colspan:"4",style:{"vertical-align":"middle"}},"Totales",-1)),t("td",Gt,[l.value?(r(),n("span",Jt,m(o.totalPrecio),1)):c((r(),n("input",{key:1,"onUpdate:modelValue":e[14]||(e[14]=a=>o.totalPrecio=a),class:"w-full bg-transparent outline-none text-right font-bold"},null,512)),[[f,o.totalPrecio]])]),t("td",Wt,[l.value?(r(),n("span",Yt,m(o.totalImporte),1)):c((r(),n("input",{key:1,"onUpdate:modelValue":e[15]||(e[15]=a=>o.totalImporte=a),class:"w-full bg-transparent outline-none text-right font-bold"},null,512)),[[f,o.totalImporte]])])])])]),t("div",Qt,[t("div",Xt,[e[50]||(e[50]=t("div",{class:"font-bold text-primary"},"REPRESENTANTE DEL PROVEEDOR",-1)),e[51]||(e[51]=w(" Nombre: ",-1)),l.value?(r(),n("span",Zt,m(o.nombreProveedor),1)):c((r(),n("input",{key:1,"onUpdate:modelValue":e[16]||(e[16]=a=>o.nombreProveedor=a),class:"bg-transparent outline-none w-40"},null,512)),[[f,o.nombreProveedor]]),e[52]||(e[52]=t("br",null,null,-1)),e[53]||(e[53]=w(" CI: ",-1)),l.value?(r(),n("span",eo,m(o.ciProveedor),1)):c((r(),n("input",{key:3,"onUpdate:modelValue":e[17]||(e[17]=a=>o.ciProveedor=a),class:"bg-transparent outline-none w-32"},null,512)),[[f,o.ciProveedor]]),e[54]||(e[54]=t("br",null,null,-1)),e[55]||(e[55]=w(" Cargo: ",-1)),l.value?(r(),n("span",to,m(o.cargoProveedor),1)):c((r(),n("input",{key:5,"onUpdate:modelValue":e[18]||(e[18]=a=>o.cargoProveedor=a),class:"bg-transparent outline-none w-32"},null,512)),[[f,o.cargoProveedor]]),e[56]||(e[56]=t("br",null,null,-1)),e[57]||(e[57]=w(" Fecha de Entrega: ",-1)),l.value?(r(),n("span",oo,m(o.fechaEntregaProveedor),1)):c((r(),n("input",{key:7,"onUpdate:modelValue":e[19]||(e[19]=a=>o.fechaEntregaProveedor=a),class:"bg-transparent outline-none w-32"},null,512)),[[f,o.fechaEntregaProveedor]]),e[58]||(e[58]=t("br",null,null,-1)),e[59]||(e[59]=w(" Firma: ",-1)),l.value?(r(),n("span",ao,m(o.firmaProveedor),1)):c((r(),n("input",{key:9,"onUpdate:modelValue":e[20]||(e[20]=a=>o.firmaProveedor=a),class:"bg-transparent outline-none w-32"},null,512)),[[f,o.firmaProveedor]]),e[60]||(e[60]=t("br",null,null,-1)),e[61]||(e[61]=w(" Cuño: ",-1)),l.value?(r(),n("span",no,m(o.cunoProveedor),1)):c((r(),n("input",{key:11,"onUpdate:modelValue":e[21]||(e[21]=a=>o.cunoProveedor=a),class:"bg-transparent outline-none w-32"},null,512)),[[f,o.cunoProveedor]])]),t("div",ro,[e[62]||(e[62]=t("div",{class:"font-bold text-primary"},"REPRESENTANTE DEL CLIENTE",-1)),e[63]||(e[63]=w(" Nombre: ",-1)),l.value?(r(),n("span",lo,m(o.nombreCliente),1)):c((r(),n("input",{key:1,"onUpdate:modelValue":e[22]||(e[22]=a=>o.nombreCliente=a),class:"bg-transparent outline-none w-40"},null,512)),[[f,o.nombreCliente]]),e[64]||(e[64]=t("br",null,null,-1)),e[65]||(e[65]=w(" CI: ",-1)),l.value?(r(),n("span",io,m(o.ciCliente),1)):c((r(),n("input",{key:3,"onUpdate:modelValue":e[23]||(e[23]=a=>o.ciCliente=a),class:"bg-transparent outline-none w-32"},null,512)),[[f,o.ciCliente]]),e[66]||(e[66]=t("br",null,null,-1)),e[67]||(e[67]=w(" Cargo: ",-1)),l.value?(r(),n("span",so,m(o.cargoCliente),1)):c((r(),n("input",{key:5,"onUpdate:modelValue":e[24]||(e[24]=a=>o.cargoCliente=a),class:"bg-transparent outline-none w-32"},null,512)),[[f,o.cargoCliente]]),e[68]||(e[68]=t("br",null,null,-1)),e[69]||(e[69]=w(" Fecha de Entrega: ",-1)),l.value?(r(),n("span",uo,m(o.fechaEntregaCliente),1)):c((r(),n("input",{key:7,"onUpdate:modelValue":e[25]||(e[25]=a=>o.fechaEntregaCliente=a),class:"bg-transparent outline-none w-32"},null,512)),[[f,o.fechaEntregaCliente]]),e[70]||(e[70]=t("br",null,null,-1)),e[71]||(e[71]=w(" Firma: ",-1)),l.value?(r(),n("span",co,m(o.firmaCliente),1)):c((r(),n("input",{key:9,"onUpdate:modelValue":e[26]||(e[26]=a=>o.firmaCliente=a),class:"bg-transparent outline-none w-32"},null,512)),[[f,o.firmaCliente]])])]),t("div",po,[e[73]||(e[73]=t("span",{class:"font-bold text-primary"},"Observaciones:",-1)),e[74]||(e[74]=t("br",null,null,-1)),l.value?(r(),n("span",mo,m(o.observaciones),1)):c((r(),n("textarea",{key:1,"onUpdate:modelValue":e[27]||(e[27]=a=>o.observaciones=a),class:"w-full bg-transparent outline-none resize-none",rows:"2"},null,512)),[[f,o.observaciones]]),e[75]||(e[75]=t("br",null,null,-1)),t("span",fo,[e[72]||(e[72]=w("Paguese a: ",-1)),l.value?(r(),n("span",vo,m(o.pagoA),1)):c((r(),n("input",{key:1,"onUpdate:modelValue":e[28]||(e[28]=a=>o.pagoA=a),class:"bg-transparent outline-none w-96 font-bold"},null,512)),[[f,o.pagoA]])]),e[76]||(e[76]=t("br",null,null,-1)),t("span",bo,m(o.validez),1)])],512)]),t("div",{class:"flex justify-end mt-4"},[t("button",{onClick:L,class:"px-6 py-2 bg-primary text-neutral rounded hover:bg-primary/90 flex items-center"},[...e[77]||(e[77]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),w(" Exportar a PDF ",-1)])])])])])):j("",!0)}},yo=he(go,[["__scopeId","data-v-ba4eb84b"]]),wo={class:"min-h-screen bg-gradient-to-br via-secondary/40 from-accent/30 to-neutral"},xo={key:0,class:"fixed top-6 left-1/2 transform -translate-x-1/2 z-[9999] w-full max-w-md px-4 pointer-events-none"},ho={key:1,class:"fixed top-24 left-1/2 transform -translate-x-1/2 z-[10000] w-full max-w-md px-4 pointer-events-auto"},ko={class:"w-[95%] mx-auto px-4 py-4 md:py-4 mt-20 md:mt-0"},Co={class:"bg-white rounded-lg shadow-md p-4"},Po={class:"md:hidden flex justify-between items-center mb-4"},Vo={class:"w-full"},_o={class:"w-full"},Eo={class:"w-full"},$o={class:"w-full"},Uo={class:"w-[95%] mx-auto px-4 py-4"},Lo={__name:"ofertas",setup(y){const M=g(""),u=g(""),A=g(""),l=g(""),o=g(!1),I=g([]),h=g([]),E=g(!1),$=g({}),L=g(!1),C=g(!1),e=g(!1),a=g({}),i=[{key:"fecha_inicio",label:"Fecha Inicio"},{key:"fecha_fin",label:"Fecha Fin"},{key:"contrato.entidad.nombre",label:"Entidad"},{key:"contrato.num_consecutivo",label:"Num Contrato"},{key:"usuario.nombre",label:"Usuario"},{key:"estado",label:"Estado",cellRenderer:p=>{if(!p)return"";switch(p.toLowerCase()){case"facturada":return'<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-accent/30 text-primary">Facturada</span>';case"vigente":return'<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">Vigente</span>';case"vencida":return'<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">Vencida</span>';default:return p}}}],s=g(1),k=g(0),V=g(!1),x=g(20),O=g([]),v=g(null),z=g(!1),B=g(null),U=Pe(),F=async()=>{try{const p=localStorage.getItem("token"),_=await(await fetch(`${U.public.backendHost}/usuario`,{method:"GET",headers:{Authorization:p,Accept:"application/json"}})).json();I.value=Array.isArray(_.data)?_.data:_;const b=await(await fetch(`${U.public.backendHost}/contrato`,{method:"GET",headers:{Authorization:p,Accept:"application/json"}})).json();h.value=Array.isArray(b.data)?b.data:b}catch(p){console.error("Error al cargar usuarios o contratos:",p)}},H=async(p=1,d=20,_="",K="",b="",S="",T="")=>{try{V.value=!0;const R=localStorage.getItem("token"),Y={descripcion:T,fecha_inicio:_,fecha_fin:K,id_contrato:b,id_usuario:S,page:p,limit:d},W=await fetch(`${U.public.backendHost}/oferta/filterOfertas`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:R,Accept:"application/json"},body:JSON.stringify(Y)});if(W.status===401){v.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{X("/")},3e3);return}if(W.status===403){v.value={title:"Acceso Denegado",description:"No tienes permisos para realizar esta acción o acceder a esta información.",type:"error"};return}const P=await W.json(),q=D=>D?D.split("T")[0]:"",Q=(P||[]).map(D=>({...D,fecha_inicio:q(D.fecha_inicio),fecha_fin:q(D.fecha_fin),contrato:D.contrato?{...D.contrato,fecha_inicio:q(D.contrato.fecha_inicio),fecha_fin:q(D.contrato.fecha_fin)}:D.contrato}));O.value=Q,k.value=O.value.length}catch(R){console.error("Error al cargar las ofertas:",R)}finally{V.value=!1}},ee=()=>{H(1,x.value,M.value,u.value,l.value,A.value,"")},me=p=>{s.value=p,H(p,x.value,M.value,u.value,l.value,A.value,"")},fe=p=>{ne(p,"ver")};Ce(()=>{F(),H(1,x.value,"","","","","")});const ae={render(){return G("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-neutral",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[G("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})])}};async function ne(p,d){(!I.value.length||!h.value.length)&&await F(),$.value={...p},L.value=d==="editar",C.value=d==="ver",E.value=!0}const ve=[{name:"Editar",icon:{render(){return G("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[G("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})])}},handler:p=>{ne(p,"editar")},buttonClass:"px-3 py-1 bg-accent text-neutral rounded-md hover:bg-accent/90"},{name:"Ver PDF",icon:{render(){return G("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[G("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})])}},handler:p=>{a.value={...p},e.value=!0},buttonClass:"px-3 py-1 bg-primary text-neutral rounded-md hover:bg-primary/90"},{name:"Eliminar",icon:ae,handler:p=>{B.value=p,z.value=!0},buttonClass:"px-3 py-1 bg-danger text-neutral rounded-md hover:bg-danger/90"}];async function be(){(!I.value.length||!h.value.length)&&(v.value={title:"Obteniendo Datos",description:"Obteniendo datos de usuarios y contratos necesarios para la creación de una nueva oferta.",type:"warning"},await F()),$.value={},L.value=!1,C.value=!1,E.value=!0}function ge(){if(z.value=!1,!!B.value)try{const p=localStorage.getItem("token");fetch(`${U.public.backendHost}/oferta/DeleteOferta/${B.value.id_oferta}`,{method:"DELETE",headers:{Authorization:p,Accept:"application/json"}}).then(async d=>{if(d.status===401){v.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{X("/")},3e3);return}if(d.status===403){v.value={title:"Acceso Denegado",description:"No tienes permisos para realizar esta acción o acceder a esta información.",type:"error"};return}if(!d.ok){const _=await d.json();v.value={title:`Error al eliminar: ${d.status}`,description:_.message||JSON.stringify(_),type:"error"};return}v.value={title:"Oferta eliminada",description:"La oferta fue eliminada correctamente",type:"success"},await H(s.value,x.value,M.value,u.value,l.value,A.value,"")}).catch(d=>{v.value={title:"Error",description:d.message,type:"error"}}).finally(()=>{B.value=null})}catch(p){v.value={title:"Error",description:p.message,type:"error"},B.value=null}}const ye=async p=>{try{let d;if(p.estado==="facturada")d="facturada";else{const T=new Date,R=new Date(p.fecha_fin);T>R?d="vencida":d="vigente"}const _={fecha_inicio:p.fecha_inicio,fecha_fin:p.fecha_fin,id_contrato:p.id_contrato,id_usuario:p.id_usuario,estado:d,descripciones:p.descripciones.map(T=>T.descripcion)},K=localStorage.getItem("token"),b=L.value?`${U.public.backendHost}/oferta/UpdateOferta/${$.value.id_oferta}`:`${U.public.backendHost}/oferta/CreateOferta`,S=await fetch(b,{method:L.value?"PUT":"POST",headers:{"Content-Type":"application/json",Authorization:K,Accept:"application/json"},body:JSON.stringify(_)});if(S.status===401){v.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{X("/")},3e3);return}if(S.status===403){v.value={title:"Acceso Denegado",description:"No tienes permisos para realizar esta acción o acceder a esta información.",type:"error"};return}if(S.status===400||S.status===500){const T=await S.json();v.value={title:`Error: ${S.status}`,description:T.message||JSON.stringify(T),type:"error"};return}S.ok?(v.value={title:L.value?"Oferta actualizada":"Oferta creada",description:`La oferta se ${L.value?"actualizó":"creó"} correctamente`,type:"success"},await H(s.value,x.value,M.value,u.value,l.value,A.value,""),E.value=!1):console.error("Error al guardar la oferta")}catch(d){console.error("Error:",d)}};async function we(){v.value={title:"Consultando datos",description:"Se están consultando los datos, la descarga comenzará en breve.",type:"info"};try{const p=localStorage.getItem("token"),d={descripcion:"",fecha_inicio:M.value,fecha_fin:u.value,id_contrato:l.value,id_usuario:A.value,page:1,limit:1e4},_=await fetch(`${U.public.backendHost}/oferta/filterOfertas`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:p,Accept:"application/json"},body:JSON.stringify(d)});if(_.status===401){v.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{X("/")},3e3);return}if(_.status===403){v.value={title:"Acceso Denegado",description:"No tienes permisos para realizar esta acción o acceder a esta información.",type:"error"};return}if(!_.ok){const P=await _.json();v.value={title:"Error al consultar datos",description:P.error||"Ocurrió un error al consultar los datos.",type:"error"};return}const K=await _.json(),b=P=>P?P.split("T")[0]:"",T=(K||[]).map(P=>({...P,fecha_inicio:b(P.fecha_inicio),fecha_fin:b(P.fecha_fin),contrato:P.contrato?{...P.contrato,fecha_inicio:b(P.contrato.fecha_inicio),fecha_fin:b(P.contrato.fecha_fin)}:P.contrato})).map(P=>{var q,Q,D,re;return{"Fecha Inicio":P.fecha_inicio,"Fecha Fin":P.fecha_fin,Entidad:((Q=(q=P.contrato)==null?void 0:q.entidad)==null?void 0:Q.nombre)||"","Num Contrato":((D=P.contrato)==null?void 0:D.num_consecutivo)||"",Usuario:((re=P.usuario)==null?void 0:re.nombre)||"",Estado:P.estado?P.estado.charAt(0).toUpperCase()+P.estado.slice(1):""}}),R=te.json_to_sheet(T),Y=te.book_new();te.book_append_sheet(Y,R,"Ofertas");const W=new Date().toISOString().split("T")[0];Ue(Y,`ofertas_${W}.xlsx`),v.value=null}catch(p){console.error("Error al exportar a Excel:",p),v.value={title:"Error",description:"Ocurrió un error al exportar los datos.",type:"error"}}}return(p,d)=>{var _,K;return r(),n("div",wo,[N(Ve,{title:"Ofertas - Contract Manager",description:"Consulta y administra ofertas asociadas a contratos.",canonical:"/ofertas"}),N(_e),v.value?(r(),n("div",xo,[N(pe,{title:v.value.title,description:v.value.description,type:v.value.type,onClose:d[0]||(d[0]=b=>v.value=null),class:"pointer-events-auto"},null,8,["title","description","type"])])):j("",!0),z.value?(r(),n("div",ho,[N($e,{title:"¿Estás seguro que deseas eliminar esta oferta?",description:"Esta acción no se puede deshacer.",icon:ae,type:"warning",onConfirm:ge,onClose:d[1]||(d[1]=b=>z.value=!1)})])):j("",!0),t("div",ko,[t("div",Co,[t("div",Po,[t("button",{onClick:d[2]||(d[2]=b=>o.value=!o.value),class:"flex items-center text-primary hover:brightness-90"},[d[11]||(d[11]=t("span",{class:"mr-2"},"Filtros adicionales",-1)),(r(),n("svg",{xmlns:"http://www.w3.org/2000/svg",class:J(["h-5 w-5 transform transition-transform",{"rotate-180":o.value}]),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[...d[10]||(d[10]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))])]),t("div",{class:J(["grid grid-cols-1 md:grid-cols-4 gap-4 mb-4",{"hidden md:grid":!o.value}])},[t("div",Vo,[d[12]||(d[12]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Fecha inicio",-1)),c(t("input",{type:"date","onUpdate:modelValue":d[3]||(d[3]=b=>M.value=b),class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary",onKeyup:de(ee,["enter"])},null,544),[[f,M.value]])]),t("div",_o,[d[13]||(d[13]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Fecha fin",-1)),c(t("input",{type:"date","onUpdate:modelValue":d[4]||(d[4]=b=>u.value=b),class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary",onKeyup:de(ee,["enter"])},null,544),[[f,u.value]])]),t("div",Eo,[d[14]||(d[14]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Nombre de usuario",-1)),N(Z,{modelValue:A.value,"onUpdate:modelValue":d[5]||(d[5]=b=>A.value=b),options:I.value,labelKey:"nombre",valueKey:"id_usuario",placeholder:"Buscar usuario..."},null,8,["modelValue","options"])]),t("div",$o,[d[15]||(d[15]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Contrato",-1)),N(Z,{modelValue:l.value,"onUpdate:modelValue":d[6]||(d[6]=b=>l.value=b),options:h.value,labelKey:b=>{var S,T,R;return`${(S=b.entidad)==null?void 0:S.nombre}: ${b==null?void 0:b.num_consecutivo} - ${(T=b.tipoContrato)==null?void 0:T.nombre} - (${(R=b.fecha_inicio)==null?void 0:R.substring(0,4)})`},valueKey:"id_contrato",placeholder:"Buscar contrato..."},null,8,["modelValue","options","labelKey"])])],2),t("div",{class:"flex justify-end mt-4 gap-2"},[t("button",{onClick:ee,class:"px-6 py-2 bg-primary text-neutral rounded-lg hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition-colors"}," Buscar "),t("button",{onClick:we,class:"px-6 py-2 bg-success text-neutral rounded-lg hover:bg-success/90 focus:outline-none focus:ring-2 focus:ring-success focus:ring-offset-2 transition-colors"}," Exportar a Excel ")])])]),t("div",Uo,[t("div",{class:"flex justify-between items-center mb-4"},[d[17]||(d[17]=t("h2",{class:"text-2xl font-bold"},"Ofertas",-1)),t("button",{onClick:be,class:"px-4 py-2 bg-primary text-neutral rounded-lg hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-primary flex items-center"},[...d[16]||(d[16]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),w(" Nueva Oferta ",-1)])])]),N(Ee,{columns:i,items:O.value,actions:ve,"total-items":k.value,"items-per-page":x.value,"current-page":s.value,"is-loading":V.value,onPageChange:me,onRowClick:fe},null,8,["items","total-items","items-per-page","current-page","is-loading"])]),N(tt,{modelValue:E.value,"onUpdate:modelValue":d[7]||(d[7]=b=>E.value=b),oferta:$.value,"is-editing":L.value,"is-viewing":C.value,usuarios:I.value,contratos:h.value,id_usuario:$.value.id_usuario??((_=$.value.usuario)==null?void 0:_.id_usuario)??null,id_contrato:$.value.id_contrato??((K=$.value.contrato)==null?void 0:K.id_contrato)??null,onSubmit:ye},null,8,["modelValue","oferta","is-editing","is-viewing","usuarios","contratos","id_usuario","id_contrato"]),N(yo,{show:e.value,"onUpdate:show":d[8]||(d[8]=b=>e.value=b),"oferta-data":a.value,onClose:d[9]||(d[9]=b=>e.value=!1)},null,8,["show","oferta-data"])])}}};export{Lo as default};
