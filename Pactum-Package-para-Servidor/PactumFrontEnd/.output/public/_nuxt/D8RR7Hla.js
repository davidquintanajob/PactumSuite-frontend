import{r as i,J as ue,k as ie,x as y,E as B,y as x,z as e,B as V,A as C,F as ye,G,H as R,D as Q,o as fe,O as xe,R as he,n as K,K as ve,L as me,q as pe,u as we,Q as de,h as te}from"./DLx_sSSf.js";import{S as ke}from"./tYk8DSAs.js";import{N as Ce}from"./uqRIYar1.js";import{D as be}from"./B1U57Od_.js";import{_ as ce}from"./DTo_Qbs3.js";import{_ as ae}from"./BiJ7237f.js";import{_ as je}from"./DlY85phm.js";import{u as oe,w as ge}from"./3SA47z_C.js";import"./ETKJmL_A.js";const _e={key:0,class:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center"},Te={key:0,class:"fixed top-6 left-1/2 transform -translate-x-1/2 z-[9999] w-full max-w-md px-4 pointer-events-none"},Se={class:"bg-white rounded-lg p-6 w-full max-w-4xl max-h-[80vh] overflow-y-auto"},Ee={class:"flex justify-between items-center mb-6"},Ae={class:"text-2xl font-bold text-gray-800"},$e={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ve=["readonly","disabled"],ze=["readonly","disabled"],Ie=["readonly","disabled"],De=["readonly","disabled"],Me={class:"mt-4"},Ne={key:0,class:"flex justify-end space-x-4 mt-6"},Oe=["disabled"],Pe=["disabled"],Be={key:0,class:"flex items-center"},Fe={key:1},He={key:0,class:"mt-8"},Le={key:1,class:"text-red-600 text-sm mt-2"},Ue=5,Ke={__name:"TrabajadorModal",props:{modelValue:{type:Boolean,required:!0},trabajador:{type:Object,default:()=>({})},isEditing:{type:Boolean,default:!1},isViewing:{type:Boolean,default:!1}},emits:["update:modelValue","submit"],setup(g,{emit:q}){const _=g,F=q,d=i({nombre:"",cargo:"",carnet_identidad:"",num_telefono:"",firma:""}),D=i([{label:"Concidia",value:"Concidia"},{label:"Firma",value:"Firma"},{label:"Concidia y Firma",value:"Concidia y Firma"}]),T=i(""),b=i(!1),k=i(null);ue(()=>_.trabajador,s=>{s&&Object.keys(s).length>0?d.value={nombre:s.nombre||"",cargo:s.cargo||"",carnet_identidad:s.carnet_identidad||"",num_telefono:s.num_telefono||"",firma:s.funcion||""}:d.value={nombre:"",cargo:"",carnet_identidad:"",num_telefono:"",firma:""}},{immediate:!0});const M=async()=>{if(T.value="",!d.value.nombre||!d.value.carnet_identidad||!d.value.firma){T.value="Todos los campos son obligatorios.";return}b.value=!0,k.value={title:_.isEditing?"Guardando Trabajador":"Creando Trabajador",description:"Comunicando con el servidor, espere por favor...",type:"warning"};try{await new Promise((s,n)=>{F("submit",{nombre:d.value.nombre,cargo:d.value.cargo,carnet_identidad:d.value.carnet_identidad,num_telefono:d.value.num_telefono,funcion:d.value.firma}),setTimeout(s,100)})}catch(s){console.error("Error en handleSubmit:",s)}finally{setTimeout(()=>{b.value=!1,k.value=null},500)}},N=s=>{let n=s.target.value.replace(/\D/g,"");n.length>11&&(n=n.slice(0,11)),d.value.carnet_identidad=n},z=s=>{let n=s.target.value;n=n.replace(/[^0-9+\-]/g,""),d.value.num_telefono=n},p=[{key:"id_contrato",label:"ID Contrato"},{key:"fecha_inicio",label:"Fecha de Inicio"},{key:"fecha_fin",label:"Fecha de Fin"},{key:"entidad_nombre",label:"Entidad"},{key:"tipo_contrato_nombre",label:"Tipo de Contrato"}],O=ie(()=>!_.trabajador||!Array.isArray(_.trabajador.contratos)?[]:_.trabajador.contratos.map(s=>{var n,r;return{id_contrato:s.id_contrato,fecha_inicio:s.fecha_inicio?s.fecha_inicio.split("T")[0]:"",fecha_fin:s.fecha_fin?s.fecha_fin.split("T")[0]:"",entidad_nombre:((n=s.entidad)==null?void 0:n.nombre)||"",tipo_contrato_nombre:((r=s.tipoContrato)==null?void 0:r.nombre)||""}})),H=ie(()=>O.value.length),h=i(1),j=s=>{h.value=s};return(s,n)=>g.modelValue?(x(),y("div",_e,[k.value?(x(),y("div",Te,[V(ce,{title:k.value.title,description:k.value.description,type:k.value.type,onClose:n[0]||(n[0]=r=>k.value=null),class:"pointer-events-auto"},null,8,["title","description","type"])])):B("",!0),e("div",Se,[e("div",Ee,[e("h2",Ae,C(g.isViewing?"Detalles de Trabajador":g.isEditing?"Editar Trabajador":"Nuevo Trabajador"),1),e("button",{onClick:n[1]||(n[1]=r=>s.$emit("update:modelValue",!1)),class:"text-gray-500 hover:text-gray-700"},[...n[8]||(n[8]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("form",{onSubmit:ye(M,["prevent"]),class:"space-y-4"},[e("div",$e,[e("div",null,[n[9]||(n[9]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Nombre",-1)),G(e("input",{"onUpdate:modelValue":n[2]||(n[2]=r=>d.value.nombre=r),type:"text",required:"",readonly:g.isViewing,disabled:g.isViewing||b.value,class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ingrese el nombre del trabajador"},null,8,Ve),[[R,d.value.nombre]])]),e("div",null,[n[10]||(n[10]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Cargo",-1)),G(e("input",{"onUpdate:modelValue":n[3]||(n[3]=r=>d.value.cargo=r),type:"text",readonly:g.isViewing,disabled:g.isViewing||b.value,class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ingrese el cargo"},null,8,ze),[[R,d.value.cargo]])]),e("div",null,[n[11]||(n[11]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Carnet de Identidad",-1)),G(e("input",{"onUpdate:modelValue":n[4]||(n[4]=r=>d.value.carnet_identidad=r),type:"text",required:"",readonly:g.isViewing,disabled:g.isViewing||b.value,class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ingrese el carnet de identidad",maxlength:"11",onInput:N},null,40,Ie),[[R,d.value.carnet_identidad]])]),e("div",null,[n[12]||(n[12]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Teléfono",-1)),G(e("input",{"onUpdate:modelValue":n[5]||(n[5]=r=>d.value.num_telefono=r),type:"text",readonly:g.isViewing,disabled:g.isViewing||b.value,class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ingrese el número de teléfono",onInput:z},null,40,De),[[R,d.value.num_telefono]])])]),e("div",Me,[n[13]||(n[13]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Función",-1)),V(ae,{modelValue:d.value.firma,"onUpdate:modelValue":n[6]||(n[6]=r=>d.value.firma=r),options:D.value,labelKey:"label",valueKey:"value",placeholder:"Seleccionar función...",readonly:g.isViewing,disabled:g.isViewing||b.value,required:""},null,8,["modelValue","options","readonly","disabled"])]),g.isViewing?B("",!0):(x(),y("div",Ne,[e("button",{type:"button",onClick:n[7]||(n[7]=r=>s.$emit("update:modelValue",!1)),class:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-500",disabled:b.value}," Cancelar ",8,Oe),e("button",{type:"submit",class:"px-4 py-2 text-neutral bg-primary rounded-lg hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-primary disabled:opacity-50 disabled:cursor-not-allowed",disabled:b.value},[b.value?(x(),y("span",Be,[n[14]||(n[14]=e("svg",{class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)),Q(" "+C(g.isEditing?"Guardando...":"Creando..."),1)])):(x(),y("span",Fe,C(g.isEditing?"Guardar Cambios":"Crear Trabajador"),1))],8,Pe)]))],32),g.isViewing||g.isEditing?(x(),y("div",He,[n[15]||(n[15]=e("h3",{class:"text-lg font-semibold mb-2"},"Contratos Asociados",-1)),V(be,{columns:p,items:O.value,"total-items":H.value,"items-per-page":Ue,"current-page":h.value,"is-loading":!1,"show-actions":!1,onPageChange:j},null,8,["items","total-items","current-page"])])):B("",!0),T.value?(x(),y("div",Le,C(T.value),1)):B("",!0)])])):B("",!0)}},qe={key:0,class:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4"},Je={class:"bg-white rounded-lg w-full max-w-7xl max-h-[90vh] overflow-hidden flex flex-col"},Ge={key:0,class:"fixed top-6 left-1/2 transform -translate-x-1/2 z-[9999] w-full max-w-md px-4 pointer-events-none"},Re={class:"p-6 border-b border-gray-200"},Qe={class:"flex justify-between items-center mb-4"},We={key:0,class:"text-sm text-gray-600 mt-1"},Ye={class:"font-medium"},Xe={class:"font-medium"},Ze={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},et={class:"flex-1 flex overflow-hidden"},tt={key:0,class:"flex justify-center items-center py-8"},ot={key:1,class:"space-y-2"},at=["onClick"],nt={class:"flex items-center justify-between"},rt={class:"flex-1"},st={class:"font-bold text-gray-900"},it={class:"text-sm text-gray-600"},lt={class:"text-sm text-gray-600"},dt={class:"text-xs text-gray-500"},ut={key:0,class:"flex justify-center items-center py-4"},ct={class:"w-1/2 p-4 overflow-y-auto"},vt={class:"space-y-2"},mt=["onClick"],pt={class:"flex items-center justify-between"},gt={class:"flex-1"},ft={class:"font-bold text-gray-900"},bt={class:"text-sm text-gray-600"},yt={class:"text-sm text-gray-600"},xt={class:"text-xs text-gray-500"},ht={class:"p-4 border-t border-gray-200 bg-gray-50"},wt={class:"flex justify-between items-center"},kt={class:"text-sm text-gray-600"},Ct={class:"font-medium"},jt={class:"font-medium"},_t={class:"flex space-x-3"},Tt={__name:"TrabajadorAsociacionModal",props:{modelValue:{type:Boolean,required:!0},trabajador:{type:Object,default:()=>({})},entidades:{type:Array,default:()=>[]}},emits:["update:modelValue","save-associations"],setup(g,{emit:q}){const _=g,F=q,d=ie(()=>_.trabajador),D=i(!1),T=i(!1),b=i([]),k=i([]),M=i(1),N=i(!0),z=i(null),p=i({numConsecutivo:"",entidad:null,tipoContrato:null}),O=ie(()=>_.entidades.map(u=>({value:u.id_entidad,label:u.nombre}))),H=i([]),h=i([]),j=i([]),s=i([]),n=u=>u?new Date(u).toLocaleDateString("es-ES"):"Sin fecha",r=async(u=1,t=!1)=>{u===1?D.value=!0:T.value=!0;try{const o=localStorage.getItem("token"),v=K(),S={},E=await fetch(`${v.public.backendHost}/contrato/filter/${u}/700`,{method:"POST",headers:{Authorization:o,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(S)});if(E.status===401||E.status===403){I.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{pe("/")},3e3);return}const A=await E.json();if(A.data&&Array.isArray(A.data)){if(t){const P=[...h.value,...A.data];h.value=P}else h.value=A.data;if(!t)d.value&&d.value.contratos?j.value=d.value.contratos.map(P=>P.id_contrato):j.value=[],s.value=h.value.map(P=>P.id_contrato).filter(P=>!j.value.includes(P));else{const P=A.data.map(Y=>Y.id_contrato).filter(Y=>!j.value.includes(Y));s.value.push(...P.filter(Y=>!s.value.includes(Y)))}ee(),A.pagination&&(N.value=A.pagination.hasNextPage,M.value=A.pagination.currentPage)}else t||(b.value=[],k.value=[])}catch(o){console.error("Error al cargar contratos:",o),t||(b.value=[],k.value=[])}finally{D.value=!1,T.value=!1}},Z=async()=>{N.value&&!T.value&&await r(M.value+1,!0)},W=async u=>{const{scrollTop:t,scrollHeight:o,clientHeight:v}=u.target;o-t-v<100&&await Z()},ne=(u,t)=>{if(t==="izquierda"){const o=s.value.indexOf(u.id_contrato);o!==-1&&(s.value.splice(o,1),j.value.push(u.id_contrato),ee())}else{const o=j.value.indexOf(u.id_contrato);o!==-1&&(j.value.splice(o,1),s.value.push(u.id_contrato),ee())}},I=i(null),le=async()=>{var S;const u=localStorage.getItem("token"),t=K(),o=(S=d.value)==null?void 0:S.id_trabajador_autorizado,v=j.value;if(!o){I.value={title:"Error",description:"No se encontró el ID del trabajador.",type:"error"};return}if(!u){window.location.href="/";return}try{const E=await fetch(`${t.public.backendHost}/contratoTrabajador/syncTrabajadorContratos`,{method:"POST",headers:{Authorization:u,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({id_trabajador_autorizado:o,ids_contratos:v})});if(E.status===401||E.status===403){I.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{pe("/")},3e3);return}if(E.ok)I.value={title:"¡Asociaciones guardadas correctamente!",description:"Las asociaciones del trabajador fueron actualizadas.",type:"success"},setTimeout(()=>{F("update:modelValue",!1),F("save-associations",{id_trabajador_autorizado:o,ids_contratos:v}),I.value=null},1200);else{const A=await E.json();I.value={title:"Error al guardar asociaciones",description:A.message||E.status,type:"error"}}}catch(E){I.value={title:"Error de red al guardar asociaciones",description:E.message,type:"error"}}};function ee(){let u=h.value.filter(o=>s.value.includes(o.id_contrato)),t=h.value.filter(o=>j.value.includes(o.id_contrato));p.value.numConsecutivo&&(u=u.filter(o=>String(o.num_consecutivo).includes(String(p.value.numConsecutivo))),t=t.filter(o=>String(o.num_consecutivo).includes(String(p.value.numConsecutivo)))),p.value.entidad&&(u=u.filter(o=>{var v;return String((v=o.entidad)==null?void 0:v.id_entidad)===String(p.value.entidad)}),t=t.filter(o=>{var v;return String((v=o.entidad)==null?void 0:v.id_entidad)===String(p.value.entidad)})),p.value.tipoContrato&&(u=u.filter(o=>{var v;return String((v=o.tipoContrato)==null?void 0:v.id_tipo_contrato)===String(p.value.tipoContrato)}),t=t.filter(o=>{var v;return String((v=o.tipoContrato)==null?void 0:v.id_tipo_contrato)===String(p.value.tipoContrato)})),b.value=u,k.value=t}ue(p,u=>{ee()},{deep:!0}),ue(()=>_.modelValue,async u=>{u&&(await J(),re())}),fe(async()=>{_.modelValue&&re(),await xe(),z.value&&z.value.addEventListener("scroll",W)}),he(()=>{z.value&&z.value.removeEventListener("scroll",W)});const J=async()=>{try{const u=localStorage.getItem("token"),t=K(),v=await(await fetch(`${t.public.backendHost}/tipoContrato`,{method:"GET",headers:{Authorization:u,Accept:"application/json"}})).json();H.value=Array.isArray(v.data)?v.data.map(S=>({value:S.id_tipo_contrato,label:S.nombre})):[]}catch{H.value=[]}},re=()=>{M.value=1,N.value=!0,b.value=[],k.value=[],h.value=[],s.value=[],j.value=[],r(1,!1)};return(u,t)=>g.modelValue?(x(),y("div",qe,[e("div",Je,[I.value?(x(),y("div",Ge,[V(ce,{title:I.value.title,description:I.value.description,type:I.value.type,onClose:t[0]||(t[0]=o=>I.value=null),class:"pointer-events-auto"},null,8,["title","description","type"])])):B("",!0),e("div",Re,[e("div",Qe,[e("div",null,[t[8]||(t[8]=e("h2",{class:"text-2xl font-bold text-gray-800"},"Asociar Trabajador a Contratos",-1)),d.value?(x(),y("p",We,[t[6]||(t[6]=Q(" Trabajador: ",-1)),e("span",Ye,C(d.value.nombre),1),t[7]||(t[7]=Q(" - ",-1)),e("span",Xe,C(d.value.cargo),1)])):B("",!0)]),e("button",{onClick:t[1]||(t[1]=o=>u.$emit("update:modelValue",!1)),class:"text-gray-500 hover:text-gray-700"},[...t[9]||(t[9]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",Ze,[e("div",null,[t[10]||(t[10]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Número consecutivo",-1)),G(e("input",{"onUpdate:modelValue":t[2]||(t[2]=o=>p.value.numConsecutivo=o),type:"number",min:"0",class:"w-full px-3 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Buscar por número..."},null,512),[[R,p.value.numConsecutivo]])]),e("div",null,[t[11]||(t[11]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Entidad",-1)),V(ae,{modelValue:p.value.entidad,"onUpdate:modelValue":t[3]||(t[3]=o=>p.value.entidad=o),options:O.value,labelKey:"label",valueKey:"value",placeholder:"Seleccionar entidad...",class:"w-full"},null,8,["modelValue","options"])]),e("div",null,[t[12]||(t[12]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Tipo de Contrato",-1)),V(ae,{modelValue:p.value.tipoContrato,"onUpdate:modelValue":t[4]||(t[4]=o=>p.value.tipoContrato=o),options:H.value,labelKey:"label",valueKey:"value",placeholder:"Seleccionar tipo...",class:"w-full"},null,8,["modelValue","options"])])])]),e("div",et,[e("div",{class:"w-1/2 border-r border-gray-200 p-4 overflow-y-auto",ref_key:"scrollContainer",ref:z},[t[16]||(t[16]=e("h3",{class:"text-lg font-semibold mb-4 text-primary"},"Contratos Existentes",-1)),D.value&&b.value.length===0?(x(),y("div",tt,[...t[13]||(t[13]=[e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"},null,-1)])])):(x(),y("div",ot,[(x(!0),y(ve,null,me(b.value,o=>{var v,S;return x(),y("div",{key:o.id_contrato,onClick:E=>ne(o,"izquierda"),class:"p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-accent/10 hover:border-accent/40 transition-colors"},[e("div",nt,[e("div",rt,[e("h4",st,C(((v=o.entidad)==null?void 0:v.nombre)||"Sin entidad"),1),e("p",it,"N° "+C(o.num_consecutivo),1),e("p",lt,C(((S=o.tipoContrato)==null?void 0:S.nombre)||"Sin tipo"),1),e("p",dt,C(n(o.fecha_inicio))+" - "+C(n(o.fecha_fin)),1)]),t[14]||(t[14]=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1))])],8,at)}),128)),T.value?(x(),y("div",ut,[...t[15]||(t[15]=[e("div",{class:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-500"},null,-1)])])):B("",!0)]))],512),e("div",ct,[t[18]||(t[18]=e("h3",{class:"text-lg font-semibold mb-4 text-green-600"},"Contratos Asociados",-1)),e("div",vt,[(x(!0),y(ve,null,me(k.value,o=>{var v,S;return x(),y("div",{key:o.id_contrato,onClick:E=>ne(o,"derecha"),class:"p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-success/10 hover:border-success/40 transition-colors"},[e("div",pt,[e("div",gt,[e("h4",ft,C(((v=o.entidad)==null?void 0:v.nombre)||"Sin entidad"),1),e("p",bt,"N° "+C(o.num_consecutivo),1),e("p",yt,C(((S=o.tipoContrato)==null?void 0:S.nombre)||"Sin tipo"),1),e("p",xt,C(n(o.fecha_inicio))+" - "+C(n(o.fecha_fin)),1)]),t[17]||(t[17]=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1))])],8,mt)}),128))])])]),e("div",ht,[e("div",wt,[e("div",kt,[e("span",Ct,C(b.value.length),1),t[19]||(t[19]=Q(" contratos disponibles | ",-1)),e("span",jt,C(k.value.length),1),t[20]||(t[20]=Q(" contratos asociados ",-1))]),e("div",_t,[e("button",{onClick:t[5]||(t[5]=o=>u.$emit("update:modelValue",!1)),class:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-500"}," Cancelar "),e("button",{onClick:le,class:"px-4 py-2 text-white bg-blue-500 rounded-lg hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500"}," Guardar Asociaciones ")])])])])])):B("",!0)}},St={class:"min-h-screen bg-gradient-to-br via-secondary/40 from-accent/30 to-neutral"},Et={key:0,class:"fixed top-6 left-1/2 transform -translate-x-1/2 z-[9999] w-full max-w-md px-4 pointer-events-none"},At={key:1,class:"fixed top-24 left-1/2 transform -translate-x-1/2 z-[10000] w-full max-w-md px-4 pointer-events-auto"},$t={class:"w-[95%] mx-auto px-4 py-4 md:py-4 mt-20 md:mt-0"},Vt={class:"bg-white rounded-lg shadow-md p-4"},zt={class:"grid grid-cols-1 md:grid-cols-3 gap-4 items-end mb-4 md:mb-2"},It={class:"relative"},Dt={class:"w-[95%] mx-auto px-4 py-4"},Kt={__name:"trabajadores",setup(g){const{navigateTo:q}=we(),_=i(""),F=i(""),d=i(""),D=i(""),T=i(""),b=i([{label:"Todos",value:""},{label:"Concidia",value:"Concidia"},{label:"Firma",value:"Firma"},{label:"Concidia y Firma",value:"Concidia y Firma"}]),k=i([]),M=i(0),N=i(10),z=i(1),p=i(!1),O=i(!1),H=i(!1),h=i(null),j=i([]),s=i(!1),n=i(!1),r=i(null),Z=i(!1),W=i(null),ne=[{key:"nombre",label:"Nombre"},{key:"cargo",label:"Cargo"},{key:"carnet_identidad",label:"Carnet"},{key:"funcion",label:"Función"},{key:"contratosAsociados",label:"Contratos Asociados"}],le=[{name:"Editar",icon:{render(){return te("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[te("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})])}},handler:l=>{h.value=l,s.value=!0,n.value=!1,O.value=!0},buttonClass:"px-3 py-1 bg-accent text-neutral rounded-md hover:bg-accent/90"},{name:"Asociar",icon:{render(){return te("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[te("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})])}},handler:l=>{h.value=l,H.value=!0},buttonClass:"px-3 py-1 bg-primary text-neutral rounded-md hover:bg-primary/90"},{name:"Eliminar",icon:{render(){return te("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-neutral",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[te("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})])}},handler:l=>{W.value=l,Z.value=!0},buttonClass:"px-3 py-1 bg-danger text-neutral rounded-md hover:bg-danger/90"}],ee=async()=>{try{const l=localStorage.getItem("token"),a=K(),f=await(await fetch(`${a.public.backendHost}/entidad`,{method:"GET",headers:{Authorization:l,Accept:"application/json"}})).json();j.value=Array.isArray(f.data)?f.data:[]}catch{j.value=[]}},J=async(l=z.value,a=N.value)=>{var c;p.value=!0;try{const f=localStorage.getItem("token"),$=K(),L={nombre:_.value,cargo:F.value,carnet_identidad:d.value,id_entidad:D.value,funcion:T.value},U=await(await fetch(`${$.public.backendHost}/trabajadorAutorizado/filter/${l}/${a}`,{method:"POST",headers:{Authorization:f,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(L)})).json();k.value=Array.isArray(U.data)?U.data.map(X=>({...X,contratosAsociados:Array.isArray(X.contratos)?X.contratos.length:0})):[],M.value=((c=U.pagination)==null?void 0:c.total)||0}catch{k.value=[],M.value=0}finally{p.value=!1}},re=l=>{z.value=l,J(l)},u=l=>{h.value=l,s.value=!1,n.value=!0,O.value=!0};fe(()=>{J(),ee()});const t=async l=>{try{const a=localStorage.getItem("token"),c=K(),f=s.value?`${c.public.backendHost}/trabajadorAutorizado/UpdateTrabajadorAutorizado/${h.value.id_trabajador_autorizado}`:`${c.public.backendHost}/trabajadorAutorizado/createTrabajadorAutorizado`,$=await fetch(f,{method:s.value?"PUT":"POST",headers:{"Content-Type":"application/json",Authorization:a,Accept:"application/json"},body:JSON.stringify(l)});if($.status===401){r.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{q("/")},3e3);return}if($.status===403){r.value={title:"Acceso Denegado",description:"No tienes permisos para realizar esta acción o acceder a esta información.",type:"error"};return}if($.status===400||$.status===500){const L=await $.json();L.error?r.value={title:`Errores de validación: ${$.status}`,description:L.message,type:"error"}:r.value={title:`Error: ${$.status}`,description:JSON.stringify(L),type:"error"};return}$.ok?(s.value?r.value={title:`Trabajador Actualizado: ${$.status}`,description:`El trabajador ${l.nombre} se actualizó con éxito`,type:"success"}:r.value={title:`Trabajador Creado: ${$.status}`,description:`El trabajador ${l.nombre} se creó con éxito`,type:"success"},await J(z.value,N.value),O.value=!1,h.value=null,s.value=!1,n.value=!1):console.error("Error al guardar el trabajador")}catch(a){console.error("Error:",a),r.value={title:"Error",description:a.message,type:"error"}}},o=l=>{let a=l.target.value.replace(/\D/g,"");a.length>11&&(a=a.slice(0,11)),d.value=a},v=()=>{h.value=null,s.value=!1,n.value=!1,O.value=!0},S=l=>{console.log("Guardando asociaciones:",l),H.value=!1,J()};async function E(){if(Z.value=!1,!!W.value)try{const l=localStorage.getItem("token"),a=K(),c=await fetch(`${a.public.backendHost}/trabajadorAutorizado/DeleteTrabajadorAutorizado/${W.value.id_trabajador_autorizado}`,{method:"DELETE",headers:{Authorization:l,Accept:"application/json"}});if(c.status===401){r.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{q("/")},3e3);return}if(c.status===403){r.value={title:"Acceso Denegado",description:"No tienes permisos para realizar esta acción o acceder a esta información.",type:"error"};return}if(!c.ok){const f=await c.json();r.value={title:`Error al eliminar: ${c.status}`,description:f.message||JSON.stringify(f),type:"error"};return}r.value={title:"Trabajador eliminado",description:"El trabajador fue eliminado correctamente",type:"success"},await J(z.value,N.value)}catch(l){r.value={title:"Error",description:l.message,type:"error"}}finally{W.value=null}}const A=async()=>{try{p.value=!0,await J(1,N.value)}catch(l){console.error("Error al buscar trabajadores:",l)}finally{p.value=!1}};async function P(){r.value={title:"Consultando datos",description:"Se están consultando los datos, la descarga comenzará en breve.",type:"info"};try{const l=localStorage.getItem("token"),a=K(),c={nombre:_.value,cargo:F.value,carnet_identidad:d.value,id_entidad:D.value,funcion:T.value},f=await fetch(`${a.public.backendHost}/trabajadorAutorizado/filter/1/${M.value}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:l,Accept:"application/json"},body:JSON.stringify(c)});if(f.status===401){r.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{q("/")},3e3);return}if(f.status===403){r.value={title:"Acceso Denegado",description:"No tienes permisos para realizar esta acción o acceder a esta información.",type:"error"};return}if(!f.ok){const w=await f.json();r.value={title:"Error al consultar datos",description:w.error||"Ocurrió un error al consultar los datos.",type:"error"};return}const L=(await f.json()).data.map(w=>({Nombre:w.nombre,Cargo:w.cargo,"Carnet de Identidad":w.carnet_identidad,Teléfono:w.num_telefono,Función:w.funcion,"Contratos Asociados":Array.isArray(w.contratos)?w.contratos.length:0})),se=oe.json_to_sheet(L),U=oe.book_new();oe.book_append_sheet(U,se,"Trabajadores");const X=new Date().toISOString().split("T")[0];ge(U,`trabajadores_${X}.xlsx`),r.value=null}catch(l){console.error("Error al exportar a Excel:",l),r.value={title:"Error",description:"Ocurrió un error al exportar los datos.",type:"error"}}}async function Y(){r.value={title:"Consultando datos",description:"Se están consultando los datos, la descarga comenzará en breve.",type:"info"};try{const l=localStorage.getItem("token"),a=K(),c={nombre:_.value,cargo:F.value,carnet_identidad:d.value,id_entidad:D.value,funcion:T.value},f=await fetch(`${a.public.backendHost}/trabajadorAutorizado/filter/1/${M.value}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:l,Accept:"application/json"},body:JSON.stringify(c)});if(f.status===401){r.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{q("/")},3e3);return}if(f.status===403){r.value={title:"Acceso Denegado",description:"No tienes permisos para realizar esta acción o acceder a esta información.",type:"error"};return}if(!f.ok){const w=await f.json();r.value={title:"Error al consultar datos",description:w.error||"Ocurrió un error al consultar los datos.",type:"error"};return}const $=await f.json(),L=[];$.data.forEach(w=>{Array.isArray(w.contratos)&&w.contratos.forEach(m=>{L.push({"Nombre Trabajador":w.nombre,"Cargo Trabajador":w.cargo,"Función Trabajador":w.funcion,"Carnet Identidad":w.carnet_identidad,"Teléfono Trabajador":w.num_telefono,"ID Contrato":m.id_contrato,"Número Consecutivo":m.num_consecutivo,"Fecha Inicio":m.fecha_inicio?new Date(m.fecha_inicio).toLocaleDateString("es-ES"):"","Fecha Fin":m.fecha_fin?new Date(m.fecha_fin).toLocaleDateString("es-ES"):"",Clasificación:m.clasificacion,Nota:m.nota,"Cliente/Proveedor":m.ClienteOProveedor,"Vigencia Facturas (Días)":m.vigenciaFacturasDias,"Tipo Contrato":m.tipoContrato?m.tipoContrato.nombre:"",Entidad:m.entidad?m.entidad.nombre:"","Dirección Entidad":m.entidad?m.entidad.direccion:"","Teléfono Entidad":m.entidad?m.entidad.telefono:"","Email Entidad":m.entidad?m.entidad.email:"",Organismo:m.entidad?m.entidad.organismo:"","Tipo Entidad":m.entidad?m.entidad.tipo_entidad:"","Código REO":m.entidad?m.entidad.codigo_reo:"","Código NIT":m.entidad?m.entidad.codigo_nit:""})})});const se=oe.json_to_sheet(L),U=oe.book_new();oe.book_append_sheet(U,se,"Trabajadores con Contratos");const X=new Date().toISOString().split("T")[0];ge(U,`trabajadores_contratos_${X}.xlsx`),r.value=null}catch(l){console.error("Error al exportar a Excel con contratos:",l),r.value={title:"Error",description:"Ocurrió un error al exportar los datos.",type:"error"}}}return(l,a)=>(x(),y("div",St,[V(ke,{title:"Trabajadores - Contract Manager",description:"Registra y gestiona trabajadores autorizados y sus contratos.",canonical:"/trabajadores"}),V(Ce),r.value?(x(),y("div",Et,[V(ce,{title:r.value.title,description:r.value.description,type:r.value.type,onClose:a[0]||(a[0]=c=>r.value=null),class:"pointer-events-auto"},null,8,["title","description","type"])])):B("",!0),Z.value?(x(),y("div",At,[V(je,{title:"¿Estás seguro que deseas eliminar este trabajador?",description:"Esta acción no se puede deshacer.",type:"warning",onConfirm:E,onClose:a[1]||(a[1]=c=>Z.value=!1)})])):B("",!0),e("div",$t,[e("div",Vt,[e("div",zt,[e("div",null,[a[10]||(a[10]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Buscar por nombre",-1)),e("div",It,[G(e("input",{type:"text","onUpdate:modelValue":a[2]||(a[2]=c=>_.value=c),placeholder:"Ingrese el nombre...",class:"w-full pl-10 pr-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary",onKeyup:de(A,["enter"])},null,544),[[R,_.value]]),a[9]||(a[9]=e("div",{class:"absolute left-3 top-2.5"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))])]),e("div",null,[a[11]||(a[11]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Buscar por cargo",-1)),G(e("input",{type:"text","onUpdate:modelValue":a[3]||(a[3]=c=>F.value=c),placeholder:"Ingrese el cargo...",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary",onKeyup:de(A,["enter"])},null,544),[[R,F.value]])]),e("div",null,[a[12]||(a[12]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Carnet de Identidad",-1)),G(e("input",{type:"text","onUpdate:modelValue":a[4]||(a[4]=c=>d.value=c),placeholder:"Carnet de identidad...",maxlength:"11",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",onInput:o,onKeyup:de(A,["enter"])},null,544),[[R,d.value]])]),e("div",null,[a[13]||(a[13]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Entidad",-1)),V(ae,{modelValue:D.value,"onUpdate:modelValue":a[5]||(a[5]=c=>D.value=c),options:j.value,labelKey:"nombre",valueKey:"id_entidad",placeholder:"Buscar entidad..."},null,8,["modelValue","options"])]),e("div",null,[a[14]||(a[14]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Función",-1)),V(ae,{modelValue:T.value,"onUpdate:modelValue":a[6]||(a[6]=c=>T.value=c),options:b.value,labelKey:"label",valueKey:"value",placeholder:"Seleccionar función..."},null,8,["modelValue","options"])])]),e("div",{class:"flex justify-end mt-4 gap-2 flex-wrap"},[e("button",{onClick:A,class:"px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors"}," Buscar "),e("button",{onClick:P,class:"px-6 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition-colors flex items-center"},[...a[15]||(a[15]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 5a2 2 0 012-2h4a2 2 0 012 2v2H8V5z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 12h2v2H7v-2zM11 12h2v2h-2v-2zM15 12h2v2h-2v-2z"})],-1),Q(" Exportar a Excel ",-1)])]),e("button",{onClick:Y,class:"px-6 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition-colors flex items-center"},[...a[16]||(a[16]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 5a2 2 0 012-2h4a2 2 0 012 2v2H8V5z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 12h2v2H7v-2zM11 12h2v2h-2v-2zM15 12h2v2h-2v-2z"})],-1),Q(" Exportar a Excel con Contratos ",-1)])])])])]),e("div",Dt,[e("div",{class:"flex justify-between items-center mb-4"},[a[18]||(a[18]=e("h2",{class:"text-2xl font-bold"},"Trabajadores Autorizados",-1)),e("button",{onClick:v,class:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 flex items-center"},[...a[17]||(a[17]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),Q(" Nuevo Trabajador ",-1)])])]),V(be,{columns:ne,items:k.value,actions:le,"total-items":M.value,"items-per-page":N.value,"current-page":z.value,"is-loading":p.value,onPageChange:re,onRowClick:u},null,8,["items","total-items","items-per-page","current-page","is-loading"])]),V(Ke,{modelValue:O.value,"onUpdate:modelValue":a[7]||(a[7]=c=>O.value=c),trabajador:h.value,"is-editing":s.value,"is-viewing":n.value,onSubmit:t},null,8,["modelValue","trabajador","is-editing","is-viewing"]),V(Tt,{modelValue:H.value,"onUpdate:modelValue":a[8]||(a[8]=c=>H.value=c),trabajador:h.value,entidades:j.value,onSaveAssociations:S},null,8,["modelValue","trabajador","entidades"])]))}};export{Kt as default};
